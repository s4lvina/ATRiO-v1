import{r as a,C as pe,f as Oe,u as Le,d as Ve,D as Pe,j as e,B,e as Be,a as Ue,E as Ne,F as Ye,H as Ze,h as Ke,J as Je,K as Qe,g as Xe,b as es,M as ss,N as ze,x as ts,O as rs,l as os,z as L,R as ns,v as is,G as I,T as De,m as te,L as as,A as ls,t as cs,o as ge,n as p,w as T,Q as Ae,U as xe,V as Re,W as ke,S as Fe}from"./index-B9r5cl9W.js";import{u as ds,M as y,q as Te}from"./index-CYMPojJR.js";import{g as us,u as Ge,d as hs,a as ms,c as ps}from"./casosApi-BKSmOZmE.js";import{u as gs,I as U,a as xs,b as fe}from"./use-form-BuTX-yjt.js";import{I as fs}from"./IconSearch-DHaK-uKX.js";import{g as Cs,I as bs,T as js}from"./IconPlus-Bn3VW0f2.js";import{T as Ce}from"./ThemeIcon-CWZr28Bc.js";import{T as j,S as Se}from"./Table-D9CHl7vx.js";import{S as $e}from"./SimpleGrid-D2l_HKT_.js";import{C as Me}from"./Card-CcdvnKuo.js";import{D as vs}from"./Divider-tgUTFFpg.js";import{N as _s}from"./NumberInput-BP-pjfXT.js";import"./Checkbox-B2UTVamD.js";import"./Pagination-vgEYL1ab.js";function Is(r,t){if(r===t||Number.isNaN(r)&&Number.isNaN(t))return!0;if(!(r instanceof Object)||!(t instanceof Object))return!1;const n=Object.keys(r),{length:g}=n;if(g!==Object.keys(t).length)return!1;for(let u=0;u<g;u+=1){const x=n[u];if(!(x in t)||r[x]!==t[x]&&!(Number.isNaN(r[x])&&Number.isNaN(t[x])))return!1}return!0}function Ds(r,t){if(!r||!t)return!1;if(r===t)return!0;if(r.length!==t.length)return!1;for(let n=0;n<r.length;n+=1)if(!Is(r[n],t[n]))return!1;return!0}function Ss(r){const t=a.useRef([]),n=a.useRef(0);return Ds(t.current,r)||(t.current=r,n.current+=1),[n.current]}function ys(r,t){a.useEffect(r,Ss(t))}function Es(r,t,n){const g=a.useRef(null),u=a.useRef(null);return a.useEffect(()=>{const x=typeof n=="function"?n():n;return(x||u.current)&&(g.current=new MutationObserver(r),g.current.observe(x||u.current,t)),()=>{var A;(A=g.current)==null||A.disconnect()}},[r,t]),u}function ws(){const[r,t]=a.useState(!1);return a.useEffect(()=>t(!0),[]),r}function Ns(r,t){if(!t||!r)return!1;let n=t.parentNode;for(;n!=null;){if(n===r)return!0;n=n.parentNode}return!1}function zs({target:r,parent:t,ref:n,displayAfterTransitionEnd:g}){const u=a.useRef(-1),[x,A]=a.useState(!1),[W,H]=a.useState(typeof g=="boolean"?g:!1),E=()=>{if(!r||!t||!n.current)return;const f=r.getBoundingClientRect(),h=t.getBoundingClientRect(),R=window.getComputedStyle(r),$=window.getComputedStyle(t),q=pe(R.borderTopWidth)+pe($.borderTopWidth),w=pe(R.borderLeftWidth)+pe($.borderLeftWidth),M={top:f.top-h.top-q,left:f.left-h.left-w,width:f.width,height:f.height};n.current.style.transform=`translateY(${M.top}px) translateX(${M.left}px)`,n.current.style.width=`${M.width}px`,n.current.style.height=`${M.height}px`},G=()=>{window.clearTimeout(u.current),n.current&&(n.current.style.transitionDuration="0ms"),E(),u.current=window.setTimeout(()=>{n.current&&(n.current.style.transitionDuration="")},30)},V=a.useRef(null),v=a.useRef(null);return a.useEffect(()=>{if(E(),r)return V.current=new ResizeObserver(G),V.current.observe(r),t&&(v.current=new ResizeObserver(G),v.current.observe(t)),()=>{var f,h;(f=V.current)==null||f.disconnect(),(h=v.current)==null||h.disconnect()}},[t,r]),a.useEffect(()=>{if(t){const f=h=>{Ns(h.target,t)&&(G(),H(!1))};return t.addEventListener("transitionend",f),()=>{t.removeEventListener("transitionend",f)}}},[t]),ds(()=>{Cs()!=="test"&&A(!0)},20,{autoInvoke:!0}),Es(f=>{f.forEach(h=>{h.type==="attributes"&&h.attributeName==="dir"&&G()})},{attributes:!0,attributeFilter:["dir"]},()=>document.documentElement),{initialized:x,hidden:W}}var We={root:"m_96b553a6"};const As={},Rs=Be((r,{transitionDuration:t})=>({root:{"--transition-duration":typeof t=="number"?`${t}ms`:t}})),ye=Oe((r,t)=>{const n=Le("FloatingIndicator",As,r),{classNames:g,className:u,style:x,styles:A,unstyled:W,vars:H,target:E,parent:G,transitionDuration:V,mod:v,displayAfterTransitionEnd:f,...h}=n,R=Ve({name:"FloatingIndicator",classes:We,props:n,className:u,style:x,classNames:g,styles:A,unstyled:W,vars:H,varsResolver:Rs}),$=a.useRef(null),{initialized:q,hidden:w}=zs({target:E,parent:G,ref:$,displayAfterTransitionEnd:f}),M=Pe(t,$);return!E||!G?null:e.jsx(B,{ref:M,mod:[{initialized:q,hidden:w},v],...R("root"),...h})});ye.displayName="@mantine/core/FloatingIndicator";ye.classes=We;var He={root:"m_cf365364",indicator:"m_9e182ccd",label:"m_1738fcb2",input:"m_1714d588",control:"m_69686b9b",innerLabel:"m_78882f40"};const ks={withItemsBorders:!0},Fs=Be((r,{radius:t,color:n,transitionDuration:g,size:u,transitionTimingFunction:x})=>({root:{"--sc-radius":t===void 0?void 0:es(t),"--sc-color":n?Xe(n,r):void 0,"--sc-shadow":n?void 0:"var(--mantine-shadow-xs)","--sc-transition-duration":g===void 0?void 0:`${g}ms`,"--sc-transition-timing-function":x,"--sc-padding":Qe(u,"sc-padding"),"--sc-font-size":Je(u)}})),Ee=Oe((r,t)=>{var ae,se;const n=Le("SegmentedControl",ks,r),{classNames:g,className:u,style:x,styles:A,unstyled:W,vars:H,data:E,value:G,defaultValue:V,onChange:v,size:f,name:h,disabled:R,readOnly:$,fullWidth:q,orientation:w,radius:M,color:re,transitionDuration:je,transitionTimingFunction:oe,variant:o,autoContrast:P,withItemsBorders:ne,mod:de,...ue}=n,O=Ve({name:"SegmentedControl",props:n,classes:He,className:u,style:x,classNames:g,styles:A,unstyled:W,vars:H,varsResolver:Fs}),he=Ue(),Z=E.map(c=>typeof c=="string"?{label:c,value:c}:c),ve=ws(),[_,k]=a.useState(Ne()),[m,Q]=a.useState(null),[ie,_e]=a.useState({}),X=(c,le)=>{ie[le]=c,_e(ie)},[K,me]=Ye({value:G,defaultValue:V,finalValue:Array.isArray(E)?((ae=Z.find(c=>!c.disabled))==null?void 0:ae.value)??((se=E[0])==null?void 0:se.value)??null:null,onChange:v}),ee=Ze(h),J=Z.map(c=>a.createElement(B,{...O("control"),mod:{active:K===c.value,orientation:w},key:c.value},a.createElement("input",{...O("input"),disabled:R||c.disabled,type:"radio",name:ee,value:c.value,id:`${ee}-${c.value}`,checked:K===c.value,onChange:()=>!$&&me(c.value),"data-focus-ring":he.focusRing,key:`${c.value}-input`}),a.createElement(B,{component:"label",...O("label"),mod:{active:K===c.value&&!(R||c.disabled),disabled:R||c.disabled,"read-only":$},htmlFor:`${ee}-${c.value}`,ref:le=>X(le,c.value),__vars:{"--sc-label-color":re!==void 0?Ke({color:re,theme:he,autoContrast:P}):void 0},key:`${c.value}-label`},e.jsx("span",{...O("innerLabel"),children:c.label})))),Ie=Pe(t,c=>Q(c));return ys(()=>{k(Ne())},[E.length]),E.length===0?null:e.jsxs(B,{...O("root"),variant:o,size:f,ref:Ie,mod:[{"full-width":q,orientation:w,initialized:ve,"with-items-borders":ne},de],...ue,role:"radiogroup","data-disabled":R,children:[typeof K=="string"&&e.jsx(ye,{target:ie[K],parent:m,component:"span",transitionDuration:"var(--sc-transition-duration)",...O("indicator")},_),J]})});Ee.classes=He;Ee.displayName="@mantine/core/SegmentedControl";/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Y=ss("outline","sort-descending","IconSortDescending",[["path",{d:"M4 6l9 0",key:"svg-0"}],["path",{d:"M4 12l7 0",key:"svg-1"}],["path",{d:"M4 18l7 0",key:"svg-2"}],["path",{d:"M15 15l3 3l3 -3",key:"svg-3"}],["path",{d:"M18 6l0 12",key:"svg-4"}]]);const be=["En Análisis","Nuevo","Esperando Archivos","Pendiente Informe","Cerrada"];function D(r){switch(r){case"Nuevo":return"#0E1049";case"Pendiente Informe":return"#2F4550";case"Esperando Archivos":return"#586F7C";case"En Análisis":return"#B8DBD9";case"Cerrada":return"#F4F4F9";default:return"#D3D3D3"}}function Zs(){var we;const[r,t]=a.useState([]),[n,g]=a.useState(!0),[u,x]=a.useState(null),[A,{open:W,close:H}]=ze(!1),[E,{open:G,close:V}]=ze(!1),[v,f]=a.useState(null),[h,R]=a.useState(null),[$,q]=a.useState(null),[w,M]=a.useState(null),[re,je]=a.useState(null),oe=ts(),{user:o}=rs(),[P,ne]=a.useState([]),[de,ue]=a.useState(!1),[O,he]=a.useState("table"),[Z,ve]=a.useState(""),[_,k]=a.useState({columnAccessor:"Fecha_de_Creacion",direction:"desc"}),m=gs({initialValues:{Nombre_del_Caso:"",Año:new Date().getFullYear(),Descripcion:"",NIV:"",ID_Grupo:""},validate:{Nombre_del_Caso:s=>s.trim().length>0?null:"El nombre del caso es obligatorio",Año:s=>s>1900&&s<=new Date().getFullYear()+1?null:"Introduce un año válido",ID_Grupo:(s,l)=>(o==null?void 0:o.Rol)==="superadmin"&&(!s||s.trim()===""||isNaN(Number(s)))?"Debe seleccionar un grupo para el caso":null}});a.useEffect(()=>{Q(),(o==null?void 0:o.Rol)==="superadmin"&&ie()},[o==null?void 0:o.Rol]);const Q=async()=>{g(!0),x(null);try{const l=[...await us()].sort((i,d)=>{const C=be.indexOf(i.Estado),b=be.indexOf(d.Estado);return C-b});t(l)}catch(s){x("Error al cargar los casos. Inténtalo de nuevo."),console.error(s)}finally{g(!1)}},ie=async()=>{var s,l;if((o==null?void 0:o.Rol)!=="superadmin"){ne([]);return}ue(!0);try{const i=await os.get("/api/grupos");ne(i.data)}catch(i){console.error("Error fetching grupos:",i),L.show({title:"Error al cargar grupos",message:((l=(s=i.response)==null?void 0:s.data)==null?void 0:l.detail)||i.message||"No se pudieron obtener los grupos para el superadmin.",color:"red"}),ne([])}finally{ue(!1)}};ns.useEffect(()=>{(o==null?void 0:o.Rol)==="superadmin"&&A&&!w&&P.length>0&&(!m.values.ID_Grupo||m.values.ID_Grupo.trim()==="")&&m.setFieldValue("ID_Grupo",String(P[0].ID_Grupo))},[o==null?void 0:o.Rol,A,w,P,m]);const _e=async s=>{var l;try{const i=(o==null?void 0:o.Rol)==="superadmin"?s.ID_Grupo?Number(s.ID_Grupo):void 0:(l=o==null?void 0:o.grupo)==null?void 0:l.ID_Grupo;if(i==null||isNaN(i)){L.show({title:"Error",message:"El grupo asignado no es válido.",color:"red"});return}const d={Nombre_del_Caso:s.Nombre_del_Caso,Año:Number(s.Año)||0,NIV:s.NIV,Descripcion:s.Descripcion,ID_Grupo:i};console.log("Enviando caso para crear:",d),await ps(d),L.show({title:"Caso Creado",message:`El caso "${s.Nombre_del_Caso}" ha sido creado exitosamente.`,color:"green"}),m.reset(),H(),Q()}catch(i){let d="Error al crear el caso.";i.response&&i.response.data&&i.response.data.detail&&(d=`${d} ${i.response.data.detail}`),L.show({title:"Error",message:d,color:"red"})}},X=async s=>{f(s),G()},K=async()=>{var s,l;if(v){R(v);try{await hs(v),L.show({title:"Caso Eliminado",message:`El caso ID ${v} y todos sus datos asociados han sido eliminados correctamente.`,color:"teal"}),t(i=>i.filter(d=>d.ID_Caso!==v))}catch(i){console.error("Error al eliminar caso:",i);let d=((l=(s=i.response)==null?void 0:s.data)==null?void 0:l.detail)||i.message||"No se pudo eliminar el caso.";L.show({title:"Error al Eliminar",message:d,color:"red"})}finally{R(null),V(),f(null)}}},me=async(s,l)=>{var d;if(!l)return;q(s);const i=(d=r.find(C=>C.ID_Caso===s))==null?void 0:d.Estado;t(C=>C.map(b=>b.ID_Caso===s?{...b,Estado:l}:b));try{await Ge(s,l)}catch{L.show({title:"Error al Actualizar Estado",message:`No se pudo actualizar el estado del caso ${s}. Revirtiendo cambio.`,color:"red"}),t(b=>b.map(ce=>ce.ID_Caso===s?{...ce,Estado:i||"Nuevo"}:ce))}finally{q(null)}},ee=async s=>{je(s);try{await Ge(s,"Nuevo"),L.show({title:"Caso Reactivado",message:"El caso ha sido reactivado exitosamente.",color:"green"}),Q()}catch{L.show({title:"Error al Reactivar",message:"No se pudo reactivar el caso.",color:"red"})}finally{je(null)}},J=a.useMemo(()=>{let s=r;if(Z.trim()){const S=Z.toLowerCase().trim();s=r.filter(F=>F.Nombre_del_Caso.toLowerCase().includes(S)||String(F.Año).includes(S)||F.NIV&&F.NIV.toLowerCase().includes(S)||F.Descripcion&&F.Descripcion.toLowerCase().includes(S))}const l=s.filter(S=>S.Estado!=="Cerrada"),i=s.filter(S=>S.Estado==="Cerrada"),d=_.columnAccessor,C=_.direction,b=(S,F)=>S[F],ce=[...l].sort((S,F)=>{const N=b(S,d),z=b(F,d);return N==null?1:z==null?-1:typeof N=="number"&&typeof z=="number"?C==="asc"?N-z:z-N:C==="asc"?String(N).localeCompare(String(z)):String(z).localeCompare(String(N))}),qe=[...i].sort((S,F)=>{const N=b(S,d),z=b(F,d);return N==null?1:z==null?-1:typeof N=="number"&&typeof z=="number"?C==="asc"?N-z:z-N:C==="asc"?String(N).localeCompare(String(z)):String(z).localeCompare(String(N))});return{active:ce,closed:qe}},[r,Z,_]),Ie=()=>{m.reset(),M(null),(o==null?void 0:o.Rol)==="superadmin"&&P.length>0&&m.setFieldValue("ID_Grupo",String(P[0].ID_Grupo)),W()},ae=s=>{M(s.ID_Caso),m.setValues({Nombre_del_Caso:s.Nombre_del_Caso,Año:s.Año,Descripcion:s.Descripcion||"",NIV:s.NIV||"",ID_Grupo:(o==null?void 0:o.Rol)==="superadmin"&&s.ID_Grupo!==void 0&&s.ID_Grupo!==null?String(s.ID_Grupo):""}),W()},se=()=>{m.reset(),M(null),H()},c=async(s,l)=>{const i=(o==null?void 0:o.Rol)==="superadmin"&&l.ID_Grupo?Number(l.ID_Grupo):void 0,d={Nombre_del_Caso:l.Nombre_del_Caso,Año:Number(l.Año)||0,NIV:l.NIV,Descripcion:l.Descripcion};(o==null?void 0:o.Rol)==="superadmin"&&i!==void 0&&!isNaN(i)&&(d.ID_Grupo=i),console.log("Enviando caso para actualizar:",d);try{await ms(s,d),L.show({title:"Caso Actualizado",message:`El caso "${l.Nombre_del_Caso}" ha sido actualizado.`,color:"blue"}),se(),Q()}catch(C){let b="Error al actualizar el caso.";C.response&&C.response.data&&C.response.data.detail&&(b=`${b} ${C.response.data.detail}`),L.show({title:"Error",message:b,color:"red"})}},le=async s=>{w?await c(w,s):await _e(s)};return e.jsxs(B,{style:{paddingLeft:32,paddingRight:32,paddingBottom:0,marginBottom:0},children:[e.jsx(is,{order:2,mb:"xl",children:"Investigaciones"}),e.jsxs(I,{justify:"space-between",mb:"lg",children:[e.jsxs(I,{children:[e.jsx(De,{placeholder:"Buscar por nombre, año, NIV, descripción...",leftSection:e.jsx(fs,{size:14}),value:Z,onChange:s=>ve(s.currentTarget.value),style:{width:"400px"}}),e.jsx(Ee,{value:O,onChange:s=>he(s),data:[{label:"Tabla",value:"table"},{label:"Grid",value:"grid"}]})]}),e.jsxs(I,{children:[O==="grid"&&e.jsxs(y,{shadow:"md",width:200,children:[e.jsx(y.Target,{children:e.jsx(te,{variant:"light",leftSection:_.columnAccessor==="Nombre_del_Caso"?_.direction==="asc"?e.jsx(U,{size:16}):e.jsx(Y,{size:16}):_.columnAccessor==="Fecha_de_Creacion"?_.direction==="asc"?e.jsx(U,{size:16}):e.jsx(Y,{size:16}):_.columnAccessor==="Año"?_.direction==="asc"?e.jsx(U,{size:16}):e.jsx(Y,{size:16}):_.columnAccessor==="Estado"?_.direction==="asc"?e.jsx(U,{size:16}):e.jsx(Y,{size:16}):e.jsx(xs,{size:16}),children:"Ordenar por"})}),e.jsxs(y.Dropdown,{children:[e.jsx(y.Item,{leftSection:e.jsx(U,{size:16}),onClick:()=>k({columnAccessor:"Nombre_del_Caso",direction:"asc"}),children:"Nombre (A-Z)"}),e.jsx(y.Item,{leftSection:e.jsx(Y,{size:16}),onClick:()=>k({columnAccessor:"Nombre_del_Caso",direction:"desc"}),children:"Nombre (Z-A)"}),e.jsx(y.Divider,{}),e.jsx(y.Item,{leftSection:e.jsx(U,{size:16}),onClick:()=>k({columnAccessor:"Fecha_de_Creacion",direction:"asc"}),children:"Fecha (Antiguo-Nuevo)"}),e.jsx(y.Item,{leftSection:e.jsx(Y,{size:16}),onClick:()=>k({columnAccessor:"Fecha_de_Creacion",direction:"desc"}),children:"Fecha (Nuevo-Antiguo)"}),e.jsx(y.Divider,{}),e.jsx(y.Item,{leftSection:e.jsx(U,{size:16}),onClick:()=>k({columnAccessor:"Año",direction:"asc"}),children:"Año (Ascendente)"}),e.jsx(y.Item,{leftSection:e.jsx(Y,{size:16}),onClick:()=>k({columnAccessor:"Año",direction:"desc"}),children:"Año (Descendente)"}),e.jsx(y.Divider,{}),e.jsx(y.Item,{leftSection:e.jsx(U,{size:16}),onClick:()=>k({columnAccessor:"Estado",direction:"asc"}),children:"Estado (A-Z)"}),e.jsx(y.Item,{leftSection:e.jsx(Y,{size:16}),onClick:()=>k({columnAccessor:"Estado",direction:"desc"}),children:"Estado (Z-A)"})]})]}),e.jsx(te,{leftSection:e.jsx(bs,{size:14}),onClick:Ie,children:"Crear Nuevo Caso"})]})]}),n&&e.jsx(as,{}),u&&e.jsx(ls,{title:"Error",color:"red",icon:e.jsx(cs,{}),children:u}),!n&&!u&&e.jsxs(e.Fragment,{children:[O==="table"?e.jsx(Te,{withTableBorder:!0,striped:!0,highlightOnHover:!0,verticalSpacing:"md",rowStyle:s=>({borderLeft:`6px solid ${D(s.Estado)}`,background:"var(--mantine-color-gray-0)",minHeight:64,marginBottom:12,borderRadius:10,boxShadow:"0 2px 8px rgba(0,0,0,0.03)"}),records:J.active,columns:[{accessor:"Nombre_del_Caso",title:"Nombre del Caso",sortable:!0,width:260,render:s=>e.jsxs(I,{align:"flex-start",gap:"md",children:[e.jsx(Ce,{color:D(s.Estado),size:38,radius:"xl",style:{background:D(s.Estado)},children:e.jsx(ge,{size:22})}),e.jsxs(B,{children:[e.jsx(p,{size:"lg",fw:700,style:{lineHeight:1.1},children:s.Nombre_del_Caso}),e.jsxs(p,{size:"sm",c:"dimmed",mt:2,children:["Año: ",e.jsx("b",{children:s.Año}),"  |  NIV: ",e.jsx("b",{children:s.NIV||"-"})]})]})]})},{accessor:"Año",title:"Año",sortable:!0,width:90,render:s=>e.jsx(p,{size:"md",children:s.Año})},{accessor:"Fecha_de_Creacion",title:"Fecha de Creación",sortable:!0,width:160,render:s=>e.jsx(p,{size:"sm",children:new Date(s.Fecha_de_Creacion).toLocaleDateString()})},{accessor:"Descripcion",title:"Descripción",sortable:!0,width:280,render:s=>e.jsx(j,{label:s.Descripcion||"Sin descripción",multiline:!0,w:300,children:e.jsx(p,{lineClamp:2,style:{maxWidth:200},children:s.Descripcion||"Sin descripción"})})},{accessor:"Estado",title:"Estado",sortable:!0,width:180,render:s=>{const l=D(s.Estado);return e.jsx(Se,{size:"xs",data:be.map(i=>({key:i,value:i,label:i})),value:s.Estado,onChange:i=>me(s.ID_Caso,i),disabled:$===s.ID_Caso,styles:{input:{borderColor:l,backgroundColor:l,color:"white",fontWeight:500}}})}},{accessor:"actions",title:"Acciones",width:120,render:s=>e.jsxs(I,{gap:"xs",children:[e.jsx(j,{label:"Ver Detalles",children:e.jsx(T,{variant:"light",color:"blue",onClick:()=>oe(`/casos/${s.ID_Caso}`),size:"lg",children:e.jsx(fe,{size:20})})}),e.jsx(j,{label:"Editar Caso",children:e.jsx(T,{variant:"light",color:"gray",onClick:()=>ae(s),size:"lg",children:e.jsx(Ae,{size:20})})}),e.jsx(j,{label:"Eliminar Caso",children:e.jsx(T,{variant:"light",color:"red",onClick:()=>X(s.ID_Caso),loading:h===s.ID_Caso,size:"lg",children:e.jsx(xe,{size:20})})})]})}],sortStatus:_,onSortStatusChange:k}):e.jsx($e,{cols:{base:1,sm:2,lg:3},spacing:"lg",children:J.active.map(s=>e.jsx(Me,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,style:{borderLeft:`6px solid ${D(s.Estado)}`,background:"var(--mantine-color-gray-0)"},children:e.jsxs(I,{align:"flex-start",gap:"md",children:[e.jsx(Ce,{color:D(s.Estado),size:38,radius:"xl",style:{background:D(s.Estado)},children:e.jsx(ge,{size:22})}),e.jsxs(B,{style:{flex:1},children:[e.jsx(p,{size:"lg",fw:700,style:{lineHeight:1.1},children:s.Nombre_del_Caso}),e.jsxs(p,{size:"sm",c:"dimmed",mt:2,children:["Año: ",e.jsx("b",{children:s.Año}),"  |  NIV: ",e.jsx("b",{children:s.NIV||"-"})]}),e.jsxs(p,{size:"sm",mt:4,children:["Fecha: ",new Date(s.Fecha_de_Creacion).toLocaleDateString()]}),e.jsx(j,{label:s.Descripcion||"Sin descripción",multiline:!0,w:300,children:e.jsx(p,{size:"sm",lineClamp:2,mt:4,children:s.Descripcion||"Sin descripción"})}),e.jsxs(I,{mt:"md",gap:"xs",children:[e.jsx(Se,{size:"xs",data:be.map(l=>({key:l,value:l,label:l})),value:s.Estado,onChange:l=>me(s.ID_Caso,l),disabled:$===s.ID_Caso,styles:{input:{borderColor:D(s.Estado),backgroundColor:D(s.Estado),color:"white",fontWeight:500}}}),e.jsxs(I,{gap:"xs",ml:"auto",children:[e.jsx(j,{label:"Ver Detalles",children:e.jsx(T,{variant:"light",color:"blue",onClick:()=>oe(`/casos/${s.ID_Caso}`),size:"lg",children:e.jsx(fe,{size:20})})}),e.jsx(j,{label:"Editar Caso",children:e.jsx(T,{variant:"light",color:"gray",onClick:()=>ae(s),size:"lg",children:e.jsx(Ae,{size:20})})}),e.jsx(j,{label:"Eliminar Caso",children:e.jsx(T,{variant:"light",color:"red",onClick:()=>X(s.ID_Caso),loading:h===s.ID_Caso,size:"lg",children:e.jsx(xe,{size:20})})})]})]})]})]})},s.ID_Caso))}),((we=J.closed)==null?void 0:we.length)>0&&e.jsxs(e.Fragment,{children:[e.jsx(vs,{label:"Casos Cerrados",labelPosition:"center",mt:"xl",mb:"md",styles:{label:{fontSize:"var(--mantine-font-size-sm)",fontWeight:500}}}),O==="table"?e.jsx(Te,{withTableBorder:!0,striped:!0,highlightOnHover:!0,verticalSpacing:"md",rowStyle:s=>({borderLeft:`6px solid ${D(s.Estado)}`,background:"var(--mantine-color-gray-0)",minHeight:64,marginBottom:12,borderRadius:10,boxShadow:"0 2px 8px rgba(0,0,0,0.03)"}),records:J.closed,columns:[{accessor:"Nombre_del_Caso",title:"Nombre del Caso",sortable:!0,width:260,render:s=>e.jsxs(I,{align:"flex-start",gap:"md",children:[e.jsx(Ce,{color:D(s.Estado),size:38,radius:"xl",style:{background:D(s.Estado)},children:e.jsx(ge,{size:22})}),e.jsxs(B,{children:[e.jsx(p,{size:"lg",fw:700,style:{lineHeight:1.1},children:s.Nombre_del_Caso}),e.jsxs(p,{size:"sm",c:"dimmed",mt:2,children:["Año: ",e.jsx("b",{children:s.Año}),"  |  NIV: ",e.jsx("b",{children:s.NIV||"-"})]})]})]})},{accessor:"Año",title:"Año",sortable:!0,width:90,render:s=>e.jsx(p,{size:"md",children:s.Año})},{accessor:"Fecha_de_Creacion",title:"Fecha de Creación",sortable:!0,width:160,render:s=>e.jsx(p,{size:"sm",children:new Date(s.Fecha_de_Creacion).toLocaleDateString()})},{accessor:"Descripcion",title:"Descripción",sortable:!0,width:280,render:s=>e.jsx(j,{label:s.Descripcion||"Sin descripción",multiline:!0,w:300,children:e.jsx(p,{lineClamp:2,style:{maxWidth:200},children:s.Descripcion||"Sin descripción"})})},{accessor:"actions",title:"Acciones",width:160,render:s=>e.jsxs(I,{gap:"xs",children:[e.jsx(j,{label:"Reactivar Caso",children:e.jsx(T,{variant:"light",color:"green",onClick:()=>ee(s.ID_Caso),loading:re===s.ID_Caso,size:"lg",children:e.jsx(Re,{size:20})})}),e.jsx(j,{label:"Ver Detalles",children:e.jsx(T,{variant:"light",color:"blue",onClick:()=>oe(`/casos/${s.ID_Caso}`),size:"lg",children:e.jsx(fe,{size:20})})}),e.jsx(j,{label:"Eliminar Caso",children:e.jsx(T,{variant:"light",color:"red",onClick:()=>X(s.ID_Caso),loading:h===s.ID_Caso,size:"lg",children:e.jsx(xe,{size:20})})})]})}],sortStatus:_,onSortStatusChange:k}):e.jsx($e,{cols:{base:1,sm:2,lg:3},spacing:"lg",children:J.closed.map(s=>e.jsx(Me,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,style:{borderLeft:`6px solid ${D(s.Estado)}`,background:"var(--mantine-color-gray-0)"},children:e.jsxs(I,{align:"flex-start",gap:"md",children:[e.jsx(Ce,{color:D(s.Estado),size:38,radius:"xl",style:{background:D(s.Estado)},children:e.jsx(ge,{size:22})}),e.jsxs(B,{style:{flex:1},children:[e.jsx(p,{size:"lg",fw:700,style:{lineHeight:1.1},children:s.Nombre_del_Caso}),e.jsxs(p,{size:"sm",c:"dimmed",mt:2,children:["Año: ",e.jsx("b",{children:s.Año}),"  |  NIV: ",e.jsx("b",{children:s.NIV||"-"})]}),e.jsxs(p,{size:"sm",mt:4,children:["Fecha: ",new Date(s.Fecha_de_Creacion).toLocaleDateString()]}),e.jsx(j,{label:s.Descripcion||"Sin descripción",multiline:!0,w:300,children:e.jsx(p,{size:"sm",lineClamp:2,mt:4,children:s.Descripcion||"Sin descripción"})}),e.jsx(I,{mt:"md",gap:"xs",children:e.jsxs(I,{gap:"xs",ml:"auto",children:[e.jsx(j,{label:"Reactivar Caso",children:e.jsx(T,{variant:"light",color:"green",onClick:()=>ee(s.ID_Caso),loading:re===s.ID_Caso,size:"lg",children:e.jsx(Re,{size:20})})}),e.jsx(j,{label:"Ver Detalles",children:e.jsx(T,{variant:"light",color:"blue",onClick:()=>oe(`/casos/${s.ID_Caso}`),size:"lg",children:e.jsx(fe,{size:20})})}),e.jsx(j,{label:"Eliminar Caso",children:e.jsx(T,{variant:"light",color:"red",onClick:()=>X(s.ID_Caso),loading:h===s.ID_Caso,size:"lg",children:e.jsx(xe,{size:20})})})]})})]})]})},s.ID_Caso))})]})]}),e.jsx(ke,{opened:A,onClose:se,title:w?"Editar Caso":"Crear Nuevo Caso",centered:!0,children:e.jsx("form",{onSubmit:m.onSubmit(le),children:e.jsxs(Fe,{children:[e.jsx(De,{required:!0,label:"Nombre del Caso",placeholder:"Ej: Investigación vehículo sospechoso",...m.getInputProps("Nombre_del_Caso")}),e.jsx(_s,{required:!0,label:"Año",placeholder:"Año del caso",min:1900,max:new Date().getFullYear()+1,...m.getInputProps("Año")}),e.jsx(De,{label:"NIV (Opcional)",placeholder:"Número de Investigación",...m.getInputProps("NIV")}),e.jsx(js,{label:"Descripción (Opcional)",placeholder:"Detalles relevantes sobre el caso",autosize:!0,minRows:2,...m.getInputProps("Descripcion")}),(o==null?void 0:o.Rol)==="superadmin"&&e.jsx(Se,{label:"Grupo",placeholder:"Selecciona un grupo",data:P.map(s=>({value:String(s.ID_Grupo),label:s.Nombre})),...m.getInputProps("ID_Grupo"),required:!0,searchable:!0,disabled:de||P.length===0}),e.jsxs(I,{justify:"flex-end",mt:"md",children:[e.jsx(te,{variant:"default",onClick:se,children:"Cancelar"}),e.jsx(te,{type:"submit",disabled:(o==null?void 0:o.Rol)==="superadmin"&&(de||P.length===0||!m.values.ID_Grupo||m.values.ID_Grupo.trim()==="")||!m.isValid(),children:w?"Guardar Cambios":"Crear Caso"})]})]})})}),e.jsx(ke,{opened:E,onClose:V,title:"Confirmar Eliminación",centered:!0,children:e.jsxs(Fe,{children:[e.jsxs(p,{children:["¿Estás SEGURO de que quieres eliminar el caso ID ",v,"?"]}),e.jsx(p,{c:"red",size:"sm",children:"¡ATENCIÓN! Esta acción eliminará permanentemente el caso, TODOS sus archivos importados y TODAS las lecturas asociadas. Esta acción NO se puede deshacer."}),e.jsxs(I,{justify:"flex-end",mt:"md",children:[e.jsx(te,{variant:"light",onClick:V,children:"Cancelar"}),e.jsx(te,{color:"red",onClick:K,loading:h===v,children:"Eliminar"})]})]})})]})}export{Zs as default};

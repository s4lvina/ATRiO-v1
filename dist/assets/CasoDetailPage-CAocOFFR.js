import{r as g,f as vf,u as Sc,d as jc,e as Lc,j as s,B as Ie,a2 as B1,a3 as N1,b as _f,K as yf,c as H1,a4 as G1,a5 as U1,F as V1,D as Z1,i as cc,g as W1,M as pt,W as Zr,G as X,m as Me,a6 as Y1,a7 as us,z as ie,w as We,Q as Cf,a8 as Sr,a9 as q1,S as ct,n as Y,$ as ch,aa as uh,v as Wt,U as Oa,V as Eo,O as X1,l as wt,p as Aa,ab as ds,R as Yr,A as Pa,T as Xe,P as zt,I as rr,q as fs,ac as wf,ad as kc,X as Gs,ae as bf,af as Mc,a as K1,o as J1,y as Sf,t as jf,ag as Q1,L as Lf,x as ey,ah as ty,s as ny,a1 as ry}from"./index-B9r5cl9W.js";import{b as ay}from"./casosApi-BKSmOZmE.js";import{I as uo,g as sy,d as iy}from"./archivosApi-BN2_ETYT.js";import{d as Tt,F as Wl,u as cr}from"./FileSaver.min-Bz-SbG9W.js";import{c as kf,l as Ic,d as Ec,e as Mf,f as oy,a as ly,M as If,T as Ef,b as Cr,L as an,h as cy}from"./leaflet-Cfx-CTIt.js";import{L as Ra}from"./LoadingOverlay-CxXc0-rV.js";import{c as Yl,T as ho,I as Af}from"./IconPlus-Bn3VW0f2.js";import{M as Pt,q as Ac}from"./index-CYMPojJR.js";import{u as nr,w as uy,a as uc}from"./xlsx-CwpDMyS9.js";import{u as dy,h as fo,I as po,a as go,A as hy,C as Pc,b as mo,D as fy,p as py,t as gy,c as my}from"./index-DptuRD17.js";import{C as wr}from"./Checkbox-B2UTVamD.js";import{T as In,a as se,S as $a}from"./Table-D9CHl7vx.js";import{M as da}from"./MultiSelect-MjVHzexh.js";import{S as xo}from"./SimpleGrid-D2l_HKT_.js";import{D as Ur}from"./Divider-tgUTFFpg.js";import{B as Mn}from"./Badge-0g_QzpBM.js";import{C as dc}from"./Card-CcdvnKuo.js";import{I as Pf}from"./IconInfoCircle-CeWkeBUc.js";import{I as ur}from"./IconSearch-DHaK-uKX.js";import{N as Vr}from"./NumberInput-BP-pjfXT.js";import{I as xy,u as vy,a as _y,b as yy}from"./use-form-BuTX-yjt.js";import{G as Ta}from"./Grid-yhenIOJ3.js";import{S as br,I as Tc}from"./IconEdit-OjoKMjxd.js";import{T as dh}from"./ThemeIcon-CWZr28Bc.js";import{I as hc}from"./IconDownload-CiLVSNyg.js";import{C as Cy}from"./Container-C6nDB0UF.js";import"./Pagination-vgEYL1ab.js";const wy={" ":"space",ArrowLeft:"arrowleft",ArrowRight:"arrowright",ArrowUp:"arrowup",ArrowDown:"arrowdown",Escape:"esc",Esc:"esc",Enter:"enter",Tab:"tab",Backspace:"backspace",Delete:"delete",Insert:"insert",Home:"home",End:"end",PageUp:"pageup",PageDown:"pagedown","+":"plus","-":"minus","*":"asterisk","/":"slash"};function Ui(t){const r=t.replace("Key","").toLowerCase();return wy[t]||r}function by(t){const r=t.toLowerCase().split("+").map(o=>o.trim()),a={alt:r.includes("alt"),ctrl:r.includes("ctrl"),meta:r.includes("meta"),mod:r.includes("mod"),shift:r.includes("shift"),plus:r.includes("[plus]")},l=["alt","ctrl","meta","shift","mod"],h=r.find(o=>!l.includes(o));return{...a,key:h==="[plus]"?"+":h}}function Sy(t,r,a){const{alt:l,ctrl:h,meta:o,mod:c,shift:d,key:f}=t,{altKey:m,ctrlKey:y,metaKey:_,shiftKey:S,key:b,code:T}=r;if(l!==m)return!1;if(c){if(!y&&!_)return!1}else if(h!==y||o!==_)return!1;return d!==S?!1:!!(f&&(a?Ui(T)===Ui(f):Ui(b??T)===Ui(f)))}function jy(t,r){return a=>Sy(by(t),a,r)}function Ly(t,r,a=!1){return t.target instanceof HTMLElement?(a||!t.target.isContentEditable)&&!r.includes(t.target.tagName):!0}function Tf(t,r=["INPUT","TEXTAREA","SELECT"],a=!1){g.useEffect(()=>{const l=h=>{t.forEach(([o,c,d={preventDefault:!0,usePhysicalKeys:!1}])=>{jy(o,d.usePhysicalKeys)(h)&&Ly(h,r,a)&&(d.preventDefault&&h.preventDefault(),c(h))})};return document.documentElement.addEventListener("keydown",l),()=>document.documentElement.removeEventListener("keydown",l)},[t])}function hh(t,r){return r.length===0?t:r.reduce((a,l)=>Math.abs(l-t)<Math.abs(a-t)?l:a)}const zf=g.createContext(null),ky=zf.Provider;function My(){return{withinGroup:!!g.useContext(zf)}}var Ao={group:"m_11def92b",root:"m_f85678b6",image:"m_11f8ac07",placeholder:"m_104cd71f"};const Iy={},Ey=Lc((t,{spacing:r})=>({group:{"--ag-spacing":B1(r)}})),zc=vf((t,r)=>{const a=Sc("AvatarGroup",Iy,t),{classNames:l,className:h,style:o,styles:c,unstyled:d,vars:f,spacing:m,...y}=a,_=jc({name:"AvatarGroup",classes:Ao,props:a,className:h,style:o,classNames:l,styles:c,unstyled:d,vars:f,varsResolver:Ey,rootSelector:"group"});return s.jsx(ky,{value:!0,children:s.jsx(Ie,{ref:r,..._("group"),...y})})});zc.classes=Ao;zc.displayName="@mantine/core/AvatarGroup";function Ay(t){return s.jsx("svg",{...t,"data-avatar-placeholder-icon":!0,viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M0.877014 7.49988C0.877014 3.84219 3.84216 0.877045 7.49985 0.877045C11.1575 0.877045 14.1227 3.84219 14.1227 7.49988C14.1227 11.1575 11.1575 14.1227 7.49985 14.1227C3.84216 14.1227 0.877014 11.1575 0.877014 7.49988ZM7.49985 1.82704C4.36683 1.82704 1.82701 4.36686 1.82701 7.49988C1.82701 8.97196 2.38774 10.3131 3.30727 11.3213C4.19074 9.94119 5.73818 9.02499 7.50023 9.02499C9.26206 9.02499 10.8093 9.94097 11.6929 11.3208C12.6121 10.3127 13.1727 8.97172 13.1727 7.49988C13.1727 4.36686 10.6328 1.82704 7.49985 1.82704ZM10.9818 11.9787C10.2839 10.7795 8.9857 9.97499 7.50023 9.97499C6.01458 9.97499 4.71624 10.7797 4.01845 11.9791C4.97952 12.7272 6.18765 13.1727 7.49985 13.1727C8.81227 13.1727 10.0206 12.727 10.9818 11.9787ZM5.14999 6.50487C5.14999 5.207 6.20212 4.15487 7.49999 4.15487C8.79786 4.15487 9.84999 5.207 9.84999 6.50487C9.84999 7.80274 8.79786 8.85487 7.49999 8.85487C6.20212 8.85487 5.14999 7.80274 5.14999 6.50487ZM7.49999 5.10487C6.72679 5.10487 6.09999 5.73167 6.09999 6.50487C6.09999 7.27807 6.72679 7.90487 7.49999 7.90487C8.27319 7.90487 8.89999 7.27807 8.89999 6.50487C8.89999 5.73167 8.27319 5.10487 7.49999 5.10487Z",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd"})})}function Py(t){let r=0;for(let a=0;a<t.length;a+=1){const l=t.charCodeAt(a);r=(r<<5)-r+l,r|=0}return r}const Ty=["blue","cyan","grape","green","indigo","lime","orange","pink","red","teal","violet"];function zy(t,r=Ty){const a=Py(t),l=Math.abs(a)%r.length;return r[l]}function Fy(t,r=2){const a=t.split(" ");return a.length===1?t.slice(0,r).toUpperCase():a.map(l=>l[0]).slice(0,r).join("").toUpperCase()}const Dy={},Ry=Lc((t,{size:r,radius:a,variant:l,gradient:h,color:o,autoContrast:c,name:d,allowedInitialsColors:f})=>{const m=o==="initials"&&typeof d=="string"?zy(d,f):o,y=t.variantColorResolver({color:m||"gray",theme:t,gradient:h,variant:l||"light",autoContrast:c});return{root:{"--avatar-size":yf(r,"avatar-size"),"--avatar-radius":a===void 0?void 0:_f(a),"--avatar-bg":m||l?y.background:void 0,"--avatar-color":m||l?y.color:void 0,"--avatar-bd":m||l?y.border:void 0}}}),Us=N1((t,r)=>{const a=Sc("Avatar",Dy,t),{classNames:l,className:h,style:o,styles:c,unstyled:d,vars:f,src:m,alt:y,radius:_,color:S,gradient:b,imageProps:T,children:z,autoContrast:J,mod:F,name:te,allowedInitialsColors:re,...O}=a,ce=My(),[xe,Ee]=g.useState(!m),Le=jc({name:"Avatar",props:a,classes:Ao,className:h,style:o,classNames:l,styles:c,unstyled:d,vars:f,varsResolver:Ry});return g.useEffect(()=>Ee(!m),[m]),s.jsx(Ie,{...Le("root"),mod:[{"within-group":ce.withinGroup},F],ref:r,...O,children:xe?s.jsx("span",{...Le("placeholder"),title:y,children:z||typeof te=="string"&&Fy(te)||s.jsx(Ay,{})}):s.jsx("img",{...T,...Le("image"),src:m,alt:y,onError:ge=>{var pe;Ee(!0),(pe=T==null?void 0:T.onError)==null||pe.call(T,ge)}})})});Us.classes=Ao;Us.displayName="@mantine/core/Avatar";Us.Group=zc;const[$y,Po]=H1("SliderProvider was not found in tree"),Ff=g.forwardRef(({size:t,disabled:r,variant:a,color:l,thumbSize:h,radius:o,...c},d)=>{const{getStyles:f}=Po();return s.jsx(Ie,{tabIndex:-1,variant:a,size:t,ref:d,...f("root"),...c})});Ff.displayName="@mantine/core/SliderRoot";const Df=g.forwardRef(({max:t,min:r,value:a,position:l,label:h,dragging:o,onMouseDown:c,onKeyDownCapture:d,labelTransitionProps:f,labelAlwaysOn:m,thumbLabel:y,onFocus:_,onBlur:S,showLabelOnHover:b,isHovered:T,children:z=null,disabled:J},F)=>{const{getStyles:te}=Po(),[re,O]=g.useState(!1),ce=m||o||re||b&&T;return s.jsxs(Ie,{tabIndex:0,role:"slider","aria-label":y,"aria-valuemax":t,"aria-valuemin":r,"aria-valuenow":a,ref:F,__vars:{"--slider-thumb-offset":`${l}%`},...te("thumb",{focusable:!0}),mod:{dragging:o,disabled:J},onFocus:xe=>{O(!0),typeof _=="function"&&_(xe)},onBlur:xe=>{O(!1),typeof S=="function"&&S(xe)},onTouchStart:c,onMouseDown:c,onKeyDownCapture:d,onClick:xe=>xe.stopPropagation(),children:[z,s.jsx(G1,{mounted:h!=null&&!!ce,transition:"fade",duration:0,...f,children:xe=>s.jsx("div",{...te("label",{style:xe}),children:h})})]})});Df.displayName="@mantine/core/SliderThumb";function Rf({value:t,min:r,max:a}){const l=(t-r)/(a-r)*100;return Math.min(Math.max(l,0),100)}function Oy({mark:t,offset:r,value:a,inverted:l=!1}){return l?typeof r=="number"&&t.value<=r||t.value>=a:typeof r=="number"?t.value>=r&&t.value<=a:t.value<=a}function $f({marks:t,min:r,max:a,disabled:l,value:h,offset:o,inverted:c}){const{getStyles:d}=Po();if(!t)return null;const f=t.map((m,y)=>g.createElement(Ie,{...d("markWrapper"),__vars:{"--mark-offset":`${Rf({value:m.value,min:r,max:a})}%`},key:y},s.jsx(Ie,{...d("mark"),mod:{filled:Oy({mark:m,value:h,offset:o,inverted:c}),disabled:l}}),m.label&&s.jsx("div",{...d("markLabel"),children:m.label})));return s.jsx("div",{children:f})}$f.displayName="@mantine/core/SliderMarks";function Of({filled:t,children:r,offset:a,disabled:l,marksOffset:h,inverted:o,containerProps:c,...d}){const{getStyles:f}=Po();return s.jsx(Ie,{...f("trackContainer"),mod:{disabled:l},...c,children:s.jsxs(Ie,{...f("track"),mod:{inverted:o,disabled:l},children:[s.jsx(Ie,{mod:{inverted:o,disabled:l},__vars:{"--slider-bar-width":`calc(${t}% + var(--slider-size))`,"--slider-bar-offset":`calc(${a}% - var(--slider-size))`},...f("bar")}),r,s.jsx($f,{...d,offset:h,disabled:l,inverted:o})]})})}Of.displayName="@mantine/core/SliderTrack";function By({value:t,containerWidth:r,min:a,max:l,step:h,precision:o}){const d=(r?Math.min(Math.max(t,0),r)/r:t)*(l-a),f=(d!==0?Math.round(d/h)*h:0)+a,m=Math.max(f,a);return o!==void 0?Number(m.toFixed(o)):m}function Vi(t,r){return parseFloat(t.toFixed(r))}function Ny(t){if(!t)return 0;const r=t.toString().split(".");return r.length>1?r[1].length:0}function ql(t,r){const l=[...r].sort((h,o)=>h.value-o.value).find(h=>h.value>t);return l?l.value:t}function Xl(t,r){const l=[...r].sort((h,o)=>o.value-h.value).find(h=>h.value<t);return l?l.value:t}function fh(t){const r=[...t].sort((a,l)=>a.value-l.value);return r.length>0?r[0].value:0}function ph(t){const r=[...t].sort((a,l)=>a.value-l.value);return r.length>0?r[r.length-1].value:100}var Bf={root:"m_dd36362e",label:"m_c9357328",thumb:"m_c9a9a60a",trackContainer:"m_a8645c2",track:"m_c9ade57f",bar:"m_38aeed47",markWrapper:"m_b7b0423a",mark:"m_dd33bc19",markLabel:"m_68c77a5b"};const Hy={radius:"xl",min:0,max:100,step:1,marks:[],label:t=>t,labelTransitionProps:{transition:"fade",duration:0},labelAlwaysOn:!1,thumbLabel:"",showLabelOnHover:!0,disabled:!1,scale:t=>t},Gy=Lc((t,{size:r,color:a,thumbSize:l,radius:h})=>({root:{"--slider-size":yf(r,"slider-size"),"--slider-color":a?W1(a,t):void 0,"--slider-radius":h===void 0?void 0:_f(h),"--slider-thumb-size":l!==void 0?cc(l):"calc(var(--slider-size) * 2)"}})),Fc=vf((t,r)=>{const a=Sc("Slider",Hy,t),{classNames:l,styles:h,value:o,onChange:c,onChangeEnd:d,size:f,min:m,max:y,step:_,precision:S,defaultValue:b,name:T,marks:z,label:J,labelTransitionProps:F,labelAlwaysOn:te,thumbLabel:re,showLabelOnHover:O,thumbChildren:ce,disabled:xe,unstyled:Ee,scale:Le,inverted:ge,className:pe,style:ae,vars:me,hiddenInputProps:Ce,restrictToMarks:Pe,thumbProps:xt,...Ye}=a,jt=jc({name:"Slider",props:a,classes:Bf,classNames:l,className:pe,styles:h,style:ae,vars:me,varsResolver:Gy,unstyled:Ee}),{dir:bt}=U1(),[Dt,rt]=g.useState(!1),[q,ke]=V1({value:typeof o=="number"?Yl(o,m,y):o,defaultValue:typeof b=="number"?Yl(b,m,y):b,finalValue:Yl(0,m,y),onChange:c}),G=g.useRef(q),K=g.useRef(d);g.useEffect(()=>{K.current=d},[d]);const W=g.useRef(null),he=g.useRef(null),de=Rf({value:q,min:m,max:y}),De=Le(q),Ne=typeof J=="function"?J(De):J,Ve=S??Ny(_),at=g.useCallback(({x:oe})=>{if(!xe){const Re=By({value:oe,min:m,max:y,step:_,precision:Ve});ke(Pe&&(z!=null&&z.length)?hh(Re,z.map(Mt=>Mt.value)):Re),G.current=Re}},[xe,m,y,_,Ve,ke,z,Pe]),Ke=g.useCallback(()=>{if(!xe&&K.current){const oe=Pe&&(z!=null&&z.length)?hh(G.current,z.map(Re=>Re.value)):G.current;K.current(oe)}},[xe,z,Pe]),{ref:Vt,active:E}=dy(at,{onScrubEnd:Ke},bt),H=g.useCallback(oe=>{!xe&&K.current&&K.current(oe)},[xe]),je=oe=>{var Re,Mt,vt,Je,dt,St;if(!xe)switch(oe.key){case"ArrowUp":{if(oe.preventDefault(),(Re=he.current)==null||Re.focus(),Pe&&z){const fe=ql(q,z);ke(fe),H(fe);break}const D=Vi(Math.min(Math.max(q+_,m),y),Ve);ke(D),H(D);break}case"ArrowRight":{if(oe.preventDefault(),(Mt=he.current)==null||Mt.focus(),Pe&&z){const fe=bt==="rtl"?Xl(q,z):ql(q,z);ke(fe),H(fe);break}const D=Vi(Math.min(Math.max(bt==="rtl"?q-_:q+_,m),y),Ve);ke(D),H(D);break}case"ArrowDown":{if(oe.preventDefault(),(vt=he.current)==null||vt.focus(),Pe&&z){const fe=Xl(q,z);ke(fe),H(fe);break}const D=Vi(Math.min(Math.max(q-_,m),y),Ve);ke(D),H(D);break}case"ArrowLeft":{if(oe.preventDefault(),(Je=he.current)==null||Je.focus(),Pe&&z){const fe=bt==="rtl"?ql(q,z):Xl(q,z);ke(fe),H(fe);break}const D=Vi(Math.min(Math.max(bt==="rtl"?q+_:q-_,m),y),Ve);ke(D),H(D);break}case"Home":{if(oe.preventDefault(),(dt=he.current)==null||dt.focus(),Pe&&z){ke(fh(z)),H(fh(z));break}ke(m),H(m);break}case"End":{if(oe.preventDefault(),(St=he.current)==null||St.focus(),Pe&&z){ke(ph(z)),H(ph(z));break}ke(y),H(y);break}}};return s.jsx($y,{value:{getStyles:jt},children:s.jsxs(Ff,{...Ye,ref:Z1(r,W),onKeyDownCapture:je,onMouseDownCapture:()=>{var oe;return(oe=W.current)==null?void 0:oe.focus()},size:f,disabled:xe,children:[s.jsx(Of,{inverted:ge,offset:0,filled:de,marks:z,min:m,max:y,value:De,disabled:xe,containerProps:{ref:Vt,onMouseEnter:O?()=>rt(!0):void 0,onMouseLeave:O?()=>rt(!1):void 0},children:s.jsx(Df,{max:y,min:m,value:De,position:de,dragging:E,label:Ne,ref:he,labelTransitionProps:F,labelAlwaysOn:te,thumbLabel:re,showLabelOnHover:O,isHovered:Dt,disabled:xe,...xt,children:ce})}),s.jsx("input",{type:"hidden",name:T,value:De,...Ce})]})})});Fc.classes=Bf;Fc.displayName="@mantine/core/Slider";/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Uy=pt("outline","analyze","IconAnalyze",[["path",{d:"M20 11a8.1 8.1 0 0 0 -6.986 -6.918a8.095 8.095 0 0 0 -8.019 3.918",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15 3",key:"svg-1"}],["path",{d:"M19 16m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}],["path",{d:"M5 8m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-3"}],["path",{d:"M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Zi=pt("outline","arrow-down","IconArrowDown",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M18 13l-6 6",key:"svg-1"}],["path",{d:"M6 13l6 6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Wi=pt("outline","arrow-up","IconArrowUp",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M18 11l-6 -6",key:"svg-1"}],["path",{d:"M6 11l6 -6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var za=pt("outline","arrows-sort","IconArrowsSort",[["path",{d:"M3 9l4 -4l4 4m-4 -4v14",key:"svg-0"}],["path",{d:"M21 15l-4 4l-4 -4m4 4v-14",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Nf=pt("outline","briefcase","IconBriefcase",[["path",{d:"M3 7m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M8 7v-2a2 2 0 0 1 2 -2h4a2 2 0 0 1 2 2v2",key:"svg-1"}],["path",{d:"M12 12l0 .01",key:"svg-2"}],["path",{d:"M3 13a20 20 0 0 0 18 0",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Vy=pt("outline","building-community","IconBuildingCommunity",[["path",{d:"M8 9l5 5v7h-5v-4m0 4h-5v-7l5 -5m1 1v-6a1 1 0 0 1 1 -1h10a1 1 0 0 1 1 1v17h-8",key:"svg-0"}],["path",{d:"M13 7l0 .01",key:"svg-1"}],["path",{d:"M17 7l0 .01",key:"svg-2"}],["path",{d:"M17 11l0 .01",key:"svg-3"}],["path",{d:"M17 15l0 .01",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Hf=pt("outline","building","IconBuilding",[["path",{d:"M3 21l18 0",key:"svg-0"}],["path",{d:"M9 8l1 0",key:"svg-1"}],["path",{d:"M9 12l1 0",key:"svg-2"}],["path",{d:"M9 16l1 0",key:"svg-3"}],["path",{d:"M14 8l1 0",key:"svg-4"}],["path",{d:"M14 12l1 0",key:"svg-5"}],["path",{d:"M14 16l1 0",key:"svg-6"}],["path",{d:"M5 21v-16a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v16",key:"svg-7"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Zy=pt("outline","chevron-down","IconChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Gf=pt("outline","clear-all","IconClearAll",[["path",{d:"M8 6h12",key:"svg-0"}],["path",{d:"M6 12h12",key:"svg-1"}],["path",{d:"M4 18h12",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Uf=pt("outline","clock","IconClock",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 7v5l3 3",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Wy=pt("outline","dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Vf=pt("outline","files","IconFiles",[["path",{d:"M15 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M18 17h-7a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h4l5 5v7a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M16 17v2a2 2 0 0 1 -2 2h-7a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h2",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var gh=pt("outline","filter-off","IconFilterOff",[["path",{d:"M8 4h12v2.172a2 2 0 0 1 -.586 1.414l-3.914 3.914m-.5 3.5v4l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Yy=pt("outline","filter","IconFilter",[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Zf=pt("outline","flag","IconFlag",[["path",{d:"M5 5a5 5 0 0 1 7 0a5 5 0 0 0 7 0v9a5 5 0 0 1 -7 0a5 5 0 0 0 -7 0v-9z",key:"svg-0"}],["path",{d:"M5 21v-7",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var qy=pt("outline","flask","IconFlask",[["path",{d:"M9 3l6 0",key:"svg-0"}],["path",{d:"M10 9l4 0",key:"svg-1"}],["path",{d:"M10 3v6l-4 11a.7 .7 0 0 0 .5 1h11a.7 .7 0 0 0 .5 -1l-4 -11v-6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xy=pt("outline","gauge","IconGauge",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M13.41 10.59l2.59 -2.59",key:"svg-2"}],["path",{d:"M7 12a5 5 0 0 1 5 -5",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Wf=pt("outline","home","IconHome",[["path",{d:"M5 12l-2 0l9 -9l9 9l-2 0",key:"svg-0"}],["path",{d:"M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7",key:"svg-1"}],["path",{d:"M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ky=pt("outline","license","IconLicense",[["path",{d:"M15 21h-9a3 3 0 0 1 -3 -3v-1h10v2a2 2 0 0 0 4 0v-14a2 2 0 1 1 2 2h-2m2 -4h-11a3 3 0 0 0 -3 3v11",key:"svg-0"}],["path",{d:"M9 7l4 0",key:"svg-1"}],["path",{d:"M9 11l4 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Jy=pt("outline","list-details","IconListDetails",[["path",{d:"M13 5h8",key:"svg-0"}],["path",{d:"M13 9h5",key:"svg-1"}],["path",{d:"M13 15h8",key:"svg-2"}],["path",{d:"M13 19h5",key:"svg-3"}],["path",{d:"M3 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-4"}],["path",{d:"M3 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Yf=pt("outline","maximize","IconMaximize",[["path",{d:"M4 8v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M4 16v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M16 20h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Qy=pt("outline","menu-2","IconMenu2",[["path",{d:"M4 6l16 0",key:"svg-0"}],["path",{d:"M4 12l16 0",key:"svg-1"}],["path",{d:"M4 18l16 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var eC=pt("outline","menu-deep","IconMenuDeep",[["path",{d:"M4 6h16",key:"svg-0"}],["path",{d:"M7 12h13",key:"svg-1"}],["path",{d:"M10 18h10",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var qf=pt("outline","minimize","IconMinimize",[["path",{d:"M15 19v-2a2 2 0 0 1 2 -2h2",key:"svg-0"}],["path",{d:"M15 5v2a2 2 0 0 0 2 2h2",key:"svg-1"}],["path",{d:"M5 15h2a2 2 0 0 1 2 2v2",key:"svg-2"}],["path",{d:"M5 9h2a2 2 0 0 0 2 -2v-2",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var tC=pt("outline","movie","IconMovie",[["path",{d:"M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M8 4l0 16",key:"svg-1"}],["path",{d:"M16 4l0 16",key:"svg-2"}],["path",{d:"M4 8l4 0",key:"svg-3"}],["path",{d:"M4 16l4 0",key:"svg-4"}],["path",{d:"M4 12l16 0",key:"svg-5"}],["path",{d:"M16 8l4 0",key:"svg-6"}],["path",{d:"M16 16l4 0",key:"svg-7"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var nC=pt("outline","player-pause","IconPlayerPause",[["path",{d:"M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var rC=pt("outline","player-play","IconPlayerPlay",[["path",{d:"M7 4v16l13 -8z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var aC=pt("outline","player-skip-back","IconPlayerSkipBack",[["path",{d:"M20 5v14l-12 -7z",key:"svg-0"}],["path",{d:"M4 5l0 14",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var sC=pt("outline","player-skip-forward","IconPlayerSkipForward",[["path",{d:"M4 5v14l12 -7z",key:"svg-0"}],["path",{d:"M20 5l0 14",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var iC=pt("outline","player-track-next","IconPlayerTrackNext",[["path",{d:"M3 5v14l8 -7z",key:"svg-0"}],["path",{d:"M14 5v14l8 -7z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var oC=pt("outline","player-track-prev","IconPlayerTrackPrev",[["path",{d:"M21 5v14l-8 -7z",key:"svg-0"}],["path",{d:"M10 5v14l-8 -7z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var lC=pt("outline","road","IconRoad",[["path",{d:"M4 19l4 -14",key:"svg-0"}],["path",{d:"M16 5l4 14",key:"svg-1"}],["path",{d:"M12 8v-2",key:"svg-2"}],["path",{d:"M12 13v-2",key:"svg-3"}],["path",{d:"M12 18v-2",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var cC=pt("outline","route","IconRoute",[["path",{d:"M3 19a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M19 7a2 2 0 1 0 0 -4a2 2 0 0 0 0 4z",key:"svg-1"}],["path",{d:"M11 19h5.5a3.5 3.5 0 0 0 0 -7h-8a3.5 3.5 0 0 1 0 -7h4.5",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var uC=pt("outline","stack","IconStack",[["path",{d:"M12 6l-8 4l8 4l8 -4l-8 -4",key:"svg-0"}],["path",{d:"M4 14l8 4l8 -4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Xf=pt("outline","star","IconStar",[["path",{d:"M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var dC=pt("outline","table-options","IconTableOptions",[["path",{d:"M12 21h-7a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v7",key:"svg-0"}],["path",{d:"M3 10h18",key:"svg-1"}],["path",{d:"M10 3v18",key:"svg-2"}],["path",{d:"M19.001 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-3"}],["path",{d:"M19.001 15.5v1.5",key:"svg-4"}],["path",{d:"M19.001 21v1.5",key:"svg-5"}],["path",{d:"M22.032 17.25l-1.299 .75",key:"svg-6"}],["path",{d:"M17.27 20l-1.3 .75",key:"svg-7"}],["path",{d:"M15.97 17.25l1.3 .75",key:"svg-8"}],["path",{d:"M20.733 20l1.3 .75",key:"svg-9"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Dc=pt("outline","table","IconTable",[["path",{d:"M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z",key:"svg-0"}],["path",{d:"M3 10h18",key:"svg-1"}],["path",{d:"M10 3v18",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Kf=pt("outline","user","IconUser",[["path",{d:"M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0",key:"svg-0"}],["path",{d:"M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2",key:"svg-1"}]]);function hC(t,r,a){r.center!==a.center&&t.setLatLng(r.center),r.radius!=null&&r.radius!==a.radius&&t.setRadius(r.radius)}const mh=kf(function({center:r,children:a,...l},h){const o=new Ic.Circle(r,l);return Ec(o,Mf(h,{overlayContainer:o}))},hC),fC=kf(function({positions:r,...a},l){const h=new Ic.Polyline(r,a);return Ec(h,Mf(l,{overlayContainer:h}))},function(r,a,l){a.positions!==l.positions&&r.setLatLngs(a.positions)}),pC=oy(function(r,a){const l=new Ic.Popup(r,a.overlayContainer);return Ec(l,a)},function(r,a,{position:l},h){g.useEffect(function(){const{instance:c}=r;function d(m){m.popup===c&&(c.update(),h(!0))}function f(m){m.popup===c&&h(!1)}return a.map.on({popupopen:d,popupclose:f}),a.overlayContainer==null?(l!=null&&c.setLatLng(l),c.openOn(a.map)):a.overlayContainer.bindPopup(c),function(){var y;a.map.off({popupopen:d,popupclose:f}),(y=a.overlayContainer)==null||y.unbindPopup(),a.map.removeLayer(c)}},[r,a,h,l])});function gC(t){return{all:t=t||new Map,on:function(r,a){var l=t.get(r);l?l.push(a):t.set(r,[a])},off:function(r,a){var l=t.get(r);l&&(a?l.splice(l.indexOf(a)>>>0,1):t.set(r,[]))},emit:function(r,a){var l=t.get(r);l&&l.slice().map(function(h){h(a)}),(l=t.get("*"))&&l.slice().map(function(h){h(r,a)})}}}const Wr=gC(),Jf=g.createContext(void 0),Qf=()=>{const t=g.useContext(Jf);if(!t)throw new Error("useMapHighlight debe usarse dentro de MapHighlightProvider");return t},mC=({children:t})=>{const[r,a]=g.useState([]);return s.jsx(Jf.Provider,{value:{highlightedLecturas:r,setHighlightedLecturas:a},children:t})},xC=({opened:t,onClose:r,lecturaRelevante:a,onSave:l})=>{const[h,o]=g.useState(""),[c,d]=g.useState(!1);g.useEffect(()=>{o(a&&a.Nota||"")},[a]);const f=async()=>{if(a){d(!0);try{await l(a.ID_Relevante,h.trim()||null)}catch(y){console.error("Error guardando nota desde modal:",y)}finally{d(!1)}}},m=()=>{d(!1),r()};return s.jsxs(Zr,{opened:t,onClose:m,title:a?`Editar Nota - Lectura ID: ${a.ID_Lectura}`:"Editar Nota",overlayProps:{backgroundOpacity:.55,blur:3},children:[s.jsx(Ra,{visible:c,overlayProps:{blur:2}}),s.jsx(ho,{label:"Nota de Relevancia",placeholder:"Añade o edita tu nota aquí...",value:h,onChange:y=>o(y.currentTarget.value),minRows:3,autosize:!0,disabled:c}),s.jsxs(X,{justify:"flex-end",mt:"md",children:[s.jsx(Me,{variant:"default",onClick:m,disabled:c,children:"Cancelar"}),s.jsx(Me,{onClick:f,loading:c,children:"Guardar Nota"})]})]})};var vo={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */vo.exports;(function(t,r){(function(){var a,l="4.17.21",h=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",c="Expected a function",d="Invalid `variable` option passed into `_.template`",f="__lodash_hash_undefined__",m=500,y="__lodash_placeholder__",_=1,S=2,b=4,T=1,z=2,J=1,F=2,te=4,re=8,O=16,ce=32,xe=64,Ee=128,Le=256,ge=512,pe=30,ae="...",me=800,Ce=16,Pe=1,xt=2,Ye=3,jt=1/0,bt=9007199254740991,Dt=17976931348623157e292,rt=NaN,q=4294967295,ke=q-1,G=q>>>1,K=[["ary",Ee],["bind",J],["bindKey",F],["curry",re],["curryRight",O],["flip",ge],["partial",ce],["partialRight",xe],["rearg",Le]],W="[object Arguments]",he="[object Array]",de="[object AsyncFunction]",De="[object Boolean]",Ne="[object Date]",Ve="[object DOMException]",at="[object Error]",Ke="[object Function]",Vt="[object GeneratorFunction]",E="[object Map]",H="[object Number]",je="[object Null]",oe="[object Object]",Re="[object Promise]",Mt="[object Proxy]",vt="[object RegExp]",Je="[object Set]",dt="[object String]",St="[object Symbol]",D="[object Undefined]",fe="[object WeakMap]",Ae="[object WeakSet]",Oe="[object ArrayBuffer]",Fe="[object DataView]",Qe="[object Float32Array]",Bt="[object Float64Array]",Lt="[object Int8Array]",I="[object Int16Array]",$="[object Int32Array]",Q="[object Uint8Array]",ue="[object Uint8ClampedArray]",It="[object Uint16Array]",Nt="[object Uint32Array]",st=/\b__p \+= '';/g,tn=/\b(__p \+=) '' \+/g,Cn=/(__e\(.*?\)|\b__t\)) \+\n'';/g,U=/&(?:amp|lt|gt|quot|#39);/g,$e=/[&<>"']/g,ot=RegExp(U.source),Jt=RegExp($e.source),jr=/<%-([\s\S]+?)%>/g,Lr=/<%([\s\S]+?)%>/g,En=/<%=([\s\S]+?)%>/g,qs=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kr=/^\w*$/,Na=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Mr=/[\\^$.*+?()[\]{}|]/g,Kr=RegExp(Mr.source),dr=/^\s+/,Ha=/\s/,Ga=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,pa=/\{\n\/\* \[wrapped with (.+)\] \*/,Xs=/,? & /,Ua=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ks=/[()=,{}\[\]\/\s]/,Jr=/\\(\\)?/g,Qr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Ir=/\w*$/,ga=/^[-+]0x[0-9a-f]+$/i,Va=/^0b[01]+$/i,Er=/^\[object .+?Constructor\]$/,Za=/^0o[0-7]+$/i,ms=/^(?:0|[1-9]\d*)$/,Wa=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,nn=/($^)/,xs=/['\n\r\u2028\u2029\\]/g,ar="\\ud800-\\udfff",Ar="\\u0300-\\u036f",ma="\\ufe20-\\ufe2f",k="\\u20d0-\\u20ff",N=Ar+ma+k,we="\\u2700-\\u27bf",ht="a-z\\xdf-\\xf6\\xf8-\\xff",_t="\\xac\\xb1\\xd7\\xf7",dn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Wn="\\u2000-\\u206f",hr=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",An="A-Z\\xc0-\\xd6\\xd8-\\xde",fr="\\ufe0e\\ufe0f",Js=_t+dn+Wn+hr,Ya="['’]",Oo="["+ar+"]",Qs="["+Js+"]",xa="["+N+"]",ei="\\d+",Bo="["+we+"]",ti="["+ht+"]",ni="[^"+ar+Js+ei+we+ht+An+"]",vs="\\ud83c[\\udffb-\\udfff]",No="(?:"+xa+"|"+vs+")",ri="[^"+ar+"]",_s="(?:\\ud83c[\\udde6-\\uddff]){2}",ys="[\\ud800-\\udbff][\\udc00-\\udfff]",Pr="["+An+"]",ai="\\u200d",A="(?:"+ti+"|"+ni+")",R="(?:"+Pr+"|"+ni+")",ne="(?:"+Ya+"(?:d|ll|m|re|s|t|ve))?",Be="(?:"+Ya+"(?:D|LL|M|RE|S|T|VE))?",yt=No+"?",_e="["+fr+"]?",le="(?:"+ai+"(?:"+[ri,_s,ys].join("|")+")"+_e+yt+")*",be="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ze="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Kt=_e+yt+le,Pn="(?:"+[Bo,_s,ys].join("|")+")"+Kt,pn="(?:"+[ri+xa+"?",xa,_s,ys,Oo].join("|")+")",pr=RegExp(Ya,"g"),Tn=RegExp(xa,"g"),zn=RegExp(vs+"(?="+vs+")|"+pn+Kt,"g"),qa=RegExp([Pr+"?"+ti+"+"+ne+"(?="+[Qs,Pr,"$"].join("|")+")",R+"+"+Be+"(?="+[Qs,Pr+A,"$"].join("|")+")",Pr+"?"+A+"+"+ne,Pr+"+"+Be,Ze,be,ei,Pn].join("|"),"g"),Cs=RegExp("["+ai+ar+N+fr+"]"),Qp=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,eg=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],tg=-1,Ht={};Ht[Qe]=Ht[Bt]=Ht[Lt]=Ht[I]=Ht[$]=Ht[Q]=Ht[ue]=Ht[It]=Ht[Nt]=!0,Ht[W]=Ht[he]=Ht[Oe]=Ht[De]=Ht[Fe]=Ht[Ne]=Ht[at]=Ht[Ke]=Ht[E]=Ht[H]=Ht[oe]=Ht[vt]=Ht[Je]=Ht[dt]=Ht[fe]=!1;var Rt={};Rt[W]=Rt[he]=Rt[Oe]=Rt[Fe]=Rt[De]=Rt[Ne]=Rt[Qe]=Rt[Bt]=Rt[Lt]=Rt[I]=Rt[$]=Rt[E]=Rt[H]=Rt[oe]=Rt[vt]=Rt[Je]=Rt[dt]=Rt[St]=Rt[Q]=Rt[ue]=Rt[It]=Rt[Nt]=!0,Rt[at]=Rt[Ke]=Rt[fe]=!1;var ng={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},rg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ag={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},sg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ig=parseFloat,og=parseInt,nu=typeof us=="object"&&us&&us.Object===Object&&us,lg=typeof self=="object"&&self&&self.Object===Object&&self,sn=nu||lg||Function("return this")(),Ho=r&&!r.nodeType&&r,va=Ho&&!0&&t&&!t.nodeType&&t,ru=va&&va.exports===Ho,Go=ru&&nu.process,Yn=function(){try{var j=va&&va.require&&va.require("util").types;return j||Go&&Go.binding&&Go.binding("util")}catch{}}(),au=Yn&&Yn.isArrayBuffer,su=Yn&&Yn.isDate,iu=Yn&&Yn.isMap,ou=Yn&&Yn.isRegExp,lu=Yn&&Yn.isSet,cu=Yn&&Yn.isTypedArray;function Fn(j,B,P){switch(P.length){case 0:return j.call(B);case 1:return j.call(B,P[0]);case 2:return j.call(B,P[0],P[1]);case 3:return j.call(B,P[0],P[1],P[2])}return j.apply(B,P)}function cg(j,B,P,Se){for(var qe=-1,kt=j==null?0:j.length;++qe<kt;){var Qt=j[qe];B(Se,Qt,P(Qt),j)}return Se}function qn(j,B){for(var P=-1,Se=j==null?0:j.length;++P<Se&&B(j[P],P,j)!==!1;);return j}function ug(j,B){for(var P=j==null?0:j.length;P--&&B(j[P],P,j)!==!1;);return j}function uu(j,B){for(var P=-1,Se=j==null?0:j.length;++P<Se;)if(!B(j[P],P,j))return!1;return!0}function ea(j,B){for(var P=-1,Se=j==null?0:j.length,qe=0,kt=[];++P<Se;){var Qt=j[P];B(Qt,P,j)&&(kt[qe++]=Qt)}return kt}function si(j,B){var P=j==null?0:j.length;return!!P&&Xa(j,B,0)>-1}function Uo(j,B,P){for(var Se=-1,qe=j==null?0:j.length;++Se<qe;)if(P(B,j[Se]))return!0;return!1}function Ut(j,B){for(var P=-1,Se=j==null?0:j.length,qe=Array(Se);++P<Se;)qe[P]=B(j[P],P,j);return qe}function ta(j,B){for(var P=-1,Se=B.length,qe=j.length;++P<Se;)j[qe+P]=B[P];return j}function Vo(j,B,P,Se){var qe=-1,kt=j==null?0:j.length;for(Se&&kt&&(P=j[++qe]);++qe<kt;)P=B(P,j[qe],qe,j);return P}function dg(j,B,P,Se){var qe=j==null?0:j.length;for(Se&&qe&&(P=j[--qe]);qe--;)P=B(P,j[qe],qe,j);return P}function Zo(j,B){for(var P=-1,Se=j==null?0:j.length;++P<Se;)if(B(j[P],P,j))return!0;return!1}var hg=Wo("length");function fg(j){return j.split("")}function pg(j){return j.match(Ua)||[]}function du(j,B,P){var Se;return P(j,function(qe,kt,Qt){if(B(qe,kt,Qt))return Se=kt,!1}),Se}function ii(j,B,P,Se){for(var qe=j.length,kt=P+(Se?1:-1);Se?kt--:++kt<qe;)if(B(j[kt],kt,j))return kt;return-1}function Xa(j,B,P){return B===B?Lg(j,B,P):ii(j,hu,P)}function gg(j,B,P,Se){for(var qe=P-1,kt=j.length;++qe<kt;)if(Se(j[qe],B))return qe;return-1}function hu(j){return j!==j}function fu(j,B){var P=j==null?0:j.length;return P?qo(j,B)/P:rt}function Wo(j){return function(B){return B==null?a:B[j]}}function Yo(j){return function(B){return j==null?a:j[B]}}function pu(j,B,P,Se,qe){return qe(j,function(kt,Qt,Ft){P=Se?(Se=!1,kt):B(P,kt,Qt,Ft)}),P}function mg(j,B){var P=j.length;for(j.sort(B);P--;)j[P]=j[P].value;return j}function qo(j,B){for(var P,Se=-1,qe=j.length;++Se<qe;){var kt=B(j[Se]);kt!==a&&(P=P===a?kt:P+kt)}return P}function Xo(j,B){for(var P=-1,Se=Array(j);++P<j;)Se[P]=B(P);return Se}function xg(j,B){return Ut(B,function(P){return[P,j[P]]})}function gu(j){return j&&j.slice(0,_u(j)+1).replace(dr,"")}function Dn(j){return function(B){return j(B)}}function Ko(j,B){return Ut(B,function(P){return j[P]})}function ws(j,B){return j.has(B)}function mu(j,B){for(var P=-1,Se=j.length;++P<Se&&Xa(B,j[P],0)>-1;);return P}function xu(j,B){for(var P=j.length;P--&&Xa(B,j[P],0)>-1;);return P}function vg(j,B){for(var P=j.length,Se=0;P--;)j[P]===B&&++Se;return Se}var _g=Yo(ng),yg=Yo(rg);function Cg(j){return"\\"+sg[j]}function wg(j,B){return j==null?a:j[B]}function Ka(j){return Cs.test(j)}function bg(j){return Qp.test(j)}function Sg(j){for(var B,P=[];!(B=j.next()).done;)P.push(B.value);return P}function Jo(j){var B=-1,P=Array(j.size);return j.forEach(function(Se,qe){P[++B]=[qe,Se]}),P}function vu(j,B){return function(P){return j(B(P))}}function na(j,B){for(var P=-1,Se=j.length,qe=0,kt=[];++P<Se;){var Qt=j[P];(Qt===B||Qt===y)&&(j[P]=y,kt[qe++]=P)}return kt}function oi(j){var B=-1,P=Array(j.size);return j.forEach(function(Se){P[++B]=Se}),P}function jg(j){var B=-1,P=Array(j.size);return j.forEach(function(Se){P[++B]=[Se,Se]}),P}function Lg(j,B,P){for(var Se=P-1,qe=j.length;++Se<qe;)if(j[Se]===B)return Se;return-1}function kg(j,B,P){for(var Se=P+1;Se--;)if(j[Se]===B)return Se;return Se}function Ja(j){return Ka(j)?Ig(j):hg(j)}function sr(j){return Ka(j)?Eg(j):fg(j)}function _u(j){for(var B=j.length;B--&&Ha.test(j.charAt(B)););return B}var Mg=Yo(ag);function Ig(j){for(var B=zn.lastIndex=0;zn.test(j);)++B;return B}function Eg(j){return j.match(zn)||[]}function Ag(j){return j.match(qa)||[]}var Pg=function j(B){B=B==null?sn:Qa.defaults(sn.Object(),B,Qa.pick(sn,eg));var P=B.Array,Se=B.Date,qe=B.Error,kt=B.Function,Qt=B.Math,Ft=B.Object,Qo=B.RegExp,Tg=B.String,Xn=B.TypeError,li=P.prototype,zg=kt.prototype,es=Ft.prototype,ci=B["__core-js_shared__"],ui=zg.toString,At=es.hasOwnProperty,Fg=0,yu=function(){var e=/[^.]+$/.exec(ci&&ci.keys&&ci.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),di=es.toString,Dg=ui.call(Ft),Rg=sn._,$g=Qo("^"+ui.call(At).replace(Mr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hi=ru?B.Buffer:a,ra=B.Symbol,fi=B.Uint8Array,Cu=hi?hi.allocUnsafe:a,pi=vu(Ft.getPrototypeOf,Ft),wu=Ft.create,bu=es.propertyIsEnumerable,gi=li.splice,Su=ra?ra.isConcatSpreadable:a,bs=ra?ra.iterator:a,_a=ra?ra.toStringTag:a,mi=function(){try{var e=Sa(Ft,"defineProperty");return e({},"",{}),e}catch{}}(),Og=B.clearTimeout!==sn.clearTimeout&&B.clearTimeout,Bg=Se&&Se.now!==sn.Date.now&&Se.now,Ng=B.setTimeout!==sn.setTimeout&&B.setTimeout,xi=Qt.ceil,vi=Qt.floor,el=Ft.getOwnPropertySymbols,Hg=hi?hi.isBuffer:a,ju=B.isFinite,Gg=li.join,Ug=vu(Ft.keys,Ft),en=Qt.max,hn=Qt.min,Vg=Se.now,Zg=B.parseInt,Lu=Qt.random,Wg=li.reverse,tl=Sa(B,"DataView"),Ss=Sa(B,"Map"),nl=Sa(B,"Promise"),ts=Sa(B,"Set"),js=Sa(B,"WeakMap"),Ls=Sa(Ft,"create"),_i=js&&new js,ns={},Yg=ja(tl),qg=ja(Ss),Xg=ja(nl),Kg=ja(ts),Jg=ja(js),yi=ra?ra.prototype:a,ks=yi?yi.valueOf:a,ku=yi?yi.toString:a;function x(e){if(Yt(e)&&!et(e)&&!(e instanceof mt)){if(e instanceof Kn)return e;if(At.call(e,"__wrapped__"))return Md(e)}return new Kn(e)}var rs=function(){function e(){}return function(n){if(!Zt(n))return{};if(wu)return wu(n);e.prototype=n;var i=new e;return e.prototype=a,i}}();function Ci(){}function Kn(e,n){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=a}x.templateSettings={escape:jr,evaluate:Lr,interpolate:En,variable:"",imports:{_:x}},x.prototype=Ci.prototype,x.prototype.constructor=x,Kn.prototype=rs(Ci.prototype),Kn.prototype.constructor=Kn;function mt(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=q,this.__views__=[]}function Qg(){var e=new mt(this.__wrapped__);return e.__actions__=wn(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=wn(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=wn(this.__views__),e}function em(){if(this.__filtered__){var e=new mt(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function tm(){var e=this.__wrapped__.value(),n=this.__dir__,i=et(e),u=n<0,p=i?e.length:0,v=f0(0,p,this.__views__),C=v.start,w=v.end,M=w-C,V=u?w:C-1,Z=this.__iteratees__,ee=Z.length,ve=0,Te=hn(M,this.__takeCount__);if(!i||!u&&p==M&&Te==M)return Ku(e,this.__actions__);var Ge=[];e:for(;M--&&ve<Te;){V+=n;for(var it=-1,Ue=e[V];++it<ee;){var gt=Z[it],Ct=gt.iteratee,On=gt.type,xn=Ct(Ue);if(On==xt)Ue=xn;else if(!xn){if(On==Pe)continue e;break e}}Ge[ve++]=Ue}return Ge}mt.prototype=rs(Ci.prototype),mt.prototype.constructor=mt;function ya(e){var n=-1,i=e==null?0:e.length;for(this.clear();++n<i;){var u=e[n];this.set(u[0],u[1])}}function nm(){this.__data__=Ls?Ls(null):{},this.size=0}function rm(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}function am(e){var n=this.__data__;if(Ls){var i=n[e];return i===f?a:i}return At.call(n,e)?n[e]:a}function sm(e){var n=this.__data__;return Ls?n[e]!==a:At.call(n,e)}function im(e,n){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Ls&&n===a?f:n,this}ya.prototype.clear=nm,ya.prototype.delete=rm,ya.prototype.get=am,ya.prototype.has=sm,ya.prototype.set=im;function Tr(e){var n=-1,i=e==null?0:e.length;for(this.clear();++n<i;){var u=e[n];this.set(u[0],u[1])}}function om(){this.__data__=[],this.size=0}function lm(e){var n=this.__data__,i=wi(n,e);if(i<0)return!1;var u=n.length-1;return i==u?n.pop():gi.call(n,i,1),--this.size,!0}function cm(e){var n=this.__data__,i=wi(n,e);return i<0?a:n[i][1]}function um(e){return wi(this.__data__,e)>-1}function dm(e,n){var i=this.__data__,u=wi(i,e);return u<0?(++this.size,i.push([e,n])):i[u][1]=n,this}Tr.prototype.clear=om,Tr.prototype.delete=lm,Tr.prototype.get=cm,Tr.prototype.has=um,Tr.prototype.set=dm;function zr(e){var n=-1,i=e==null?0:e.length;for(this.clear();++n<i;){var u=e[n];this.set(u[0],u[1])}}function hm(){this.size=0,this.__data__={hash:new ya,map:new(Ss||Tr),string:new ya}}function fm(e){var n=zi(this,e).delete(e);return this.size-=n?1:0,n}function pm(e){return zi(this,e).get(e)}function gm(e){return zi(this,e).has(e)}function mm(e,n){var i=zi(this,e),u=i.size;return i.set(e,n),this.size+=i.size==u?0:1,this}zr.prototype.clear=hm,zr.prototype.delete=fm,zr.prototype.get=pm,zr.prototype.has=gm,zr.prototype.set=mm;function Ca(e){var n=-1,i=e==null?0:e.length;for(this.__data__=new zr;++n<i;)this.add(e[n])}function xm(e){return this.__data__.set(e,f),this}function vm(e){return this.__data__.has(e)}Ca.prototype.add=Ca.prototype.push=xm,Ca.prototype.has=vm;function ir(e){var n=this.__data__=new Tr(e);this.size=n.size}function _m(){this.__data__=new Tr,this.size=0}function ym(e){var n=this.__data__,i=n.delete(e);return this.size=n.size,i}function Cm(e){return this.__data__.get(e)}function wm(e){return this.__data__.has(e)}function bm(e,n){var i=this.__data__;if(i instanceof Tr){var u=i.__data__;if(!Ss||u.length<h-1)return u.push([e,n]),this.size=++i.size,this;i=this.__data__=new zr(u)}return i.set(e,n),this.size=i.size,this}ir.prototype.clear=_m,ir.prototype.delete=ym,ir.prototype.get=Cm,ir.prototype.has=wm,ir.prototype.set=bm;function Mu(e,n){var i=et(e),u=!i&&La(e),p=!i&&!u&&la(e),v=!i&&!u&&!p&&os(e),C=i||u||p||v,w=C?Xo(e.length,Tg):[],M=w.length;for(var V in e)(n||At.call(e,V))&&!(C&&(V=="length"||p&&(V=="offset"||V=="parent")||v&&(V=="buffer"||V=="byteLength"||V=="byteOffset")||$r(V,M)))&&w.push(V);return w}function Iu(e){var n=e.length;return n?e[fl(0,n-1)]:a}function Sm(e,n){return Fi(wn(e),wa(n,0,e.length))}function jm(e){return Fi(wn(e))}function rl(e,n,i){(i!==a&&!or(e[n],i)||i===a&&!(n in e))&&Fr(e,n,i)}function Ms(e,n,i){var u=e[n];(!(At.call(e,n)&&or(u,i))||i===a&&!(n in e))&&Fr(e,n,i)}function wi(e,n){for(var i=e.length;i--;)if(or(e[i][0],n))return i;return-1}function Lm(e,n,i,u){return aa(e,function(p,v,C){n(u,p,i(p),C)}),u}function Eu(e,n){return e&&mr(n,rn(n),e)}function km(e,n){return e&&mr(n,Sn(n),e)}function Fr(e,n,i){n=="__proto__"&&mi?mi(e,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[n]=i}function al(e,n){for(var i=-1,u=n.length,p=P(u),v=e==null;++i<u;)p[i]=v?a:$l(e,n[i]);return p}function wa(e,n,i){return e===e&&(i!==a&&(e=e<=i?e:i),n!==a&&(e=e>=n?e:n)),e}function Jn(e,n,i,u,p,v){var C,w=n&_,M=n&S,V=n&b;if(i&&(C=p?i(e,u,p,v):i(e)),C!==a)return C;if(!Zt(e))return e;var Z=et(e);if(Z){if(C=g0(e),!w)return wn(e,C)}else{var ee=fn(e),ve=ee==Ke||ee==Vt;if(la(e))return ed(e,w);if(ee==oe||ee==W||ve&&!p){if(C=M||ve?{}:_d(e),!w)return M?a0(e,km(C,e)):r0(e,Eu(C,e))}else{if(!Rt[ee])return p?e:{};C=m0(e,ee,w)}}v||(v=new ir);var Te=v.get(e);if(Te)return Te;v.set(e,C),Yd(e)?e.forEach(function(Ue){C.add(Jn(Ue,n,i,Ue,e,v))}):Zd(e)&&e.forEach(function(Ue,gt){C.set(gt,Jn(Ue,n,i,gt,e,v))});var Ge=V?M?Sl:bl:M?Sn:rn,it=Z?a:Ge(e);return qn(it||e,function(Ue,gt){it&&(gt=Ue,Ue=e[gt]),Ms(C,gt,Jn(Ue,n,i,gt,e,v))}),C}function Mm(e){var n=rn(e);return function(i){return Au(i,e,n)}}function Au(e,n,i){var u=i.length;if(e==null)return!u;for(e=Ft(e);u--;){var p=i[u],v=n[p],C=e[p];if(C===a&&!(p in e)||!v(C))return!1}return!0}function Pu(e,n,i){if(typeof e!="function")throw new Xn(c);return Fs(function(){e.apply(a,i)},n)}function Is(e,n,i,u){var p=-1,v=si,C=!0,w=e.length,M=[],V=n.length;if(!w)return M;i&&(n=Ut(n,Dn(i))),u?(v=Uo,C=!1):n.length>=h&&(v=ws,C=!1,n=new Ca(n));e:for(;++p<w;){var Z=e[p],ee=i==null?Z:i(Z);if(Z=u||Z!==0?Z:0,C&&ee===ee){for(var ve=V;ve--;)if(n[ve]===ee)continue e;M.push(Z)}else v(n,ee,u)||M.push(Z)}return M}var aa=sd(gr),Tu=sd(il,!0);function Im(e,n){var i=!0;return aa(e,function(u,p,v){return i=!!n(u,p,v),i}),i}function bi(e,n,i){for(var u=-1,p=e.length;++u<p;){var v=e[u],C=n(v);if(C!=null&&(w===a?C===C&&!$n(C):i(C,w)))var w=C,M=v}return M}function Em(e,n,i,u){var p=e.length;for(i=nt(i),i<0&&(i=-i>p?0:p+i),u=u===a||u>p?p:nt(u),u<0&&(u+=p),u=i>u?0:Xd(u);i<u;)e[i++]=n;return e}function zu(e,n){var i=[];return aa(e,function(u,p,v){n(u,p,v)&&i.push(u)}),i}function on(e,n,i,u,p){var v=-1,C=e.length;for(i||(i=v0),p||(p=[]);++v<C;){var w=e[v];n>0&&i(w)?n>1?on(w,n-1,i,u,p):ta(p,w):u||(p[p.length]=w)}return p}var sl=id(),Fu=id(!0);function gr(e,n){return e&&sl(e,n,rn)}function il(e,n){return e&&Fu(e,n,rn)}function Si(e,n){return ea(n,function(i){return Or(e[i])})}function ba(e,n){n=ia(n,e);for(var i=0,u=n.length;e!=null&&i<u;)e=e[xr(n[i++])];return i&&i==u?e:a}function Du(e,n,i){var u=n(e);return et(e)?u:ta(u,i(e))}function gn(e){return e==null?e===a?D:je:_a&&_a in Ft(e)?h0(e):j0(e)}function ol(e,n){return e>n}function Am(e,n){return e!=null&&At.call(e,n)}function Pm(e,n){return e!=null&&n in Ft(e)}function Tm(e,n,i){return e>=hn(n,i)&&e<en(n,i)}function ll(e,n,i){for(var u=i?Uo:si,p=e[0].length,v=e.length,C=v,w=P(v),M=1/0,V=[];C--;){var Z=e[C];C&&n&&(Z=Ut(Z,Dn(n))),M=hn(Z.length,M),w[C]=!i&&(n||p>=120&&Z.length>=120)?new Ca(C&&Z):a}Z=e[0];var ee=-1,ve=w[0];e:for(;++ee<p&&V.length<M;){var Te=Z[ee],Ge=n?n(Te):Te;if(Te=i||Te!==0?Te:0,!(ve?ws(ve,Ge):u(V,Ge,i))){for(C=v;--C;){var it=w[C];if(!(it?ws(it,Ge):u(e[C],Ge,i)))continue e}ve&&ve.push(Ge),V.push(Te)}}return V}function zm(e,n,i,u){return gr(e,function(p,v,C){n(u,i(p),v,C)}),u}function Es(e,n,i){n=ia(n,e),e=bd(e,n);var u=e==null?e:e[xr(er(n))];return u==null?a:Fn(u,e,i)}function Ru(e){return Yt(e)&&gn(e)==W}function Fm(e){return Yt(e)&&gn(e)==Oe}function Dm(e){return Yt(e)&&gn(e)==Ne}function As(e,n,i,u,p){return e===n?!0:e==null||n==null||!Yt(e)&&!Yt(n)?e!==e&&n!==n:Rm(e,n,i,u,As,p)}function Rm(e,n,i,u,p,v){var C=et(e),w=et(n),M=C?he:fn(e),V=w?he:fn(n);M=M==W?oe:M,V=V==W?oe:V;var Z=M==oe,ee=V==oe,ve=M==V;if(ve&&la(e)){if(!la(n))return!1;C=!0,Z=!1}if(ve&&!Z)return v||(v=new ir),C||os(e)?md(e,n,i,u,p,v):u0(e,n,M,i,u,p,v);if(!(i&T)){var Te=Z&&At.call(e,"__wrapped__"),Ge=ee&&At.call(n,"__wrapped__");if(Te||Ge){var it=Te?e.value():e,Ue=Ge?n.value():n;return v||(v=new ir),p(it,Ue,i,u,v)}}return ve?(v||(v=new ir),d0(e,n,i,u,p,v)):!1}function $m(e){return Yt(e)&&fn(e)==E}function cl(e,n,i,u){var p=i.length,v=p,C=!u;if(e==null)return!v;for(e=Ft(e);p--;){var w=i[p];if(C&&w[2]?w[1]!==e[w[0]]:!(w[0]in e))return!1}for(;++p<v;){w=i[p];var M=w[0],V=e[M],Z=w[1];if(C&&w[2]){if(V===a&&!(M in e))return!1}else{var ee=new ir;if(u)var ve=u(V,Z,M,e,n,ee);if(!(ve===a?As(Z,V,T|z,u,ee):ve))return!1}}return!0}function $u(e){if(!Zt(e)||y0(e))return!1;var n=Or(e)?$g:Er;return n.test(ja(e))}function Om(e){return Yt(e)&&gn(e)==vt}function Bm(e){return Yt(e)&&fn(e)==Je}function Nm(e){return Yt(e)&&Ni(e.length)&&!!Ht[gn(e)]}function Ou(e){return typeof e=="function"?e:e==null?jn:typeof e=="object"?et(e)?Hu(e[0],e[1]):Nu(e):oh(e)}function ul(e){if(!zs(e))return Ug(e);var n=[];for(var i in Ft(e))At.call(e,i)&&i!="constructor"&&n.push(i);return n}function Hm(e){if(!Zt(e))return S0(e);var n=zs(e),i=[];for(var u in e)u=="constructor"&&(n||!At.call(e,u))||i.push(u);return i}function dl(e,n){return e<n}function Bu(e,n){var i=-1,u=bn(e)?P(e.length):[];return aa(e,function(p,v,C){u[++i]=n(p,v,C)}),u}function Nu(e){var n=Ll(e);return n.length==1&&n[0][2]?Cd(n[0][0],n[0][1]):function(i){return i===e||cl(i,e,n)}}function Hu(e,n){return Ml(e)&&yd(n)?Cd(xr(e),n):function(i){var u=$l(i,e);return u===a&&u===n?Ol(i,e):As(n,u,T|z)}}function ji(e,n,i,u,p){e!==n&&sl(n,function(v,C){if(p||(p=new ir),Zt(v))Gm(e,n,C,i,ji,u,p);else{var w=u?u(El(e,C),v,C+"",e,n,p):a;w===a&&(w=v),rl(e,C,w)}},Sn)}function Gm(e,n,i,u,p,v,C){var w=El(e,i),M=El(n,i),V=C.get(M);if(V){rl(e,i,V);return}var Z=v?v(w,M,i+"",e,n,C):a,ee=Z===a;if(ee){var ve=et(M),Te=!ve&&la(M),Ge=!ve&&!Te&&os(M);Z=M,ve||Te||Ge?et(w)?Z=w:qt(w)?Z=wn(w):Te?(ee=!1,Z=ed(M,!0)):Ge?(ee=!1,Z=td(M,!0)):Z=[]:Ds(M)||La(M)?(Z=w,La(w)?Z=Kd(w):(!Zt(w)||Or(w))&&(Z=_d(M))):ee=!1}ee&&(C.set(M,Z),p(Z,M,u,v,C),C.delete(M)),rl(e,i,Z)}function Gu(e,n){var i=e.length;if(i)return n+=n<0?i:0,$r(n,i)?e[n]:a}function Uu(e,n,i){n.length?n=Ut(n,function(v){return et(v)?function(C){return ba(C,v.length===1?v[0]:v)}:v}):n=[jn];var u=-1;n=Ut(n,Dn(He()));var p=Bu(e,function(v,C,w){var M=Ut(n,function(V){return V(v)});return{criteria:M,index:++u,value:v}});return mg(p,function(v,C){return n0(v,C,i)})}function Um(e,n){return Vu(e,n,function(i,u){return Ol(e,u)})}function Vu(e,n,i){for(var u=-1,p=n.length,v={};++u<p;){var C=n[u],w=ba(e,C);i(w,C)&&Ps(v,ia(C,e),w)}return v}function Vm(e){return function(n){return ba(n,e)}}function hl(e,n,i,u){var p=u?gg:Xa,v=-1,C=n.length,w=e;for(e===n&&(n=wn(n)),i&&(w=Ut(e,Dn(i)));++v<C;)for(var M=0,V=n[v],Z=i?i(V):V;(M=p(w,Z,M,u))>-1;)w!==e&&gi.call(w,M,1),gi.call(e,M,1);return e}function Zu(e,n){for(var i=e?n.length:0,u=i-1;i--;){var p=n[i];if(i==u||p!==v){var v=p;$r(p)?gi.call(e,p,1):ml(e,p)}}return e}function fl(e,n){return e+vi(Lu()*(n-e+1))}function Zm(e,n,i,u){for(var p=-1,v=en(xi((n-e)/(i||1)),0),C=P(v);v--;)C[u?v:++p]=e,e+=i;return C}function pl(e,n){var i="";if(!e||n<1||n>bt)return i;do n%2&&(i+=e),n=vi(n/2),n&&(e+=e);while(n);return i}function lt(e,n){return Al(wd(e,n,jn),e+"")}function Wm(e){return Iu(ls(e))}function Ym(e,n){var i=ls(e);return Fi(i,wa(n,0,i.length))}function Ps(e,n,i,u){if(!Zt(e))return e;n=ia(n,e);for(var p=-1,v=n.length,C=v-1,w=e;w!=null&&++p<v;){var M=xr(n[p]),V=i;if(M==="__proto__"||M==="constructor"||M==="prototype")return e;if(p!=C){var Z=w[M];V=u?u(Z,M,w):a,V===a&&(V=Zt(Z)?Z:$r(n[p+1])?[]:{})}Ms(w,M,V),w=w[M]}return e}var Wu=_i?function(e,n){return _i.set(e,n),e}:jn,qm=mi?function(e,n){return mi(e,"toString",{configurable:!0,enumerable:!1,value:Nl(n),writable:!0})}:jn;function Xm(e){return Fi(ls(e))}function Qn(e,n,i){var u=-1,p=e.length;n<0&&(n=-n>p?0:p+n),i=i>p?p:i,i<0&&(i+=p),p=n>i?0:i-n>>>0,n>>>=0;for(var v=P(p);++u<p;)v[u]=e[u+n];return v}function Km(e,n){var i;return aa(e,function(u,p,v){return i=n(u,p,v),!i}),!!i}function Li(e,n,i){var u=0,p=e==null?u:e.length;if(typeof n=="number"&&n===n&&p<=G){for(;u<p;){var v=u+p>>>1,C=e[v];C!==null&&!$n(C)&&(i?C<=n:C<n)?u=v+1:p=v}return p}return gl(e,n,jn,i)}function gl(e,n,i,u){var p=0,v=e==null?0:e.length;if(v===0)return 0;n=i(n);for(var C=n!==n,w=n===null,M=$n(n),V=n===a;p<v;){var Z=vi((p+v)/2),ee=i(e[Z]),ve=ee!==a,Te=ee===null,Ge=ee===ee,it=$n(ee);if(C)var Ue=u||Ge;else V?Ue=Ge&&(u||ve):w?Ue=Ge&&ve&&(u||!Te):M?Ue=Ge&&ve&&!Te&&(u||!it):Te||it?Ue=!1:Ue=u?ee<=n:ee<n;Ue?p=Z+1:v=Z}return hn(v,ke)}function Yu(e,n){for(var i=-1,u=e.length,p=0,v=[];++i<u;){var C=e[i],w=n?n(C):C;if(!i||!or(w,M)){var M=w;v[p++]=C===0?0:C}}return v}function qu(e){return typeof e=="number"?e:$n(e)?rt:+e}function Rn(e){if(typeof e=="string")return e;if(et(e))return Ut(e,Rn)+"";if($n(e))return ku?ku.call(e):"";var n=e+"";return n=="0"&&1/e==-jt?"-0":n}function sa(e,n,i){var u=-1,p=si,v=e.length,C=!0,w=[],M=w;if(i)C=!1,p=Uo;else if(v>=h){var V=n?null:l0(e);if(V)return oi(V);C=!1,p=ws,M=new Ca}else M=n?[]:w;e:for(;++u<v;){var Z=e[u],ee=n?n(Z):Z;if(Z=i||Z!==0?Z:0,C&&ee===ee){for(var ve=M.length;ve--;)if(M[ve]===ee)continue e;n&&M.push(ee),w.push(Z)}else p(M,ee,i)||(M!==w&&M.push(ee),w.push(Z))}return w}function ml(e,n){return n=ia(n,e),e=bd(e,n),e==null||delete e[xr(er(n))]}function Xu(e,n,i,u){return Ps(e,n,i(ba(e,n)),u)}function ki(e,n,i,u){for(var p=e.length,v=u?p:-1;(u?v--:++v<p)&&n(e[v],v,e););return i?Qn(e,u?0:v,u?v+1:p):Qn(e,u?v+1:0,u?p:v)}function Ku(e,n){var i=e;return i instanceof mt&&(i=i.value()),Vo(n,function(u,p){return p.func.apply(p.thisArg,ta([u],p.args))},i)}function xl(e,n,i){var u=e.length;if(u<2)return u?sa(e[0]):[];for(var p=-1,v=P(u);++p<u;)for(var C=e[p],w=-1;++w<u;)w!=p&&(v[p]=Is(v[p]||C,e[w],n,i));return sa(on(v,1),n,i)}function Ju(e,n,i){for(var u=-1,p=e.length,v=n.length,C={};++u<p;){var w=u<v?n[u]:a;i(C,e[u],w)}return C}function vl(e){return qt(e)?e:[]}function _l(e){return typeof e=="function"?e:jn}function ia(e,n){return et(e)?e:Ml(e,n)?[e]:kd(Et(e))}var Jm=lt;function oa(e,n,i){var u=e.length;return i=i===a?u:i,!n&&i>=u?e:Qn(e,n,i)}var Qu=Og||function(e){return sn.clearTimeout(e)};function ed(e,n){if(n)return e.slice();var i=e.length,u=Cu?Cu(i):new e.constructor(i);return e.copy(u),u}function yl(e){var n=new e.constructor(e.byteLength);return new fi(n).set(new fi(e)),n}function Qm(e,n){var i=n?yl(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}function e0(e){var n=new e.constructor(e.source,Ir.exec(e));return n.lastIndex=e.lastIndex,n}function t0(e){return ks?Ft(ks.call(e)):{}}function td(e,n){var i=n?yl(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}function nd(e,n){if(e!==n){var i=e!==a,u=e===null,p=e===e,v=$n(e),C=n!==a,w=n===null,M=n===n,V=$n(n);if(!w&&!V&&!v&&e>n||v&&C&&M&&!w&&!V||u&&C&&M||!i&&M||!p)return 1;if(!u&&!v&&!V&&e<n||V&&i&&p&&!u&&!v||w&&i&&p||!C&&p||!M)return-1}return 0}function n0(e,n,i){for(var u=-1,p=e.criteria,v=n.criteria,C=p.length,w=i.length;++u<C;){var M=nd(p[u],v[u]);if(M){if(u>=w)return M;var V=i[u];return M*(V=="desc"?-1:1)}}return e.index-n.index}function rd(e,n,i,u){for(var p=-1,v=e.length,C=i.length,w=-1,M=n.length,V=en(v-C,0),Z=P(M+V),ee=!u;++w<M;)Z[w]=n[w];for(;++p<C;)(ee||p<v)&&(Z[i[p]]=e[p]);for(;V--;)Z[w++]=e[p++];return Z}function ad(e,n,i,u){for(var p=-1,v=e.length,C=-1,w=i.length,M=-1,V=n.length,Z=en(v-w,0),ee=P(Z+V),ve=!u;++p<Z;)ee[p]=e[p];for(var Te=p;++M<V;)ee[Te+M]=n[M];for(;++C<w;)(ve||p<v)&&(ee[Te+i[C]]=e[p++]);return ee}function wn(e,n){var i=-1,u=e.length;for(n||(n=P(u));++i<u;)n[i]=e[i];return n}function mr(e,n,i,u){var p=!i;i||(i={});for(var v=-1,C=n.length;++v<C;){var w=n[v],M=u?u(i[w],e[w],w,i,e):a;M===a&&(M=e[w]),p?Fr(i,w,M):Ms(i,w,M)}return i}function r0(e,n){return mr(e,kl(e),n)}function a0(e,n){return mr(e,xd(e),n)}function Mi(e,n){return function(i,u){var p=et(i)?cg:Lm,v=n?n():{};return p(i,e,He(u,2),v)}}function as(e){return lt(function(n,i){var u=-1,p=i.length,v=p>1?i[p-1]:a,C=p>2?i[2]:a;for(v=e.length>3&&typeof v=="function"?(p--,v):a,C&&mn(i[0],i[1],C)&&(v=p<3?a:v,p=1),n=Ft(n);++u<p;){var w=i[u];w&&e(n,w,u,v)}return n})}function sd(e,n){return function(i,u){if(i==null)return i;if(!bn(i))return e(i,u);for(var p=i.length,v=n?p:-1,C=Ft(i);(n?v--:++v<p)&&u(C[v],v,C)!==!1;);return i}}function id(e){return function(n,i,u){for(var p=-1,v=Ft(n),C=u(n),w=C.length;w--;){var M=C[e?w:++p];if(i(v[M],M,v)===!1)break}return n}}function s0(e,n,i){var u=n&J,p=Ts(e);function v(){var C=this&&this!==sn&&this instanceof v?p:e;return C.apply(u?i:this,arguments)}return v}function od(e){return function(n){n=Et(n);var i=Ka(n)?sr(n):a,u=i?i[0]:n.charAt(0),p=i?oa(i,1).join(""):n.slice(1);return u[e]()+p}}function ss(e){return function(n){return Vo(sh(ah(n).replace(pr,"")),e,"")}}function Ts(e){return function(){var n=arguments;switch(n.length){case 0:return new e;case 1:return new e(n[0]);case 2:return new e(n[0],n[1]);case 3:return new e(n[0],n[1],n[2]);case 4:return new e(n[0],n[1],n[2],n[3]);case 5:return new e(n[0],n[1],n[2],n[3],n[4]);case 6:return new e(n[0],n[1],n[2],n[3],n[4],n[5]);case 7:return new e(n[0],n[1],n[2],n[3],n[4],n[5],n[6])}var i=rs(e.prototype),u=e.apply(i,n);return Zt(u)?u:i}}function i0(e,n,i){var u=Ts(e);function p(){for(var v=arguments.length,C=P(v),w=v,M=is(p);w--;)C[w]=arguments[w];var V=v<3&&C[0]!==M&&C[v-1]!==M?[]:na(C,M);if(v-=V.length,v<i)return hd(e,n,Ii,p.placeholder,a,C,V,a,a,i-v);var Z=this&&this!==sn&&this instanceof p?u:e;return Fn(Z,this,C)}return p}function ld(e){return function(n,i,u){var p=Ft(n);if(!bn(n)){var v=He(i,3);n=rn(n),i=function(w){return v(p[w],w,p)}}var C=e(n,i,u);return C>-1?p[v?n[C]:C]:a}}function cd(e){return Rr(function(n){var i=n.length,u=i,p=Kn.prototype.thru;for(e&&n.reverse();u--;){var v=n[u];if(typeof v!="function")throw new Xn(c);if(p&&!C&&Ti(v)=="wrapper")var C=new Kn([],!0)}for(u=C?u:i;++u<i;){v=n[u];var w=Ti(v),M=w=="wrapper"?jl(v):a;M&&Il(M[0])&&M[1]==(Ee|re|ce|Le)&&!M[4].length&&M[9]==1?C=C[Ti(M[0])].apply(C,M[3]):C=v.length==1&&Il(v)?C[w]():C.thru(v)}return function(){var V=arguments,Z=V[0];if(C&&V.length==1&&et(Z))return C.plant(Z).value();for(var ee=0,ve=i?n[ee].apply(this,V):Z;++ee<i;)ve=n[ee].call(this,ve);return ve}})}function Ii(e,n,i,u,p,v,C,w,M,V){var Z=n&Ee,ee=n&J,ve=n&F,Te=n&(re|O),Ge=n&ge,it=ve?a:Ts(e);function Ue(){for(var gt=arguments.length,Ct=P(gt),On=gt;On--;)Ct[On]=arguments[On];if(Te)var xn=is(Ue),Bn=vg(Ct,xn);if(u&&(Ct=rd(Ct,u,p,Te)),v&&(Ct=ad(Ct,v,C,Te)),gt-=Bn,Te&&gt<V){var Xt=na(Ct,xn);return hd(e,n,Ii,Ue.placeholder,i,Ct,Xt,w,M,V-gt)}var lr=ee?i:this,Nr=ve?lr[e]:e;return gt=Ct.length,w?Ct=L0(Ct,w):Ge&&gt>1&&Ct.reverse(),Z&&M<gt&&(Ct.length=M),this&&this!==sn&&this instanceof Ue&&(Nr=it||Ts(Nr)),Nr.apply(lr,Ct)}return Ue}function ud(e,n){return function(i,u){return zm(i,e,n(u),{})}}function Ei(e,n){return function(i,u){var p;if(i===a&&u===a)return n;if(i!==a&&(p=i),u!==a){if(p===a)return u;typeof i=="string"||typeof u=="string"?(i=Rn(i),u=Rn(u)):(i=qu(i),u=qu(u)),p=e(i,u)}return p}}function Cl(e){return Rr(function(n){return n=Ut(n,Dn(He())),lt(function(i){var u=this;return e(n,function(p){return Fn(p,u,i)})})})}function Ai(e,n){n=n===a?" ":Rn(n);var i=n.length;if(i<2)return i?pl(n,e):n;var u=pl(n,xi(e/Ja(n)));return Ka(n)?oa(sr(u),0,e).join(""):u.slice(0,e)}function o0(e,n,i,u){var p=n&J,v=Ts(e);function C(){for(var w=-1,M=arguments.length,V=-1,Z=u.length,ee=P(Z+M),ve=this&&this!==sn&&this instanceof C?v:e;++V<Z;)ee[V]=u[V];for(;M--;)ee[V++]=arguments[++w];return Fn(ve,p?i:this,ee)}return C}function dd(e){return function(n,i,u){return u&&typeof u!="number"&&mn(n,i,u)&&(i=u=a),n=Br(n),i===a?(i=n,n=0):i=Br(i),u=u===a?n<i?1:-1:Br(u),Zm(n,i,u,e)}}function Pi(e){return function(n,i){return typeof n=="string"&&typeof i=="string"||(n=tr(n),i=tr(i)),e(n,i)}}function hd(e,n,i,u,p,v,C,w,M,V){var Z=n&re,ee=Z?C:a,ve=Z?a:C,Te=Z?v:a,Ge=Z?a:v;n|=Z?ce:xe,n&=~(Z?xe:ce),n&te||(n&=-4);var it=[e,n,p,Te,ee,Ge,ve,w,M,V],Ue=i.apply(a,it);return Il(e)&&Sd(Ue,it),Ue.placeholder=u,jd(Ue,e,n)}function wl(e){var n=Qt[e];return function(i,u){if(i=tr(i),u=u==null?0:hn(nt(u),292),u&&ju(i)){var p=(Et(i)+"e").split("e"),v=n(p[0]+"e"+(+p[1]+u));return p=(Et(v)+"e").split("e"),+(p[0]+"e"+(+p[1]-u))}return n(i)}}var l0=ts&&1/oi(new ts([,-0]))[1]==jt?function(e){return new ts(e)}:Ul;function fd(e){return function(n){var i=fn(n);return i==E?Jo(n):i==Je?jg(n):xg(n,e(n))}}function Dr(e,n,i,u,p,v,C,w){var M=n&F;if(!M&&typeof e!="function")throw new Xn(c);var V=u?u.length:0;if(V||(n&=-97,u=p=a),C=C===a?C:en(nt(C),0),w=w===a?w:nt(w),V-=p?p.length:0,n&xe){var Z=u,ee=p;u=p=a}var ve=M?a:jl(e),Te=[e,n,i,u,p,Z,ee,v,C,w];if(ve&&b0(Te,ve),e=Te[0],n=Te[1],i=Te[2],u=Te[3],p=Te[4],w=Te[9]=Te[9]===a?M?0:e.length:en(Te[9]-V,0),!w&&n&(re|O)&&(n&=-25),!n||n==J)var Ge=s0(e,n,i);else n==re||n==O?Ge=i0(e,n,w):(n==ce||n==(J|ce))&&!p.length?Ge=o0(e,n,i,u):Ge=Ii.apply(a,Te);var it=ve?Wu:Sd;return jd(it(Ge,Te),e,n)}function pd(e,n,i,u){return e===a||or(e,es[i])&&!At.call(u,i)?n:e}function gd(e,n,i,u,p,v){return Zt(e)&&Zt(n)&&(v.set(n,e),ji(e,n,a,gd,v),v.delete(n)),e}function c0(e){return Ds(e)?a:e}function md(e,n,i,u,p,v){var C=i&T,w=e.length,M=n.length;if(w!=M&&!(C&&M>w))return!1;var V=v.get(e),Z=v.get(n);if(V&&Z)return V==n&&Z==e;var ee=-1,ve=!0,Te=i&z?new Ca:a;for(v.set(e,n),v.set(n,e);++ee<w;){var Ge=e[ee],it=n[ee];if(u)var Ue=C?u(it,Ge,ee,n,e,v):u(Ge,it,ee,e,n,v);if(Ue!==a){if(Ue)continue;ve=!1;break}if(Te){if(!Zo(n,function(gt,Ct){if(!ws(Te,Ct)&&(Ge===gt||p(Ge,gt,i,u,v)))return Te.push(Ct)})){ve=!1;break}}else if(!(Ge===it||p(Ge,it,i,u,v))){ve=!1;break}}return v.delete(e),v.delete(n),ve}function u0(e,n,i,u,p,v,C){switch(i){case Fe:if(e.byteLength!=n.byteLength||e.byteOffset!=n.byteOffset)return!1;e=e.buffer,n=n.buffer;case Oe:return!(e.byteLength!=n.byteLength||!v(new fi(e),new fi(n)));case De:case Ne:case H:return or(+e,+n);case at:return e.name==n.name&&e.message==n.message;case vt:case dt:return e==n+"";case E:var w=Jo;case Je:var M=u&T;if(w||(w=oi),e.size!=n.size&&!M)return!1;var V=C.get(e);if(V)return V==n;u|=z,C.set(e,n);var Z=md(w(e),w(n),u,p,v,C);return C.delete(e),Z;case St:if(ks)return ks.call(e)==ks.call(n)}return!1}function d0(e,n,i,u,p,v){var C=i&T,w=bl(e),M=w.length,V=bl(n),Z=V.length;if(M!=Z&&!C)return!1;for(var ee=M;ee--;){var ve=w[ee];if(!(C?ve in n:At.call(n,ve)))return!1}var Te=v.get(e),Ge=v.get(n);if(Te&&Ge)return Te==n&&Ge==e;var it=!0;v.set(e,n),v.set(n,e);for(var Ue=C;++ee<M;){ve=w[ee];var gt=e[ve],Ct=n[ve];if(u)var On=C?u(Ct,gt,ve,n,e,v):u(gt,Ct,ve,e,n,v);if(!(On===a?gt===Ct||p(gt,Ct,i,u,v):On)){it=!1;break}Ue||(Ue=ve=="constructor")}if(it&&!Ue){var xn=e.constructor,Bn=n.constructor;xn!=Bn&&"constructor"in e&&"constructor"in n&&!(typeof xn=="function"&&xn instanceof xn&&typeof Bn=="function"&&Bn instanceof Bn)&&(it=!1)}return v.delete(e),v.delete(n),it}function Rr(e){return Al(wd(e,a,Ad),e+"")}function bl(e){return Du(e,rn,kl)}function Sl(e){return Du(e,Sn,xd)}var jl=_i?function(e){return _i.get(e)}:Ul;function Ti(e){for(var n=e.name+"",i=ns[n],u=At.call(ns,n)?i.length:0;u--;){var p=i[u],v=p.func;if(v==null||v==e)return p.name}return n}function is(e){var n=At.call(x,"placeholder")?x:e;return n.placeholder}function He(){var e=x.iteratee||Hl;return e=e===Hl?Ou:e,arguments.length?e(arguments[0],arguments[1]):e}function zi(e,n){var i=e.__data__;return _0(n)?i[typeof n=="string"?"string":"hash"]:i.map}function Ll(e){for(var n=rn(e),i=n.length;i--;){var u=n[i],p=e[u];n[i]=[u,p,yd(p)]}return n}function Sa(e,n){var i=wg(e,n);return $u(i)?i:a}function h0(e){var n=At.call(e,_a),i=e[_a];try{e[_a]=a;var u=!0}catch{}var p=di.call(e);return u&&(n?e[_a]=i:delete e[_a]),p}var kl=el?function(e){return e==null?[]:(e=Ft(e),ea(el(e),function(n){return bu.call(e,n)}))}:Vl,xd=el?function(e){for(var n=[];e;)ta(n,kl(e)),e=pi(e);return n}:Vl,fn=gn;(tl&&fn(new tl(new ArrayBuffer(1)))!=Fe||Ss&&fn(new Ss)!=E||nl&&fn(nl.resolve())!=Re||ts&&fn(new ts)!=Je||js&&fn(new js)!=fe)&&(fn=function(e){var n=gn(e),i=n==oe?e.constructor:a,u=i?ja(i):"";if(u)switch(u){case Yg:return Fe;case qg:return E;case Xg:return Re;case Kg:return Je;case Jg:return fe}return n});function f0(e,n,i){for(var u=-1,p=i.length;++u<p;){var v=i[u],C=v.size;switch(v.type){case"drop":e+=C;break;case"dropRight":n-=C;break;case"take":n=hn(n,e+C);break;case"takeRight":e=en(e,n-C);break}}return{start:e,end:n}}function p0(e){var n=e.match(pa);return n?n[1].split(Xs):[]}function vd(e,n,i){n=ia(n,e);for(var u=-1,p=n.length,v=!1;++u<p;){var C=xr(n[u]);if(!(v=e!=null&&i(e,C)))break;e=e[C]}return v||++u!=p?v:(p=e==null?0:e.length,!!p&&Ni(p)&&$r(C,p)&&(et(e)||La(e)))}function g0(e){var n=e.length,i=new e.constructor(n);return n&&typeof e[0]=="string"&&At.call(e,"index")&&(i.index=e.index,i.input=e.input),i}function _d(e){return typeof e.constructor=="function"&&!zs(e)?rs(pi(e)):{}}function m0(e,n,i){var u=e.constructor;switch(n){case Oe:return yl(e);case De:case Ne:return new u(+e);case Fe:return Qm(e,i);case Qe:case Bt:case Lt:case I:case $:case Q:case ue:case It:case Nt:return td(e,i);case E:return new u;case H:case dt:return new u(e);case vt:return e0(e);case Je:return new u;case St:return t0(e)}}function x0(e,n){var i=n.length;if(!i)return e;var u=i-1;return n[u]=(i>1?"& ":"")+n[u],n=n.join(i>2?", ":" "),e.replace(Ga,`{
/* [wrapped with `+n+`] */
`)}function v0(e){return et(e)||La(e)||!!(Su&&e&&e[Su])}function $r(e,n){var i=typeof e;return n=n??bt,!!n&&(i=="number"||i!="symbol"&&ms.test(e))&&e>-1&&e%1==0&&e<n}function mn(e,n,i){if(!Zt(i))return!1;var u=typeof n;return(u=="number"?bn(i)&&$r(n,i.length):u=="string"&&n in i)?or(i[n],e):!1}function Ml(e,n){if(et(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||$n(e)?!0:kr.test(e)||!qs.test(e)||n!=null&&e in Ft(n)}function _0(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}function Il(e){var n=Ti(e),i=x[n];if(typeof i!="function"||!(n in mt.prototype))return!1;if(e===i)return!0;var u=jl(i);return!!u&&e===u[0]}function y0(e){return!!yu&&yu in e}var C0=ci?Or:Zl;function zs(e){var n=e&&e.constructor,i=typeof n=="function"&&n.prototype||es;return e===i}function yd(e){return e===e&&!Zt(e)}function Cd(e,n){return function(i){return i==null?!1:i[e]===n&&(n!==a||e in Ft(i))}}function w0(e){var n=Oi(e,function(u){return i.size===m&&i.clear(),u}),i=n.cache;return n}function b0(e,n){var i=e[1],u=n[1],p=i|u,v=p<(J|F|Ee),C=u==Ee&&i==re||u==Ee&&i==Le&&e[7].length<=n[8]||u==(Ee|Le)&&n[7].length<=n[8]&&i==re;if(!(v||C))return e;u&J&&(e[2]=n[2],p|=i&J?0:te);var w=n[3];if(w){var M=e[3];e[3]=M?rd(M,w,n[4]):w,e[4]=M?na(e[3],y):n[4]}return w=n[5],w&&(M=e[5],e[5]=M?ad(M,w,n[6]):w,e[6]=M?na(e[5],y):n[6]),w=n[7],w&&(e[7]=w),u&Ee&&(e[8]=e[8]==null?n[8]:hn(e[8],n[8])),e[9]==null&&(e[9]=n[9]),e[0]=n[0],e[1]=p,e}function S0(e){var n=[];if(e!=null)for(var i in Ft(e))n.push(i);return n}function j0(e){return di.call(e)}function wd(e,n,i){return n=en(n===a?e.length-1:n,0),function(){for(var u=arguments,p=-1,v=en(u.length-n,0),C=P(v);++p<v;)C[p]=u[n+p];p=-1;for(var w=P(n+1);++p<n;)w[p]=u[p];return w[n]=i(C),Fn(e,this,w)}}function bd(e,n){return n.length<2?e:ba(e,Qn(n,0,-1))}function L0(e,n){for(var i=e.length,u=hn(n.length,i),p=wn(e);u--;){var v=n[u];e[u]=$r(v,i)?p[v]:a}return e}function El(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}var Sd=Ld(Wu),Fs=Ng||function(e,n){return sn.setTimeout(e,n)},Al=Ld(qm);function jd(e,n,i){var u=n+"";return Al(e,x0(u,k0(p0(u),i)))}function Ld(e){var n=0,i=0;return function(){var u=Vg(),p=Ce-(u-i);if(i=u,p>0){if(++n>=me)return arguments[0]}else n=0;return e.apply(a,arguments)}}function Fi(e,n){var i=-1,u=e.length,p=u-1;for(n=n===a?u:n;++i<n;){var v=fl(i,p),C=e[v];e[v]=e[i],e[i]=C}return e.length=n,e}var kd=w0(function(e){var n=[];return e.charCodeAt(0)===46&&n.push(""),e.replace(Na,function(i,u,p,v){n.push(p?v.replace(Jr,"$1"):u||i)}),n});function xr(e){if(typeof e=="string"||$n(e))return e;var n=e+"";return n=="0"&&1/e==-jt?"-0":n}function ja(e){if(e!=null){try{return ui.call(e)}catch{}try{return e+""}catch{}}return""}function k0(e,n){return qn(K,function(i){var u="_."+i[0];n&i[1]&&!si(e,u)&&e.push(u)}),e.sort()}function Md(e){if(e instanceof mt)return e.clone();var n=new Kn(e.__wrapped__,e.__chain__);return n.__actions__=wn(e.__actions__),n.__index__=e.__index__,n.__values__=e.__values__,n}function M0(e,n,i){(i?mn(e,n,i):n===a)?n=1:n=en(nt(n),0);var u=e==null?0:e.length;if(!u||n<1)return[];for(var p=0,v=0,C=P(xi(u/n));p<u;)C[v++]=Qn(e,p,p+=n);return C}function I0(e){for(var n=-1,i=e==null?0:e.length,u=0,p=[];++n<i;){var v=e[n];v&&(p[u++]=v)}return p}function E0(){var e=arguments.length;if(!e)return[];for(var n=P(e-1),i=arguments[0],u=e;u--;)n[u-1]=arguments[u];return ta(et(i)?wn(i):[i],on(n,1))}var A0=lt(function(e,n){return qt(e)?Is(e,on(n,1,qt,!0)):[]}),P0=lt(function(e,n){var i=er(n);return qt(i)&&(i=a),qt(e)?Is(e,on(n,1,qt,!0),He(i,2)):[]}),T0=lt(function(e,n){var i=er(n);return qt(i)&&(i=a),qt(e)?Is(e,on(n,1,qt,!0),a,i):[]});function z0(e,n,i){var u=e==null?0:e.length;return u?(n=i||n===a?1:nt(n),Qn(e,n<0?0:n,u)):[]}function F0(e,n,i){var u=e==null?0:e.length;return u?(n=i||n===a?1:nt(n),n=u-n,Qn(e,0,n<0?0:n)):[]}function D0(e,n){return e&&e.length?ki(e,He(n,3),!0,!0):[]}function R0(e,n){return e&&e.length?ki(e,He(n,3),!0):[]}function $0(e,n,i,u){var p=e==null?0:e.length;return p?(i&&typeof i!="number"&&mn(e,n,i)&&(i=0,u=p),Em(e,n,i,u)):[]}function Id(e,n,i){var u=e==null?0:e.length;if(!u)return-1;var p=i==null?0:nt(i);return p<0&&(p=en(u+p,0)),ii(e,He(n,3),p)}function Ed(e,n,i){var u=e==null?0:e.length;if(!u)return-1;var p=u-1;return i!==a&&(p=nt(i),p=i<0?en(u+p,0):hn(p,u-1)),ii(e,He(n,3),p,!0)}function Ad(e){var n=e==null?0:e.length;return n?on(e,1):[]}function O0(e){var n=e==null?0:e.length;return n?on(e,jt):[]}function B0(e,n){var i=e==null?0:e.length;return i?(n=n===a?1:nt(n),on(e,n)):[]}function N0(e){for(var n=-1,i=e==null?0:e.length,u={};++n<i;){var p=e[n];u[p[0]]=p[1]}return u}function Pd(e){return e&&e.length?e[0]:a}function H0(e,n,i){var u=e==null?0:e.length;if(!u)return-1;var p=i==null?0:nt(i);return p<0&&(p=en(u+p,0)),Xa(e,n,p)}function G0(e){var n=e==null?0:e.length;return n?Qn(e,0,-1):[]}var U0=lt(function(e){var n=Ut(e,vl);return n.length&&n[0]===e[0]?ll(n):[]}),V0=lt(function(e){var n=er(e),i=Ut(e,vl);return n===er(i)?n=a:i.pop(),i.length&&i[0]===e[0]?ll(i,He(n,2)):[]}),Z0=lt(function(e){var n=er(e),i=Ut(e,vl);return n=typeof n=="function"?n:a,n&&i.pop(),i.length&&i[0]===e[0]?ll(i,a,n):[]});function W0(e,n){return e==null?"":Gg.call(e,n)}function er(e){var n=e==null?0:e.length;return n?e[n-1]:a}function Y0(e,n,i){var u=e==null?0:e.length;if(!u)return-1;var p=u;return i!==a&&(p=nt(i),p=p<0?en(u+p,0):hn(p,u-1)),n===n?kg(e,n,p):ii(e,hu,p,!0)}function q0(e,n){return e&&e.length?Gu(e,nt(n)):a}var X0=lt(Td);function Td(e,n){return e&&e.length&&n&&n.length?hl(e,n):e}function K0(e,n,i){return e&&e.length&&n&&n.length?hl(e,n,He(i,2)):e}function J0(e,n,i){return e&&e.length&&n&&n.length?hl(e,n,a,i):e}var Q0=Rr(function(e,n){var i=e==null?0:e.length,u=al(e,n);return Zu(e,Ut(n,function(p){return $r(p,i)?+p:p}).sort(nd)),u});function ex(e,n){var i=[];if(!(e&&e.length))return i;var u=-1,p=[],v=e.length;for(n=He(n,3);++u<v;){var C=e[u];n(C,u,e)&&(i.push(C),p.push(u))}return Zu(e,p),i}function Pl(e){return e==null?e:Wg.call(e)}function tx(e,n,i){var u=e==null?0:e.length;return u?(i&&typeof i!="number"&&mn(e,n,i)?(n=0,i=u):(n=n==null?0:nt(n),i=i===a?u:nt(i)),Qn(e,n,i)):[]}function nx(e,n){return Li(e,n)}function rx(e,n,i){return gl(e,n,He(i,2))}function ax(e,n){var i=e==null?0:e.length;if(i){var u=Li(e,n);if(u<i&&or(e[u],n))return u}return-1}function sx(e,n){return Li(e,n,!0)}function ix(e,n,i){return gl(e,n,He(i,2),!0)}function ox(e,n){var i=e==null?0:e.length;if(i){var u=Li(e,n,!0)-1;if(or(e[u],n))return u}return-1}function lx(e){return e&&e.length?Yu(e):[]}function cx(e,n){return e&&e.length?Yu(e,He(n,2)):[]}function ux(e){var n=e==null?0:e.length;return n?Qn(e,1,n):[]}function dx(e,n,i){return e&&e.length?(n=i||n===a?1:nt(n),Qn(e,0,n<0?0:n)):[]}function hx(e,n,i){var u=e==null?0:e.length;return u?(n=i||n===a?1:nt(n),n=u-n,Qn(e,n<0?0:n,u)):[]}function fx(e,n){return e&&e.length?ki(e,He(n,3),!1,!0):[]}function px(e,n){return e&&e.length?ki(e,He(n,3)):[]}var gx=lt(function(e){return sa(on(e,1,qt,!0))}),mx=lt(function(e){var n=er(e);return qt(n)&&(n=a),sa(on(e,1,qt,!0),He(n,2))}),xx=lt(function(e){var n=er(e);return n=typeof n=="function"?n:a,sa(on(e,1,qt,!0),a,n)});function vx(e){return e&&e.length?sa(e):[]}function _x(e,n){return e&&e.length?sa(e,He(n,2)):[]}function yx(e,n){return n=typeof n=="function"?n:a,e&&e.length?sa(e,a,n):[]}function Tl(e){if(!(e&&e.length))return[];var n=0;return e=ea(e,function(i){if(qt(i))return n=en(i.length,n),!0}),Xo(n,function(i){return Ut(e,Wo(i))})}function zd(e,n){if(!(e&&e.length))return[];var i=Tl(e);return n==null?i:Ut(i,function(u){return Fn(n,a,u)})}var Cx=lt(function(e,n){return qt(e)?Is(e,n):[]}),wx=lt(function(e){return xl(ea(e,qt))}),bx=lt(function(e){var n=er(e);return qt(n)&&(n=a),xl(ea(e,qt),He(n,2))}),Sx=lt(function(e){var n=er(e);return n=typeof n=="function"?n:a,xl(ea(e,qt),a,n)}),jx=lt(Tl);function Lx(e,n){return Ju(e||[],n||[],Ms)}function kx(e,n){return Ju(e||[],n||[],Ps)}var Mx=lt(function(e){var n=e.length,i=n>1?e[n-1]:a;return i=typeof i=="function"?(e.pop(),i):a,zd(e,i)});function Fd(e){var n=x(e);return n.__chain__=!0,n}function Ix(e,n){return n(e),e}function Di(e,n){return n(e)}var Ex=Rr(function(e){var n=e.length,i=n?e[0]:0,u=this.__wrapped__,p=function(v){return al(v,e)};return n>1||this.__actions__.length||!(u instanceof mt)||!$r(i)?this.thru(p):(u=u.slice(i,+i+(n?1:0)),u.__actions__.push({func:Di,args:[p],thisArg:a}),new Kn(u,this.__chain__).thru(function(v){return n&&!v.length&&v.push(a),v}))});function Ax(){return Fd(this)}function Px(){return new Kn(this.value(),this.__chain__)}function Tx(){this.__values__===a&&(this.__values__=qd(this.value()));var e=this.__index__>=this.__values__.length,n=e?a:this.__values__[this.__index__++];return{done:e,value:n}}function zx(){return this}function Fx(e){for(var n,i=this;i instanceof Ci;){var u=Md(i);u.__index__=0,u.__values__=a,n?p.__wrapped__=u:n=u;var p=u;i=i.__wrapped__}return p.__wrapped__=e,n}function Dx(){var e=this.__wrapped__;if(e instanceof mt){var n=e;return this.__actions__.length&&(n=new mt(this)),n=n.reverse(),n.__actions__.push({func:Di,args:[Pl],thisArg:a}),new Kn(n,this.__chain__)}return this.thru(Pl)}function Rx(){return Ku(this.__wrapped__,this.__actions__)}var $x=Mi(function(e,n,i){At.call(e,i)?++e[i]:Fr(e,i,1)});function Ox(e,n,i){var u=et(e)?uu:Im;return i&&mn(e,n,i)&&(n=a),u(e,He(n,3))}function Bx(e,n){var i=et(e)?ea:zu;return i(e,He(n,3))}var Nx=ld(Id),Hx=ld(Ed);function Gx(e,n){return on(Ri(e,n),1)}function Ux(e,n){return on(Ri(e,n),jt)}function Vx(e,n,i){return i=i===a?1:nt(i),on(Ri(e,n),i)}function Dd(e,n){var i=et(e)?qn:aa;return i(e,He(n,3))}function Rd(e,n){var i=et(e)?ug:Tu;return i(e,He(n,3))}var Zx=Mi(function(e,n,i){At.call(e,i)?e[i].push(n):Fr(e,i,[n])});function Wx(e,n,i,u){e=bn(e)?e:ls(e),i=i&&!u?nt(i):0;var p=e.length;return i<0&&(i=en(p+i,0)),Hi(e)?i<=p&&e.indexOf(n,i)>-1:!!p&&Xa(e,n,i)>-1}var Yx=lt(function(e,n,i){var u=-1,p=typeof n=="function",v=bn(e)?P(e.length):[];return aa(e,function(C){v[++u]=p?Fn(n,C,i):Es(C,n,i)}),v}),qx=Mi(function(e,n,i){Fr(e,i,n)});function Ri(e,n){var i=et(e)?Ut:Bu;return i(e,He(n,3))}function Xx(e,n,i,u){return e==null?[]:(et(n)||(n=n==null?[]:[n]),i=u?a:i,et(i)||(i=i==null?[]:[i]),Uu(e,n,i))}var Kx=Mi(function(e,n,i){e[i?0:1].push(n)},function(){return[[],[]]});function Jx(e,n,i){var u=et(e)?Vo:pu,p=arguments.length<3;return u(e,He(n,4),i,p,aa)}function Qx(e,n,i){var u=et(e)?dg:pu,p=arguments.length<3;return u(e,He(n,4),i,p,Tu)}function ev(e,n){var i=et(e)?ea:zu;return i(e,Bi(He(n,3)))}function tv(e){var n=et(e)?Iu:Wm;return n(e)}function nv(e,n,i){(i?mn(e,n,i):n===a)?n=1:n=nt(n);var u=et(e)?Sm:Ym;return u(e,n)}function rv(e){var n=et(e)?jm:Xm;return n(e)}function av(e){if(e==null)return 0;if(bn(e))return Hi(e)?Ja(e):e.length;var n=fn(e);return n==E||n==Je?e.size:ul(e).length}function sv(e,n,i){var u=et(e)?Zo:Km;return i&&mn(e,n,i)&&(n=a),u(e,He(n,3))}var iv=lt(function(e,n){if(e==null)return[];var i=n.length;return i>1&&mn(e,n[0],n[1])?n=[]:i>2&&mn(n[0],n[1],n[2])&&(n=[n[0]]),Uu(e,on(n,1),[])}),$i=Bg||function(){return sn.Date.now()};function ov(e,n){if(typeof n!="function")throw new Xn(c);return e=nt(e),function(){if(--e<1)return n.apply(this,arguments)}}function $d(e,n,i){return n=i?a:n,n=e&&n==null?e.length:n,Dr(e,Ee,a,a,a,a,n)}function Od(e,n){var i;if(typeof n!="function")throw new Xn(c);return e=nt(e),function(){return--e>0&&(i=n.apply(this,arguments)),e<=1&&(n=a),i}}var zl=lt(function(e,n,i){var u=J;if(i.length){var p=na(i,is(zl));u|=ce}return Dr(e,u,n,i,p)}),Bd=lt(function(e,n,i){var u=J|F;if(i.length){var p=na(i,is(Bd));u|=ce}return Dr(n,u,e,i,p)});function Nd(e,n,i){n=i?a:n;var u=Dr(e,re,a,a,a,a,a,n);return u.placeholder=Nd.placeholder,u}function Hd(e,n,i){n=i?a:n;var u=Dr(e,O,a,a,a,a,a,n);return u.placeholder=Hd.placeholder,u}function Gd(e,n,i){var u,p,v,C,w,M,V=0,Z=!1,ee=!1,ve=!0;if(typeof e!="function")throw new Xn(c);n=tr(n)||0,Zt(i)&&(Z=!!i.leading,ee="maxWait"in i,v=ee?en(tr(i.maxWait)||0,n):v,ve="trailing"in i?!!i.trailing:ve);function Te(Xt){var lr=u,Nr=p;return u=p=a,V=Xt,C=e.apply(Nr,lr),C}function Ge(Xt){return V=Xt,w=Fs(gt,n),Z?Te(Xt):C}function it(Xt){var lr=Xt-M,Nr=Xt-V,lh=n-lr;return ee?hn(lh,v-Nr):lh}function Ue(Xt){var lr=Xt-M,Nr=Xt-V;return M===a||lr>=n||lr<0||ee&&Nr>=v}function gt(){var Xt=$i();if(Ue(Xt))return Ct(Xt);w=Fs(gt,it(Xt))}function Ct(Xt){return w=a,ve&&u?Te(Xt):(u=p=a,C)}function On(){w!==a&&Qu(w),V=0,u=M=p=w=a}function xn(){return w===a?C:Ct($i())}function Bn(){var Xt=$i(),lr=Ue(Xt);if(u=arguments,p=this,M=Xt,lr){if(w===a)return Ge(M);if(ee)return Qu(w),w=Fs(gt,n),Te(M)}return w===a&&(w=Fs(gt,n)),C}return Bn.cancel=On,Bn.flush=xn,Bn}var lv=lt(function(e,n){return Pu(e,1,n)}),cv=lt(function(e,n,i){return Pu(e,tr(n)||0,i)});function uv(e){return Dr(e,ge)}function Oi(e,n){if(typeof e!="function"||n!=null&&typeof n!="function")throw new Xn(c);var i=function(){var u=arguments,p=n?n.apply(this,u):u[0],v=i.cache;if(v.has(p))return v.get(p);var C=e.apply(this,u);return i.cache=v.set(p,C)||v,C};return i.cache=new(Oi.Cache||zr),i}Oi.Cache=zr;function Bi(e){if(typeof e!="function")throw new Xn(c);return function(){var n=arguments;switch(n.length){case 0:return!e.call(this);case 1:return!e.call(this,n[0]);case 2:return!e.call(this,n[0],n[1]);case 3:return!e.call(this,n[0],n[1],n[2])}return!e.apply(this,n)}}function dv(e){return Od(2,e)}var hv=Jm(function(e,n){n=n.length==1&&et(n[0])?Ut(n[0],Dn(He())):Ut(on(n,1),Dn(He()));var i=n.length;return lt(function(u){for(var p=-1,v=hn(u.length,i);++p<v;)u[p]=n[p].call(this,u[p]);return Fn(e,this,u)})}),Fl=lt(function(e,n){var i=na(n,is(Fl));return Dr(e,ce,a,n,i)}),Ud=lt(function(e,n){var i=na(n,is(Ud));return Dr(e,xe,a,n,i)}),fv=Rr(function(e,n){return Dr(e,Le,a,a,a,n)});function pv(e,n){if(typeof e!="function")throw new Xn(c);return n=n===a?n:nt(n),lt(e,n)}function gv(e,n){if(typeof e!="function")throw new Xn(c);return n=n==null?0:en(nt(n),0),lt(function(i){var u=i[n],p=oa(i,0,n);return u&&ta(p,u),Fn(e,this,p)})}function mv(e,n,i){var u=!0,p=!0;if(typeof e!="function")throw new Xn(c);return Zt(i)&&(u="leading"in i?!!i.leading:u,p="trailing"in i?!!i.trailing:p),Gd(e,n,{leading:u,maxWait:n,trailing:p})}function xv(e){return $d(e,1)}function vv(e,n){return Fl(_l(n),e)}function _v(){if(!arguments.length)return[];var e=arguments[0];return et(e)?e:[e]}function yv(e){return Jn(e,b)}function Cv(e,n){return n=typeof n=="function"?n:a,Jn(e,b,n)}function wv(e){return Jn(e,_|b)}function bv(e,n){return n=typeof n=="function"?n:a,Jn(e,_|b,n)}function Sv(e,n){return n==null||Au(e,n,rn(n))}function or(e,n){return e===n||e!==e&&n!==n}var jv=Pi(ol),Lv=Pi(function(e,n){return e>=n}),La=Ru(function(){return arguments}())?Ru:function(e){return Yt(e)&&At.call(e,"callee")&&!bu.call(e,"callee")},et=P.isArray,kv=au?Dn(au):Fm;function bn(e){return e!=null&&Ni(e.length)&&!Or(e)}function qt(e){return Yt(e)&&bn(e)}function Mv(e){return e===!0||e===!1||Yt(e)&&gn(e)==De}var la=Hg||Zl,Iv=su?Dn(su):Dm;function Ev(e){return Yt(e)&&e.nodeType===1&&!Ds(e)}function Av(e){if(e==null)return!0;if(bn(e)&&(et(e)||typeof e=="string"||typeof e.splice=="function"||la(e)||os(e)||La(e)))return!e.length;var n=fn(e);if(n==E||n==Je)return!e.size;if(zs(e))return!ul(e).length;for(var i in e)if(At.call(e,i))return!1;return!0}function Pv(e,n){return As(e,n)}function Tv(e,n,i){i=typeof i=="function"?i:a;var u=i?i(e,n):a;return u===a?As(e,n,a,i):!!u}function Dl(e){if(!Yt(e))return!1;var n=gn(e);return n==at||n==Ve||typeof e.message=="string"&&typeof e.name=="string"&&!Ds(e)}function zv(e){return typeof e=="number"&&ju(e)}function Or(e){if(!Zt(e))return!1;var n=gn(e);return n==Ke||n==Vt||n==de||n==Mt}function Vd(e){return typeof e=="number"&&e==nt(e)}function Ni(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=bt}function Zt(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}function Yt(e){return e!=null&&typeof e=="object"}var Zd=iu?Dn(iu):$m;function Fv(e,n){return e===n||cl(e,n,Ll(n))}function Dv(e,n,i){return i=typeof i=="function"?i:a,cl(e,n,Ll(n),i)}function Rv(e){return Wd(e)&&e!=+e}function $v(e){if(C0(e))throw new qe(o);return $u(e)}function Ov(e){return e===null}function Bv(e){return e==null}function Wd(e){return typeof e=="number"||Yt(e)&&gn(e)==H}function Ds(e){if(!Yt(e)||gn(e)!=oe)return!1;var n=pi(e);if(n===null)return!0;var i=At.call(n,"constructor")&&n.constructor;return typeof i=="function"&&i instanceof i&&ui.call(i)==Dg}var Rl=ou?Dn(ou):Om;function Nv(e){return Vd(e)&&e>=-bt&&e<=bt}var Yd=lu?Dn(lu):Bm;function Hi(e){return typeof e=="string"||!et(e)&&Yt(e)&&gn(e)==dt}function $n(e){return typeof e=="symbol"||Yt(e)&&gn(e)==St}var os=cu?Dn(cu):Nm;function Hv(e){return e===a}function Gv(e){return Yt(e)&&fn(e)==fe}function Uv(e){return Yt(e)&&gn(e)==Ae}var Vv=Pi(dl),Zv=Pi(function(e,n){return e<=n});function qd(e){if(!e)return[];if(bn(e))return Hi(e)?sr(e):wn(e);if(bs&&e[bs])return Sg(e[bs]());var n=fn(e),i=n==E?Jo:n==Je?oi:ls;return i(e)}function Br(e){if(!e)return e===0?e:0;if(e=tr(e),e===jt||e===-jt){var n=e<0?-1:1;return n*Dt}return e===e?e:0}function nt(e){var n=Br(e),i=n%1;return n===n?i?n-i:n:0}function Xd(e){return e?wa(nt(e),0,q):0}function tr(e){if(typeof e=="number")return e;if($n(e))return rt;if(Zt(e)){var n=typeof e.valueOf=="function"?e.valueOf():e;e=Zt(n)?n+"":n}if(typeof e!="string")return e===0?e:+e;e=gu(e);var i=Va.test(e);return i||Za.test(e)?og(e.slice(2),i?2:8):ga.test(e)?rt:+e}function Kd(e){return mr(e,Sn(e))}function Wv(e){return e?wa(nt(e),-bt,bt):e===0?e:0}function Et(e){return e==null?"":Rn(e)}var Yv=as(function(e,n){if(zs(n)||bn(n)){mr(n,rn(n),e);return}for(var i in n)At.call(n,i)&&Ms(e,i,n[i])}),Jd=as(function(e,n){mr(n,Sn(n),e)}),Gi=as(function(e,n,i,u){mr(n,Sn(n),e,u)}),qv=as(function(e,n,i,u){mr(n,rn(n),e,u)}),Xv=Rr(al);function Kv(e,n){var i=rs(e);return n==null?i:Eu(i,n)}var Jv=lt(function(e,n){e=Ft(e);var i=-1,u=n.length,p=u>2?n[2]:a;for(p&&mn(n[0],n[1],p)&&(u=1);++i<u;)for(var v=n[i],C=Sn(v),w=-1,M=C.length;++w<M;){var V=C[w],Z=e[V];(Z===a||or(Z,es[V])&&!At.call(e,V))&&(e[V]=v[V])}return e}),Qv=lt(function(e){return e.push(a,gd),Fn(Qd,a,e)});function e_(e,n){return du(e,He(n,3),gr)}function t_(e,n){return du(e,He(n,3),il)}function n_(e,n){return e==null?e:sl(e,He(n,3),Sn)}function r_(e,n){return e==null?e:Fu(e,He(n,3),Sn)}function a_(e,n){return e&&gr(e,He(n,3))}function s_(e,n){return e&&il(e,He(n,3))}function i_(e){return e==null?[]:Si(e,rn(e))}function o_(e){return e==null?[]:Si(e,Sn(e))}function $l(e,n,i){var u=e==null?a:ba(e,n);return u===a?i:u}function l_(e,n){return e!=null&&vd(e,n,Am)}function Ol(e,n){return e!=null&&vd(e,n,Pm)}var c_=ud(function(e,n,i){n!=null&&typeof n.toString!="function"&&(n=di.call(n)),e[n]=i},Nl(jn)),u_=ud(function(e,n,i){n!=null&&typeof n.toString!="function"&&(n=di.call(n)),At.call(e,n)?e[n].push(i):e[n]=[i]},He),d_=lt(Es);function rn(e){return bn(e)?Mu(e):ul(e)}function Sn(e){return bn(e)?Mu(e,!0):Hm(e)}function h_(e,n){var i={};return n=He(n,3),gr(e,function(u,p,v){Fr(i,n(u,p,v),u)}),i}function f_(e,n){var i={};return n=He(n,3),gr(e,function(u,p,v){Fr(i,p,n(u,p,v))}),i}var p_=as(function(e,n,i){ji(e,n,i)}),Qd=as(function(e,n,i,u){ji(e,n,i,u)}),g_=Rr(function(e,n){var i={};if(e==null)return i;var u=!1;n=Ut(n,function(v){return v=ia(v,e),u||(u=v.length>1),v}),mr(e,Sl(e),i),u&&(i=Jn(i,_|S|b,c0));for(var p=n.length;p--;)ml(i,n[p]);return i});function m_(e,n){return eh(e,Bi(He(n)))}var x_=Rr(function(e,n){return e==null?{}:Um(e,n)});function eh(e,n){if(e==null)return{};var i=Ut(Sl(e),function(u){return[u]});return n=He(n),Vu(e,i,function(u,p){return n(u,p[0])})}function v_(e,n,i){n=ia(n,e);var u=-1,p=n.length;for(p||(p=1,e=a);++u<p;){var v=e==null?a:e[xr(n[u])];v===a&&(u=p,v=i),e=Or(v)?v.call(e):v}return e}function __(e,n,i){return e==null?e:Ps(e,n,i)}function y_(e,n,i,u){return u=typeof u=="function"?u:a,e==null?e:Ps(e,n,i,u)}var th=fd(rn),nh=fd(Sn);function C_(e,n,i){var u=et(e),p=u||la(e)||os(e);if(n=He(n,4),i==null){var v=e&&e.constructor;p?i=u?new v:[]:Zt(e)?i=Or(v)?rs(pi(e)):{}:i={}}return(p?qn:gr)(e,function(C,w,M){return n(i,C,w,M)}),i}function w_(e,n){return e==null?!0:ml(e,n)}function b_(e,n,i){return e==null?e:Xu(e,n,_l(i))}function S_(e,n,i,u){return u=typeof u=="function"?u:a,e==null?e:Xu(e,n,_l(i),u)}function ls(e){return e==null?[]:Ko(e,rn(e))}function j_(e){return e==null?[]:Ko(e,Sn(e))}function L_(e,n,i){return i===a&&(i=n,n=a),i!==a&&(i=tr(i),i=i===i?i:0),n!==a&&(n=tr(n),n=n===n?n:0),wa(tr(e),n,i)}function k_(e,n,i){return n=Br(n),i===a?(i=n,n=0):i=Br(i),e=tr(e),Tm(e,n,i)}function M_(e,n,i){if(i&&typeof i!="boolean"&&mn(e,n,i)&&(n=i=a),i===a&&(typeof n=="boolean"?(i=n,n=a):typeof e=="boolean"&&(i=e,e=a)),e===a&&n===a?(e=0,n=1):(e=Br(e),n===a?(n=e,e=0):n=Br(n)),e>n){var u=e;e=n,n=u}if(i||e%1||n%1){var p=Lu();return hn(e+p*(n-e+ig("1e-"+((p+"").length-1))),n)}return fl(e,n)}var I_=ss(function(e,n,i){return n=n.toLowerCase(),e+(i?rh(n):n)});function rh(e){return Bl(Et(e).toLowerCase())}function ah(e){return e=Et(e),e&&e.replace(Wa,_g).replace(Tn,"")}function E_(e,n,i){e=Et(e),n=Rn(n);var u=e.length;i=i===a?u:wa(nt(i),0,u);var p=i;return i-=n.length,i>=0&&e.slice(i,p)==n}function A_(e){return e=Et(e),e&&Jt.test(e)?e.replace($e,yg):e}function P_(e){return e=Et(e),e&&Kr.test(e)?e.replace(Mr,"\\$&"):e}var T_=ss(function(e,n,i){return e+(i?"-":"")+n.toLowerCase()}),z_=ss(function(e,n,i){return e+(i?" ":"")+n.toLowerCase()}),F_=od("toLowerCase");function D_(e,n,i){e=Et(e),n=nt(n);var u=n?Ja(e):0;if(!n||u>=n)return e;var p=(n-u)/2;return Ai(vi(p),i)+e+Ai(xi(p),i)}function R_(e,n,i){e=Et(e),n=nt(n);var u=n?Ja(e):0;return n&&u<n?e+Ai(n-u,i):e}function $_(e,n,i){e=Et(e),n=nt(n);var u=n?Ja(e):0;return n&&u<n?Ai(n-u,i)+e:e}function O_(e,n,i){return i||n==null?n=0:n&&(n=+n),Zg(Et(e).replace(dr,""),n||0)}function B_(e,n,i){return(i?mn(e,n,i):n===a)?n=1:n=nt(n),pl(Et(e),n)}function N_(){var e=arguments,n=Et(e[0]);return e.length<3?n:n.replace(e[1],e[2])}var H_=ss(function(e,n,i){return e+(i?"_":"")+n.toLowerCase()});function G_(e,n,i){return i&&typeof i!="number"&&mn(e,n,i)&&(n=i=a),i=i===a?q:i>>>0,i?(e=Et(e),e&&(typeof n=="string"||n!=null&&!Rl(n))&&(n=Rn(n),!n&&Ka(e))?oa(sr(e),0,i):e.split(n,i)):[]}var U_=ss(function(e,n,i){return e+(i?" ":"")+Bl(n)});function V_(e,n,i){return e=Et(e),i=i==null?0:wa(nt(i),0,e.length),n=Rn(n),e.slice(i,i+n.length)==n}function Z_(e,n,i){var u=x.templateSettings;i&&mn(e,n,i)&&(n=a),e=Et(e),n=Gi({},n,u,pd);var p=Gi({},n.imports,u.imports,pd),v=rn(p),C=Ko(p,v),w,M,V=0,Z=n.interpolate||nn,ee="__p += '",ve=Qo((n.escape||nn).source+"|"+Z.source+"|"+(Z===En?Qr:nn).source+"|"+(n.evaluate||nn).source+"|$","g"),Te="//# sourceURL="+(At.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++tg+"]")+`
`;e.replace(ve,function(Ue,gt,Ct,On,xn,Bn){return Ct||(Ct=On),ee+=e.slice(V,Bn).replace(xs,Cg),gt&&(w=!0,ee+=`' +
__e(`+gt+`) +
'`),xn&&(M=!0,ee+=`';
`+xn+`;
__p += '`),Ct&&(ee+=`' +
((__t = (`+Ct+`)) == null ? '' : __t) +
'`),V=Bn+Ue.length,Ue}),ee+=`';
`;var Ge=At.call(n,"variable")&&n.variable;if(!Ge)ee=`with (obj) {
`+ee+`
}
`;else if(Ks.test(Ge))throw new qe(d);ee=(M?ee.replace(st,""):ee).replace(tn,"$1").replace(Cn,"$1;"),ee="function("+(Ge||"obj")+`) {
`+(Ge?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(M?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ee+`return __p
}`;var it=ih(function(){return kt(v,Te+"return "+ee).apply(a,C)});if(it.source=ee,Dl(it))throw it;return it}function W_(e){return Et(e).toLowerCase()}function Y_(e){return Et(e).toUpperCase()}function q_(e,n,i){if(e=Et(e),e&&(i||n===a))return gu(e);if(!e||!(n=Rn(n)))return e;var u=sr(e),p=sr(n),v=mu(u,p),C=xu(u,p)+1;return oa(u,v,C).join("")}function X_(e,n,i){if(e=Et(e),e&&(i||n===a))return e.slice(0,_u(e)+1);if(!e||!(n=Rn(n)))return e;var u=sr(e),p=xu(u,sr(n))+1;return oa(u,0,p).join("")}function K_(e,n,i){if(e=Et(e),e&&(i||n===a))return e.replace(dr,"");if(!e||!(n=Rn(n)))return e;var u=sr(e),p=mu(u,sr(n));return oa(u,p).join("")}function J_(e,n){var i=pe,u=ae;if(Zt(n)){var p="separator"in n?n.separator:p;i="length"in n?nt(n.length):i,u="omission"in n?Rn(n.omission):u}e=Et(e);var v=e.length;if(Ka(e)){var C=sr(e);v=C.length}if(i>=v)return e;var w=i-Ja(u);if(w<1)return u;var M=C?oa(C,0,w).join(""):e.slice(0,w);if(p===a)return M+u;if(C&&(w+=M.length-w),Rl(p)){if(e.slice(w).search(p)){var V,Z=M;for(p.global||(p=Qo(p.source,Et(Ir.exec(p))+"g")),p.lastIndex=0;V=p.exec(Z);)var ee=V.index;M=M.slice(0,ee===a?w:ee)}}else if(e.indexOf(Rn(p),w)!=w){var ve=M.lastIndexOf(p);ve>-1&&(M=M.slice(0,ve))}return M+u}function Q_(e){return e=Et(e),e&&ot.test(e)?e.replace(U,Mg):e}var e1=ss(function(e,n,i){return e+(i?" ":"")+n.toUpperCase()}),Bl=od("toUpperCase");function sh(e,n,i){return e=Et(e),n=i?a:n,n===a?bg(e)?Ag(e):pg(e):e.match(n)||[]}var ih=lt(function(e,n){try{return Fn(e,a,n)}catch(i){return Dl(i)?i:new qe(i)}}),t1=Rr(function(e,n){return qn(n,function(i){i=xr(i),Fr(e,i,zl(e[i],e))}),e});function n1(e){var n=e==null?0:e.length,i=He();return e=n?Ut(e,function(u){if(typeof u[1]!="function")throw new Xn(c);return[i(u[0]),u[1]]}):[],lt(function(u){for(var p=-1;++p<n;){var v=e[p];if(Fn(v[0],this,u))return Fn(v[1],this,u)}})}function r1(e){return Mm(Jn(e,_))}function Nl(e){return function(){return e}}function a1(e,n){return e==null||e!==e?n:e}var s1=cd(),i1=cd(!0);function jn(e){return e}function Hl(e){return Ou(typeof e=="function"?e:Jn(e,_))}function o1(e){return Nu(Jn(e,_))}function l1(e,n){return Hu(e,Jn(n,_))}var c1=lt(function(e,n){return function(i){return Es(i,e,n)}}),u1=lt(function(e,n){return function(i){return Es(e,i,n)}});function Gl(e,n,i){var u=rn(n),p=Si(n,u);i==null&&!(Zt(n)&&(p.length||!u.length))&&(i=n,n=e,e=this,p=Si(n,rn(n)));var v=!(Zt(i)&&"chain"in i)||!!i.chain,C=Or(e);return qn(p,function(w){var M=n[w];e[w]=M,C&&(e.prototype[w]=function(){var V=this.__chain__;if(v||V){var Z=e(this.__wrapped__),ee=Z.__actions__=wn(this.__actions__);return ee.push({func:M,args:arguments,thisArg:e}),Z.__chain__=V,Z}return M.apply(e,ta([this.value()],arguments))})}),e}function d1(){return sn._===this&&(sn._=Rg),this}function Ul(){}function h1(e){return e=nt(e),lt(function(n){return Gu(n,e)})}var f1=Cl(Ut),p1=Cl(uu),g1=Cl(Zo);function oh(e){return Ml(e)?Wo(xr(e)):Vm(e)}function m1(e){return function(n){return e==null?a:ba(e,n)}}var x1=dd(),v1=dd(!0);function Vl(){return[]}function Zl(){return!1}function _1(){return{}}function y1(){return""}function C1(){return!0}function w1(e,n){if(e=nt(e),e<1||e>bt)return[];var i=q,u=hn(e,q);n=He(n),e-=q;for(var p=Xo(u,n);++i<e;)n(i);return p}function b1(e){return et(e)?Ut(e,xr):$n(e)?[e]:wn(kd(Et(e)))}function S1(e){var n=++Fg;return Et(e)+n}var j1=Ei(function(e,n){return e+n},0),L1=wl("ceil"),k1=Ei(function(e,n){return e/n},1),M1=wl("floor");function I1(e){return e&&e.length?bi(e,jn,ol):a}function E1(e,n){return e&&e.length?bi(e,He(n,2),ol):a}function A1(e){return fu(e,jn)}function P1(e,n){return fu(e,He(n,2))}function T1(e){return e&&e.length?bi(e,jn,dl):a}function z1(e,n){return e&&e.length?bi(e,He(n,2),dl):a}var F1=Ei(function(e,n){return e*n},1),D1=wl("round"),R1=Ei(function(e,n){return e-n},0);function $1(e){return e&&e.length?qo(e,jn):0}function O1(e,n){return e&&e.length?qo(e,He(n,2)):0}return x.after=ov,x.ary=$d,x.assign=Yv,x.assignIn=Jd,x.assignInWith=Gi,x.assignWith=qv,x.at=Xv,x.before=Od,x.bind=zl,x.bindAll=t1,x.bindKey=Bd,x.castArray=_v,x.chain=Fd,x.chunk=M0,x.compact=I0,x.concat=E0,x.cond=n1,x.conforms=r1,x.constant=Nl,x.countBy=$x,x.create=Kv,x.curry=Nd,x.curryRight=Hd,x.debounce=Gd,x.defaults=Jv,x.defaultsDeep=Qv,x.defer=lv,x.delay=cv,x.difference=A0,x.differenceBy=P0,x.differenceWith=T0,x.drop=z0,x.dropRight=F0,x.dropRightWhile=D0,x.dropWhile=R0,x.fill=$0,x.filter=Bx,x.flatMap=Gx,x.flatMapDeep=Ux,x.flatMapDepth=Vx,x.flatten=Ad,x.flattenDeep=O0,x.flattenDepth=B0,x.flip=uv,x.flow=s1,x.flowRight=i1,x.fromPairs=N0,x.functions=i_,x.functionsIn=o_,x.groupBy=Zx,x.initial=G0,x.intersection=U0,x.intersectionBy=V0,x.intersectionWith=Z0,x.invert=c_,x.invertBy=u_,x.invokeMap=Yx,x.iteratee=Hl,x.keyBy=qx,x.keys=rn,x.keysIn=Sn,x.map=Ri,x.mapKeys=h_,x.mapValues=f_,x.matches=o1,x.matchesProperty=l1,x.memoize=Oi,x.merge=p_,x.mergeWith=Qd,x.method=c1,x.methodOf=u1,x.mixin=Gl,x.negate=Bi,x.nthArg=h1,x.omit=g_,x.omitBy=m_,x.once=dv,x.orderBy=Xx,x.over=f1,x.overArgs=hv,x.overEvery=p1,x.overSome=g1,x.partial=Fl,x.partialRight=Ud,x.partition=Kx,x.pick=x_,x.pickBy=eh,x.property=oh,x.propertyOf=m1,x.pull=X0,x.pullAll=Td,x.pullAllBy=K0,x.pullAllWith=J0,x.pullAt=Q0,x.range=x1,x.rangeRight=v1,x.rearg=fv,x.reject=ev,x.remove=ex,x.rest=pv,x.reverse=Pl,x.sampleSize=nv,x.set=__,x.setWith=y_,x.shuffle=rv,x.slice=tx,x.sortBy=iv,x.sortedUniq=lx,x.sortedUniqBy=cx,x.split=G_,x.spread=gv,x.tail=ux,x.take=dx,x.takeRight=hx,x.takeRightWhile=fx,x.takeWhile=px,x.tap=Ix,x.throttle=mv,x.thru=Di,x.toArray=qd,x.toPairs=th,x.toPairsIn=nh,x.toPath=b1,x.toPlainObject=Kd,x.transform=C_,x.unary=xv,x.union=gx,x.unionBy=mx,x.unionWith=xx,x.uniq=vx,x.uniqBy=_x,x.uniqWith=yx,x.unset=w_,x.unzip=Tl,x.unzipWith=zd,x.update=b_,x.updateWith=S_,x.values=ls,x.valuesIn=j_,x.without=Cx,x.words=sh,x.wrap=vv,x.xor=wx,x.xorBy=bx,x.xorWith=Sx,x.zip=jx,x.zipObject=Lx,x.zipObjectDeep=kx,x.zipWith=Mx,x.entries=th,x.entriesIn=nh,x.extend=Jd,x.extendWith=Gi,Gl(x,x),x.add=j1,x.attempt=ih,x.camelCase=I_,x.capitalize=rh,x.ceil=L1,x.clamp=L_,x.clone=yv,x.cloneDeep=wv,x.cloneDeepWith=bv,x.cloneWith=Cv,x.conformsTo=Sv,x.deburr=ah,x.defaultTo=a1,x.divide=k1,x.endsWith=E_,x.eq=or,x.escape=A_,x.escapeRegExp=P_,x.every=Ox,x.find=Nx,x.findIndex=Id,x.findKey=e_,x.findLast=Hx,x.findLastIndex=Ed,x.findLastKey=t_,x.floor=M1,x.forEach=Dd,x.forEachRight=Rd,x.forIn=n_,x.forInRight=r_,x.forOwn=a_,x.forOwnRight=s_,x.get=$l,x.gt=jv,x.gte=Lv,x.has=l_,x.hasIn=Ol,x.head=Pd,x.identity=jn,x.includes=Wx,x.indexOf=H0,x.inRange=k_,x.invoke=d_,x.isArguments=La,x.isArray=et,x.isArrayBuffer=kv,x.isArrayLike=bn,x.isArrayLikeObject=qt,x.isBoolean=Mv,x.isBuffer=la,x.isDate=Iv,x.isElement=Ev,x.isEmpty=Av,x.isEqual=Pv,x.isEqualWith=Tv,x.isError=Dl,x.isFinite=zv,x.isFunction=Or,x.isInteger=Vd,x.isLength=Ni,x.isMap=Zd,x.isMatch=Fv,x.isMatchWith=Dv,x.isNaN=Rv,x.isNative=$v,x.isNil=Bv,x.isNull=Ov,x.isNumber=Wd,x.isObject=Zt,x.isObjectLike=Yt,x.isPlainObject=Ds,x.isRegExp=Rl,x.isSafeInteger=Nv,x.isSet=Yd,x.isString=Hi,x.isSymbol=$n,x.isTypedArray=os,x.isUndefined=Hv,x.isWeakMap=Gv,x.isWeakSet=Uv,x.join=W0,x.kebabCase=T_,x.last=er,x.lastIndexOf=Y0,x.lowerCase=z_,x.lowerFirst=F_,x.lt=Vv,x.lte=Zv,x.max=I1,x.maxBy=E1,x.mean=A1,x.meanBy=P1,x.min=T1,x.minBy=z1,x.stubArray=Vl,x.stubFalse=Zl,x.stubObject=_1,x.stubString=y1,x.stubTrue=C1,x.multiply=F1,x.nth=q0,x.noConflict=d1,x.noop=Ul,x.now=$i,x.pad=D_,x.padEnd=R_,x.padStart=$_,x.parseInt=O_,x.random=M_,x.reduce=Jx,x.reduceRight=Qx,x.repeat=B_,x.replace=N_,x.result=v_,x.round=D1,x.runInContext=j,x.sample=tv,x.size=av,x.snakeCase=H_,x.some=sv,x.sortedIndex=nx,x.sortedIndexBy=rx,x.sortedIndexOf=ax,x.sortedLastIndex=sx,x.sortedLastIndexBy=ix,x.sortedLastIndexOf=ox,x.startCase=U_,x.startsWith=V_,x.subtract=R1,x.sum=$1,x.sumBy=O1,x.template=Z_,x.times=w1,x.toFinite=Br,x.toInteger=nt,x.toLength=Xd,x.toLower=W_,x.toNumber=tr,x.toSafeInteger=Wv,x.toString=Et,x.toUpper=Y_,x.trim=q_,x.trimEnd=X_,x.trimStart=K_,x.truncate=J_,x.unescape=Q_,x.uniqueId=S1,x.upperCase=e1,x.upperFirst=Bl,x.each=Dd,x.eachRight=Rd,x.first=Pd,Gl(x,function(){var e={};return gr(x,function(n,i){At.call(x.prototype,i)||(e[i]=n)}),e}(),{chain:!1}),x.VERSION=l,qn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){x[e].placeholder=x}),qn(["drop","take"],function(e,n){mt.prototype[e]=function(i){i=i===a?1:en(nt(i),0);var u=this.__filtered__&&!n?new mt(this):this.clone();return u.__filtered__?u.__takeCount__=hn(i,u.__takeCount__):u.__views__.push({size:hn(i,q),type:e+(u.__dir__<0?"Right":"")}),u},mt.prototype[e+"Right"]=function(i){return this.reverse()[e](i).reverse()}}),qn(["filter","map","takeWhile"],function(e,n){var i=n+1,u=i==Pe||i==Ye;mt.prototype[e]=function(p){var v=this.clone();return v.__iteratees__.push({iteratee:He(p,3),type:i}),v.__filtered__=v.__filtered__||u,v}}),qn(["head","last"],function(e,n){var i="take"+(n?"Right":"");mt.prototype[e]=function(){return this[i](1).value()[0]}}),qn(["initial","tail"],function(e,n){var i="drop"+(n?"":"Right");mt.prototype[e]=function(){return this.__filtered__?new mt(this):this[i](1)}}),mt.prototype.compact=function(){return this.filter(jn)},mt.prototype.find=function(e){return this.filter(e).head()},mt.prototype.findLast=function(e){return this.reverse().find(e)},mt.prototype.invokeMap=lt(function(e,n){return typeof e=="function"?new mt(this):this.map(function(i){return Es(i,e,n)})}),mt.prototype.reject=function(e){return this.filter(Bi(He(e)))},mt.prototype.slice=function(e,n){e=nt(e);var i=this;return i.__filtered__&&(e>0||n<0)?new mt(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),n!==a&&(n=nt(n),i=n<0?i.dropRight(-n):i.take(n-e)),i)},mt.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},mt.prototype.toArray=function(){return this.take(q)},gr(mt.prototype,function(e,n){var i=/^(?:filter|find|map|reject)|While$/.test(n),u=/^(?:head|last)$/.test(n),p=x[u?"take"+(n=="last"?"Right":""):n],v=u||/^find/.test(n);p&&(x.prototype[n]=function(){var C=this.__wrapped__,w=u?[1]:arguments,M=C instanceof mt,V=w[0],Z=M||et(C),ee=function(gt){var Ct=p.apply(x,ta([gt],w));return u&&ve?Ct[0]:Ct};Z&&i&&typeof V=="function"&&V.length!=1&&(M=Z=!1);var ve=this.__chain__,Te=!!this.__actions__.length,Ge=v&&!ve,it=M&&!Te;if(!v&&Z){C=it?C:new mt(this);var Ue=e.apply(C,w);return Ue.__actions__.push({func:Di,args:[ee],thisArg:a}),new Kn(Ue,ve)}return Ge&&it?e.apply(this,w):(Ue=this.thru(ee),Ge?u?Ue.value()[0]:Ue.value():Ue)})}),qn(["pop","push","shift","sort","splice","unshift"],function(e){var n=li[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",u=/^(?:pop|shift)$/.test(e);x.prototype[e]=function(){var p=arguments;if(u&&!this.__chain__){var v=this.value();return n.apply(et(v)?v:[],p)}return this[i](function(C){return n.apply(et(C)?C:[],p)})}}),gr(mt.prototype,function(e,n){var i=x[n];if(i){var u=i.name+"";At.call(ns,u)||(ns[u]=[]),ns[u].push({name:n,func:i})}}),ns[Ii(a,F).name]=[{name:"wrapper",func:a}],mt.prototype.clone=Qg,mt.prototype.reverse=em,mt.prototype.value=tm,x.prototype.at=Ex,x.prototype.chain=Ax,x.prototype.commit=Px,x.prototype.next=Tx,x.prototype.plant=Fx,x.prototype.reverse=Dx,x.prototype.toJSON=x.prototype.valueOf=x.prototype.value=Rx,x.prototype.first=x.prototype.head,bs&&(x.prototype[bs]=zx),x},Qa=Pg();va?((va.exports=Qa)._=Qa,Ho._=Qa):sn._=Qa}).call(us)})(vo,vo.exports);var ep=vo.exports;const ka=Y1(ep),vC=`
.mantine-DataTable-pagination, .mantine-DataTable-paginationRoot {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
  min-height: 0 !important;
}
`;function _C({lecturas:t,loading:r,totalRecords:a,page:l,onPageChange:h,pageSize:o,sortStatus:c,onSortStatusChange:d,selectedRecordIds:f,onSelectionChange:m,onEditNota:y,onDesmarcar:_,onDesmarcarSeleccionados:S,onGuardarVehiculo:b,onGuardarVehiculosSeleccionados:T,onRefresh:z}){const[J,F]=g.useState(!1),[te,re]=g.useState([]),[O,ce]=g.useState([]),xe=g.useRef(null),[Ee,Le]=g.useState(!1),[ge,pe]=g.useState(null),ae=g.useMemo(()=>[{value:"Fecha_y_Hora",label:"Fecha y Hora"},{value:"Matricula",label:"Matrícula"},{value:"ID_Lector",label:"ID Lector"},{value:"Carril",label:"Carril"},{value:"relevancia.Nota",label:"Observaciones"}],[]);g.useEffect(()=>{ce(ae.map(q=>q.value))},[ae]);const me=g.useCallback(()=>f.length>0?t.filter(ke=>f.includes(ke.ID_Lectura)):t,[t,f]),Ce=g.useCallback(()=>{const q=me();if(!q.length)return;const ke=q.map(de=>{const De={};return O.forEach(Ne=>{var Ve;Ne==="Fecha_y_Hora"?De[Ne]=Tt(de[Ne]).format("DD/MM/YYYY HH:mm:ss"):Ne==="relevancia.Nota"?De.Nota=((Ve=de.relevancia)==null?void 0:Ve.Nota)||"-":De[Ne]=de[Ne]||"-"}),De}),G=nr.json_to_sheet(ke),K=nr.book_new();nr.book_append_sheet(K,G,"Lecturas Relevantes");const W=uy(K,{bookType:"xlsx",type:"array"}),he=new Blob([W],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Wl.saveAs(he,"lecturas_relevantes.xlsx")},[me,O]),Pe=g.useCallback(()=>{const q=me();if(!q.length)return;const ke=document.createElement("table");ke.style.borderCollapse="collapse",ke.style.width="100%";const G=document.createElement("thead"),K=document.createElement("tr");O.forEach(De=>{var Ve;const Ne=document.createElement("th");Ne.style.border="1px solid black",Ne.style.padding="8px",Ne.textContent=((Ve=ae.find(at=>at.value===De))==null?void 0:Ve.label)||De,K.appendChild(Ne)}),G.appendChild(K),ke.appendChild(G);const W=document.createElement("tbody");q.forEach(De=>{const Ne=document.createElement("tr");O.forEach(Ve=>{var Ke;const at=document.createElement("td");at.style.border="1px solid black",at.style.padding="8px",Ve==="Fecha_y_Hora"?at.textContent=Tt(De[Ve]).format("DD/MM/YYYY HH:mm:ss"):Ve==="relevancia.Nota"?at.textContent=((Ke=De.relevancia)==null?void 0:Ke.Nota)||"-":at.textContent=De[Ve]||"-",Ne.appendChild(at)}),W.appendChild(Ne)}),ke.appendChild(W);const he=`
            <html>
                <head>
                    <meta charset="UTF-8">
                    <style>
                        table { border-collapse: collapse; width: 100%; font-family: Arial, sans-serif; font-size: 12pt; }
                        th, td { border: 1px solid black; padding: 8px; font-family: Arial, sans-serif; font-size: 12pt; }
                    </style>
                </head>
                <body>
                    ${ke.outerHTML}
                </body>
            </html>
        `,de=new Blob([he],{type:"application/msword"});Wl.saveAs(de,"lecturas_relevantes.doc")},[me,O,ae]),xt=g.useCallback(async()=>{if(xe.current)try{(await fo(xe.current)).toBlob(ke=>{ke&&Wl.saveAs(ke,"lecturas_relevantes.png")})}catch(q){console.error("Error al generar la captura:",q),ie.show({title:"Error",message:"No se pudo generar la captura de pantalla",color:"red"})}},[]),Ye=g.useCallback((q,ke)=>{const G=ke?[...f,q]:f.filter(K=>K!==q);m(G)},[f,m]),jt=g.useCallback(q=>{const ke=Array.isArray(t)?t.map(G=>G.ID_Lectura):[];m(q?ke:[])},[t,m]),bt=g.useMemo(()=>{let q=Array.isArray(t)?[...t]:[];c!=null&&c.columnAccessor&&(q=ka.orderBy(q,[c.columnAccessor],[c.direction]));const ke=(l-1)*o,G=ke+o;return q.slice(ke,G)},[t,c,l,o]),Dt=g.useMemo(()=>{const q=Array.isArray(t)?t:[],ke=q.length>0&&f.length===q.length,G=f.length>0&&f.length<q.length;return[{accessor:"select",title:s.jsx(wr,{"aria-label":"Seleccionar todas las filas",checked:ke,indeterminate:G,onChange:K=>jt(K.currentTarget.checked)}),width:"0%",styles:{cell:{paddingLeft:"var(--mantine-spacing-xs)",paddingRight:"var(--mantine-spacing-xs)"}},render:K=>s.jsx(wr,{"aria-label":`Seleccionar fila ${K.ID_Lectura}`,checked:f.includes(K.ID_Lectura),onChange:W=>Ye(K.ID_Lectura,W.currentTarget.checked),onClick:W=>W.stopPropagation()})},{accessor:"Fecha_y_Hora",title:"Fecha y Hora",render:K=>Tt(K.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss"),sortable:!0,width:140},{accessor:"Matricula",title:"Matrícula",sortable:!0,width:100},{accessor:"ID_Lector",title:"ID Lector",render:K=>K.ID_Lector||"-",sortable:!0,width:150},{accessor:"Carril",title:"Carril",render:K=>K.Carril||"-",sortable:!0,width:70},{accessor:"relevancia.Nota",title:"Observaciones",render:K=>{var W;return((W=K.relevancia)==null?void 0:W.Nota)||"-"},width:200},{accessor:"actions",title:"Acciones",width:120,textAlign:"center",render:K=>s.jsxs(X,{gap:"xs",justify:"center",wrap:"nowrap",children:[s.jsx(In,{label:"Editar Nota",children:s.jsx(We,{variant:"subtle",color:"blue",onClick:()=>y(K),disabled:!K.relevancia,children:s.jsx(Cf,{size:16})})}),s.jsx(In,{label:"Guardar Vehículo",children:s.jsx(We,{variant:"subtle",color:"green",onClick:()=>b(K),disabled:!K.Matricula,children:s.jsx(Sr,{size:16})})}),s.jsx(In,{label:"Desmarcar como Relevante",children:s.jsx(We,{variant:"subtle",color:"red",onClick:()=>_(K.ID_Lectura),disabled:!K.relevancia,children:s.jsx(q1,{size:16})})})]})}]},[t,f,y,b,_,Ye,jt]),rt=s.jsx(Zr,{opened:!!Ee,onClose:()=>Le(!1),title:ge==="excel"?"Exportar a Excel":"Exportar a Word",size:"lg",styles:{body:{minWidth:480}},children:s.jsxs(ct,{children:[s.jsx(Y,{size:"sm",children:"Selecciona las columnas que deseas exportar:"}),s.jsx(da,{data:ae,value:O,onChange:ce,placeholder:"Seleccionar columnas para exportar",style:{width:"100%"}}),s.jsxs(X,{justify:"flex-end",children:[s.jsx(Me,{variant:"default",onClick:()=>Le(!1),children:"Cancelar"}),s.jsx(Me,{leftSection:ge==="excel"?s.jsx(ch,{size:16}):s.jsx(uh,{size:16}),onClick:()=>{Le(!1),setTimeout(()=>{ge==="excel"?Ce():ge==="word"&&Pe()},200)},disabled:O.length===0,children:"Exportar"})]})]})});return s.jsxs(s.Fragment,{children:[s.jsx("style",{children:vC}),s.jsx(Ie,{style:{position:"relative"},children:s.jsxs(ct,{style:{marginBottom:0,paddingBottom:0},children:[s.jsxs(X,{justify:"space-between",align:"center",mb:"sm",children:[s.jsxs(Wt,{order:4,children:["Lecturas Marcadas como Relevantes (",a,")"]}),s.jsxs(X,{gap:"xs",children:[s.jsxs(Pt,{shadow:"md",width:200,children:[s.jsx(Pt.Target,{children:s.jsx(Me,{variant:"light",size:"xs",leftSection:s.jsx(po,{size:16}),children:"Exportar"})}),s.jsxs(Pt.Dropdown,{children:[s.jsx(Pt.Item,{leftSection:s.jsx(ch,{size:16}),onClick:()=>{pe("excel"),Le("excel")},children:"Exportar a Excel"}),s.jsx(Pt.Item,{leftSection:s.jsx(uh,{size:16}),onClick:()=>{pe("word"),Le("word")},children:"Exportar a Word"}),s.jsx(Pt.Item,{leftSection:s.jsx(go,{size:16}),onClick:xt,children:"Captura de Pantalla"})]})]}),s.jsxs(Me,{color:"red",variant:"light",size:"xs",leftSection:s.jsx(Oa,{size:16}),disabled:f.length===0||r,onClick:S,children:["Desmarcar Selección (",f.length,")"]}),s.jsxs(Me,{color:"green",variant:"light",size:"xs",leftSection:s.jsx(Sr,{size:16}),disabled:f.length===0||r,onClick:T,children:["Guardar Vehículos (",f.length,")"]}),s.jsx(Me,{leftSection:s.jsx(Eo,{size:16}),onClick:z,variant:"default",size:"xs",disabled:r,children:"Actualizar Lista"})]})]}),a===0&&!r&&s.jsx(Y,{c:"dimmed",children:"No hay lecturas marcadas como relevantes para este caso."}),a>0&&s.jsx(Ie,{ref:xe,style:{paddingBottom:0,marginBottom:0},children:s.jsx(Ac,{records:bt,columns:Dt,totalRecords:a,recordsPerPage:o,page:l,onPageChange:h,sortStatus:c,onSortStatusChange:d,idAccessor:"ID_Lectura",withTableBorder:!0,borderRadius:"sm",withColumnBorders:!0,striped:!0,highlightOnHover:!0,noRecordsText:"",noRecordsIcon:s.jsx(s.Fragment,{}),rowStyle:q=>({backgroundColor:te.includes(q.ID_Lectura)?"var(--mantine-color-blue-0)":void 0}),onRowClick:({record:q})=>{re(ke=>ke.includes(q.ID_Lectura)?ke.filter(G=>G!==q.ID_Lectura):[...ke,q.ID_Lectura])},styles:{pagination:{marginBottom:0,paddingBottom:0},root:{marginBottom:0,paddingBottom:0}},fetching:r})})]})}),rt]})}function yC({casoId:t}){const{user:r}=X1(),[a,l]=g.useState([]),[h,o]=g.useState(!0),[c,d]=g.useState(null),[f,m]=g.useState(null),[y,_]=g.useState(!1),[S,b]=g.useState(!1),[T,z]=g.useState(null),[J,F]=g.useState({}),[te,re]=g.useState({}),[O,ce]=g.useState("sospechoso"),[xe,Ee]=g.useState(""),[Le,ge]=g.useState(""),[pe,ae]=g.useState(""),[me,Ce]=g.useState(""),[Pe,xt]=g.useState(!1),[Ye,jt]=g.useState(""),[bt,Dt]=g.useState(!1),[rt,q]=g.useState(!1),[ke,G]=g.useState(!1),[K,W]=g.useState(!1),[he,de]=g.useState(""),[De,Ne]=g.useState(""),[Ve,at]=g.useState(""),[Ke,Vt]=g.useState(""),[E,H]=g.useState(""),[je,oe]=g.useState(!1),[Re,Mt]=g.useState(""),[vt,Je]=g.useState(!1),[dt,St]=g.useState(!1),[D,fe]=g.useState(!1),Ae=[{value:"sospechoso",label:"Sospechosos primero"},{value:"matricula-az",label:"Matrícula (A-Z)"},{value:"matricula-za",label:"Matrícula (Z-A)"},{value:"marca-az",label:"Marca (A-Z)"},{value:"marca-za",label:"Marca (Z-A)"}],Oe={sospechoso:"Sospechosos primero","matricula-az":"Matrícula (A-Z)","matricula-za":"Matrícula (Z-A)","marca-az":"Marca (A-Z)","marca-za":"Marca (Z-A)"},Fe=g.useCallback(async()=>{var U,$e;if(!t){d("ID de caso inválido."),o(!1);return}o(!0),d(null);try{const ot=await wt.get(`/casos/${t}/vehiculos`);l(ot.data||[])}catch(ot){console.error("Error fetching vehiculos:",ot),d((($e=(U=ot.response)==null?void 0:U.data)==null?void 0:$e.detail)||"No se pudieron cargar los vehículos."),l([])}finally{o(!1)}},[t]);g.useEffect(()=>{Fe()},[Fe]),g.useEffect(()=>{const U=()=>{console.log("[VehiculosPanel]: Evento listaVehiculosCambiada recibido, recargando..."),Fe()};return Wr.on("listaVehiculosCambiada",U),()=>Wr.off("listaVehiculosCambiada",U)},[Fe]);const Qe=g.useCallback(async(U,$e,ot)=>{var Jt,jr;try{const Lr={Comprobado:$e,Sospechoso:ot};await wt.put(`/vehiculos/${U}`,Lr),ie.show({title:"Estado Actualizado",message:"El estado del vehículo ha sido actualizado.",color:"green",icon:s.jsx(Aa,{size:16})}),Fe(),Wr.emit("listaVehiculosCambiada")}catch(Lr){console.error("Error updating vehicle status:",Lr),ie.show({title:"Error al Actualizar",message:((jr=(Jt=Lr.response)==null?void 0:Jt.data)==null?void 0:jr.detail)||"No se pudo actualizar el estado.",color:"red"})}},[Fe]),Bt=g.useCallback(async U=>{if(!te[U]){re($e=>({...$e,[U]:!0}));try{const $e=await wt.get(`/vehiculos/${U}/lecturas?caso_id=${t}`);F(ot=>({...ot,[U]:$e.data||[]}))}catch($e){console.error(`Error fetching lecturas for vehiculo ${U}:`,$e),ie.show({title:"Error",message:"No se pudieron cargar las lecturas.",color:"red"})}finally{re($e=>({...$e,[U]:!1}))}}},[t]);g.useEffect(()=>{y&&f&&Bt(f.ID_Vehiculo)},[y,f,Bt]);const Lt=g.useCallback(U=>{m(U),_(!0)},[]),I=g.useCallback((U,$e)=>{$e.stopPropagation(),m(U),Ee(U.Marca||""),ge(U.Modelo||""),ae(U.Color||""),Ce(U.Propiedad||""),xt(U.Alquiler),jt(U.Observaciones||""),Dt(U.Comprobado),q(U.Sospechoso),b(!0)},[]),$=g.useCallback((U,$e)=>{$e.stopPropagation(),ds({title:`Eliminar Vehículo ${U.Matricula}`,centered:!0,children:s.jsx(Y,{size:"sm",children:"¿Estás seguro de eliminar este vehículo? Esta acción no se puede deshacer."}),labels:{confirm:"Eliminar",cancel:"Cancelar"},confirmProps:{color:"red"},onConfirm:async()=>{var ot,Jt;try{await wt.delete(`/vehiculos/${U.ID_Vehiculo}`),ie.show({title:"Vehículo Eliminado",message:`Vehículo ${U.Matricula} eliminado.`,color:"green"}),Fe()}catch(jr){ie.show({title:"Error al Eliminar",message:((Jt=(ot=jr.response)==null?void 0:ot.data)==null?void 0:Jt.detail)||"No se pudo eliminar.",color:"red"})}}})},[Fe]),Q=g.useCallback(async()=>{var U,$e;if(f){G(!0);try{const ot={Marca:xe||null,Modelo:Le||null,Color:pe||null,Propiedad:me||null,Alquiler:Pe,Observaciones:Ye||null,Comprobado:bt,Sospechoso:rt};await wt.put(`/vehiculos/${f.ID_Vehiculo}`,ot),ie.show({title:"Éxito",message:`Vehículo ${f.Matricula} actualizado.`,color:"green"}),b(!1),Fe()}catch(ot){console.error("Error updating vehiculo:",ot),ie.show({title:"Error al Actualizar",message:(($e=(U=ot.response)==null?void 0:U.data)==null?void 0:$e.detail)||"No se pudo guardar los cambios.",color:"red"})}finally{G(!1)}}},[f,xe,Le,pe,me,Pe,Ye,bt,rt,Fe]),ue=Yr.useMemo(()=>{let U=[...a];switch(O){case"matricula-az":return ka.orderBy(U,["Matricula"],["asc"]);case"matricula-za":return ka.orderBy(U,["Matricula"],["desc"]);case"marca-az":return ka.orderBy(U,[$e=>{var ot;return((ot=$e.Marca)==null?void 0:ot.toLowerCase())||""}],["asc"]);case"marca-za":return ka.orderBy(U,[$e=>{var ot;return((ot=$e.Marca)==null?void 0:ot.toLowerCase())||""}],["desc"]);case"sospechoso":default:return ka.orderBy(U,[$e=>!$e.Sospechoso,"Matricula"],["asc","asc"])}},[a,O]),It=U=>s.jsxs(dc,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,style:{cursor:"pointer"},onClick:()=>Lt(U),children:[s.jsx(dc.Section,{children:s.jsx(Ie,{p:"md",style:{backgroundColor:"#f8f9fa"},children:s.jsxs(X,{justify:"space-between",align:"center",children:[s.jsxs(X,{children:[s.jsx(Us,{color:"blue",radius:"xl",children:s.jsx(Sr,{size:24})}),s.jsxs("div",{children:[s.jsx(Y,{fw:500,size:"lg",children:U.Matricula}),s.jsxs(Y,{size:"sm",c:"dimmed",children:[U.Marca," ",U.Modelo]})]})]}),s.jsxs(X,{children:[U.Comprobado&&s.jsx(In,{label:"Vehículo Comprobado",children:s.jsxs(Mn,{color:"green",variant:"light",children:[s.jsx(Aa,{size:14,style:{marginRight:5}}),"Comprobado"]})}),U.Sospechoso&&s.jsx(In,{label:"Vehículo Sospechoso",children:s.jsxs(Mn,{color:"red",variant:"light",children:[s.jsx(uo,{size:14,style:{marginRight:5}}),"Sospechoso"]})})]})]})})}),s.jsxs(ct,{mt:"md",gap:"xs",children:[s.jsxs(X,{children:[s.jsx(rr,{size:16,style:{color:"#228be6"}}),s.jsx(Y,{size:"sm",children:U.Propiedad||"Propiedad no especificada"})]}),U.Color&&s.jsxs(X,{children:[s.jsx(Sr,{size:16,style:{color:"#228be6"}}),s.jsx(Y,{size:"sm",children:U.Color})]}),U.Alquiler&&s.jsxs(X,{children:[s.jsx(Pf,{size:16,style:{color:"#228be6"}}),s.jsx(Y,{size:"sm",children:"Vehículo de alquiler"})]})]}),s.jsx(X,{mt:"md",justify:"flex-end",children:s.jsxs(Pt,{withinPortal:!0,position:"bottom-end",shadow:"sm",children:[s.jsx(Pt.Target,{children:s.jsx(We,{variant:"subtle",color:"gray",onClick:$e=>$e.stopPropagation(),children:s.jsx(Wy,{size:16})})}),s.jsxs(Pt.Dropdown,{children:[s.jsx(Pt.Label,{children:"Acciones Rápidas"}),s.jsx(Pt.Item,{leftSection:s.jsx(Aa,{size:14}),onClick:$e=>{$e.stopPropagation(),Qe(U.ID_Vehiculo,!0,!1)},disabled:U.Comprobado,children:"Marcar Comprobado"}),s.jsx(Pt.Item,{leftSection:s.jsx(uo,{size:14}),color:"orange",onClick:$e=>{$e.stopPropagation(),Qe(U.ID_Vehiculo,!1,!0)},disabled:U.Sospechoso,children:"Marcar Sospechoso"}),s.jsx(Pt.Item,{leftSection:s.jsx(fs,{size:14}),color:"red",onClick:$e=>{$e.stopPropagation(),Qe(U.ID_Vehiculo,!1,!1)},disabled:!U.Comprobado&&!U.Sospechoso,children:"Limpiar Estado"}),s.jsx(Pt.Divider,{}),s.jsx(Pt.Label,{children:"Gestión"}),s.jsx(Pt.Item,{leftSection:s.jsx(Cf,{size:14}),onClick:$e=>I(U,$e),children:"Editar Vehículo"}),s.jsx(Pt.Item,{color:"red",leftSection:s.jsx(Oa,{size:14}),onClick:$e=>$(U,$e),children:"Eliminar Vehículo"})]})]})})]},U.ID_Vehiculo),Nt=()=>{const U=f?(J[f.ID_Vehiculo]||[]).filter($e=>$e.Tipo_Fuente==="LPR"):[];return s.jsx(Zr,{opened:y,onClose:()=>_(!1),title:`Detalles del Vehículo ${f==null?void 0:f.Matricula}`,size:"xl",children:f&&s.jsxs(ct,{children:[s.jsxs(X,{children:[s.jsx(Us,{size:"xl",color:"blue",radius:"xl",children:s.jsx(Sr,{size:32})}),s.jsxs("div",{children:[s.jsx(Y,{size:"xl",fw:700,children:f.Matricula}),s.jsxs(Y,{size:"lg",children:[f.Marca," ",f.Modelo]}),s.jsx(Y,{size:"sm",c:"dimmed",children:f.Propiedad||"Propiedad no especificada"})]})]}),s.jsx(Ur,{}),s.jsxs(xo,{cols:2,children:[s.jsxs(Ie,{children:[s.jsx(Y,{fw:500,mb:"xs",children:"Información del Vehículo"}),s.jsxs(ct,{gap:"xs",children:[s.jsxs(X,{children:[s.jsx(Y,{size:"sm",fw:500,children:"Color:"}),s.jsx(Y,{size:"sm",children:f.Color||"No especificado"})]}),s.jsxs(X,{children:[s.jsx(Y,{size:"sm",fw:500,children:"Alquiler:"}),s.jsx(Y,{size:"sm",children:f.Alquiler?"Sí":"No"})]}),s.jsxs(X,{children:[s.jsx(Y,{size:"sm",fw:500,children:"Estado:"}),s.jsxs(X,{gap:"xs",children:[f.Comprobado&&s.jsx(Mn,{color:"green",children:"Comprobado"}),f.Sospechoso&&s.jsx(Mn,{color:"red",children:"Sospechoso"})]})]})]})]}),s.jsxs(Ie,{children:[s.jsx(Y,{fw:500,mb:"xs",children:"Observaciones"}),s.jsx(Y,{size:"sm",children:f.Observaciones||"Sin observaciones"})]})]}),s.jsx(Ur,{}),s.jsxs(Ie,{children:[s.jsx(Y,{fw:500,mb:"xs",children:"Últimas Lecturas"}),s.jsx(Ra,{visible:te[f.ID_Vehiculo]}),U.length>0?s.jsx(ct,{gap:"xs",children:U.map(($e,ot)=>s.jsx(zt,{p:"xs",withBorder:!0,children:s.jsxs(X,{children:[s.jsx(Uf,{size:16,style:{color:"#228be6"}}),s.jsx(Y,{size:"sm",children:Tt($e.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss")}),s.jsx(Y,{size:"sm",children:"•"}),s.jsxs(Y,{size:"sm",children:["Lector: ",$e.ID_Lector]})]})},ot))}):s.jsx(Y,{size:"sm",c:"dimmed",children:"No hay lecturas registradas"})]})]})})},st=()=>s.jsx(Zr,{opened:S,onClose:()=>b(!1),title:`Editar Vehículo ${f==null?void 0:f.Matricula}`,size:"md",children:s.jsxs(ct,{children:[s.jsx(Xe,{label:"Marca",value:xe,onChange:U=>Ee(U.target.value)}),s.jsx(Xe,{label:"Modelo",value:Le,onChange:U=>ge(U.target.value)}),s.jsx(Xe,{label:"Color",value:pe,onChange:U=>ae(U.target.value)}),s.jsx(Xe,{label:"Propiedad",value:me,onChange:U=>Ce(U.target.value)}),s.jsx(ho,{label:"Observaciones",value:Ye,onChange:U=>jt(U.target.value),minRows:3}),s.jsxs(X,{children:[s.jsx(wr,{label:"Vehículo de Alquiler",checked:Pe,onChange:U=>xt(U.target.checked)}),s.jsx(wr,{label:"Comprobado",checked:bt,onChange:U=>Dt(U.target.checked)}),s.jsx(wr,{label:"Sospechoso",checked:rt,onChange:U=>q(U.target.checked)})]}),s.jsxs(X,{justify:"flex-end",mt:"md",children:[s.jsx(Me,{variant:"light",onClick:()=>b(!1),children:"Cancelar"}),s.jsx(Me,{onClick:Q,loading:ke,children:"Guardar Cambios"})]})]})}),tn=()=>{de(""),Ne(""),at(""),Vt(""),H(""),oe(!1),Mt(""),Je(!1),St(!1),W(!0)},Cn=async()=>{var U,$e;fe(!0);try{const ot={Matricula:he.trim().toUpperCase(),Marca:De||null,Modelo:Ve||null,Color:Ke||null,Propiedad:E||null,Alquiler:je,Observaciones:Re||null,Comprobado:vt,Sospechoso:dt};await wt.post("/vehiculos",ot),ie.show({title:"Vehículo añadido",message:"Vehículo creado correctamente.",color:"green"}),W(!1),Fe()}catch(ot){console.error("Error creating vehiculo:",ot),ie.show({title:"Error al crear vehículo",message:(($e=(U=ot.response)==null?void 0:U.data)==null?void 0:$e.detail)||"No se pudo crear el vehículo.",color:"red"})}finally{fe(!1)}};return h?s.jsx(Ra,{visible:!0}):c?s.jsx(Pa,{color:"red",title:"Error",children:c}):s.jsxs(Ie,{children:[s.jsxs(X,{justify:"space-between",mb:"md",children:[s.jsx(Wt,{order:3,children:"Vehículos del Caso"}),s.jsxs(X,{children:[s.jsxs(Pt,{shadow:"md",width:200,position:"bottom-end",children:[s.jsx(Pt.Target,{children:s.jsxs(Me,{variant:"default",size:"xs",children:["Ordenar por: ",Oe[O]]})}),s.jsx(Pt.Dropdown,{children:Ae.map(U=>s.jsx(Pt.Item,{onClick:()=>ce(U.value),rightSection:O===U.value?s.jsx(Aa,{size:14}):null,children:U.label},U.value))})]}),s.jsx(Me,{variant:"outline",leftSection:s.jsx(Eo,{size:16}),onClick:Fe,size:"xs",color:"blue",style:{backgroundColor:"white",color:"var(--mantine-color-blue-6)",border:"1px solid var(--mantine-color-blue-3)",fontWeight:500,borderRadius:8,paddingLeft:14,paddingRight:14,height:32,boxShadow:"none",fontSize:15,display:"flex",alignItems:"center",gap:6,minWidth:0},children:"Actualizar"})]})]}),(r==null?void 0:r.Rol)==="superadmin"&&s.jsx(X,{justify:"flex-start",mb:"md",children:s.jsx(Me,{leftSection:s.jsx(Sr,{size:18}),color:"blue",onClick:tn,children:"Añadir vehículo manualmente"})}),s.jsx(xo,{cols:{base:1,sm:2,md:3,lg:4},spacing:"md",children:ue.map(It)}),Nt(),st(),s.jsx(Zr,{opened:K,onClose:()=>W(!1),title:"Añadir Vehículo Manual",centered:!0,children:s.jsxs(ct,{children:[s.jsx(Xe,{label:"Matrícula",value:he,onChange:U=>de(U.target.value),required:!0,autoFocus:!0}),s.jsx(Xe,{label:"Marca",value:De,onChange:U=>Ne(U.target.value)}),s.jsx(Xe,{label:"Modelo",value:Ve,onChange:U=>at(U.target.value)}),s.jsx(Xe,{label:"Color",value:Ke,onChange:U=>Vt(U.target.value)}),s.jsx(Xe,{label:"Propiedad",value:E,onChange:U=>H(U.target.value)}),s.jsx(wr,{label:"Alquiler",checked:je,onChange:U=>oe(U.currentTarget.checked)}),s.jsx(ho,{label:"Observaciones",value:Re,onChange:U=>Mt(U.target.value),minRows:2}),s.jsxs(X,{children:[s.jsx(wr,{label:"Comprobado",checked:vt,onChange:U=>Je(U.currentTarget.checked)}),s.jsx(wr,{label:"Sospechoso",checked:dt,onChange:U=>St(U.currentTarget.checked)})]}),s.jsxs(X,{justify:"flex-end",children:[s.jsx(Me,{variant:"default",onClick:()=>W(!1),disabled:D,children:"Cancelar"}),s.jsx(Me,{color:"blue",onClick:Cn,loading:D,disabled:!he.trim(),children:"Guardar"})]})]})})]})}function _o(){return _o=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(t[l]=a[l])}return t},_o.apply(this,arguments)}function CC(t,r){if(t==null)return{};var a={},l=Object.keys(t),h,o;for(o=0;o<l.length;o++)h=l[o],!(r.indexOf(h)>=0)&&(a[h]=t[h]);return a}var wC=["cdnSuffix","cdnUrl","countryCode","style","svg"],bC="https://cdn.jsdelivr.net/gh/lipis/flag-icons/flags/4x3/",SC="svg",jC=127397,Yi=function(r){var a=r.cdnSuffix,l=a===void 0?SC:a,h=r.cdnUrl,o=h===void 0?bC:h,c=r.countryCode,d=r.style,f=r.svg,m=f===void 0?!1:f,y=CC(r,wC);if(typeof c!="string")return null;if(m){var _=""+o+c.toLowerCase()+"."+l;return g.createElement("img",Object.assign({},y,{src:_,style:_o({display:"inline-block",width:"1em",height:"1em",verticalAlign:"middle"},d)}))}var S=c.toUpperCase().replace(/./g,function(b){return String.fromCodePoint(b.charCodeAt(0)+jC)});return g.createElement("span",Object.assign({role:"img"},y,{style:_o({display:"inline-block",fontSize:"1em",lineHeight:"1em",verticalAlign:"middle"},d)}),S)};const tp={ES:{name:"España",regex:/^[0-9]{4}[A-Z]{3}$/,example:"1234ABC"},PT:{name:"Portugal",regex:/^[0-9]{2}-[0-9]{2}-[A-Z]{2}$/,example:"12-34-AB"},FR:{name:"Francia",regex:/^[A-Z]{2}-[0-9]{3}-[A-Z]{2}$/,example:"AB-123-CD"},IT:{name:"Italia",regex:/^[A-Z]{2}[0-9]{3}[A-Z]{2}$/,example:"AB123CD"},BE:{name:"Bélgica",regex:/^[1-9]-[A-Z]{3}-[0-9]{3}$/,example:"1-ABC-234"},NL:{name:"Países Bajos",regex:/^[A-Z]{2}-[0-9]{3}-[A-Z]{1,2}$/,example:"AB-123-C"},LU:{name:"Luxemburgo",regex:/^[0-9]{4,6}$/,example:"12345"},MC:{name:"Mónaco",regex:/^\d{2,5} [A-Z]{2}$/,example:"1234 MC"},DE:{name:"Alemania",regex:/^[A-Z]{1,3}-[A-Z]{1,2} [0-9]{1,4}$/,example:"B-AB 1234"},AT:{name:"Austria",regex:/^[A-Z]{1,2}-[0-9]{1,5}-[A-Z]{1,2}$/,example:"W-12345A"},CH:{name:"Suiza",regex:/^[A-Z]{2} [0-9]{1,6}$/,example:"ZH 123456"},PL:{name:"Polonia",regex:/^[A-Z]{2,3} [0-9A-Z]{4,5}$/,example:"PO 12345"},CZ:{name:"Chequia",regex:/^[0-9]{1,2}[A-Z]{1,2} [0-9]{4,5}$/,example:"1AB 2345"},SK:{name:"Eslovaquia",regex:/^[A-Z]{2} [0-9]{3}[A-Z]{2}$/,example:"BA 123AB"},HU:{name:"Hungría",regex:/^[A-Z]{3}-[0-9]{3}$/,example:"ABC-123"},SI:{name:"Eslovenia",regex:/^[A-Z]{2}-[0-9]{3}-[A-Z]{1,2}$/,example:"LJ-123-A"},HR:{name:"Croacia",regex:/^[A-Z]{2}-[0-9]{3,4}-[A-Z]{2}$/,example:"ZG-1234-AB"},RS:{name:"Serbia",regex:/^[A-Z]{2} [0-9]{3}-[A-Z]{2}$/,example:"BG 123-AB"},RO:{name:"Rumanía",regex:/^[A-Z]{1,2}-[0-9]{2,3}-[A-Z]{3}$/,example:"B-123-ABC"},BG:{name:"Bulgaria",regex:/^[A-Z]{1,2} [0-9]{4} [A-Z]{1,2}$/,example:"CA 1234 AB"},UA:{name:"Ucrania",regex:/^[A-Z]{2} [0-9]{4} [A-Z]{2}$/,example:"AA 1234 BB"},BY:{name:"Bielorrusia",regex:/^[0-9]{4} [A-Z]{2}-[1-7]$/,example:"1234 AB-7"},LT:{name:"Lituania",regex:/^[A-Z]{3} [0-9]{3}$/,example:"ABC 123"},LV:{name:"Letonia",regex:/^[A-Z]{2}-[0-9]{4}$/,example:"AB-1234"},EE:{name:"Estonia",regex:/^[0-9]{3}[A-Z]{3}$/,example:"123ABC"},FI:{name:"Finlandia",regex:/^[A-Z]{2,3}-[0-9]{1,3}$/,example:"ABC-123"},SE:{name:"Suecia",regex:/^[A-Z]{3} [0-9]{2}[A-Z0-9]$/,example:"ABC 12A"},NO:{name:"Noruega",regex:/^[A-Z]{2} [0-9]{5,6}$/,example:"AB 12345"},DK:{name:"Dinamarca",regex:/^[A-Z]{2} [0-9]{5}$/,example:"AB 12345"},GB:{name:"Reino Unido",regex:/^[A-Z]{2}[0-9]{2} [A-Z]{3}$/,example:"AB12 CDE"},IE:{name:"Irlanda",regex:/^[0-9]{2,3}-[A-Z]{1,2}-[0-9]{1,6}$/,example:"12-D-12345"},AL:{name:"Albania",regex:/^[A-Z]{2}-[0-9]{3}-[A-Z]{2}$/,example:"AA-123-AA"},MK:{name:"Macedonia",regex:/^[A-Z]{2}-[0-9]{3}-[A-Z]{2}$/,example:"SK-123-AB"},ME:{name:"Montenegro",regex:/^[A-Z]{2}-[0-9]{3}-[A-Z]{2}$/,example:"PG-123-AB"},BA:{name:"Bosnia y Herzegovina",regex:/^[A-Z]{2}-[0-9]{3}-[A-Z]{2}$/,example:"MO-123-AA"},GR:{name:"Grecia",regex:/^[A-Z]{3}-[0-9]{4}$/,example:"ABC-1234"},TR:{name:"Turquía",regex:/^[0-9]{2} [A-Z]{1,3} [0-9]{2,4}$/,example:"34 ABC 1234"},RU:{name:"Rusia",regex:/^[A-Z]{1}[0-9]{3}[A-Z]{2} [0-9]{2,3}$/,example:"A123BC 77"},KZ:{name:"Kazajistán",regex:/^[0-9]{3}[A-Z]{2}[0-9]{2}$/,example:"123AB45"},GE:{name:"Georgia",regex:/^[A-Z]{2}-[0-9]{3}-[A-Z]{2}$/,example:"AB-123-CD"},AM:{name:"Armenia",regex:/^[0-9]{2} [A-Z]{2} [0-9]{3}$/,example:"12 AB 123"},AZ:{name:"Azerbaiyán",regex:/^[0-9]{2}-[A-Z]{2}-[0-9]{3}$/,example:"10-AA-123"},MA:{name:"Marruecos",regex:/^[0-9]{1,5}-[A-Z]{1,2}-[0-9]{2}$/,example:"12345-A-12"},DZ:{name:"Argelia",regex:/^[0-9]{5,6}-[0-9]{2}-[0-9]{2}$/,example:"123456-12-34"},TN:{name:"Túnez",regex:/^[0-9]{1,4} تونس [0-9]{1,4}$/,example:"1234 تونس 5678"},LY:{name:"Libia",regex:/^[0-9]{1,7}$/,example:"1234567"}},LC=Object.entries(tp).filter(([t])=>t!=="ES").map(([t,{name:r}])=>({value:t,label:r}));function xh(t){if(/^[0-9]{3}[A-Z]{3}$/.test(t))return{code:"ES",name:"España",isPotentiallyIncomplete:!0};for(const[a,{name:l,regex:h}]of Object.entries(tp))if(h.test(t))return a==="FR"||a==="IT"?{code:"FRIT",name:"Francia / Italia"}:{code:a,name:l};return null}function kC({loading:t}){const{idCaso:r}=wf(),[a,l]=g.useState(""),[h,o]=g.useState([]),[c,d]=g.useState(null),[f,m]=g.useState(null),[y,_]=g.useState([]),[S,b]=g.useState(!1),[T,z]=g.useState([]),[J,F]=g.useState(!0),[te,re]=g.useState("fecha"),[O,ce]=g.useState("desc");g.useEffect(()=>((async()=>{if(!r)return;const ae="matriculas-extranjeras-loading";ie.show({id:ae,title:"Cargando lecturas...",message:"Indexando lecturas en segundo plano...",color:"blue",autoClose:!1,withCloseButton:!1,loading:!0}),F(!0);const me=`lecturas_caso_${r}`,Ce=sessionStorage.getItem(me);if(Ce)try{const Pe=JSON.parse(Ce);z(Pe),F(!1),ie.update({id:ae,title:"Lecturas cargadas",message:"Lecturas indexadas desde caché.",color:"green",autoClose:2e3,loading:!1});return}catch{}try{let Pe=0;const xt=setInterval(()=>{Pe=Math.min(Pe+10,90),ie.update({id:ae,message:`Indexando lecturas en segundo plano... (${Pe}%)`})},300),Ye=await fetch(`http://localhost:8000/casos/${r}/lecturas`);if(!Ye.ok)throw new Error("Error al cargar lecturas");const jt=await Ye.json();z(jt),clearInterval(xt),ie.update({id:ae,title:"Lecturas cargadas",message:`Lecturas indexadas correctamente. (${jt.length} registros)`,color:"green",autoClose:2e3,loading:!1})}catch{ie.update({id:ae,title:"Error al cargar lecturas",message:"No se pudieron indexar las lecturas.",color:"red",autoClose:4e3,loading:!1}),z([])}finally{F(!1)}})(),()=>{const ae=`lecturas_caso_${r}`;sessionStorage.removeItem(ae),ie.clean()}),[r]);const xe=()=>{b(!0);const pe="matriculas-extranjeras-busqueda";ie.show({id:pe,title:"Buscando matrículas extranjeras...",message:"Procesando búsqueda de matrículas extranjeras.",color:"blue",autoClose:!1,withCloseButton:!1,loading:!0}),setTimeout(()=>{let ae=T.filter(Ce=>{const Pe=xh(Ce.Matricula);return!(!Pe||Pe.code==="ES"||a&&!Ce.Matricula.includes(a.toUpperCase())||c&&new Date(Ce.Fecha_y_Hora)<c||f&&new Date(Ce.Fecha_y_Hora)>f||h.length>0&&!h.includes(Pe.code))});_(ae.map(Ce=>({...Ce,pais:xh(Ce.Matricula)}))),b(!1),ie.update({id:pe,title:"Búsqueda completada",message:`Se encontraron ${ae.length} matrículas extranjeras.`,color:"green",autoClose:2e3,loading:!1});const me=`lecturas_caso_${r}`;sessionStorage.removeItem(me)},200)},Ee=pe=>{te===pe?ce(O==="asc"?"desc":"asc"):(re(pe),ce("asc"))},Le=[...y].sort((pe,ae)=>{var Ce,Pe;let me=0;switch(te){case"pais":me=(((Ce=pe.pais)==null?void 0:Ce.name)||"").localeCompare(((Pe=ae.pais)==null?void 0:Pe.name)||"");break;case"matricula":me=pe.Matricula.localeCompare(ae.Matricula);break;case"fecha":me=new Date(pe.Fecha_y_Hora).getTime()-new Date(ae.Fecha_y_Hora).getTime();break;case"lector":me=(pe.ID_Lector||"").localeCompare(ae.ID_Lector||"");break}return O==="asc"?me:-me}),ge=t||J||S;return s.jsxs(Ie,{children:[s.jsx(X,{justify:"space-between",mb:"md",children:s.jsx(Wt,{order:4,children:"Búsqueda de Matrículas Extranjeras"})}),s.jsx(X,{justify:"space-between",mb:"md",children:s.jsxs(X,{children:[s.jsx(da,{label:"Países (opcional)",placeholder:"Todos los países",data:LC.map(pe=>({value:pe.value,label:pe.label})),value:h,onChange:o,searchable:!0,clearable:!0,maxDropdownHeight:300,renderOption:({option:pe})=>s.jsxs("span",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx(Yi,{countryCode:pe.value,svg:!0,style:{width:20}})," ",pe.label]})}),s.jsx(Xe,{label:"Matrícula (opcional)",value:a,onChange:pe=>l(pe.target.value),placeholder:"Ej: 1234ABC"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[s.jsx("span",{style:{fontSize:12,color:"#666",marginBottom:2},children:"Fecha inicio (opcional)"}),s.jsx(Xe,{type:"date",value:c?c.toISOString().split("T")[0]:"",onChange:pe=>d(pe.target.value?new Date(pe.target.value):null),style:{minWidth:160}})]}),s.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[s.jsx("span",{style:{fontSize:12,color:"#666",marginBottom:2},children:"Fecha fin (opcional)"}),s.jsx(Xe,{type:"date",value:f?f.toISOString().split("T")[0]:"",onChange:pe=>m(pe.target.value?new Date(pe.target.value):null),style:{minWidth:160}})]}),s.jsx(Me,{leftSection:s.jsx(ur,{size:16}),onClick:xe,loading:S,children:"Buscar"})]})}),s.jsxs(Ie,{style:{position:"relative"},children:[s.jsx(Ra,{visible:ge&&!J}),s.jsxs(se,{striped:!0,highlightOnHover:!0,withColumnBorders:!0,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:s.jsxs(X,{gap:4,style:{cursor:"pointer"},onClick:()=>Ee("pais"),children:["País",te==="pais"?O==="asc"?s.jsx(Wi,{size:14}):s.jsx(Zi,{size:14}):s.jsx(za,{size:14})]})}),s.jsx("th",{children:s.jsxs(X,{gap:4,style:{cursor:"pointer"},onClick:()=>Ee("matricula"),children:["Matrícula",te==="matricula"?O==="asc"?s.jsx(Wi,{size:14}):s.jsx(Zi,{size:14}):s.jsx(za,{size:14})]})}),s.jsx("th",{children:s.jsxs(X,{gap:4,style:{cursor:"pointer"},onClick:()=>Ee("fecha"),children:["Fecha/Hora",te==="fecha"?O==="asc"?s.jsx(Wi,{size:14}):s.jsx(Zi,{size:14}):s.jsx(za,{size:14})]})}),s.jsx("th",{children:s.jsxs(X,{gap:4,style:{cursor:"pointer"},onClick:()=>Ee("lector"),children:["Lector",te==="lector"?O==="asc"?s.jsx(Wi,{size:14}):s.jsx(Zi,{size:14}):s.jsx(za,{size:14})]})})]})}),s.jsx("tbody",{children:Le.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:4,style:{textAlign:"center",color:"#888"},children:"No hay resultados."})}):Le.map((pe,ae)=>s.jsxs("tr",{children:[s.jsx("td",{style:{display:"flex",alignItems:"center",gap:6},children:pe.pais&&s.jsxs(s.Fragment,{children:[pe.pais.code==="FRIT"?s.jsxs(s.Fragment,{children:[s.jsx(Yi,{countryCode:"FR",svg:!0,style:{width:24}}),s.jsx(Yi,{countryCode:"IT",svg:!0,style:{width:24}})]}):s.jsx(Yi,{countryCode:pe.pais.code,svg:!0,style:{width:24}}),pe.pais.name,pe.pais.isPotentiallyIncomplete&&s.jsx("span",{style:{color:"orange",marginLeft:"8px"},children:"(Posible lectura incompleta)"})]})}),s.jsx("td",{children:pe.Matricula}),s.jsx("td",{children:new Date(pe.Fecha_y_Hora).toLocaleString()}),s.jsx("td",{children:pe.ID_Lector||"-"})]},ae))})]})]})]})}function MC({casoId:t}){var Vt;const[r,a]=g.useState(!1),[l,h]=g.useState(null),[o,c]=g.useState([]),[d,f]=g.useState({velocidadMinima:140,fechaInicio:"",fechaFin:"",horaInicio:"",horaFin:"",carretera:""}),[m,y]=g.useState(!1),[_,S]=g.useState({matricula:"",ventanaMinutos:10,diferenciaMinima:5,fechaInicio:"",fechaFin:"",minCoincidencias:2}),[b,T]=g.useState(!1),[z,J]=g.useState([]),[F,te]=g.useState([]),[re,O]=g.useState([]),[ce,xe]=g.useState(!1),{setHighlightedLecturas:Ee}=Qf(),[Le,ge]=g.useState("fecha"),[pe,ae]=g.useState(!0),me=()=>{f({velocidadMinima:140,fechaInicio:"",fechaFin:"",horaInicio:"",horaFin:"",carretera:""}),c([]),h(null)},Ce=E=>{if(!E)return 0;const je=E.trim().toUpperCase().match(/(?:PK|P\.K\.)?\s*(\d+)(?:[.,+](\d+))?/);if(!je)return 0;const oe=parseInt(je[1]||"0",10),Re=je[2]?parseInt(je[2].padEnd(3,"0"),10):0;return oe+Re/1e3},Pe=E=>{if(!E)return"";const H=E.trim().toUpperCase(),je=H.match(/^([A-Z]+)[\s-]*(\d+)/);if(!je)return H;const oe=je[1],Re=je[2];return`${oe}-${Re}`},xt=(E,H)=>{var je,oe,Re,Mt;try{const vt=Ce(((je=E.lector)==null?void 0:je.PK)||""),Je=Ce(((oe=H.lector)==null?void 0:oe.PK)||""),dt=Pe(((Re=E.lector)==null?void 0:Re.Carretera)||""),St=Pe(((Mt=H.lector)==null?void 0:Mt.Carretera)||"");if(vt===0||Je===0||dt!==St)return null;const fe={"M-30":32.5,M30:32.5,"M-40":63.3,M40:63.3}[dt]||null;let Ae=Math.abs(Je-vt);fe&&Ae>fe/2&&(Ae=fe-Ae);const Oe=new Date(E.Fecha_y_Hora),Fe=new Date(H.Fecha_y_Hora),Qe=Math.abs(Fe.getTime()-Oe.getTime())/(1e3*60*60);return Ae/Qe}catch(vt){return console.error("Error calculando velocidad:",vt),null}},Ye=E=>{try{const H=E.match(/([A-Z]+\d+)/i),je=E.match(/PK\s*(\d+[.,+]?\d*)/i);return{pk:je?`PK${je[1].replace(",",".").replace("+",".")}`:void 0,carretera:H?H[1].toUpperCase():void 0}}catch(H){return console.warn("Error extrayendo datos del lector:",E,H),{}}},jt=E=>{var H,je;if(!((H=E.lector)!=null&&H.PK)||!((je=E.lector)!=null&&je.Carretera)){const oe=Ye(E.ID_Lector||"");return{...E,lector:{...E.lector,PK:oe.pk||"",Carretera:oe.carretera||""}}}return E},bt=async()=>{a(!0),h(null);const E="vehiculos-rapidos-loading";ie.show({id:E,title:"Buscando vehículos rápidos...",message:"Procesando búsqueda de vehículos rápidos.",color:"blue",autoClose:!1,withCloseButton:!1,loading:!0});try{const H={tipo_fuente:"LPR"};d.fechaInicio&&(H.fecha_inicio=d.fechaInicio),d.fechaFin&&(H.fecha_fin=d.fechaFin),d.horaInicio&&(H.hora_inicio=d.horaInicio),d.horaFin&&(H.hora_fin=d.horaFin),d.carretera&&(H.carretera=d.carretera);const je=await wt.get(`/casos/${t}/lecturas`,{params:H});if(!je.data||!Array.isArray(je.data))throw new Error("Formato de respuesta inválido");const oe=je.data;if(console.log("Lecturas recibidas:",oe.length),oe.length===0){c([]),ie.show({title:"Sin resultados",message:"No se encontraron lecturas para los filtros seleccionados",color:"blue"});return}const Re=new Map,Mt=new Map;oe.forEach(Je=>{var St,D,fe;if(!Je.Matricula){console.warn("Lectura sin matrícula:",Je);return}const dt=jt(Je);if(!((St=dt.lector)!=null&&St.PK)||!((D=dt.lector)!=null&&D.Carretera)){console.warn("No se pudo completar la lectura con los datos del lector:",Je);return}Mt.has(Je.Matricula)||Mt.set(Je.Matricula,[]),(fe=Mt.get(Je.Matricula))==null||fe.push(dt)});for(const[Je,dt]of Mt.entries())dt.length<2&&(console.log(`Descartando vehículo ${Je} - solo tiene ${dt.length} lectura(s)`),Mt.delete(Je));console.log("Vehículos con múltiples lecturas:",Mt.size),Mt.forEach((Je,dt)=>{var St,D,fe,Ae,Oe;Je.sort((Fe,Qe)=>new Date(Fe.Fecha_y_Hora).getTime()-new Date(Qe.Fecha_y_Hora).getTime());for(let Fe=0;Fe<Je.length-1;Fe++){const Qe=Je[Fe],Bt=Je[Fe+1];if(((St=Qe.lector)==null?void 0:St.Carretera)!==((D=Bt.lector)==null?void 0:D.Carretera))continue;const Lt=xt(Qe,Bt);Lt!==null&&Lt>d.velocidadMinima&&Re.set(dt,{matricula:dt,velocidad:Math.round(Lt),fechaHoraInicio:Qe.Fecha_y_Hora,fechaHoraFin:Bt.Fecha_y_Hora,lectorInicio:Qe.ID_Lector||"",lectorFin:Bt.ID_Lector||"",pkInicio:((fe=Qe.lector)==null?void 0:fe.PK)||"",pkFin:((Ae=Bt.lector)==null?void 0:Ae.PK)||"",carretera:((Oe=Qe.lector)==null?void 0:Oe.Carretera)||""})}});const vt=Array.from(Re.values());console.log("Vehículos rápidos encontrados:",vt.length),c(vt),vt.length===0?ie.show({title:"Sin resultados",message:"No se encontraron vehículos que superen la velocidad mínima establecida",color:"blue"}):ie.update({id:E,title:"Búsqueda completada",message:`Se encontraron ${vt.length} vehículos con velocidad superior a ${d.velocidadMinima} km/h`,color:"green",autoClose:2e3,loading:!1})}catch(H){console.error("Error al buscar vehículos rápidos:",H),h("Error al procesar los datos de vehículos rápidos"),ie.update({id:E,title:"Error",message:"Ocurrió un error al buscar vehículos rápidos",color:"red",autoClose:4e3,loading:!1})}finally{a(!1)}},Dt=()=>{const E=["PK045+600","PK45.600","45,800","PK 25+800","25.800","25,800","25","PK25","P.K. 25+800","25+800","25.8","25,8","PK 25.800","PK 25,800","PK25+800","PK25.800","PK25,800"];console.log("=== Pruebas de Parseo de PK ==="),E.forEach(je=>{const oe=Ce(je);console.log(`PK: "${je}" -> ${oe} km`)});const H=["A-1","N340","AP7","C-31","A1","N 340","A 1","A-1 (Madrid)","A1, PK25+800","A-1 PK25+800","M-40","M40","M 40","M-40 (Madrid)","M40, PK25+800"];console.log(`
=== Pruebas de Parseo de Carretera ===`),H.forEach(je=>{const oe=Pe(je);console.log(`Carretera: "${je}" -> "${oe}"`)})};g.useEffect(()=>{Dt()},[]);const rt=async()=>{if(!_.matricula){ie.show({title:"Error",message:"Por favor, introduce la matrícula objetivo",color:"red"});return}T(!0),xe(!0);const E="lanzadera-loading";ie.show({id:E,title:"Buscando vehículo acompañante...",message:"Procesando búsqueda de vehículo acompañante.",color:"blue",autoClose:!1,withCloseButton:!1,loading:!0});try{const H=await wt.post(`/casos/${t}/detectar-lanzaderas`,{matricula:_.matricula,fecha_inicio:_.fechaInicio||void 0,fecha_fin:_.fechaFin||void 0,ventana_minutos:_.ventanaMinutos,diferencia_minima:_.diferenciaMinima,min_coincidencias:_.minCoincidencias});J(H.data.vehiculos_lanzadera),te(H.data.detalles),H.data.vehiculos_lanzadera.length===0?ie.show({title:"Sin resultados",message:"No se han detectado vehículos acompañante para los criterios especificados",color:"blue"}):ie.update({id:E,title:"Búsqueda completada",message:`Se han detectado ${H.data.vehiculos_lanzadera.length} vehículos acompañante`,color:"green",autoClose:2e3,loading:!1})}catch(H){console.error("Error al buscar vehículos lanzadera:",H),ie.update({id:E,title:"Error",message:"Ocurrió un error al buscar vehículos lanzadera",color:"red",autoClose:4e3,loading:!1})}finally{T(!1)}},q=(Vt=_.matricula)==null?void 0:Vt.trim().toUpperCase(),ke=g.useMemo(()=>{if(!q||!F||F.length===0)return{};const E=F.filter(Re=>Re.matricula&&Re.fecha&&Re.hora&&Re.lector),H=E.filter(Re=>Re.matricula===q),je=E.filter(Re=>Re.matricula!==q),oe={};return je.forEach(Re=>{H.filter(vt=>vt.fecha===Re.fecha&&vt.lector===Re.lector).forEach(vt=>{oe[Re.matricula]||(oe[Re.matricula]=[]),oe[Re.matricula].push({objetivo:vt,acompanante:Re})})}),oe},[F,q]),G=E=>`velocidad-${E.matricula}-${E.fechaHoraInicio}-${E.fechaHoraFin}`,K=E=>`lanzadera-${E.matricula}-${E.fecha}-${E.hora}-${E.lector}`,W=E=>re.some(H=>H._rowId===G(E)),he=E=>re.some(H=>H._rowId===K(E)),de=o.length>0&&o.every(W);F.length>0&&F.every(he);const De=(E,H)=>{const je={...E,tipo:"velocidad",_rowId:G(E)};O(oe=>H?[...oe,je]:oe.filter(Re=>Re._rowId!==je._rowId))},Ne=E=>{if(E){const H=o.filter(je=>!W(je)).map(je=>({...je,tipo:"velocidad",_rowId:G(je)}));O(je=>[...je,...H])}else O(H=>H.filter(je=>!o.some(oe=>je._rowId===G(oe))))},Ve=async()=>{const E=re.filter(H=>H.tipo==="velocidad"&&H.ID_Lectura);if(E.length===0){ie.show({title:"Sin lecturas seleccionadas",message:"No hay lecturas con ID para marcar como relevante.",color:"orange"});return}for(const H of E)try{await wt.post(`/lecturas/${H.ID_Lectura}/marcar_relevante`,{caso_id:t})}catch{ie.show({title:"Error",message:`No se pudo marcar la lectura ${H.ID_Lectura} como relevante.`,color:"red"})}ie.show({title:"Éxito",message:"Lecturas marcadas como relevantes.",color:"green"}),O([])},at=async()=>{var H,je;const E=Array.from(new Set(re.map(oe=>oe.matricula||oe.Matricula)));if(E.length===0){ie.show({title:"Sin matrículas",message:"No hay matrículas seleccionadas.",color:"orange"});return}for(const oe of E)try{await wt.post("/vehiculos",{Matricula:oe})}catch(Re){((H=Re.response)==null?void 0:H.status)===400||((je=Re.response)==null?void 0:je.status)===409?ie.show({title:"Vehículo Existente",message:`El vehículo ${oe} ya existe.`,color:"blue"}):ie.show({title:"Error",message:`No se pudo guardar el vehículo ${oe}.`,color:"red"})}ie.show({title:"Éxito",message:"Vehículos guardados.",color:"green"}),O([])},Ke=Object.values(ke).filter(E=>E.length>=(_.minCoincidencias||2)).length;return s.jsxs(Ie,{children:[s.jsxs(X,{justify:"flex-end",mb:"xs",children:[s.jsxs(Me,{size:"xs",variant:"outline",leftSection:s.jsx(kc,{size:16}),onClick:Ve,disabled:re.length===0,children:["Marcar Relevante (",re.length,")"]}),s.jsxs(Me,{size:"xs",variant:"outline",color:"green",leftSection:s.jsx(Sr,{size:16}),onClick:at,disabled:re.length===0,children:["Guardar Vehículos (",re.length,")"]})]}),s.jsxs(zt,{shadow:"sm",p:"md",mb:"md",children:[s.jsx(X,{justify:"space-between",mb:"md",children:s.jsx(Wt,{order:4,children:"Detección de Vehículos Rápidos"})}),s.jsxs(X,{mb:"md",children:[s.jsx(Vr,{label:"Velocidad Mínima (km/h)",value:d.velocidadMinima,onChange:E=>f({...d,velocidadMinima:typeof E=="number"?E:140}),min:0,max:300}),s.jsxs(Ie,{children:[s.jsx(Y,{size:"sm",mb:4,children:"Fecha y Hora Inicio"}),s.jsxs(X,{gap:"xs",children:[s.jsx(Xe,{type:"date",value:d.fechaInicio,onChange:E=>f({...d,fechaInicio:E.target.value}),style:{width:"160px"}}),s.jsx(Xe,{type:"time",value:d.horaInicio,onChange:E=>f({...d,horaInicio:E.target.value}),style:{width:"120px"}})]})]}),s.jsxs(Ie,{children:[s.jsx(Y,{size:"sm",mb:4,children:"Fecha y Hora Fin"}),s.jsxs(X,{gap:"xs",children:[s.jsx(Xe,{type:"date",value:d.fechaFin,onChange:E=>f({...d,fechaFin:E.target.value}),style:{width:"160px"}}),s.jsx(Xe,{type:"time",value:d.horaFin,onChange:E=>f({...d,horaFin:E.target.value}),style:{width:"120px"}})]})]}),s.jsx(Xe,{label:"Carretera",value:d.carretera,onChange:E=>f({...d,carretera:E.target.value}),placeholder:"Ej: M-40"}),s.jsxs(X,{mt:"xl",children:[s.jsx(Me,{leftSection:s.jsx(ur,{size:14}),onClick:bt,children:"Buscar"}),s.jsx(Me,{variant:"light",color:"gray",onClick:me,children:"Limpiar"})]})]}),l&&s.jsx(Pa,{color:"red",title:"Error",mb:"md",children:l}),s.jsxs(Ie,{style:{position:"relative"},children:[s.jsx(Ra,{visible:r}),s.jsxs(se,{striped:!0,highlightOnHover:!0,children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:s.jsx(wr,{checked:de,onChange:E=>Ne(E.currentTarget.checked)})}),s.jsx("th",{style:{textAlign:"center"},children:"Matrícula"}),s.jsx("th",{style:{textAlign:"center"},children:"Velocidad (km/h)"}),s.jsx("th",{style:{textAlign:"center"},children:"Fecha/Hora Inicio"}),s.jsx("th",{style:{textAlign:"center"},children:"Fecha/Hora Fin"}),s.jsx("th",{style:{textAlign:"center"},children:"Lector Inicio"}),s.jsx("th",{style:{textAlign:"center"},children:"Lector Fin"}),s.jsx("th",{style:{textAlign:"center"},children:"PK Inicio"}),s.jsx("th",{style:{textAlign:"center"},children:"PK Fin"}),s.jsx("th",{style:{textAlign:"center"},children:"Carretera"})]})}),s.jsx("tbody",{children:o.map((E,H)=>s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx(wr,{checked:W(E),onChange:je=>De(E,je.currentTarget.checked)})}),s.jsx("td",{style:{textAlign:"center"},children:E.matricula}),s.jsx("td",{style:{textAlign:"center"},children:s.jsxs(Mn,{color:"red",leftSection:s.jsx(uo,{size:12}),children:[E.velocidad," km/h"]})}),s.jsx("td",{style:{textAlign:"center"},children:new Date(E.fechaHoraInicio).toLocaleString()}),s.jsx("td",{style:{textAlign:"center"},children:new Date(E.fechaHoraFin).toLocaleString()}),s.jsx("td",{style:{textAlign:"center"},children:E.lectorInicio}),s.jsx("td",{style:{textAlign:"center"},children:E.lectorFin}),s.jsx("td",{style:{textAlign:"center"},children:E.pkInicio}),s.jsx("td",{style:{textAlign:"center"},children:E.pkFin}),s.jsx("td",{style:{textAlign:"center"},children:E.carretera})]},H))})]})]})]}),s.jsxs(zt,{shadow:"sm",p:"md",mb:"md",children:[s.jsx(X,{justify:"space-between",mb:"md",children:s.jsx(Wt,{order:4,children:"Detección de Vehículo Acompañante"})}),s.jsxs(X,{mb:"md",children:[s.jsx(Xe,{label:"Matrícula objetivo",value:(_==null?void 0:_.matricula)||"",onChange:E=>S(H=>({...H,matricula:E.target.value})),placeholder:"Introduce matrícula",required:!0}),s.jsx(Xe,{type:"date",label:"Fecha Inicio",value:(_==null?void 0:_.fechaInicio)||"",onChange:E=>S(H=>({...H,fechaInicio:E.target.value}))}),s.jsx(Xe,{type:"date",label:"Fecha Fin",value:(_==null?void 0:_.fechaFin)||"",onChange:E=>S(H=>({...H,fechaFin:E.target.value}))}),s.jsx(Vr,{label:"Ventana temporal (minutos)",value:(_==null?void 0:_.ventanaMinutos)||10,onChange:E=>S(H=>({...H,ventanaMinutos:typeof E=="number"?E:10})),min:1,max:120}),s.jsx(Vr,{label:"Diferencia mínima entre lecturas (min)",value:(_==null?void 0:_.diferenciaMinima)||5,onChange:E=>S(H=>({...H,diferenciaMinima:typeof E=="number"?E:5})),min:1,max:60}),s.jsx(Vr,{label:"Mínimo de coincidencias",value:(_==null?void 0:_.minCoincidencias)||2,onChange:E=>S(H=>({...H,minCoincidencias:typeof E=="number"?E:2})),min:2,max:20}),s.jsxs(X,{mt:"md",children:[s.jsx(Me,{leftSection:s.jsx(ur,{size:16}),onClick:rt,loading:b,children:"Buscar"}),s.jsx(Me,{variant:"light",color:"gray",onClick:()=>{S({matricula:"",ventanaMinutos:10,diferenciaMinima:5,fechaInicio:"",fechaFin:"",minCoincidencias:2}),te([]),J([]),xe(!1),O([])},children:"Limpiar"})]})]}),s.jsx(Wt,{order:5,mt:"md",mb:"xs",children:"Lecturas Intercaladas (Objetivo y Acompañante)"}),s.jsxs(X,{align:"center",mb:"xs",children:[s.jsxs(Y,{fw:500,children:["Coincidencias encontradas: ",Ke]}),s.jsxs(Pt,{shadow:"md",width:180,children:[s.jsx(Pt.Target,{children:s.jsx(We,{variant:"light",color:"blue",children:s.jsx(xy,{size:18})})}),s.jsxs(Pt.Dropdown,{children:[s.jsx(Pt.Item,{onClick:()=>{ge("fecha"),ae(!0)},children:"Fecha ascendente"}),s.jsx(Pt.Item,{onClick:()=>{ge("fecha"),ae(!1)},children:"Fecha descendente"}),s.jsx(Pt.Item,{onClick:()=>{ge("matricula"),ae(!0)},children:"Matrícula ascendente"}),s.jsx(Pt.Item,{onClick:()=>{ge("matricula"),ae(!1)},children:"Matrícula descendente"})]})]})]}),s.jsxs(ct,{children:[Ke===0&&s.jsx(Y,{c:"dimmed",ta:"center",my:"md",children:"No se han encontrado vehículos acompañantes"}),Object.entries(ke).filter(([E,H])=>H.length>=(_.minCoincidencias||2)).sort((E,H)=>H[1].length-E[1].length).map(([E,H],je)=>s.jsxs(dc,{shadow:"sm",p:"md",radius:"md",withBorder:!0,mb:"sm",children:[s.jsxs(X,{justify:"space-between",mb:"xs",children:[s.jsxs(Y,{fw:700,children:[E," ",s.jsxs(Mn,{color:"gray",ml:"sm",children:["Coincidencias: ",H.length]})]}),s.jsx(Me,{size:"xs",onClick:()=>Ee(H.flatMap(oe=>[oe.objetivo,oe.acompanante])),leftSection:s.jsx(rr,{size:16}),children:"Ver en mapa"})]}),s.jsx(ct,{gap:4,children:H.map((oe,Re)=>s.jsxs(X,{spacing:"md",children:[s.jsx(Mn,{color:"blue",children:"OBJETIVO"}),s.jsx(Y,{fw:700,children:oe.objetivo.matricula}),s.jsxs(Y,{children:[oe.objetivo.fecha," ",oe.objetivo.hora.length===5?oe.objetivo.hora+":00":oe.objetivo.hora]}),s.jsx(Y,{size:"sm",color:"dimmed",children:oe.objetivo.lector}),s.jsx(Mn,{color:"gray",children:"ACOMPAÑANTE"}),s.jsx(Y,{fw:400,children:oe.acompanante.matricula}),s.jsxs(Y,{children:[oe.acompanante.fecha," ",oe.acompanante.hora.length===5?oe.acompanante.hora+":00":oe.acompanante.hora]}),s.jsx(Y,{size:"sm",color:"dimmed",children:oe.acompanante.lector})]},Re))})]},E))]})]}),s.jsx(zt,{shadow:"sm",p:"md",mb:"md",children:s.jsx(kC,{lecturas:[...o.map(E=>({Matricula:E.matricula,Fecha_y_Hora:E.fechaHoraInicio,ID_Lector:E.lectorInicio})),...F.map(E=>({Matricula:E.matricula,Fecha_y_Hora:`${E.fecha}T${E.hora}`,ID_Lector:E.lector}))],loading:r||b})})]})}const IC=({filters:t,onFilterChange:r,onFiltrar:a,onLimpiar:l,loading:h=!1,lectorSuggestions:o=[]})=>{const c=f=>m=>{r({[f]:m||""})},d=()=>{let f=t.fechaInicio||"",m=t.horaInicio||"",y=t.fechaFin||"",_=t.horaFin||"";if(f&&!m&&(m="00:00"),y&&!_&&(_="23:59"),f&&y&&f===y&&m&&_&&_<m){const S=new Date(y);S.setDate(S.getDate()+1),y=S.toISOString().slice(0,10)}f||(m=""),y||(_=""),r({fechaInicio:f,horaInicio:m,fechaFin:y,horaFin:_}),a()};return s.jsxs(ct,{gap:"md",children:[s.jsx(X,{grow:!0,children:s.jsx(hy,{label:"ID Lector",placeholder:"Filtrar por ID lector...",value:t.lectorId,onChange:c("lectorId"),data:o,limit:10,maxDropdownHeight:200})}),s.jsxs(X,{grow:!0,children:[s.jsx(Xe,{label:"Fecha Inicio",type:"date",value:t.fechaInicio,onChange:f=>r({fechaInicio:f.target.value})}),s.jsx(Xe,{label:"Hora Inicio",type:"time",value:t.horaInicio,onChange:f=>r({horaInicio:f.target.value})})]}),s.jsxs(X,{grow:!0,children:[s.jsx(Xe,{label:"Fecha Fin",type:"date",value:t.fechaFin,onChange:f=>r({fechaFin:f.target.value})}),s.jsx(Xe,{label:"Hora Fin",type:"time",value:t.horaFin,onChange:f=>r({horaFin:f.target.value})})]}),s.jsxs(X,{justify:"flex-end",children:[s.jsx(Me,{variant:"outline",leftSection:s.jsx(Gf,{size:16}),onClick:l,disabled:h,children:"Limpiar Filtros"}),s.jsx(Me,{leftSection:s.jsx(ur,{size:16}),onClick:d,loading:h,children:"Aplicar Filtros"})]})]})},EC={height:"100%",width:"100%",position:"relative",zIndex:1},Kl=(t,r,a)=>{var d;const h=`marker-${a.replace("#","")}`,o="dynamic-marker-styles";let c=document.getElementById(o);if(c||(c=document.createElement("style"),c.id=o,document.head.appendChild(c)),!((d=c.textContent)!=null&&d.includes(h))){const f=`
      .${h} {
        background-color: ${a} !important;
        border-radius: 50%;
        box-shadow: 0 0 4px rgba(0,0,0,0.4);
      }
      .${h}-count {
        background-color: ${a} !important;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: bold;
        box-shadow: 0 0 4px rgba(0,0,0,0.4);
      }
    `;c.textContent+=f}return t>1?an.divIcon({className:"custom-div-icon",html:`
        <div class="marker-container">
          <div class="${h}" style="width: 12px; height: 12px; border: 2px solid white;"></div>
          <div class="${h}-count" style="position: absolute; top: -8px; right: -8px; width: 16px; height: 16px;">
            ${t}
          </div>
        </div>
      `,iconSize:[28,28],iconAnchor:[28/2,28/2]}):an.divIcon({className:"custom-div-icon",html:`
      <div class="${h}" style="width: 12px; height: 12px; border: 2px solid white;"></div>
    `,iconSize:[12,12],iconAnchor:[12/2,12/2]})},AC=({info:t,onClose:r,onNavigate:a,disableNav:l})=>{var h,o;return t?s.jsx(Ie,{style:{position:"absolute",bottom:20,left:"50%",transform:"translateX(-50%)",zIndex:1e3,backgroundColor:"white",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",maxWidth:"90%",width:"auto"},children:s.jsxs(ct,{gap:"xs",children:[s.jsxs(X,{gap:"xs",align:"center",children:[s.jsx(Ie,{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:t.tipo==="lector"?"#011638":"#228be6",flexShrink:0}}),s.jsxs(Y,{fw:700,size:"sm",children:[t.tipo==="lector"?t.ID_Lector:t.Matricula,t.Nombre&&` - ${t.Nombre}`]}),s.jsx(We,{variant:"subtle",color:"gray",onClick:r,size:"sm",style:{marginLeft:"auto"},children:s.jsx(fs,{size:14})})]}),s.jsxs(X,{gap:"md",children:[s.jsxs(Y,{size:"sm",children:[s.jsx("b",{children:"Fecha/Hora:"})," ",Tt(t.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss")]}),t.tipo!=="lector"&&t.Velocidad&&s.jsxs(Y,{size:"sm",children:[s.jsx("b",{children:"Velocidad:"})," ",typeof t.Velocidad=="number"&&!isNaN(t.Velocidad)?t.Velocidad.toFixed(1):"?"," km/h"]})]}),s.jsxs(X,{gap:"md",children:[s.jsxs(Y,{size:"sm",children:[s.jsx("b",{children:"Coordenadas:"})," ",(h=t.Coordenada_Y)==null?void 0:h.toFixed(6),", ",(o=t.Coordenada_X)==null?void 0:o.toFixed(6)]}),t.tipo==="lector"&&t.lecturas&&t.lecturas.length>0&&s.jsxs(Y,{size:"sm",children:[s.jsx("b",{children:"Pasos registrados:"})," ",t.lecturas.length]})]}),a&&!l&&s.jsxs(X,{justify:"center",gap:4,mt:"xs",children:[s.jsx(We,{size:"md",variant:"filled",color:"blue",onClick:()=>a("prev"),children:s.jsx(bf,{size:20})}),s.jsx(We,{size:"md",variant:"filled",color:"blue",onClick:()=>a("next"),children:s.jsx(Mc,{size:20})})]})]})}):null},PC=({casoId:t})=>{g.useEffect(()=>{const I="map-base-styles";if(!document.getElementById(I)){const $=document.createElement("style");$.id=I,$.textContent=`
        .custom-div-icon {
          background: transparent !important;
          border: none !important;
        }
        .marker-container {
          position: relative;
        }
      `,document.head.appendChild($)}},[]);const[r,a]=g.useState([]),[l,h]=g.useState([]),[o,c]=g.useState(!1),[d,f]=g.useState([]),[m,y]=g.useState(!1),[_,S]=g.useState(null),[b,T]=g.useState(null),[z,J]=g.useState([]),[F,te]=g.useState([]),[re,O]=g.useState({nombre:"",color:"#228be6"}),[ce,xe]=g.useState(null),[Ee,Le]=g.useState(!1),[ge,pe]=g.useState({lecturas:[],lectores:[]}),[ae,me]=g.useState({fechaInicio:"",horaInicio:"",fechaFin:"",horaFin:"",lectorId:""}),[Ce,Pe]=g.useState({visualizationType:"cartodb-light",showCaseReaders:!0,showAllReaders:!1,showCoincidencias:!0}),[xt,Ye]=g.useState([]),[jt,bt]=g.useState(0),[Dt,rt]=g.useState(!1),[q,ke]=g.useState(!1),[G,K]=g.useState(null),[W,he]=g.useState(null),de=g.useRef(null),{highlightedLecturas:De}=Qf();Tf([["Escape",()=>Dt&&rt(!1)]]),g.useEffect(()=>{(async()=>{try{const $=r.map(Q=>Q.ID_Lector);J($.sort())}catch($){console.error("Error fetching lector suggestions:",$),J([])}})()},[r]),g.useEffect(()=>{(async()=>{y(!0),S(null);try{console.log("Cargando vehículos para caso:",t);const $=await wt.get(`/casos/${t}/vehiculos`);console.log("Vehículos cargados:",$.data),f($.data)}catch($){console.error("Error al obtener vehículos de interés:",$),S("No se pudieron cargar los vehículos")}finally{y(!1)}})()},[t]);const Ne=g.useCallback(I=>{me($=>({...$,...I}))},[]),Ve=g.useCallback(async()=>{if(!b){h([]),pe({lecturas:[],lectores:[]});return}c(!0);try{const[I,$]=await Promise.all([wt.get(`/casos/${t}/lectores`),wt.get(`/casos/${t}/lecturas`,{params:{matricula:b,fecha_inicio:ae.fechaInicio,hora_inicio:ae.horaInicio,fecha_fin:ae.fechaFin,hora_fin:ae.horaFin,lector_id:ae.lectorId}})]);console.log("Respuesta de lecturas:",$.data),console.log("Total lecturas recibidas:",$.data.length);const Q=I.data.filter(st=>st.Coordenada_X!=null&&st.Coordenada_Y!=null),ue=new Map(Q.map(st=>[String(st.ID_Lector),st])),It=$.data.map(st=>{const tn=ue.get(String(st.ID_Lector));return tn?{...st,Coordenada_X:tn.Coordenada_X,Coordenada_Y:tn.Coordenada_Y}:st}).filter(st=>st.Coordenada_X!=null&&st.Coordenada_Y!=null);console.log("Lecturas con coordenadas:",It.length),console.log("Muestra de lecturas con coordenadas:",It.slice(0,3));const Nt=Q.filter(st=>It.some(tn=>String(tn.ID_Lector)===String(st.ID_Lector)));console.log("Lectores filtrados:",Nt.length),a(Q),h(It),pe({lecturas:It,lectores:Nt}),O(st=>({...st,nombre:b}))}catch(I){console.error("Error al filtrar:",I)}finally{c(!1)}},[t,ae,b]),at=g.useCallback(()=>{me({fechaInicio:"",horaInicio:"",fechaFin:"",horaFin:"",lectorId:""}),T(null),h([])},[]);g.useEffect(()=>{(async()=>{try{console.log("Cargando lectores para caso:",t);const Q=(await wt.get(`/casos/${t}/lectores`)).data.filter(ue=>ue.Coordenada_X!=null&&ue.Coordenada_Y!=null);console.log("Lectores cargados:",Q),a(Q)}catch($){console.error("Error al cargar lectores:",$)}})()},[t]);const Ke=g.useCallback(I=>{if(console.log("🎯 centerMapOnLectura llamado con:",I),console.log("🗺️ mapRef.current existe:",!!de.current),he(I),console.log("✅ selectedLectura actualizada"),K({...I,tipo:"lectura"}),console.log("✅ InfoBanner actualizado"),de.current&&I.Coordenada_X&&I.Coordenada_Y){console.log("📍 Centrando en coordenadas de lectura:",I.Coordenada_Y,I.Coordenada_X),setTimeout(()=>{de.current?(console.log("🔄 Ejecutando setView..."),de.current.setView([I.Coordenada_Y,I.Coordenada_X],16,{animate:!0,duration:1}),console.log("✅ setView ejecutado correctamente")):console.log("❌ mapRef.current no disponible en setTimeout")},50);return}const $=r.find(Q=>String(Q.ID_Lector)===String(I.ID_Lector));if($&&$.Coordenada_X&&$.Coordenada_Y&&de.current){console.log("📍 Centrando en coordenadas de lector:",$.Coordenada_Y,$.Coordenada_X),setTimeout(()=>{de.current?(console.log("🔄 Ejecutando setView para lector..."),de.current.setView([$.Coordenada_Y,$.Coordenada_X],16,{animate:!0,duration:1}),console.log("✅ setView para lector ejecutado correctamente")):console.log("❌ mapRef.current no disponible en setTimeout para lector")},50);return}console.log("❌ No se encontraron coordenadas para la lectura"),ie.show({title:"No se puede centrar",message:"No hay coordenadas disponibles para esta lectura ni para su lector asociado.",color:"red"})},[r]),Vt=g.useMemo(()=>[40.416775,-3.70379],[]),E=10,H=g.useMemo(()=>(console.log("Preparando opciones de vehículos. Total vehículos:",d.length),console.log("Vehículos disponibles:",d),d.map(I=>({value:I.Matricula,label:`${I.Matricula}${I.Marca?` - ${I.Marca}`:""}${I.Modelo?` ${I.Modelo}`:""}`}))),[d]);g.useMemo(()=>{const I=new Map;return l.forEach($=>{if($.ID_Lector){const Q=I.get($.ID_Lector)||[];Q.push($),I.set($.ID_Lector,Q)}}),I},[l]);const je=()=>{if(!re.nombre)return;const I={id:Date.now().toString(),nombre:re.nombre,color:re.color||"#228be6",activa:!0,lecturas:ge.lecturas,lectores:ge.lectores,filtros:{...ae}};te($=>[...$,I]),O({nombre:"",color:"#228be6"}),Le(!1),pe({lecturas:[],lectores:[]}),T(null),me({fechaInicio:"",horaInicio:"",fechaFin:"",horaFin:"",lectorId:""})},oe=I=>{const $=F.find(Q=>Q.id===I);$&&(O({nombre:$.nombre,color:$.color}),xe($),Le(!0))},Re=()=>{!ce||!re.nombre||(te(I=>I.map($=>$.id===ce.id?{...$,nombre:re.nombre,color:re.color||$.color}:$)),O({nombre:"",color:"#228be6"}),xe(null),Le(!1))},Mt=I=>{te($=>$.map(Q=>Q.id===I?{...Q,activa:!Q.activa}:Q))},vt=I=>{te($=>$.filter(Q=>Q.id!==I))},Je=g.useMemo(()=>{if(!Ce.showCoincidencias)return[];const I=[];if(F.filter(ue=>ue.activa).length===0&&ge.lecturas.length===0)return[];const $=new Map,Q=ue=>{if(!ue.Coordenada_X||!ue.Coordenada_Y)return;const It=`${ue.Coordenada_X.toFixed(6)}-${ue.Coordenada_Y.toFixed(6)}`,Nt=$.get(It)||{lat:ue.Coordenada_Y,lon:ue.Coordenada_X,vehiculos:new Set,lectores:new Set,fechas:new Map};Nt.vehiculos.add(ue.Matricula),ue.ID_Lector&&Nt.lectores.add(ue.ID_Lector),Nt.fechas.set(ue.Matricula,ue.Fecha_y_Hora),$.set(It,Nt)};return F.forEach(ue=>{ue.activa&&ue.lecturas.forEach(Q)}),ge.lecturas.length>0&&ge.lecturas.forEach(Q),$.forEach(ue=>{ue.vehiculos.size>1&&I.push({lat:ue.lat,lon:ue.lon,vehiculos:Array.from(ue.vehiculos),lectores:Array.from(ue.lectores),fechas:Array.from(ue.fechas.entries()).map(([It,Nt])=>({vehiculo:It,fecha:Tt(Nt).format("DD/MM/YYYY HH:mm:ss")}))})}),I},[F,ge.lecturas,Ce.showCoincidencias]),dt=()=>{const I=ge.lecturas.filter($=>$.Tipo_Fuente!=="GPS");return console.log("Renderizando resultados. Total lecturas LPR:",I.length),console.log("Muestra de lecturas LPR:",I.slice(0,3)),console.log("Tipos de fuente en lecturas:",[...new Set(ge.lecturas.map($=>$.Tipo_Fuente))]),console.log("Lectores en resultados:",ge.lectores.length),I.length===0?null:s.jsxs(s.Fragment,{children:[ge.lectores.map($=>{const Q=I.filter(ue=>ue.ID_Lector===$.ID_Lector);return console.log(`Lector ${$.ID_Lector} tiene ${Q.length} lecturas`),s.jsx(Cr,{position:[$.Coordenada_Y,$.Coordenada_X],icon:Kl(Q.length,"lector","#228be6"),zIndexOffset:500,eventHandlers:{click:()=>{K({...$,tipo:"lector",lecturas:Q}),Q.length>0&&Ke(Q[0])}}},`filtro-lector-${$.ID_Lector}`)}),I.filter($=>$.Coordenada_X&&$.Coordenada_Y).map($=>{const Q=(W==null?void 0:W.ID_Lectura)===$.ID_Lectura;return s.jsxs(Yr.Fragment,{children:[Q&&s.jsx(mh,{center:[$.Coordenada_Y,$.Coordenada_X],radius:50,pathOptions:{color:"#e03131",fillColor:"#e03131",fillOpacity:.15,weight:3,dashArray:"5, 5"}}),s.jsx(Cr,{position:[$.Coordenada_Y,$.Coordenada_X],icon:an.divIcon({className:"custom-div-icon",html:`
                      <div style="
                        position: relative;
                        width: ${Q?"36px":"16px"};
                        height: ${Q?"36px":"16px"};
                        background: ${Q?"rgba(224,49,49,0.25)":"#228be6"};
                        border-radius: 50%;
                        border: ${Q?"3px solid #e03131":"2px solid #fff"};
                        box-shadow: 0 0 12px ${Q?"#e03131":"rgba(34,139,230,0.5)"};
                        animation: ${Q?"gpsPulse 1.5s infinite":"none"};
                        display: flex;
                        align-items: center;
                        justify-content: center;
                      ">
                        ${Q?`
                          <div style="
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            width: 12px;
                            height: 12px;
                            background: #e03131;
                            border-radius: 50%;
                            box-shadow: 0 0 8px #e03131;
                          "></div>
                        `:""}
                      </div>
                      <style>
                        @keyframes gpsPulse {
                          0% { box-shadow: 0 0 0 0 #e03131; }
                          70% { box-shadow: 0 0 0 16px rgba(224,49,49,0); }
                          100% { box-shadow: 0 0 0 0 #e03131; }
                        }
                      </style>
                    `,iconSize:[Q?36:16,Q?36:16],iconAnchor:[Q?18:8,Q?18:8]}),zIndexOffset:Q?900:600,eventHandlers:{click:()=>Ke($)}})]},`filtro-lectura-${$.ID_Lectura}`)})]})},St=I=>{if(!I.activa)return null;console.log(`Renderizando capa ${I.nombre}:`,{lectores:I.lectores.length,lecturas:I.lecturas.length});const $=[];return I.lectores.forEach(Q=>{if(!Q.Coordenada_X||!Q.Coordenada_Y)return;const ue=I.lecturas.filter(It=>It.ID_Lector===Q.ID_Lector&&It.Tipo_Fuente!=="GPS");console.log(`Lector ${Q.ID_Lector} en capa ${I.nombre} tiene ${ue.length} lecturas`),$.push(s.jsx(Cr,{position:[Q.Coordenada_Y,Q.Coordenada_X],icon:Kl(ue.length,"lector",I.color),zIndexOffset:300,eventHandlers:{click:()=>{K({...Q,tipo:"lector",lecturas:ue}),ue.length>0&&Ke(ue[0])}}},`${I.id}-lector-${Q.ID_Lector}`))}),I.lecturas.filter(Q=>Q.Coordenada_X&&Q.Coordenada_Y&&Q.Tipo_Fuente!=="GPS").forEach(Q=>{console.log("Renderizando lectura individual en capa:",Q.ID_Lectura);const ue=(W==null?void 0:W.ID_Lectura)===Q.ID_Lectura;$.push(s.jsxs(Yr.Fragment,{children:[ue&&s.jsx(mh,{center:[Q.Coordenada_Y,Q.Coordenada_X],radius:50,pathOptions:{color:"#e03131",fillColor:"#e03131",fillOpacity:.15,weight:3,dashArray:"5, 5"}}),s.jsx(Cr,{position:[Q.Coordenada_Y,Q.Coordenada_X],icon:an.divIcon({className:"custom-div-icon",html:`
                  <div style="
                    position: relative;
                    width: ${ue?"36px":"16px"};
                    height: ${ue?"36px":"16px"};
                    background: ${ue?"rgba(224,49,49,0.25)":I.color};
                    border-radius: 50%;
                    border: ${ue?"3px solid #e03131":"2px solid #fff"};
                    box-shadow: 0 0 12px ${ue?"#e03131":"rgba(34,139,230,0.5)"};
                    animation: ${ue?"gpsPulse 1.5s infinite":"none"};
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  ">
                    ${ue?`
                      <div style="
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 12px;
                        height: 12px;
                        background: #e03131;
                        border-radius: 50%;
                        box-shadow: 0 0 8px #e03131;
                      "></div>
                    `:""}
                  </div>
                  <style>
                    @keyframes gpsPulse {
                      0% { box-shadow: 0 0 0 0 #e03131; }
                      70% { box-shadow: 0 0 0 16px rgba(224,49,49,0); }
                      100% { box-shadow: 0 0 0 0 #e03131; }
                    }
                  </style>
                `,iconSize:[ue?36:16,ue?36:16],iconAnchor:[ue?18:8,ue?18:8]}),zIndexOffset:ue?900:400,eventHandlers:{click:()=>Ke(Q)}})]},`${I.id}-lectura-${Q.ID_Lectura}`))}),$},D=I=>{Pe($=>({...$,...I}))},fe=()=>{switch(Ce.visualizationType){case"satellite":return"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}";case"cartodb-light":return"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png";default:return"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}};g.useEffect(()=>{const I=async()=>{try{const $=await ly();Ye($.filter(Q=>Q.Coordenada_X!=null&&Q.Coordenada_Y!=null))}catch($){console.error("Error al cargar todos los lectores del sistema:",$)}};Ce.showAllReaders&&I()},[Ce.showAllReaders]);const Ae=()=>(console.log("Renderizando capas de lectores:",{showCaseReaders:Ce.showCaseReaders,showAllReaders:Ce.showAllReaders,lectoresCaso:r.length,lectoresSistema:xt.length}),s.jsxs(s.Fragment,{children:[Ce.showAllReaders&&xt.map(I=>s.jsx(Cr,{position:[I.Coordenada_Y,I.Coordenada_X],icon:Kl(1,"lector","#228be6"),zIndexOffset:100,eventHandlers:{click:()=>K({...I,tipo:"lector",lecturas:[]})}},`system-reader-${I.ID_Lector}`)),Ce.showCaseReaders&&r.map(I=>s.jsx(Cr,{position:[I.Coordenada_Y,I.Coordenada_X],icon:an.divIcon({className:"custom-div-icon",html:`
                <div style="
                  background-color: white;
                  width: 16px;
                  height: 16px;
                  border-radius: 50%;
                  border: 3px solid #3b5bdb;
                  box-shadow: 0 0 8px rgba(0,0,0,0.4);
                  position: relative;
                ">
                  <div style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 6px;
                    height: 6px;
                    background-color: #3b5bdb;
                    border-radius: 50%;
                  "></div>
                </div>
              `,iconSize:[16,16],iconAnchor:[8,8]}),zIndexOffset:200,eventHandlers:{click:()=>K({...I,tipo:"lector",lecturas:[]})}},`case-reader-${I.ID_Lector}`))]})),Oe=()=>{if(!Ce.showCoincidencias)return null;const I=Je;return I.length===0?null:I.map(($,Q)=>s.jsx(Cr,{position:[$.lat,$.lon],icon:an.divIcon({className:"custom-div-icon",html:`
            <div style="
              position: relative;
              width: 48px;
              height: 48px;
            ">
              <div style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 40px;
                height: 40px;
                border-radius: 50%;
                border: 3px solid red;
                background-color: rgba(255, 0, 0, 0.2);
                box-shadow: 0 0 12px rgba(255, 0, 0, 0.4);
                animation: pulse 2s infinite;
              "></div>
              <div style="
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 16px;
                height: 16px;
                border-radius: 50%;
                background-color: red;
              "></div>
              <div style="
                position: absolute;
                top: -8px;
                right: -8px;
                background-color: red;
                color: white;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 14px;
                box-shadow: 0 0 8px rgba(255, 0, 0, 0.6);
                animation: float 2s infinite;
              ">!</div>
            </div>
            <style>
              @keyframes pulse {
                0% { transform: translate(-50%, -50%) scale(1); }
                50% { transform: translate(-50%, -50%) scale(1.1); }
                100% { transform: translate(-50%, -50%) scale(1); }
              }
              @keyframes float {
                0% { transform: translate(0, 0); }
                50% { transform: translate(0, -5px); }
                100% { transform: translate(0, 0); }
              }
            </style>
          `,iconSize:[48,48],iconAnchor:[24,24]}),zIndexOffset:700},`coincidencia-${Q}`))};g.useCallback(()=>{D({showCoincidencias:!1}),te([]),pe({lecturas:[],lectores:[]}),h([]),T(null),O({nombre:"",color:"#228be6"}),Le(!1),xe(null),me({fechaInicio:"",horaInicio:"",fechaFin:"",horaFin:"",lectorId:""}),bt(I=>I+1)},[D]),g.useEffect(()=>{if(W){const I=document.getElementById(`lectura-${W.ID_Lectura}`);I&&I.scrollIntoView({behavior:"smooth",block:"center"})}},[W]);const Fe=({isFullscreen:I=!1})=>{const[$,Q]=g.useState(!1);return g.useEffect(()=>{Q(!0)},[]),s.jsxs("div",{style:{position:"relative",height:"100%",width:"100%"},children:[s.jsx("style",{children:`
            .leaflet-container {
              z-index: ${I?1e4:1} !important;
            }
            .leaflet-div-icon {
              background: transparent !important;
              border: none !important;
            }
            .custom-div-icon {
              background: transparent !important;
              border: none !important;
            }
            .lectura-popup {
              max-height: ${I?"400px":"200px"};
              overflow-y: auto;
            }
            canvas {
              will-read-frequently: true;
            }
          `}),s.jsx(AC,{info:G,onClose:()=>K(null),onNavigate:W?Lt:void 0,disableNav:(G==null?void 0:G.tipo)==="lector"}),s.jsxs("div",{style:{position:"absolute",top:I?24:12,right:I?32:16,zIndex:2e4,display:"flex",gap:8},children:[s.jsx(We,{variant:"default",size:I?48:32,style:{width:I?48:32,height:I?48:32,background:"white",border:"2px solid #234be7",color:"#234be7",boxShadow:"none",fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",padding:0},onClick:Bt,id:"camera-capture-btn-lpr","aria-label":"Exportar captura de pantalla",children:s.jsx(go,{size:I?28:16,color:"#234be7"})}),s.jsx(In,{label:I?"Salir de pantalla completa":"Pantalla completa",position:"left",withArrow:!0,children:s.jsx(We,{variant:"filled",color:"blue",size:I?56:32,style:{width:I?56:32,height:I?56:32,background:I?"#234be7":"white",border:I?"3px solid #234be7":"2px solid #234be7",color:I?"white":"#234be7",boxShadow:I?"0 0 16px #234be7":"none",fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",padding:0,zIndex:20001},onClick:()=>rt(!I),"aria-label":I?"Salir de pantalla completa":"Pantalla completa",children:I?s.jsx(qf,{size:I?32:16,color:I?"white":"#234be7"}):s.jsx(Yf,{size:16,color:"#234be7"})})})]}),s.jsxs(If,{...$?{}:{center:Vt,zoom:E},scrollWheelZoom:!0,style:{...EC,height:I?"100vh":"100%"},ref:de,children:[s.jsx(Ef,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:fe(),maxZoom:19,errorTileUrl:"https://tiles.stadiamaps.com/tiles/stamen_toner_lite/0/0/0.png",tileSize:256,zoomOffset:0,updateWhenIdle:!0,updateWhenZooming:!1,keepBuffer:2}),Ae(),ge.lecturas.length>0&&!Ee&&!F.some(ue=>ue.activa&&ue.filtros.lectorId===b)&&dt(),F.map(St),Oe(),De&&De.length>0&&De.map((ue,It)=>ue.Coordenada_Y&&ue.Coordenada_X&&s.jsx(Cr,{position:[ue.Coordenada_Y,ue.Coordenada_X],icon:an.divIcon({className:"custom-div-icon",html:'<div style="width:28px;height:28px;background:#ffd700;border-radius:50%;border:3px solid #228be6;box-shadow:0 0 12px #ffd700;"></div>'}),zIndexOffset:999},`highlighted-${It}`))]})]})},Qe=()=>{const[I,$]=g.useState("Fecha_y_Hora"),[Q,ue]=g.useState("asc"),It=g.useMemo(()=>[...ge.lecturas].filter(st=>st.Tipo_Fuente!=="GPS").sort((st,tn)=>{const Cn=st[I],U=tn[I];if(I==="Fecha_y_Hora"){const ot=new Date(Cn).getTime(),Jt=new Date(U).getTime();return Q==="asc"?ot-Jt:Jt-ot}const $e=String(Cn).localeCompare(String(U));return Q==="asc"?$e:-$e}),[ge.lecturas,I,Q]),Nt=st=>{I===st?ue(tn=>tn==="asc"?"desc":"asc"):($(st),ue("asc"))};return It.length===0?s.jsx(zt,{p:"md",withBorder:!0,style:{height:"calc(100vh - 300px)"},children:s.jsx(Y,{c:"dimmed",ta:"center",children:"No hay lecturas LPR filtradas para mostrar"})}):s.jsxs(zt,{p:"sm",withBorder:!0,style:{height:"calc(100vh - 300px)",display:"flex",flexDirection:"column"},children:[s.jsxs(Wt,{order:4,mb:"sm",size:"h5",children:["Lecturas LPR Filtradas (",It.length,")"]}),s.jsx(Gs,{style:{flex:1},children:s.jsxs(se,{striped:!0,highlightOnHover:!0,withTableBorder:!0,withColumnBorders:!0,style:{fontSize:"13px","--table-striped-color":"#f8f9fa","--table-hover-color":"#e3f2fd"},children:[s.jsx(se.Thead,{style:{position:"sticky",top:0,backgroundColor:"#f1f3f4",zIndex:10},children:s.jsxs(se.Tr,{children:[s.jsxs(se.Th,{style:{cursor:"pointer",padding:"8px 12px",fontSize:"12px",fontWeight:600,borderBottom:"2px solid #dee2e6"},onClick:()=>Nt("Fecha_y_Hora"),children:["Fecha/Hora",I==="Fecha_y_Hora"&&s.jsx("span",{style:{marginLeft:4},children:Q==="asc"?"↑":"↓"})]}),s.jsxs(se.Th,{style:{cursor:"pointer",padding:"8px 12px",fontSize:"12px",fontWeight:600,borderBottom:"2px solid #dee2e6"},onClick:()=>Nt("Matricula"),children:["Matrícula",I==="Matricula"&&s.jsx("span",{style:{marginLeft:4},children:Q==="asc"?"↑":"↓"})]}),s.jsxs(se.Th,{style:{cursor:"pointer",padding:"8px 12px",fontSize:"12px",fontWeight:600,borderBottom:"2px solid #dee2e6"},onClick:()=>Nt("ID_Lector"),children:["Lector",I==="ID_Lector"&&s.jsx("span",{style:{marginLeft:4},children:Q==="asc"?"↑":"↓"})]})]})}),s.jsx(se.Tbody,{children:It.map((st,tn)=>s.jsxs(se.Tr,{id:`lectura-${st.ID_Lectura}`,style:{cursor:"pointer",height:"32px",backgroundColor:(W==null?void 0:W.ID_Lectura)===st.ID_Lectura?"#e3f2fd":tn%2===0?"#ffffff":"#f8f9fa",fontWeight:(W==null?void 0:W.ID_Lectura)===st.ID_Lectura?600:400,borderLeft:(W==null?void 0:W.ID_Lectura)===st.ID_Lectura?"3px solid #1976d2":void 0,transition:"background-color 0.15s ease"},onClick:()=>Ke(st),onMouseDown:Cn=>{Cn.button===0&&Ke(st)},children:[s.jsx(se.Td,{style:{padding:"6px 12px",fontSize:"13px"},children:Tt(st.Fecha_y_Hora).format("DD/MM/YY HH:mm:ss")}),s.jsx(se.Td,{style:{padding:"6px 12px",fontSize:"13px",fontWeight:500},children:st.Matricula}),s.jsx(se.Td,{style:{padding:"6px 12px",fontSize:"13px"},children:st.ID_Lector||"-"})]},st.ID_Lectura))})]})})]})},Bt=async()=>{const I=document.querySelector(".leaflet-container");if(I)try{const $=await fo(I,{useCORS:!0,allowTaint:!0,backgroundColor:null,scale:2}),Q=document.createElement("a");Q.download="captura-mapa-lpr.png",Q.href=$.toDataURL("image/png"),Q.click()}catch($){console.error("Error al exportar el mapa:",$)}},Lt=g.useCallback(I=>{const $=ge.lecturas.filter(Nt=>Nt.Tipo_Fuente!=="GPS");if(!W||$.length===0)return;const Q=$.findIndex(Nt=>Nt.ID_Lectura===W.ID_Lectura);if(Q===-1)return;let ue=I==="prev"?Q-1:Q+1;ue<0&&(ue=$.length-1),ue>=$.length&&(ue=0);const It=$[ue];Ke(It)},[ge.lecturas,W,Ke]);return Dt?s.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"white",zIndex:9999},children:s.jsx(zt,{p:"md",withBorder:!0,style:{height:"100%"},children:s.jsx(Fe,{isFullscreen:!0})})}):s.jsxs(Ie,{style:{height:"100%",display:"flex",flexDirection:"column",marginBottom:"20px"},children:[s.jsx(X,{justify:"flex-end",mb:"xs",children:s.jsx(Me,{variant:"outline",size:"xs",color:"blue",onClick:()=>{var I;return(I=de.current)==null?void 0:I.invalidateSize()},leftSection:s.jsx(Eo,{size:16}),style:{backgroundColor:"white",color:"var(--mantine-color-blue-6)",border:"1px solid var(--mantine-color-blue-3)",fontWeight:500,borderRadius:8,paddingLeft:14,paddingRight:14,height:32,boxShadow:"none",fontSize:15,display:"flex",alignItems:"center",gap:6,minWidth:0},children:"Actualizar"})}),s.jsxs(Ta,{style:{flex:1,margin:0,height:"calc(100vh - 303px)",gap:"1rem"},children:[s.jsx(Ta.Col,{span:3,style:{padding:"16px",borderRight:"1px solid #eee"},children:s.jsxs(ct,{gap:"md",children:[s.jsxs(zt,{p:"md",withBorder:!0,children:[s.jsx(Wt,{order:3,mb:"md",style:{fontSize:22,fontWeight:700},children:"Mapa LPR"}),s.jsxs(ct,{gap:"md",children:[s.jsxs(Ie,{children:[s.jsx($a,{label:"Vehículo",placeholder:"Selecciona un vehículo",value:b,onChange:I=>{T(I)},data:H,searchable:!0,clearable:!0,error:_,disabled:m}),m&&s.jsx(Y,{size:"xs",c:"dimmed",mt:4,children:"Cargando vehículos..."})]}),s.jsx(IC,{filters:ae,onFilterChange:Ne,onFiltrar:Ve,onLimpiar:at,loading:o,lectorSuggestions:z})]})]}),s.jsxs(zt,{p:"md",withBorder:!0,children:[s.jsxs(X,{justify:"space-between",mb:"md",children:[s.jsx(Wt,{order:4,children:"Capas"}),s.jsx(Me,{variant:"light",size:"xs",leftSection:s.jsx(Af,{size:16}),onClick:je,disabled:!b||ge.lecturas.length===0,children:"Nueva Capa"})]}),s.jsx(ct,{gap:"xs",children:F.map(I=>s.jsx(zt,{p:"xs",withBorder:!0,children:s.jsxs(X,{justify:"space-between",children:[s.jsxs(X,{gap:"xs",children:[s.jsx(br,{checked:I.activa,onChange:()=>Mt(I.id),size:"xs"}),s.jsx(Y,{size:"sm",style:{flex:1},children:I.nombre})]}),s.jsxs(X,{gap:4,children:[s.jsx(We,{variant:"subtle",color:"blue",size:"sm",onClick:()=>oe(I.id),children:s.jsx(Tc,{size:16})}),s.jsx(We,{variant:"subtle",color:"red",size:"sm",onClick:()=>vt(I.id),children:s.jsx(Oa,{size:16})})]})]})},I.id))})]}),s.jsxs(zt,{p:"md",withBorder:!0,children:[s.jsx(Wt,{order:4,mb:"md",children:"Controles"}),s.jsxs(ct,{gap:"xs",children:[s.jsx($a,{label:"Visualización",value:Ce.visualizationType,onChange:I=>D({visualizationType:I}),data:[{value:"standard",label:"Estándar"},{value:"satellite",label:"Satélite"},{value:"cartodb-light",label:"CartoDB Light"}]}),s.jsx(br,{label:"Mostrar lectores del caso",checked:Ce.showCaseReaders,onChange:I=>D({showCaseReaders:I.currentTarget.checked})}),s.jsx(br,{label:"Mostrar todos los lectores",checked:Ce.showAllReaders,onChange:I=>D({showAllReaders:I.currentTarget.checked})}),s.jsx(br,{label:"Mostrar coincidencias",checked:Ce.showCoincidencias,onChange:I=>D({showCoincidencias:I.currentTarget.checked})})]})]})]})}),s.jsx(Ta.Col,{span:6,style:{padding:0},children:s.jsx(zt,{withBorder:!0,style:{height:"100%"},children:s.jsx(Fe,{})})}),s.jsx(Ta.Col,{span:3,style:{padding:"16px",borderLeft:"1px solid #eee"},children:s.jsx(Qe,{})})]}),s.jsx(Zr,{opened:!!ce,onClose:()=>xe(null),title:"Editar Capa",size:"md",children:ce&&s.jsxs(ct,{gap:"md",children:[s.jsx(Xe,{label:"Nombre",value:ce.nombre,onChange:I=>xe({...ce,nombre:I.currentTarget.value})}),s.jsx(Pc,{label:"Color",value:ce.color,onChange:I=>xe({...ce,color:I})}),s.jsxs(X,{justify:"flex-end",children:[s.jsx(Me,{variant:"light",onClick:()=>xe(null),children:"Cancelar"}),s.jsx(Me,{onClick:Re,children:"Guardar"})]})]})})]})};function TC({opened:t,onClose:r,onSave:a,loading:l=!1}){const h=vy({initialValues:{name:""},validate:{name:c=>c.trim()?null:"El nombre es requerido"}}),o=c=>{a(c.name.trim()),h.reset()};return s.jsx(Zr,{opened:t,onClose:r,title:"Guardar Búsqueda",centered:!0,children:s.jsx("form",{onSubmit:h.onSubmit(o),children:s.jsxs(ct,{children:[s.jsx(Xe,{label:"Nombre de la búsqueda",placeholder:"Introduce un nombre descriptivo",...h.getInputProps("name"),autoFocus:!0}),s.jsxs(X,{justify:"flex-end",mt:"md",children:[s.jsx(Me,{variant:"light",onClick:r,children:"Cancelar"}),s.jsx(Me,{type:"submit",loading:l,children:"Guardar"})]})]})})})}const zC=({opened:t,onClose:r,savedSearches:a,selectedSearches:l,setSelectedSearches:h,handleCrossSearch:o,handleDeleteSavedSearch:c,onClearResults:d,onLoadSearch:f})=>{const[m,y]=g.useState("created_at"),[_,S]=g.useState("desc"),[b,T]=g.useState([]),z=[...a].sort((O,ce)=>{let xe=0;return m==="name"?xe=O.name.localeCompare(ce.name):m==="created_at"?xe=(O.created_at||"").localeCompare(ce.created_at||""):m==="results"&&(xe=O.results.length-ce.results.length),_==="asc"?xe:-xe}),J=()=>{if(l.length<2)return;d&&d();const O=a.filter(Le=>l.includes(Le.id)),ce=O.map(Le=>Le.name),Ee=O.map(Le=>new Set(Le.results.map(ge=>ge.Matricula))).reduce((Le,ge)=>new Set([...Le].filter(pe=>ge.has(pe))));T(Le=>[{ids:l,names:ce,date:Tt().format("DD/MM/YYYY HH:mm"),count:Ee.size},...Le]),o(),r()},F=O=>{h(O.ids),o(),r()},te=O=>{if(!O.results||O.results.length===0)return;const ce=O.results.map(ge=>{var pe,ae,me;return{Matrícula:ge.Matricula,"Fecha y Hora":ge.Fecha_y_Hora,Lector:((pe=ge.lector)==null?void 0:pe.Nombre)||"",Carretera:((ae=ge.lector)==null?void 0:ae.Carretera)||"",Sentido:((me=ge.lector)==null?void 0:me.Sentido)||"","ID Lectura":ge.ID_Lectura,"ID Archivo":ge.ID_Archivo,"Tipo Fuente":ge.Tipo_Fuente,Pasos:ge.pasos,Relevante:ge.es_relevante?"Sí":"No"}}),xe=nr.json_to_sheet(ce),Ee=nr.book_new();nr.book_append_sheet(Ee,xe,"Lecturas");const Le=`${O.name.replace(/[^a-zA-Z0-9_\-]/g,"_")}_${Tt().format("YYYYMMDD_HHmmss")}.xlsx`;uc(Ee,Le)},re=O=>{const ce=a.filter(me=>O.ids.includes(me.id)),Ee=ce.map(me=>new Set(me.results.map(Ce=>Ce.Matricula))).reduce((me,Ce)=>new Set([...me].filter(Pe=>Ce.has(Pe))));let Le=[];ce.forEach(me=>{me.results.forEach(Ce=>{var Pe,xt,Ye;Ee.has(Ce.Matricula)&&Le.push({Búsqueda:me.name,Matrícula:Ce.Matricula,"Fecha y Hora":Ce.Fecha_y_Hora,Lector:((Pe=Ce.lector)==null?void 0:Pe.Nombre)||"",Carretera:((xt=Ce.lector)==null?void 0:xt.Carretera)||"",Sentido:((Ye=Ce.lector)==null?void 0:Ye.Sentido)||"","ID Lectura":Ce.ID_Lectura,"ID Archivo":Ce.ID_Archivo,"Tipo Fuente":Ce.Tipo_Fuente,Pasos:Ce.pasos,Relevante:Ce.es_relevante?"Sí":"No"})})});const ge=nr.json_to_sheet(Le),pe=nr.book_new();nr.book_append_sheet(pe,ge,"Cruce");const ae=`Cruce_${O.names.map(me=>me.replace(/[^a-zA-Z0-9_\-]/g,"_")).join("_")}_${Tt().format("YYYYMMDD_HHmmss")}.xlsx`;uc(pe,ae)};return s.jsx(Zr,{opened:t,onClose:r,title:s.jsx(Wt,{order:4,children:"Búsquedas Guardadas"}),size:"75vw",centered:!0,styles:{content:{minWidth:"900px",width:"75vw",maxWidth:"1200px"}},children:s.jsxs(ct,{children:[s.jsxs(Ie,{children:[s.jsx(X,{justify:"space-between",mb:"sm",children:s.jsx(Y,{size:"sm",children:"Selecciona búsquedas para cruzar o gestionar"})}),s.jsx(Gs,{h:300,children:s.jsxs(se,{striped:!0,highlightOnHover:!0,withTableBorder:!0,children:[s.jsx(se.Thead,{children:s.jsxs(se.Tr,{children:[s.jsxs(se.Th,{style:{cursor:"pointer",width:"40%"},onClick:()=>{y("name"),S(m==="name"&&_==="asc"?"desc":"asc")},children:["Nombre ",s.jsx(za,{size:14,style:{verticalAlign:"middle"}})]}),s.jsxs(se.Th,{style:{cursor:"pointer",width:"20%"},onClick:()=>{y("created_at"),S(m==="created_at"&&_==="asc"?"desc":"asc")},children:["Fecha ",s.jsx(za,{size:14,style:{verticalAlign:"middle"}})]}),s.jsxs(se.Th,{style:{cursor:"pointer",width:"15%"},onClick:()=>{y("results"),S(m==="results"&&_==="asc"?"desc":"asc")},children:["Nº lecturas ",s.jsx(za,{size:14,style:{verticalAlign:"middle"}})]}),s.jsx(se.Th,{style:{width:"10%"},children:"Seleccionar"}),s.jsx(se.Th,{style:{width:"15%"},children:"Acciones"})]})}),s.jsxs(se.Tbody,{children:[z.map(O=>s.jsxs(se.Tr,{children:[s.jsx(se.Td,{children:O.name}),s.jsx(se.Td,{children:O.created_at?Tt(O.created_at).format("DD/MM/YYYY HH:mm"):""}),s.jsx(se.Td,{children:O.results.length}),s.jsx(se.Td,{children:s.jsx("input",{type:"checkbox",checked:l.includes(O.id),onChange:ce=>{ce.target.checked?h([...l,O.id]):h(l.filter(xe=>xe!==O.id))}})}),s.jsx(se.Td,{children:s.jsxs(X,{gap:"xs",justify:"flex-end",children:[s.jsx(We,{color:"blue",variant:"subtle",onClick:()=>f(O),title:"Recuperar búsqueda",children:s.jsx(ur,{size:18})}),s.jsx(We,{color:"red",variant:"subtle",onClick:()=>c(O.id),title:"Eliminar búsqueda",children:s.jsx(Oa,{size:18})}),s.jsx(We,{color:"green",variant:"subtle",onClick:()=>te(O),disabled:!O.results||O.results.length===0,title:"Exportar a Excel",children:s.jsx(po,{size:18})})]})})]},O.id)),z.length===0&&s.jsx(se.Tr,{children:s.jsx(se.Td,{colSpan:5,children:s.jsx(Y,{color:"dimmed",size:"sm",ta:"center",children:"No hay búsquedas guardadas"})})})]})]})}),s.jsxs(Me,{mt:"md",size:"sm",variant:"filled",color:"blue",fullWidth:!0,leftSection:s.jsx(ur,{size:16}),onClick:J,disabled:l.length<2,children:["Realizar Cruce (",l.length," seleccionadas)"]})]}),s.jsxs(Ie,{mt:"md",children:[s.jsx(Wt,{order:5,mb:"xs",children:"Cruces realizados en esta sesión"}),s.jsx(Gs,{h:150,children:s.jsxs(se,{striped:!0,highlightOnHover:!0,withTableBorder:!0,children:[s.jsx(se.Thead,{children:s.jsxs(se.Tr,{children:[s.jsx(se.Th,{children:"Búsquedas cruzadas"}),s.jsx(se.Th,{children:"Fecha"}),s.jsx(se.Th,{children:"Nº vehículos encontrados"}),s.jsx(se.Th,{children:"Acciones"})]})}),s.jsx(se.Tbody,{children:b.length>0?b.map((O,ce)=>s.jsxs(se.Tr,{children:[s.jsx(se.Td,{children:O.names.join(" + ")}),s.jsx(se.Td,{children:O.date}),s.jsx(se.Td,{children:O.count}),s.jsxs(se.Td,{children:[s.jsx(We,{color:"blue",variant:"subtle",onClick:()=>F(O),title:"Ver cruce en resultados",children:s.jsx(ur,{size:18})}),s.jsx(We,{color:"teal",variant:"subtle",onClick:()=>re(O),title:"Exportar cruce a Excel",children:s.jsx(po,{size:18})})]})]},ce)):s.jsx(se.Tr,{children:s.jsx(se.Td,{colSpan:3,children:s.jsx(Y,{color:"dimmed",size:"sm",ta:"center",children:"No se han realizado cruces en esta sesión"})})})})]})})]})]})})},FC=`
  .highlighted-row {
    background-color: var(--mantine-color-blue-0) !important; /* Azul muy claro */
  }
  .highlighted-row:hover {
    background-color: var(--mantine-color-blue-1) !important; /* Un azul ligeramente más oscuro */
  }
  .session-selected-row {
    background-color: var(--mantine-color-yellow-0) !important;
  }
  .session-selected-row:hover {
    background-color: var(--mantine-color-yellow-1) !important;
  }
  /* Forzar label encima del input para DatePicker en este panel */
  .analisis-datepicker-wrapper .mantine-InputWrapper-label {
      display: block;
      margin-bottom: var(--mantine-spacing-xs); /* Ajustar espacio si es necesario */
  }
`,cs="http://localhost:8000",DC=g.forwardRef((t,r)=>{const{casoIdFijo:a=null,permitirSeleccionCaso:l=!0,mostrarTitulo:h=!0,tipoFuenteFijo:o=null,interactedMatriculas:c,addInteractedMatricula:d}=t,f={width:cc(16),height:cc(16)};K1();const[m,y]=g.useState([]),[_]=cr(m,500),[S,b]=g.useState(""),[T]=cr(S,500),[z,J]=g.useState(""),[F]=cr(z,500),[te,re]=g.useState(""),[O]=cr(te,500),[ce,xe]=g.useState(""),[Ee]=cr(ce,500),[Le,ge]=g.useState([]),[pe]=cr(Le,500),[ae,me]=g.useState([]),[Ce]=cr(ae,500),[Pe,xt]=g.useState([]),[Ye]=cr(Pe,500),[jt,bt]=g.useState(""),[Dt]=cr(jt,500),[rt,q]=g.useState(""),[ke]=cr(rt,500),[G,K]=g.useState(""),[W]=cr(G,500),[he,de]=g.useState([]),[De,Ne]=g.useState([]),[Ve,at]=g.useState([]),[Ke,Vt]=g.useState(""),[E,H]=g.useState([]),[je,oe]=g.useState([]),[Re,Mt]=g.useState([]),[vt,Je]=g.useState([{value:"Creciente",label:"Creciente"},{value:"Decreciente",label:"Decreciente"}]),[dt,St]=g.useState(!1),[D,fe]=g.useState(!0),[Ae,Oe]=g.useState([]),[Fe,Qe]=g.useState([]),[Bt,Lt]=g.useState(1),[I,$]=g.useState(1),Q=50,[ue,It]=g.useState({columnAccessor:"Fecha_y_Hora",direction:"desc"}),[Nt,st]=g.useState([]),[tn,Cn]=g.useState([]),[U,$e]=g.useState([]),[ot,Jt]=g.useState(null),[jr,Lr]=g.useState("desc"),[En,qs]=g.useState(!1),[kr,Na]=g.useState(new Set),[Mr,Kr]=g.useState([]),[dr,Ha]=g.useState([]),[Ga,pa]=g.useState(!1),[Xs,Ua]=g.useState(""),[Ks,Jr]=g.useState(0),[Qr,Ir]=g.useState(!1),[ga,Va]=g.useState(!1),[Er,Za]=g.useState(new Set),[ms,Wa]=g.useState([]),[nn,xs]=g.useState({}),ar=g.useCallback(async()=>{try{const A=await wt.get("/vehiculos/statuses");xs(A.data),console.log("Vehicle statuses updated/fetched.")}catch(A){console.error("Error fetching vehicle statuses:",A),ie.show({title:"Error",message:"No se pudieron cargar los estados de los vehículos.",color:"red"})}},[]);g.useEffect(()=>{ar();const A=()=>ar();return Wr.on("listaVehiculosCambiada",A),()=>{Wr.off("listaVehiculosCambiada",A)}},[ar]);const Ar=A=>A?A.replace(/\s+C\d+$/,""):"",ma=A=>{const R=new Map;let ne=0;return A.forEach(Be=>{const yt=(typeof Be.ID_Lectura=="number",Be.ID_Lectura);R.has(yt)?(ne++,console.log(`[AnalisisLecturasPanel] Duplicado encontrado y eliminado: ID_Lectura=${yt}, Matricula=${Be.Matricula}, Fecha=${Be.Fecha_y_Hora}`)):R.set(yt,Be)}),ne>0&&(console.log(`[AnalisisLecturasPanel] Total de duplicados eliminados: ${ne}`),console.log(`[AnalisisLecturasPanel] Lecturas originales: ${A.length}, Lecturas únicas: ${R.size}`)),Array.from(R.values())},k=A=>{var yt,_e;if(A.length<=1)return A;const R=[...A].sort((le,be)=>le.Fecha_y_Hora.localeCompare(be.Fecha_y_Hora)),ne=[];let Be=0;for(let le=0;le<R.length;le++){const be=R[le];let Ze=!1;const Kt=ne.slice(-5);for(const Pn of Kt)if(be.Matricula===Pn.Matricula){const pn=Ar(((yt=be.lector)==null?void 0:yt.Nombre)||""),pr=Ar(((_e=Pn.lector)==null?void 0:_e.Nombre)||"");if(pn===pr&&pn!==""){const Tn=Math.abs(Tt(be.Fecha_y_Hora).diff(Tt(Pn.Fecha_y_Hora),"second"));if(Tn<=5){Ze=!0,Be++,console.log(`[AnalisisLecturasPanel] Duplicado similar eliminado: Matricula=${be.Matricula}, Lector=${pn}, Diferencia=${Tn}s`);break}}}Ze||ne.push(be)}return Be>0&&console.log(`[AnalisisLecturasPanel] Total de duplicados similares eliminados: ${Be}`),ne},N=A=>{const ne=[...ma(A)].sort((_e,le)=>_e.Fecha_y_Hora.localeCompare(le.Fecha_y_Hora)),Be={};return ne.forEach(_e=>{var Pn;const le=((Pn=_e.lector)==null?void 0:Pn.Nombre)||"Desconocido";if(!_e.Fecha_y_Hora||!_e.Matricula)return;const be=Ar(le),Ze=Tt(_e.Fecha_y_Hora);let Kt=!1;for(const[pn,pr]of Object.entries(Be)){const[Tn,zn,qa]=pn.split("_");if(zn===_e.Matricula&&qa===be&&Math.abs(Ze.diff(Tt(Tn),"second"))<=2){Be[pn].push(_e),Kt=!0;break}}if(!Kt){const pn=`${_e.Fecha_y_Hora}_${_e.Matricula}_${be}`;Be[pn]=[_e]}}),Object.values(Be).map(_e=>{var pn,pr;if(_e.length===1)return _e[0];_e.sort((Tn,zn)=>Tn.Fecha_y_Hora.localeCompare(zn.Fecha_y_Hora));const le=_e[0],be=_e.map(Tn=>{var zn,qa,Cs;return((Cs=(qa=(zn=Tn.lector)==null?void 0:zn.Nombre)==null?void 0:qa.match(/C\d+$/))==null?void 0:Cs[0])||""}).filter(Boolean).sort(),Ze=Tt(_e[0].Fecha_y_Hora),Pn=Tt(_e[_e.length-1].Fecha_y_Hora).diff(Ze,"second");return{...le,carriles_detectados:be,_lecturas_originales:_e,ID_Lectura:`${le.ID_Lectura}_consolidated`,lector:{...le.lector,Nombre:be.length>1?`${Ar(((pn=le.lector)==null?void 0:pn.Nombre)||"")} (${be.join(", ")})${Pn>0?` [Δt=${Pn}s]`:""}`:(pr=le.lector)==null?void 0:pr.Nombre}}}).sort((_e,le)=>le.Fecha_y_Hora.localeCompare(_e.Fecha_y_Hora))},we=g.useMemo(()=>{if(!Ae.length)return[];const A=(_e,le)=>le?le.split(".").reduce((be,Ze)=>be&&be[Ze],_e):_e,R=(_e,le)=>{const be=ue.columnAccessor;let Ze=A(_e,be),Kt=A(le,be);if(Ze==null)return 1;if(Kt==null)return-1;if(be==="Fecha_y_Hora"){const Tn=new Date(Ze).getTime(),zn=new Date(Kt).getTime();return ue.direction==="asc"?Tn-zn:zn-Tn}if(typeof Ze=="number"&&typeof Kt=="number")return ue.direction==="asc"?Ze-Kt:Kt-Ze;const Pn=String(Ze).toLowerCase(),pn=String(Kt).toLowerCase(),pr=Pn.localeCompare(pn);return ue.direction==="asc"?pr:-pr};if(!En){const _e=ma(Ae);return[...k(_e)].sort(R)}const ne=N(Ae),Be=ka.groupBy(ne,"Matricula");let yt=Object.entries(Be).map(([_e,le])=>{const be=[...le].sort((Ze,Kt)=>new Date(Kt.Fecha_y_Hora).getTime()-new Date(Ze.Fecha_y_Hora).getTime());return{Matricula:_e,pasos:le.length,_isGroup:!0,_lecturas:be,_expanded:kr.has(`group_${_e}`),ID_Lectura:`group_${_e}`,Fecha_y_Hora:le[0].Fecha_y_Hora,lector:le[0].lector,ID_Archivo:le[0].ID_Archivo,Tipo_Fuente:le[0].Tipo_Fuente}});return yt.sort(R),yt.flatMap(_e=>{const le=_e._expanded&&_e._lecturas?_e._lecturas.map(be=>({...be,_isSubRow:!0,_groupId:_e.ID_Lectura})):[];return[_e,...le]})},[Ae,En,kr,ue]),ht=g.useMemo(()=>{if(!we.length)return[];const A=(Bt-1)*Q,R=A+Q;return we.slice(A,R)},[we,Bt]);g.useEffect(()=>{(async()=>{fe(!0);try{if(a){const R=await fetch(`${cs}/casos/${a}/lectores`);if(!R.ok)throw new Error(`Error HTTP: ${R.status}`);const ne=await R.json();if(!ne||!Array.isArray(ne))throw new Error("Formato de respuesta inválido");Wa(ne);const Be=ne.filter(le=>le&&le.ID_Lector).map(le=>({value:String(le.ID_Lector),label:`${le.Nombre||le.ID_Lector} (${le.ID_Lector})`}));H(Be);const yt=Array.from(new Set(ne.map(le=>le.Organismo_Regulador).filter(Boolean)));Cn(yt.map(le=>({value:le,label:le})));const _e=Array.from(new Set(ne.map(le=>le.Provincia).filter(Boolean)));$e(_e.map(le=>({value:le,label:le})))}}catch(R){console.error(R)}finally{fe(!1)}})()},[a]),g.useEffect(()=>{(async()=>{try{const R=await cy();Cn(R.organismos.filter(ne=>ne&&ne.trim()!=="").map(ne=>({value:String(ne),label:String(ne)}))),$e(R.provincias.filter(ne=>ne&&ne.trim()!=="").map(ne=>({value:String(ne),label:String(ne)}))),Mt(R.carreteras.filter(ne=>ne&&ne.trim()!=="").map(ne=>({value:String(ne),label:String(ne)})))}catch(R){console.error("Error fetching sugerencias:",R),ie.show({title:"Error",message:"No se pudieron cargar las sugerencias de filtros",color:"red"})}})()},[]);const _t=g.useCallback(A=>{A.key===" "&&Ke.trim()&&(A.preventDefault(),at(R=>[...R,Ke.trim()]),Vt(""))},[Ke]),dn=g.useCallback(A=>{Vt(A.target.value)},[]),Wn=g.useCallback(A=>{at(R=>R.filter(ne=>ne!==A))},[]),hr=g.useCallback(()=>{y([]),me([]),xt([]),de([]),Ne([]),Vt(""),at([]),q(""),K(""),Qe([]),ie.show({title:"Filtros Limpiados",message:"Se han restablecido todos los filtros a sus valores por defecto.",color:"blue"})},[]),An=g.useCallback(()=>{if(T&&F&&T>F)return ie.show({title:"Error en Fechas",message:"La fecha de inicio no puede ser posterior a la fecha de fin",color:"red"}),!1;if(T&&F&&T===F&&O&&Ee&&O>Ee)return ie.show({title:"Error en Horas",message:"La hora de inicio no puede ser posterior a la hora de fin en el mismo día",color:"red"}),!1;const A=typeof ke=="number"?ke:void 0,R=typeof W=="number"?W:void 0;return A!==void 0&&R!==void 0&&A>R?(ie.show({title:"Error en Pasos",message:"El mínimo de pasos no puede ser mayor que el máximo",color:"red"}),!1):!0},[T,F,O,Ee,ke,W]),fr=g.useCallback(async()=>{const A="analisis-loading";ie.show({id:A,title:"Procesando búsqueda de lecturas...",message:"Por favor, espera mientras se procesan los resultados.",color:"blue",autoClose:!1,withCloseButton:!1,position:"bottom-right",style:{minWidth:350}}),Ua("Procesando búsqueda de lecturas..."),Jr(0),St(!0);try{if(!An())return;Oe([]),Qe([]);const R=new URLSearchParams;T&&R.append("fecha_inicio",T),F&&R.append("fecha_fin",F),O&&R.append("hora_inicio",O),Ee&&R.append("hora_fin",Ee),pe.forEach(Ze=>R.append("lector_ids",Ze)),Ce.forEach(Ze=>R.append("carretera_ids",Ze)),Ye.forEach(Ze=>R.append("sentido",Ze)),he.forEach(Ze=>R.append("organismos",Ze)),De.forEach(Ze=>R.append("provincias",Ze)),a?R.append("caso_ids",String(a)):l&&_.forEach(Ze=>R.append("caso_ids",Ze)),Ve.length>0?Ve.forEach(Ze=>R.append("matricula",Ze)):Ke.trim()&&R.append("matricula",Ke.trim()),o&&R.append("tipo_fuente",o);const ne=typeof ke=="number"?ke:void 0,Be=typeof W=="number"?W:void 0;ne!==void 0&&ne>0&&(R.append("min_pasos",String(ne)),console.log("[AnalisisLecturasPanel] Aplicando min_pasos:",ne)),Be!==void 0&&Be>0&&(R.append("max_pasos",String(Be)),console.log("[AnalisisLecturasPanel] Aplicando max_pasos:",Be)),R.append("limit","100000");const yt=R.toString(),_e=`${cs}/lecturas?${yt}`;console.log("[AnalisisLecturasPanel] URL de búsqueda:",_e);const le=await fetch(_e);if(!le.ok)throw new Error(`Error en la búsqueda: ${le.statusText||le.status}`);const be=await le.json();if(!Array.isArray(be))throw new Error("Formato de respuesta inesperado");console.log(`[AnalisisLecturasPanel] Resultados: ${be.length} lecturas`),Oe(be),ie.update({id:A,title:"Búsqueda completada",message:`Se encontraron ${be.length} lecturas.`,color:"green",autoClose:2e3,loading:!1})}catch(R){console.error("Error en la búsqueda:",R),ie.update({id:A,title:"Error en la búsqueda",message:R instanceof Error?R.message:"Error desconocido",color:"red",autoClose:4e3,loading:!1})}finally{St(!1),Ua(""),Jr(0)}},[a,l,_,Ce,Ye,pe,T,F,O,Ee,o,Ke,Ve,ke,W,he,De,An]),Js=g.useCallback(A=>{const R=A.map(Be=>Be.ID_Lectura);Qe(R),Za(Be=>{const yt=new Set(Be);return R.forEach(_e=>yt.add(_e)),yt});const ne=A.map(Be=>Be.Matricula);ne.length>0&&d(ne)},[d]),Ya=g.useCallback(async()=>{St(!0);try{console.log("Exportando: Obteniendo todos los lectores...");const A=await fetch(`${cs}/lectores?limit=10000`);if(!A.ok)throw new Error(`Error al obtener lectores: ${A.statusText}`);const R=await A.json();let ne=[];if(R&&Array.isArray(R.lectores))ne=R.lectores;else if(R&&Array.isArray(R))ne=R;else throw new Error("Formato de respuesta inesperado al obtener lectores para exportar");if(console.log(`Exportando: ${ne.length} lectores obtenidos.`),ne.length===0){ie.show({title:"Nada que Exportar",message:"No hay lectores para incluir en el archivo.",color:"blue"});return}const Be=ne.map(be=>({"ID Lector":be.ID_Lector,Nombre:be.Nombre,Carretera:be.Carretera,Provincia:be.Provincia,Localidad:be.Localidad,Sentido:be.Sentido,Orientación:be.Orientacion,Organismo:be.Organismo_Regulador,Latitud:be.Coordenada_Y,Longitud:be.Coordenada_X,Contacto:be.Contacto,Notas:be.Texto_Libre})),yt=nr.json_to_sheet(Be),_e=nr.book_new();nr.book_append_sheet(_e,yt,"Lectores");const le=`Lista_Lectores_${Tt().format("YYYYMMDD_HHmmss")}.xlsx`;uc(_e,le),ie.show({title:"Exportación Completa",message:`Se ha descargado el archivo ${le}`,color:"green"})}catch(A){console.error("Error al exportar lectores:",A),ie.show({title:"Error en Exportación",message:A instanceof Error?A.message:"Error desconocido",color:"red"})}finally{St(!1)}},[]);g.useImperativeHandle(r,()=>({exportarListaLectores:Ya}),[Ya]);const Oo=async()=>{var A,R;if(Fe.length!==0){St(!0);try{const ne=Fe.map(le=>Ae.find(be=>be.ID_Lectura===le)).filter(le=>le&&typeof le.ID_Lectura=="number");if(ne.length===0){ie.show({title:"Error",message:"No hay lecturas válidas para marcar.",color:"red"}),Qe([]);return}const Be=ne.map(le=>le.ID_Lectura);let yt=0,_e=0;for(const le of Be)try{await wt.post(`/lecturas/${le}/marcar_relevante`,{caso_id:a}),yt++}catch(be){_e++,console.error(`Error marcando lectura ${le}:`,be),ie.show({title:"Error al Marcar",message:`No se pudo marcar ID ${le}: ${((R=(A=be.response)==null?void 0:A.data)==null?void 0:R.detail)||be.message}`,color:"red"})}yt>0&&(ie.show({title:"Éxito",message:`${yt} de ${Be.length} lecturas marcadas como relevantes.`,color:"green"}),Oe(le=>le.map(be=>Be.includes(be.ID_Lectura)?{...be,es_relevante:!0}:be))),_e>0&&ie.show({title:"Error Parcial",message:`${_e} lecturas no se pudieron marcar.`,color:"orange"})}catch(ne){console.error("Error en handleMarcarRelevante:",ne),ie.show({title:"Error",message:"No se pudieron marcar las lecturas como relevantes.",color:"red"})}finally{Qe([]),St(!1)}}},Qs=async()=>{var A,R;if(Fe.length!==0){St(!0);try{const ne=Array.from(new Set(Fe.map(be=>{const Ze=Ae.find(Kt=>Kt.ID_Lectura===be);return Ze==null?void 0:Ze.Matricula}).filter(be=>typeof be=="string"&&be.trim()!=="")));if(ne.length===0){ie.show({title:"Sin matrículas",message:"No hay matrículas válidas seleccionadas.",color:"orange"});return}let Be=0,yt=0,_e=0;for(const be of ne)try{const Ze=await wt.post("/vehiculos",{Matricula:be});Ze.status===201?Be++:(Ze.status===400||Ze.status===409)&&yt++}catch(Ze){((A=Ze.response)==null?void 0:A.status)===400||((R=Ze.response)==null?void 0:R.status)===409?yt++:(_e++,console.error(`Error guardando vehículo ${be}:`,Ze))}let le="";Be>0&&(le+=`${Be} vehículo(s) nuevo(s) guardado(s). `),yt>0&&(le+=`${yt} vehículo(s) ya existían. `),_e>0&&(le+=`${_e} matrícula(s) no se pudieron procesar.`),le&&ie.show({title:"Guardar Vehículos Completado",message:le.trim(),color:_e>0?Be>0?"orange":"red":"green"}),Wr.emit("listaVehiculosCambiada")}catch(ne){console.error("Error en handleGuardarVehiculos:",ne),ie.show({title:"Error",message:"No se pudieron guardar los vehículos.",color:"red"})}finally{Qe([]),St(!1)}}},xa=g.useCallback(A=>{Na(R=>{const ne=new Set(R);return ne.has(A)?ne.delete(A):ne.add(A),ne})},[]),ei=g.useMemo(()=>[...En?[{accessor:"expand",title:"",width:40,render:A=>A._isGroup?s.jsx(We,{variant:"subtle",onClick:()=>xa(A.ID_Lectura),children:kr.has(A.ID_Lectura)?s.jsx(Zy,{size:16}):s.jsx(Mc,{size:16})}):null}]:[],{accessor:"Fecha_y_Hora",title:"Fecha y Hora",sortable:!0,render:A=>{var R;return A._isSubRow?s.jsx(Y,{ml:20,children:Tt(A.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss")}):A._isGroup?`${((R=A._lecturas)==null?void 0:R.length)||0} lecturas`:Tt(A.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss")}},{accessor:"Matricula",title:"Matrícula",sortable:!0,render:A=>A._isSubRow?s.jsx(Y,{ml:20,children:A.Matricula}):A.Matricula},{accessor:"lector.Nombre",title:"Lector",sortable:!0,render:A=>{var ne;const R=((ne=A.lector)==null?void 0:ne.Nombre)||"-";return A.carriles_detectados&&A.carriles_detectados.length>1?s.jsx(In,{label:`Detectado en carriles: ${A.carriles_detectados.join(", ")}`,children:s.jsxs(Y,{children:[Ar(R),s.jsxs(Y,{component:"span",size:"xs",color:"dimmed",children:[" (",A.carriles_detectados.length," carriles)"]})]})}):A._isSubRow?s.jsx(Y,{ml:20,children:R}):R}},{accessor:"lector.Carretera",title:"Carretera",sortable:!0,render:A=>{var ne;const R=((ne=A.lector)==null?void 0:ne.Carretera)||"-";return A._isSubRow?s.jsx(Y,{ml:20,children:R}):R}},{accessor:"lector.Sentido",title:"Sentido",sortable:!0,render:A=>{var ne;const R=((ne=A.lector)==null?void 0:ne.Sentido)||"-";return A._isSubRow?s.jsx(Y,{ml:20,children:R}):R}},{accessor:"pasos",title:"Pasos",sortable:!0,textAlign:"right",width:80,render:A=>A._isSubRow?null:A.pasos},{accessor:"comprobado",title:"Comp.",width:60,textAlign:"center",render:A=>nn[A.Matricula]==="Comprobado"?s.jsx(In,{label:"Vehículo Comprobado",children:s.jsx(dh,{color:"green",variant:"light",size:"sm",children:s.jsx(Aa,{size:14})})}):null},{accessor:"sospechoso",title:"Sosp.",width:60,textAlign:"center",render:A=>nn[A.Matricula]==="Sospechoso"?s.jsx(In,{label:"Vehículo Sospechoso",children:s.jsx(dh,{color:"orange",variant:"light",size:"sm",children:s.jsx(uo,{size:14})})}):null}],[En,xa,kr,nn]),Bo=g.useCallback(A=>{It(A)},[]),ti=A=>{let R="";typeof A=="number"&&!isNaN(A)&&(R=A),q(R),console.log("[AnalisisLecturasPanel] Nuevo valor min_pasos:",R)},ni=A=>{let R="";typeof A=="number"&&!isNaN(A)&&(R=A),K(R),console.log("[AnalisisLecturasPanel] Nuevo valor max_pasos:",R)};g.useEffect(()=>{(async()=>{if(!a)return;const R="saved-searches-loading";ie.show({id:R,title:"Cargando búsquedas guardadas...",message:"Obteniendo búsquedas guardadas del caso.",color:"blue",autoClose:!1,withCloseButton:!1,loading:!0});try{const ne=await fetch(`${cs}/casos/${a}/saved_searches`);if(!ne.ok)throw new Error("Error al cargar búsquedas guardadas");const Be=await ne.json();Kr(Be),ie.update({id:R,title:"Búsquedas guardadas cargadas",message:`Se han cargado ${Be.length} búsquedas guardadas.`,color:"green",autoClose:2e3,loading:!1})}catch(ne){console.error("Error cargando búsquedas guardadas:",ne),ie.update({id:R,title:"Error",message:"No se pudieron cargar las búsquedas guardadas",color:"red",autoClose:4e3,loading:!1})}})()},[a]);const vs=g.useCallback(async A=>{if(!a){ie.show({title:"Error",message:"No se puede guardar la búsqueda sin un caso seleccionado",color:"red"});return}Va(!0);const R={name:A,caso_id:a,filters:{fechaInicio:T,fechaFin:F,timeFrom:O,timeTo:Ee,selectedLectores:pe,selectedCarreteras:Ce,selectedSentidos:Ye,matricula:Dt,minPasos:ke,maxPasos:W},results:[...Ae]};try{const ne=await fetch(`${cs}/casos/${a}/saved_searches`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)});if(!ne.ok)throw new Error("Error al guardar la búsqueda");const Be=await ne.json();Kr(yt=>[...yt,Be]),ie.show({title:"Búsqueda Guardada",message:`Se ha guardado la búsqueda "${A}"`,color:"green"}),Ir(!1)}catch(ne){console.error("Error guardando búsqueda:",ne),ie.show({title:"Error",message:"No se pudo guardar la búsqueda",color:"red"})}finally{Va(!1)}},[a,T,F,O,Ee,pe,Ce,Ye,Dt,ke,W,Ae]),No=async A=>{try{if(!(await fetch(`${cs}/saved_searches/${A}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar la búsqueda");Kr(ne=>ne.filter(Be=>Be.id!==A)),Ha(ne=>ne.filter(Be=>Be!==A)),ie.show({title:"Búsqueda Eliminada",message:"La búsqueda ha sido eliminada correctamente",color:"green"})}catch(R){console.error("Error eliminando búsqueda:",R),ie.show({title:"Error",message:"No se pudo eliminar la búsqueda",color:"red"})}},ri=g.useCallback(()=>{if(dr.length<2){ie.show({title:"Error",message:"Selecciona al menos 2 búsquedas para realizar el cruce",color:"red"});return}const A=dr.map(_e=>{var le;return((le=Mr.find(be=>be.id===_e))==null?void 0:le.results)||[]}),ne=A.map(_e=>new Set(_e.map(le=>le.Matricula))).reduce((_e,le)=>new Set([..._e].filter(be=>le.has(be)))),yt=A.flat().filter(_e=>ne.has(_e.Matricula));Oe(yt),ie.show({title:"Cruce Completado",message:`Se encontraron ${ne.size} vehículos en común`,color:"green"})},[dr,Mr]),_s=g.useCallback(A=>{Lt(A);const R=document.querySelector(".mantine-DataTable-tableContainer");R&&(R.scrollTop=0)},[]),ys=g.useCallback(A=>{A!==null&&Lt(1)},[]),Pr=g.useCallback(()=>{Oe([]),Qe([]),fe(!1),ie.show({title:"Tabla Limpiada",message:"Se han eliminado todos los resultados de la tabla.",color:"blue"})},[]),ai=g.useCallback(A=>{const R=A.filters||{},ne=R.fechaInicio?Tt(R.fechaInicio).format("YYYY-MM-DD"):"",Be=R.fechaFin?Tt(R.fechaFin).format("YYYY-MM-DD"):"";b(ne),J(Be),re(R.timeFrom||""),xe(R.timeTo||""),ge(R.selectedLectores||[]),me(R.selectedCarreteras||[]),xt(R.selectedSentidos||[]),at(R.matricula?R.matricula.split(" "):[]),q(R.minPasos||""),K(R.maxPasos||""),Oe(A.results||[]),pa(!1),ie.show({title:"Búsqueda Recuperada",message:`Se ha recuperado la búsqueda "${A.name}"`,color:"green"})},[]);return s.jsxs(Ie,{style:{position:"relative"},children:[s.jsx("style",{children:FC}),s.jsx(Ie,{children:s.jsxs(Ta,{children:[s.jsx(Ta.Col,{span:{base:12,md:3},style:{minWidth:300},children:s.jsx(zt,{shadow:"sm",p:"md",withBorder:!0,children:s.jsxs(ct,{gap:"sm",children:[s.jsx(Wt,{order:4,mb:"sm",children:"Definir Filtros"}),l&&s.jsx(da,{label:"Casos",placeholder:"Seleccionar casos...",data:je,value:m,onChange:y,searchable:!0,clearable:!0,disabled:D,leftSection:s.jsx(J1,{style:f})}),s.jsxs(X,{grow:!0,children:[s.jsx(Xe,{label:"Fecha Inicio",type:"date",value:S,onChange:A=>b(A.target.value)}),s.jsx(Xe,{label:"Hora Inicio",type:"time",value:te,onChange:A=>re(A.target.value)})]}),s.jsxs(X,{grow:!0,children:[s.jsx(Xe,{label:"Fecha Fin",type:"date",value:z,onChange:A=>J(A.target.value)}),s.jsx(Xe,{label:"Hora Fin",type:"time",value:ce,onChange:A=>xe(A.target.value)})]}),s.jsxs(Ie,{children:[s.jsx(Xe,{label:"Matrícula (Completa o parcial)",placeholder:"Ej: ?98?C* (Presiona espacio para agregar múltiples)",value:Ke,onChange:dn,onKeyDown:_t,leftSection:s.jsx(Ky,{style:f})}),Ve.length>0&&s.jsx(X,{mt:"xs",gap:"xs",children:Ve.map((A,R)=>s.jsx(zt,{p:"xs",withBorder:!0,children:s.jsxs(X,{gap:"xs",children:[s.jsx(Y,{size:"sm",children:A}),s.jsx(We,{variant:"subtle",color:"red",size:"xs",onClick:()=>Wn(A),children:s.jsx(fs,{size:14})})]})},R))})]}),s.jsx(da,{label:"Lectores",placeholder:"Todos",data:E,value:Le,onChange:ge,searchable:!0,clearable:!0,disabled:D,leftSection:s.jsx(Sf,{style:f}),comboboxProps:{withinPortal:!0,position:"bottom",middlewares:{flip:!1,shift:!1},offset:0}}),s.jsxs(X,{grow:!0,children:[s.jsx(da,{label:"Organismo",data:tn,value:he,onChange:de,searchable:!0,clearable:!0,leftSection:s.jsx(Vy,{style:f})}),s.jsx(da,{label:"Provincia",data:U,value:De,onChange:Ne,searchable:!0,clearable:!0,leftSection:s.jsx(rr,{style:f})})]}),s.jsxs(X,{grow:!0,children:[s.jsx(da,{label:"Carretera",placeholder:"Todas",data:Re,value:ae,onChange:me,searchable:!0,clearable:!0,leftSection:s.jsx(lC,{style:f})}),o==="LPR"?s.jsx(da,{label:"Sentido",placeholder:"Ambos",data:vt,value:Pe,onChange:xt,clearable:!0,leftSection:s.jsx(_y,{style:f})}):null]}),s.jsxs(X,{grow:!0,children:[s.jsx(Vr,{label:"Mín. Pasos",placeholder:"Cualquiera",value:rt||"",onChange:ti,min:1,allowDecimal:!1,allowNegative:!1,clampBehavior:"strict",hideControls:!0}),s.jsx(Vr,{label:"Máx. Pasos",placeholder:"Cualquiera",value:G||"",onChange:ni,min:1,allowDecimal:!1,allowNegative:!1,clampBehavior:"strict",hideControls:!0})]}),s.jsx(Me,{onClick:fr,loading:dt,disabled:D,leftSection:s.jsx(ur,{style:f}),size:"sm",variant:"filled",fullWidth:!0,mt:"md",children:"Ejecutar Filtro"}),s.jsx(Me,{variant:"outline",color:"gray",leftSection:s.jsx(gh,{size:16}),onClick:hr,size:"xs",fullWidth:!0,mt:"xs",disabled:dt||D,children:"Limpiar Filtros Actuales"}),s.jsx(Me,{variant:"outline",color:"gray",leftSection:s.jsx(gh,{size:16}),onClick:Pr,size:"xs",fullWidth:!0,mt:"xs",disabled:dt||D,children:"Limpiar Tabla de Resultados"})]})})}),s.jsx(Ta.Col,{span:{base:12,md:9},children:s.jsxs(zt,{shadow:"sm",p:"md",withBorder:!0,style:{position:"relative",overflow:"hidden"},children:[s.jsxs(X,{justify:"space-between",mb:"md",children:[s.jsxs(Wt,{order:4,children:["Resultados (",we.length," lecturas únicas, ",Array.from(new Set(we.map(A=>A.Matricula))).length," vehículos)"]}),s.jsxs(X,{children:[s.jsx(Me,{size:"xs",variant:En?"filled":"outline",color:"blue",leftSection:En?s.jsx(dC,{size:16}):s.jsx(Dc,{size:16}),onClick:()=>qs(!En),children:En?"Vista Normal":"Agrupar por Vehículo"}),s.jsxs(Me,{size:"xs",variant:"outline",leftSection:s.jsx(kc,{size:16}),onClick:Oo,disabled:Fe.length===0||dt,children:["Marcar Relevante (",Fe.length,")"]}),s.jsxs(Me,{size:"xs",variant:"outline",color:"green",leftSection:s.jsx(Sr,{size:16}),onClick:Qs,disabled:Fe.length===0||dt,children:["Guardar Vehículos (",Fe.length,")"]}),s.jsx(Me,{size:"xs",variant:"outline",color:"blue",leftSection:s.jsx(ur,{size:16}),onClick:()=>Ir(!0),children:"Guardar Búsqueda"}),s.jsx(Me,{size:"xs",variant:"outline",color:"violet",leftSection:s.jsx(ur,{size:16}),onClick:()=>pa(!Ga),children:"Búsquedas Guardadas"})]})]}),s.jsx(zC,{opened:Ga,onClose:()=>pa(!1),savedSearches:Mr,selectedSearches:dr,setSelectedSearches:Ha,handleCrossSearch:ri,handleDeleteSavedSearch:No,onClearResults:Pr,onLoadSearch:ai}),s.jsxs(Ie,{style:{maxHeight:"calc(100vh - 400px)",overflow:"auto"},children:[s.jsx(Ac,{withTableBorder:!0,borderRadius:"sm",withColumnBorders:!0,striped:!0,highlightOnHover:!0,records:ht,columns:ei,minHeight:200,totalRecords:we.length,recordsPerPage:Q,page:Bt,onPageChange:_s,idAccessor:"ID_Lectura",selectedRecords:Fe.map(A=>we.find(R=>R.ID_Lectura===A)).filter(Boolean),onSelectedRecordsChange:Js,noRecordsText:dt?"Cargando...":Ae.length===0?"No se encontraron resultados con los filtros aplicados":"",noRecordsIcon:s.jsx(s.Fragment,{}),fetching:dt,sortStatus:ue,onSortStatusChange:Bo,style:{tableLayout:"fixed"},rowClassName:A=>Er.has(A.ID_Lectura)?"session-selected-row":""}),s.jsxs(X,{justify:"space-between",mt:"md",children:[s.jsx($a,{label:"Filas por página",data:["25","50","100"],value:String(Q),onChange:ys,style:{width:150},disabled:dt}),s.jsxs(Y,{size:"sm",children:["Total: ",we.length," lecturas"]})]})]})]})})]})}),s.jsx(TC,{opened:Qr,onClose:()=>Ir(!1),onSave:vs,loading:ga})]})}),np=async(t,r)=>{const a={...r,tipo_fuente:"GPS"};return(await wt.get(`/casos/${t}/lecturas`,{params:a})).data.filter(h=>!(typeof h.Coordenada_Y!="number"||typeof h.Coordenada_X!="number"||isNaN(h.Coordenada_Y)||isNaN(h.Coordenada_X)||h.Coordenada_Y<-90||h.Coordenada_Y>90||h.Coordenada_X<-180||h.Coordenada_X>180))},RC=async t=>(await wt.get(`/casos/${t}/gps-capas`)).data,$C=async(t,r)=>(await wt.post(`/casos/${t}/gps-capas`,r)).data,vh=async(t,r,a)=>(await wt.put(`/casos/${t}/gps-capas/${r}`,a)).data,OC=async(t,r)=>{await wt.delete(`/casos/${t}/gps-capas/${r}`)},BC=async t=>(await wt.get(`/casos/${t}/localizaciones-interes`)).data,NC=async(t,r)=>(await wt.post(`/casos/${t}/localizaciones-interes`,r)).data,HC=async(t,r,a)=>(await wt.put(`/casos/${t}/localizaciones-interes/${r}`,a)).data,GC=async(t,r)=>{await wt.delete(`/casos/${t}/localizaciones-interes/${r}`)};var Ba={},ps={};/**
 * @license React
 * react-dom-server-legacy.browser.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rp=g;function tt(t){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ln=Object.prototype.hasOwnProperty,UC=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,_h={},yh={};function ap(t){return Ln.call(yh,t)?!0:Ln.call(_h,t)?!1:UC.test(t)?yh[t]=!0:(_h[t]=!0,!1)}function _n(t,r,a,l,h,o,c){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=l,this.attributeNamespace=h,this.mustUseProperty=a,this.propertyName=t,this.type=r,this.sanitizeURL=o,this.removeEmptyString=c}var cn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){cn[t]=new _n(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var r=t[0];cn[r]=new _n(r,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){cn[t]=new _n(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){cn[t]=new _n(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){cn[t]=new _n(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){cn[t]=new _n(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){cn[t]=new _n(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){cn[t]=new _n(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){cn[t]=new _n(t,5,!1,t.toLowerCase(),null,!1,!1)});var Rc=/[\-:]([a-z])/g;function $c(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var r=t.replace(Rc,$c);cn[r]=new _n(r,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var r=t.replace(Rc,$c);cn[r]=new _n(r,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var r=t.replace(Rc,$c);cn[r]=new _n(r,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){cn[t]=new _n(t,1,!1,t.toLowerCase(),null,!1,!1)});cn.xlinkHref=new _n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){cn[t]=new _n(t,1,!1,t.toLowerCase(),null,!0,!0)});var eo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},VC=["Webkit","ms","Moz","O"];Object.keys(eo).forEach(function(t){VC.forEach(function(r){r=r+t.charAt(0).toUpperCase()+t.substring(1),eo[r]=eo[t]})});var ZC=/["'&<>]/;function vn(t){if(typeof t=="boolean"||typeof t=="number")return""+t;t=""+t;var r=ZC.exec(t);if(r){var a="",l,h=0;for(l=r.index;l<t.length;l++){switch(t.charCodeAt(l)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#x27;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}h!==l&&(a+=t.substring(h,l)),h=l+1,a+=r}t=h!==l?a+t.substring(h,l):a}return t}var WC=/([A-Z])/g,YC=/^ms-/,fc=Array.isArray;function Hr(t,r){return{insertionMode:t,selectedValue:r}}function qC(t,r,a){switch(r){case"select":return Hr(1,a.value!=null?a.value:a.defaultValue);case"svg":return Hr(2,null);case"math":return Hr(3,null);case"foreignObject":return Hr(1,null);case"table":return Hr(4,null);case"thead":case"tbody":case"tfoot":return Hr(5,null);case"colgroup":return Hr(7,null);case"tr":return Hr(6,null)}return 4<=t.insertionMode||t.insertionMode===0?Hr(1,null):t}var Ch=new Map;function sp(t,r,a){if(typeof a!="object")throw Error(tt(62));r=!0;for(var l in a)if(Ln.call(a,l)){var h=a[l];if(h!=null&&typeof h!="boolean"&&h!==""){if(l.indexOf("--")===0){var o=vn(l);h=vn((""+h).trim())}else{o=l;var c=Ch.get(o);c!==void 0||(c=vn(o.replace(WC,"-$1").toLowerCase().replace(YC,"-ms-")),Ch.set(o,c)),o=c,h=typeof h=="number"?h===0||Ln.call(eo,l)?""+h:h+"px":vn((""+h).trim())}r?(r=!1,t.push(' style="',o,":",h)):t.push(";",o,":",h)}}r||t.push('"')}function Nn(t,r,a,l){switch(a){case"style":sp(t,r,l);return;case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N"){if(r=cn.hasOwnProperty(a)?cn[a]:null,r!==null){switch(typeof l){case"function":case"symbol":return;case"boolean":if(!r.acceptsBooleans)return}switch(a=r.attributeName,r.type){case 3:l&&t.push(" ",a,'=""');break;case 4:l===!0?t.push(" ",a,'=""'):l!==!1&&t.push(" ",a,'="',vn(l),'"');break;case 5:isNaN(l)||t.push(" ",a,'="',vn(l),'"');break;case 6:!isNaN(l)&&1<=l&&t.push(" ",a,'="',vn(l),'"');break;default:r.sanitizeURL&&(l=""+l),t.push(" ",a,'="',vn(l),'"')}}else if(ap(a)){switch(typeof l){case"function":case"symbol":return;case"boolean":if(r=a.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-")return}t.push(" ",a,'="',vn(l),'"')}}}function to(t,r,a){if(r!=null){if(a!=null)throw Error(tt(60));if(typeof r!="object"||!("__html"in r))throw Error(tt(61));r=r.__html,r!=null&&t.push(""+r)}}function XC(t){var r="";return rp.Children.forEach(t,function(a){a!=null&&(r+=a)}),r}function Jl(t,r,a,l){t.push(vr(a));var h=a=null,o;for(o in r)if(Ln.call(r,o)){var c=r[o];if(c!=null)switch(o){case"children":a=c;break;case"dangerouslySetInnerHTML":h=c;break;default:Nn(t,l,o,c)}}return t.push(">"),to(t,h,a),typeof a=="string"?(t.push(vn(a)),null):a}var KC=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,wh=new Map;function vr(t){var r=wh.get(t);if(r===void 0){if(!KC.test(t))throw Error(tt(65,t));r="<"+t,wh.set(t,r)}return r}function JC(t,r,a,l,h){switch(r){case"select":t.push(vr("select"));var o=null,c=null;for(y in a)if(Ln.call(a,y)){var d=a[y];if(d!=null)switch(y){case"children":o=d;break;case"dangerouslySetInnerHTML":c=d;break;case"defaultValue":case"value":break;default:Nn(t,l,y,d)}}return t.push(">"),to(t,c,o),o;case"option":c=h.selectedValue,t.push(vr("option"));var f=d=null,m=null,y=null;for(o in a)if(Ln.call(a,o)){var _=a[o];if(_!=null)switch(o){case"children":d=_;break;case"selected":m=_;break;case"dangerouslySetInnerHTML":y=_;break;case"value":f=_;default:Nn(t,l,o,_)}}if(c!=null)if(a=f!==null?""+f:XC(d),fc(c)){for(l=0;l<c.length;l++)if(""+c[l]===a){t.push(' selected=""');break}}else""+c===a&&t.push(' selected=""');else m&&t.push(' selected=""');return t.push(">"),to(t,y,d),d;case"textarea":t.push(vr("textarea")),y=c=o=null;for(d in a)if(Ln.call(a,d)&&(f=a[d],f!=null))switch(d){case"children":y=f;break;case"value":o=f;break;case"defaultValue":c=f;break;case"dangerouslySetInnerHTML":throw Error(tt(91));default:Nn(t,l,d,f)}if(o===null&&c!==null&&(o=c),t.push(">"),y!=null){if(o!=null)throw Error(tt(92));if(fc(y)&&1<y.length)throw Error(tt(93));o=""+y}return typeof o=="string"&&o[0]===`
`&&t.push(`
`),o!==null&&t.push(vn(""+o)),null;case"input":t.push(vr("input")),f=y=d=o=null;for(c in a)if(Ln.call(a,c)&&(m=a[c],m!=null))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(tt(399,"input"));case"defaultChecked":f=m;break;case"defaultValue":d=m;break;case"checked":y=m;break;case"value":o=m;break;default:Nn(t,l,c,m)}return y!==null?Nn(t,l,"checked",y):f!==null&&Nn(t,l,"checked",f),o!==null?Nn(t,l,"value",o):d!==null&&Nn(t,l,"value",d),t.push("/>"),null;case"menuitem":t.push(vr("menuitem"));for(var S in a)if(Ln.call(a,S)&&(o=a[S],o!=null))switch(S){case"children":case"dangerouslySetInnerHTML":throw Error(tt(400));default:Nn(t,l,S,o)}return t.push(">"),null;case"title":t.push(vr("title")),o=null;for(_ in a)if(Ln.call(a,_)&&(c=a[_],c!=null))switch(_){case"children":o=c;break;case"dangerouslySetInnerHTML":throw Error(tt(434));default:Nn(t,l,_,c)}return t.push(">"),o;case"listing":case"pre":t.push(vr(r)),c=o=null;for(f in a)if(Ln.call(a,f)&&(d=a[f],d!=null))switch(f){case"children":o=d;break;case"dangerouslySetInnerHTML":c=d;break;default:Nn(t,l,f,d)}if(t.push(">"),c!=null){if(o!=null)throw Error(tt(60));if(typeof c!="object"||!("__html"in c))throw Error(tt(61));a=c.__html,a!=null&&(typeof a=="string"&&0<a.length&&a[0]===`
`?t.push(`
`,a):t.push(""+a))}return typeof o=="string"&&o[0]===`
`&&t.push(`
`),o;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":t.push(vr(r));for(var b in a)if(Ln.call(a,b)&&(o=a[b],o!=null))switch(b){case"children":case"dangerouslySetInnerHTML":throw Error(tt(399,r));default:Nn(t,l,b,o)}return t.push("/>"),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return Jl(t,a,r,l);case"html":return h.insertionMode===0&&t.push("<!DOCTYPE html>"),Jl(t,a,r,l);default:if(r.indexOf("-")===-1&&typeof a.is!="string")return Jl(t,a,r,l);t.push(vr(r)),c=o=null;for(m in a)if(Ln.call(a,m)&&(d=a[m],d!=null))switch(m){case"children":o=d;break;case"dangerouslySetInnerHTML":c=d;break;case"style":sp(t,l,d);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:ap(m)&&typeof d!="function"&&typeof d!="symbol"&&t.push(" ",m,'="',vn(d),'"')}return t.push(">"),to(t,c,o),o}}function bh(t,r,a){if(t.push('<!--$?--><template id="'),a===null)throw Error(tt(395));return t.push(a),t.push('"></template>')}function QC(t,r,a,l){switch(a.insertionMode){case 0:case 1:return t.push('<div hidden id="'),t.push(r.segmentPrefix),r=l.toString(16),t.push(r),t.push('">');case 2:return t.push('<svg aria-hidden="true" style="display:none" id="'),t.push(r.segmentPrefix),r=l.toString(16),t.push(r),t.push('">');case 3:return t.push('<math aria-hidden="true" style="display:none" id="'),t.push(r.segmentPrefix),r=l.toString(16),t.push(r),t.push('">');case 4:return t.push('<table hidden id="'),t.push(r.segmentPrefix),r=l.toString(16),t.push(r),t.push('">');case 5:return t.push('<table hidden><tbody id="'),t.push(r.segmentPrefix),r=l.toString(16),t.push(r),t.push('">');case 6:return t.push('<table hidden><tr id="'),t.push(r.segmentPrefix),r=l.toString(16),t.push(r),t.push('">');case 7:return t.push('<table hidden><colgroup id="'),t.push(r.segmentPrefix),r=l.toString(16),t.push(r),t.push('">');default:throw Error(tt(397))}}function ew(t,r){switch(r.insertionMode){case 0:case 1:return t.push("</div>");case 2:return t.push("</svg>");case 3:return t.push("</math>");case 4:return t.push("</table>");case 5:return t.push("</tbody></table>");case 6:return t.push("</tr></table>");case 7:return t.push("</colgroup></table>");default:throw Error(tt(397))}}var tw=/[<\u2028\u2029]/g;function Ql(t){return JSON.stringify(t).replace(tw,function(r){switch(r){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}function nw(t,r){return r=r===void 0?"":r,{bootstrapChunks:[],startInlineScript:"<script>",placeholderPrefix:r+"P:",segmentPrefix:r+"S:",boundaryPrefix:r+"B:",idPrefix:r,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1,generateStaticMarkup:t}}function Sh(t,r,a,l){return a.generateStaticMarkup?(t.push(vn(r)),!1):(r===""?t=l:(l&&t.push("<!-- -->"),t.push(vn(r)),t=!0),t)}var Ns=Object.assign,rw=Symbol.for("react.element"),ip=Symbol.for("react.portal"),op=Symbol.for("react.fragment"),lp=Symbol.for("react.strict_mode"),cp=Symbol.for("react.profiler"),up=Symbol.for("react.provider"),dp=Symbol.for("react.context"),hp=Symbol.for("react.forward_ref"),fp=Symbol.for("react.suspense"),pp=Symbol.for("react.suspense_list"),gp=Symbol.for("react.memo"),Oc=Symbol.for("react.lazy"),aw=Symbol.for("react.scope"),sw=Symbol.for("react.debug_trace_mode"),iw=Symbol.for("react.legacy_hidden"),ow=Symbol.for("react.default_value"),jh=Symbol.iterator;function pc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case op:return"Fragment";case ip:return"Portal";case cp:return"Profiler";case lp:return"StrictMode";case fp:return"Suspense";case pp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case dp:return(t.displayName||"Context")+".Consumer";case up:return(t._context.displayName||"Context")+".Provider";case hp:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case gp:return r=t.displayName||null,r!==null?r:pc(t.type)||"Memo";case Oc:r=t._payload,t=t._init;try{return pc(t(r))}catch{}}return null}var mp={};function Lh(t,r){if(t=t.contextTypes,!t)return mp;var a={},l;for(l in t)a[l]=r[l];return a}var Fa=null;function To(t,r){if(t!==r){t.context._currentValue2=t.parentValue,t=t.parent;var a=r.parent;if(t===null){if(a!==null)throw Error(tt(401))}else{if(a===null)throw Error(tt(401));To(t,a)}r.context._currentValue2=r.value}}function xp(t){t.context._currentValue2=t.parentValue,t=t.parent,t!==null&&xp(t)}function vp(t){var r=t.parent;r!==null&&vp(r),t.context._currentValue2=t.value}function _p(t,r){if(t.context._currentValue2=t.parentValue,t=t.parent,t===null)throw Error(tt(402));t.depth===r.depth?To(t,r):_p(t,r)}function yp(t,r){var a=r.parent;if(a===null)throw Error(tt(402));t.depth===a.depth?To(t,a):yp(t,a),r.context._currentValue2=r.value}function yo(t){var r=Fa;r!==t&&(r===null?vp(t):t===null?xp(r):r.depth===t.depth?To(r,t):r.depth>t.depth?_p(r,t):yp(r,t),Fa=t)}var kh={isMounted:function(){return!1},enqueueSetState:function(t,r){t=t._reactInternals,t.queue!==null&&t.queue.push(r)},enqueueReplaceState:function(t,r){t=t._reactInternals,t.replace=!0,t.queue=[r]},enqueueForceUpdate:function(){}};function Mh(t,r,a,l){var h=t.state!==void 0?t.state:null;t.updater=kh,t.props=a,t.state=h;var o={queue:[],replace:!1};t._reactInternals=o;var c=r.contextType;if(t.context=typeof c=="object"&&c!==null?c._currentValue2:l,c=r.getDerivedStateFromProps,typeof c=="function"&&(c=c(a,h),h=c==null?h:Ns({},h,c),t.state=h),typeof r.getDerivedStateFromProps!="function"&&typeof t.getSnapshotBeforeUpdate!="function"&&(typeof t.UNSAFE_componentWillMount=="function"||typeof t.componentWillMount=="function"))if(r=t.state,typeof t.componentWillMount=="function"&&t.componentWillMount(),typeof t.UNSAFE_componentWillMount=="function"&&t.UNSAFE_componentWillMount(),r!==t.state&&kh.enqueueReplaceState(t,t.state,null),o.queue!==null&&0<o.queue.length)if(r=o.queue,c=o.replace,o.queue=null,o.replace=!1,c&&r.length===1)t.state=r[0];else{for(o=c?r[0]:t.state,h=!0,c=c?1:0;c<r.length;c++){var d=r[c];d=typeof d=="function"?d.call(t,o,a,l):d,d!=null&&(h?(h=!1,o=Ns({},o,d)):Ns(o,d))}t.state=o}else o.queue=null}var lw={id:1,overflow:""};function gc(t,r,a){var l=t.id;t=t.overflow;var h=32-no(l)-1;l&=~(1<<h),a+=1;var o=32-no(r)+h;if(30<o){var c=h-h%5;return o=(l&(1<<c)-1).toString(32),l>>=c,h-=c,{id:1<<32-no(r)+h|a<<h|l,overflow:o+t}}return{id:1<<o|a<<h|l,overflow:t}}var no=Math.clz32?Math.clz32:dw,cw=Math.log,uw=Math.LN2;function dw(t){return t>>>=0,t===0?32:31-(cw(t)/uw|0)|0}function hw(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var fw=typeof Object.is=="function"?Object.is:hw,qr=null,Bc=null,ro=null,$t=null,Rs=!1,Co=!1,Vs=0,ha=null,zo=0;function Ma(){if(qr===null)throw Error(tt(321));return qr}function Ih(){if(0<zo)throw Error(tt(312));return{memoizedState:null,queue:null,next:null}}function Nc(){return $t===null?ro===null?(Rs=!1,ro=$t=Ih()):(Rs=!0,$t=ro):$t.next===null?(Rs=!1,$t=$t.next=Ih()):(Rs=!0,$t=$t.next),$t}function Hc(){Bc=qr=null,Co=!1,ro=null,zo=0,$t=ha=null}function Cp(t,r){return typeof r=="function"?r(t):r}function Eh(t,r,a){if(qr=Ma(),$t=Nc(),Rs){var l=$t.queue;if(r=l.dispatch,ha!==null&&(a=ha.get(l),a!==void 0)){ha.delete(l),l=$t.memoizedState;do l=t(l,a.action),a=a.next;while(a!==null);return $t.memoizedState=l,[l,r]}return[$t.memoizedState,r]}return t=t===Cp?typeof r=="function"?r():r:a!==void 0?a(r):r,$t.memoizedState=t,t=$t.queue={last:null,dispatch:null},t=t.dispatch=pw.bind(null,qr,t),[$t.memoizedState,t]}function Ah(t,r){if(qr=Ma(),$t=Nc(),r=r===void 0?null:r,$t!==null){var a=$t.memoizedState;if(a!==null&&r!==null){var l=a[1];e:if(l===null)l=!1;else{for(var h=0;h<l.length&&h<r.length;h++)if(!fw(r[h],l[h])){l=!1;break e}l=!0}if(l)return a[0]}}return t=t(),$t.memoizedState=[t,r],t}function pw(t,r,a){if(25<=zo)throw Error(tt(301));if(t===qr)if(Co=!0,t={action:a,next:null},ha===null&&(ha=new Map),a=ha.get(r),a===void 0)ha.set(r,t);else{for(r=a;r.next!==null;)r=r.next;r.next=t}}function gw(){throw Error(tt(394))}function qi(){}var Ph={readContext:function(t){return t._currentValue2},useContext:function(t){return Ma(),t._currentValue2},useMemo:Ah,useReducer:Eh,useRef:function(t){qr=Ma(),$t=Nc();var r=$t.memoizedState;return r===null?(t={current:t},$t.memoizedState=t):r},useState:function(t){return Eh(Cp,t)},useInsertionEffect:qi,useLayoutEffect:function(){},useCallback:function(t,r){return Ah(function(){return t},r)},useImperativeHandle:qi,useEffect:qi,useDebugValue:qi,useDeferredValue:function(t){return Ma(),t},useTransition:function(){return Ma(),[!1,gw]},useId:function(){var t=Bc.treeContext,r=t.overflow;t=t.id,t=(t&~(1<<32-no(t)-1)).toString(32)+r;var a=ao;if(a===null)throw Error(tt(404));return r=Vs++,t=":"+a.idPrefix+"R"+t,0<r&&(t+="H"+r.toString(32)),t+":"},useMutableSource:function(t,r){return Ma(),r(t._source)},useSyncExternalStore:function(t,r,a){if(a===void 0)throw Error(tt(407));return a()}},ao=null,ec=rp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function mw(t){return console.error(t),null}function $s(){}function xw(t,r,a,l,h,o,c,d,f){var m=[],y=new Set;return r={destination:null,responseState:r,progressiveChunkSize:l===void 0?12800:l,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:y,pingedTasks:m,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:h===void 0?mw:h,onAllReady:$s,onShellReady:c===void 0?$s:c,onShellError:$s,onFatalError:$s},a=wo(r,0,null,a,!1,!1),a.parentFlushed=!0,t=Gc(r,t,null,a,y,mp,null,lw),m.push(t),r}function Gc(t,r,a,l,h,o,c,d){t.allPendingTasks++,a===null?t.pendingRootTasks++:a.pendingTasks++;var f={node:r,ping:function(){var m=t.pingedTasks;m.push(f),m.length===1&&Sp(t)},blockedBoundary:a,blockedSegment:l,abortSet:h,legacyContext:o,context:c,treeContext:d};return h.add(f),f}function wo(t,r,a,l,h,o){return{status:0,id:-1,index:r,parentFlushed:!1,chunks:[],children:[],formatContext:l,boundary:a,lastPushedText:h,textEmbedded:o}}function Zs(t,r){if(t=t.onError(r),t!=null&&typeof t!="string")throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof t+'" instead');return t}function bo(t,r){var a=t.onShellError;a(r),a=t.onFatalError,a(r),t.destination!==null?(t.status=2,t.destination.destroy(r)):(t.status=1,t.fatalError=r)}function Th(t,r,a,l,h){for(qr={},Bc=r,Vs=0,t=a(l,h);Co;)Co=!1,Vs=0,zo+=1,$t=null,t=a(l,h);return Hc(),t}function zh(t,r,a,l){var h=a.render(),o=l.childContextTypes;if(o!=null){var c=r.legacyContext;if(typeof a.getChildContext!="function")l=c;else{a=a.getChildContext();for(var d in a)if(!(d in o))throw Error(tt(108,pc(l)||"Unknown",d));l=Ns({},c,a)}r.legacyContext=l,Gn(t,r,h),r.legacyContext=c}else Gn(t,r,h)}function Fh(t,r){if(t&&t.defaultProps){r=Ns({},r),t=t.defaultProps;for(var a in t)r[a]===void 0&&(r[a]=t[a]);return r}return r}function mc(t,r,a,l,h){if(typeof a=="function")if(a.prototype&&a.prototype.isReactComponent){h=Lh(a,r.legacyContext);var o=a.contextType;o=new a(l,typeof o=="object"&&o!==null?o._currentValue2:h),Mh(o,a,l,h),zh(t,r,o,a)}else{o=Lh(a,r.legacyContext),h=Th(t,r,a,l,o);var c=Vs!==0;if(typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0)Mh(h,a,l,o),zh(t,r,h,a);else if(c){l=r.treeContext,r.treeContext=gc(l,1,0);try{Gn(t,r,h)}finally{r.treeContext=l}}else Gn(t,r,h)}else if(typeof a=="string"){switch(h=r.blockedSegment,o=JC(h.chunks,a,l,t.responseState,h.formatContext),h.lastPushedText=!1,c=h.formatContext,h.formatContext=qC(c,a,l),xc(t,r,o),h.formatContext=c,a){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:h.chunks.push("</",a,">")}h.lastPushedText=!1}else{switch(a){case iw:case sw:case lp:case cp:case op:Gn(t,r,l.children);return;case pp:Gn(t,r,l.children);return;case aw:throw Error(tt(343));case fp:e:{a=r.blockedBoundary,h=r.blockedSegment,o=l.fallback,l=l.children,c=new Set;var d={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:c,errorDigest:null},f=wo(t,h.chunks.length,d,h.formatContext,!1,!1);h.children.push(f),h.lastPushedText=!1;var m=wo(t,0,null,h.formatContext,!1,!1);m.parentFlushed=!0,r.blockedBoundary=d,r.blockedSegment=m;try{if(xc(t,r,l),t.responseState.generateStaticMarkup||m.lastPushedText&&m.textEmbedded&&m.chunks.push("<!-- -->"),m.status=1,So(d,m),d.pendingTasks===0)break e}catch(y){m.status=4,d.forceClientRender=!0,d.errorDigest=Zs(t,y)}finally{r.blockedBoundary=a,r.blockedSegment=h}r=Gc(t,o,a,f,c,r.legacyContext,r.context,r.treeContext),t.pingedTasks.push(r)}return}if(typeof a=="object"&&a!==null)switch(a.$$typeof){case hp:if(l=Th(t,r,a.render,l,h),Vs!==0){a=r.treeContext,r.treeContext=gc(a,1,0);try{Gn(t,r,l)}finally{r.treeContext=a}}else Gn(t,r,l);return;case gp:a=a.type,l=Fh(a,l),mc(t,r,a,l,h);return;case up:if(h=l.children,a=a._context,l=l.value,o=a._currentValue2,a._currentValue2=l,c=Fa,Fa=l={parent:c,depth:c===null?0:c.depth+1,context:a,parentValue:o,value:l},r.context=l,Gn(t,r,h),t=Fa,t===null)throw Error(tt(403));l=t.parentValue,t.context._currentValue2=l===ow?t.context._defaultValue:l,t=Fa=t.parent,r.context=t;return;case dp:l=l.children,l=l(a._currentValue2),Gn(t,r,l);return;case Oc:h=a._init,a=h(a._payload),l=Fh(a,l),mc(t,r,a,l,void 0);return}throw Error(tt(130,a==null?a:typeof a,""))}}function Gn(t,r,a){if(r.node=a,typeof a=="object"&&a!==null){switch(a.$$typeof){case rw:mc(t,r,a.type,a.props,a.ref);return;case ip:throw Error(tt(257));case Oc:var l=a._init;a=l(a._payload),Gn(t,r,a);return}if(fc(a)){Dh(t,r,a);return}if(a===null||typeof a!="object"?l=null:(l=jh&&a[jh]||a["@@iterator"],l=typeof l=="function"?l:null),l&&(l=l.call(a))){if(a=l.next(),!a.done){var h=[];do h.push(a.value),a=l.next();while(!a.done);Dh(t,r,h)}return}throw t=Object.prototype.toString.call(a),Error(tt(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t))}typeof a=="string"?(l=r.blockedSegment,l.lastPushedText=Sh(r.blockedSegment.chunks,a,t.responseState,l.lastPushedText)):typeof a=="number"&&(l=r.blockedSegment,l.lastPushedText=Sh(r.blockedSegment.chunks,""+a,t.responseState,l.lastPushedText))}function Dh(t,r,a){for(var l=a.length,h=0;h<l;h++){var o=r.treeContext;r.treeContext=gc(o,l,h);try{xc(t,r,a[h])}finally{r.treeContext=o}}}function xc(t,r,a){var l=r.blockedSegment.formatContext,h=r.legacyContext,o=r.context;try{return Gn(t,r,a)}catch(f){if(Hc(),typeof f=="object"&&f!==null&&typeof f.then=="function"){a=f;var c=r.blockedSegment,d=wo(t,c.chunks.length,null,c.formatContext,c.lastPushedText,!0);c.children.push(d),c.lastPushedText=!1,t=Gc(t,r.node,r.blockedBoundary,d,r.abortSet,r.legacyContext,r.context,r.treeContext).ping,a.then(t,t),r.blockedSegment.formatContext=l,r.legacyContext=h,r.context=o,yo(o)}else throw r.blockedSegment.formatContext=l,r.legacyContext=h,r.context=o,yo(o),f}}function vw(t){var r=t.blockedBoundary;t=t.blockedSegment,t.status=3,bp(this,r,t)}function wp(t,r,a){var l=t.blockedBoundary;t.blockedSegment.status=3,l===null?(r.allPendingTasks--,r.status!==2&&(r.status=2,r.destination!==null&&r.destination.push(null))):(l.pendingTasks--,l.forceClientRender||(l.forceClientRender=!0,t=a===void 0?Error(tt(432)):a,l.errorDigest=r.onError(t),l.parentFlushed&&r.clientRenderedBoundaries.push(l)),l.fallbackAbortableTasks.forEach(function(h){return wp(h,r,a)}),l.fallbackAbortableTasks.clear(),r.allPendingTasks--,r.allPendingTasks===0&&(l=r.onAllReady,l()))}function So(t,r){if(r.chunks.length===0&&r.children.length===1&&r.children[0].boundary===null){var a=r.children[0];a.id=r.id,a.parentFlushed=!0,a.status===1&&So(t,a)}else t.completedSegments.push(r)}function bp(t,r,a){if(r===null){if(a.parentFlushed){if(t.completedRootSegment!==null)throw Error(tt(389));t.completedRootSegment=a}t.pendingRootTasks--,t.pendingRootTasks===0&&(t.onShellError=$s,r=t.onShellReady,r())}else r.pendingTasks--,r.forceClientRender||(r.pendingTasks===0?(a.parentFlushed&&a.status===1&&So(r,a),r.parentFlushed&&t.completedBoundaries.push(r),r.fallbackAbortableTasks.forEach(vw,t),r.fallbackAbortableTasks.clear()):a.parentFlushed&&a.status===1&&(So(r,a),r.completedSegments.length===1&&r.parentFlushed&&t.partialBoundaries.push(r)));t.allPendingTasks--,t.allPendingTasks===0&&(t=t.onAllReady,t())}function Sp(t){if(t.status!==2){var r=Fa,a=ec.current;ec.current=Ph;var l=ao;ao=t.responseState;try{var h=t.pingedTasks,o;for(o=0;o<h.length;o++){var c=h[o],d=t,f=c.blockedSegment;if(f.status===0){yo(c.context);try{Gn(d,c,c.node),d.responseState.generateStaticMarkup||f.lastPushedText&&f.textEmbedded&&f.chunks.push("<!-- -->"),c.abortSet.delete(c),f.status=1,bp(d,c.blockedBoundary,f)}catch(T){if(Hc(),typeof T=="object"&&T!==null&&typeof T.then=="function"){var m=c.ping;T.then(m,m)}else{c.abortSet.delete(c),f.status=4;var y=c.blockedBoundary,_=T,S=Zs(d,_);if(y===null?bo(d,_):(y.pendingTasks--,y.forceClientRender||(y.forceClientRender=!0,y.errorDigest=S,y.parentFlushed&&d.clientRenderedBoundaries.push(y))),d.allPendingTasks--,d.allPendingTasks===0){var b=d.onAllReady;b()}}}finally{}}}h.splice(0,o),t.destination!==null&&Uc(t,t.destination)}catch(T){Zs(t,T),bo(t,T)}finally{ao=l,ec.current=a,a===Ph&&yo(r)}}}function Xi(t,r,a){switch(a.parentFlushed=!0,a.status){case 0:var l=a.id=t.nextSegmentId++;return a.lastPushedText=!1,a.textEmbedded=!1,t=t.responseState,r.push('<template id="'),r.push(t.placeholderPrefix),t=l.toString(16),r.push(t),r.push('"></template>');case 1:a.status=2;var h=!0;l=a.chunks;var o=0;a=a.children;for(var c=0;c<a.length;c++){for(h=a[c];o<h.index;o++)r.push(l[o]);h=Fo(t,r,h)}for(;o<l.length-1;o++)r.push(l[o]);return o<l.length&&(h=r.push(l[o])),h;default:throw Error(tt(390))}}function Fo(t,r,a){var l=a.boundary;if(l===null)return Xi(t,r,a);if(l.parentFlushed=!0,l.forceClientRender)return t.responseState.generateStaticMarkup||(l=l.errorDigest,r.push("<!--$!-->"),r.push("<template"),l&&(r.push(' data-dgst="'),l=vn(l),r.push(l),r.push('"')),r.push("></template>")),Xi(t,r,a),t=t.responseState.generateStaticMarkup?!0:r.push("<!--/$-->"),t;if(0<l.pendingTasks){l.rootSegmentID=t.nextSegmentId++,0<l.completedSegments.length&&t.partialBoundaries.push(l);var h=t.responseState,o=h.nextSuspenseID++;return h=h.boundaryPrefix+o.toString(16),l=l.id=h,bh(r,t.responseState,l),Xi(t,r,a),r.push("<!--/$-->")}if(l.byteSize>t.progressiveChunkSize)return l.rootSegmentID=t.nextSegmentId++,t.completedBoundaries.push(l),bh(r,t.responseState,l.id),Xi(t,r,a),r.push("<!--/$-->");if(t.responseState.generateStaticMarkup||r.push("<!--$-->"),a=l.completedSegments,a.length!==1)throw Error(tt(391));return Fo(t,r,a[0]),t=t.responseState.generateStaticMarkup?!0:r.push("<!--/$-->"),t}function Rh(t,r,a){return QC(r,t.responseState,a.formatContext,a.id),Fo(t,r,a),ew(r,a.formatContext)}function $h(t,r,a){for(var l=a.completedSegments,h=0;h<l.length;h++)jp(t,r,a,l[h]);if(l.length=0,t=t.responseState,l=a.id,a=a.rootSegmentID,r.push(t.startInlineScript),t.sentCompleteBoundaryFunction?r.push('$RC("'):(t.sentCompleteBoundaryFunction=!0,r.push('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("')),l===null)throw Error(tt(395));return a=a.toString(16),r.push(l),r.push('","'),r.push(t.segmentPrefix),r.push(a),r.push('")<\/script>')}function jp(t,r,a,l){if(l.status===2)return!0;var h=l.id;if(h===-1){if((l.id=a.rootSegmentID)===-1)throw Error(tt(392));return Rh(t,r,l)}return Rh(t,r,l),t=t.responseState,r.push(t.startInlineScript),t.sentCompleteSegmentFunction?r.push('$RS("'):(t.sentCompleteSegmentFunction=!0,r.push('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("')),r.push(t.segmentPrefix),h=h.toString(16),r.push(h),r.push('","'),r.push(t.placeholderPrefix),r.push(h),r.push('")<\/script>')}function Uc(t,r){try{var a=t.completedRootSegment;if(a!==null&&t.pendingRootTasks===0){Fo(t,r,a),t.completedRootSegment=null;var l=t.responseState.bootstrapChunks;for(a=0;a<l.length-1;a++)r.push(l[a]);a<l.length&&r.push(l[a])}var h=t.clientRenderedBoundaries,o;for(o=0;o<h.length;o++){var c=h[o];l=r;var d=t.responseState,f=c.id,m=c.errorDigest,y=c.errorMessage,_=c.errorComponentStack;if(l.push(d.startInlineScript),d.sentClientRenderFunction?l.push('$RX("'):(d.sentClientRenderFunction=!0,l.push('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("')),f===null)throw Error(tt(395));if(l.push(f),l.push('"'),m||y||_){l.push(",");var S=Ql(m||"");l.push(S)}if(y||_){l.push(",");var b=Ql(y||"");l.push(b)}if(_){l.push(",");var T=Ql(_);l.push(T)}if(!l.push(")<\/script>")){t.destination=null,o++,h.splice(0,o);return}}h.splice(0,o);var z=t.completedBoundaries;for(o=0;o<z.length;o++)if(!$h(t,r,z[o])){t.destination=null,o++,z.splice(0,o);return}z.splice(0,o);var J=t.partialBoundaries;for(o=0;o<J.length;o++){var F=J[o];e:{h=t,c=r;var te=F.completedSegments;for(d=0;d<te.length;d++)if(!jp(h,c,F,te[d])){d++,te.splice(0,d);var re=!1;break e}te.splice(0,d),re=!0}if(!re){t.destination=null,o++,J.splice(0,o);return}}J.splice(0,o);var O=t.completedBoundaries;for(o=0;o<O.length;o++)if(!$h(t,r,O[o])){t.destination=null,o++,O.splice(0,o);return}O.splice(0,o)}finally{t.allPendingTasks===0&&t.pingedTasks.length===0&&t.clientRenderedBoundaries.length===0&&t.completedBoundaries.length===0&&r.push(null)}}function _w(t,r){try{var a=t.abortableTasks;a.forEach(function(l){return wp(l,t,r)}),a.clear(),t.destination!==null&&Uc(t,t.destination)}catch(l){Zs(t,l),bo(t,l)}}function yw(){}function Lp(t,r,a,l){var h=!1,o=null,c="",d={push:function(m){return m!==null&&(c+=m),!0},destroy:function(m){h=!0,o=m}},f=!1;if(t=xw(t,nw(a,r?r.identifierPrefix:void 0),{insertionMode:1,selectedValue:null},1/0,yw,void 0,function(){f=!0}),Sp(t),_w(t,l),t.status===1)t.status=2,d.destroy(t.fatalError);else if(t.status!==2&&t.destination===null){t.destination=d;try{Uc(t,d)}catch(m){Zs(t,m),bo(t,m)}}if(h)throw o;if(!f)throw Error(tt(426));return c}ps.renderToNodeStream=function(){throw Error(tt(207))};ps.renderToStaticMarkup=function(t,r){return Lp(t,r,!0,'The server used "renderToStaticMarkup" which does not support Suspense. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')};ps.renderToStaticNodeStream=function(){throw Error(tt(208))};ps.renderToString=function(t,r){return Lp(t,r,!1,'The server used "renderToString" which does not support Suspense. If you intended for this Suspense boundary to render the fallback content on the server consider throwing an Error somewhere within the Suspense boundary. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')};ps.version="18.3.1";var Vc={};/**
 * @license React
 * react-dom-server.browser.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kp=g;function ut(t){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+t+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Un=null,Vn=0;function ze(t,r){if(r.length!==0)if(512<r.length)0<Vn&&(t.enqueue(new Uint8Array(Un.buffer,0,Vn)),Un=new Uint8Array(512),Vn=0),t.enqueue(r);else{var a=Un.length-Vn;a<r.length&&(a===0?t.enqueue(Un):(Un.set(r.subarray(0,a),Vn),t.enqueue(Un),r=r.subarray(a)),Un=new Uint8Array(512),Vn=0),Un.set(r,Vn),Vn+=r.length}}function Gt(t,r){return ze(t,r),!0}function Oh(t){Un&&0<Vn&&(t.enqueue(new Uint8Array(Un.buffer,0,Vn)),Un=null,Vn=0)}var Mp=new TextEncoder;function ft(t){return Mp.encode(t)}function ye(t){return Mp.encode(t)}function Ip(t,r){typeof t.error=="function"?t.error(r):t.close()}var kn=Object.prototype.hasOwnProperty,Cw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Bh={},Nh={};function Ep(t){return kn.call(Nh,t)?!0:kn.call(Bh,t)?!1:Cw.test(t)?Nh[t]=!0:(Bh[t]=!0,!1)}function yn(t,r,a,l,h,o,c){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=l,this.attributeNamespace=h,this.mustUseProperty=a,this.propertyName=t,this.type=r,this.sanitizeURL=o,this.removeEmptyString=c}var un={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){un[t]=new yn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var r=t[0];un[r]=new yn(r,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){un[t]=new yn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){un[t]=new yn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){un[t]=new yn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){un[t]=new yn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){un[t]=new yn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){un[t]=new yn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){un[t]=new yn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Zc=/[\-:]([a-z])/g;function Wc(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var r=t.replace(Zc,Wc);un[r]=new yn(r,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var r=t.replace(Zc,Wc);un[r]=new yn(r,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var r=t.replace(Zc,Wc);un[r]=new yn(r,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){un[t]=new yn(t,1,!1,t.toLowerCase(),null,!1,!1)});un.xlinkHref=new yn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){un[t]=new yn(t,1,!1,t.toLowerCase(),null,!0,!0)});var so={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ww=["Webkit","ms","Moz","O"];Object.keys(so).forEach(function(t){ww.forEach(function(r){r=r+t.charAt(0).toUpperCase()+t.substring(1),so[r]=so[t]})});var bw=/["'&<>]/;function ln(t){if(typeof t=="boolean"||typeof t=="number")return""+t;t=""+t;var r=bw.exec(t);if(r){var a="",l,h=0;for(l=r.index;l<t.length;l++){switch(t.charCodeAt(l)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#x27;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}h!==l&&(a+=t.substring(h,l)),h=l+1,a+=r}t=h!==l?a+t.substring(h,l):a}return t}var Sw=/([A-Z])/g,jw=/^ms-/,vc=Array.isArray,Lw=ye("<script>"),kw=ye("<\/script>"),Mw=ye('<script src="'),Iw=ye('<script type="module" src="'),Hh=ye('" async=""><\/script>'),Ew=/(<\/|<)(s)(cript)/gi;function Aw(t,r,a,l){return""+r+(a==="s"?"\\u0073":"\\u0053")+l}function Pw(t,r,a,l,h){t=t===void 0?"":t,r=r===void 0?Lw:ye('<script nonce="'+ln(r)+'">');var o=[];if(a!==void 0&&o.push(r,ft((""+a).replace(Ew,Aw)),kw),l!==void 0)for(a=0;a<l.length;a++)o.push(Mw,ft(ln(l[a])),Hh);if(h!==void 0)for(l=0;l<h.length;l++)o.push(Iw,ft(ln(h[l])),Hh);return{bootstrapChunks:o,startInlineScript:r,placeholderPrefix:ye(t+"P:"),segmentPrefix:ye(t+"S:"),boundaryPrefix:t+"B:",idPrefix:t,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1}}function _r(t,r){return{insertionMode:t,selectedValue:r}}function Tw(t){return _r(t==="http://www.w3.org/2000/svg"?2:t==="http://www.w3.org/1998/Math/MathML"?3:0,null)}function zw(t,r,a){switch(r){case"select":return _r(1,a.value!=null?a.value:a.defaultValue);case"svg":return _r(2,null);case"math":return _r(3,null);case"foreignObject":return _r(1,null);case"table":return _r(4,null);case"thead":case"tbody":case"tfoot":return _r(5,null);case"colgroup":return _r(7,null);case"tr":return _r(6,null)}return 4<=t.insertionMode||t.insertionMode===0?_r(1,null):t}var Yc=ye("<!-- -->");function Gh(t,r,a,l){return r===""?l:(l&&t.push(Yc),t.push(ft(ln(r))),!0)}var Uh=new Map,Fw=ye(' style="'),Vh=ye(":"),Dw=ye(";");function Ap(t,r,a){if(typeof a!="object")throw Error(ut(62));r=!0;for(var l in a)if(kn.call(a,l)){var h=a[l];if(h!=null&&typeof h!="boolean"&&h!==""){if(l.indexOf("--")===0){var o=ft(ln(l));h=ft(ln((""+h).trim()))}else{o=l;var c=Uh.get(o);c!==void 0||(c=ye(ln(o.replace(Sw,"-$1").toLowerCase().replace(jw,"-ms-"))),Uh.set(o,c)),o=c,h=typeof h=="number"?h===0||kn.call(so,l)?ft(""+h):ft(h+"px"):ft(ln((""+h).trim()))}r?(r=!1,t.push(Fw,o,Vh,h)):t.push(Dw,o,Vh,h)}}r||t.push(Ia)}var ca=ye(" "),hs=ye('="'),Ia=ye('"'),Zh=ye('=""');function Hn(t,r,a,l){switch(a){case"style":Ap(t,r,l);return;case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N"){if(r=un.hasOwnProperty(a)?un[a]:null,r!==null){switch(typeof l){case"function":case"symbol":return;case"boolean":if(!r.acceptsBooleans)return}switch(a=ft(r.attributeName),r.type){case 3:l&&t.push(ca,a,Zh);break;case 4:l===!0?t.push(ca,a,Zh):l!==!1&&t.push(ca,a,hs,ft(ln(l)),Ia);break;case 5:isNaN(l)||t.push(ca,a,hs,ft(ln(l)),Ia);break;case 6:!isNaN(l)&&1<=l&&t.push(ca,a,hs,ft(ln(l)),Ia);break;default:r.sanitizeURL&&(l=""+l),t.push(ca,a,hs,ft(ln(l)),Ia)}}else if(Ep(a)){switch(typeof l){case"function":case"symbol":return;case"boolean":if(r=a.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-")return}t.push(ca,ft(a),hs,ft(ln(l)),Ia)}}}var ua=ye(">"),Wh=ye("/>");function io(t,r,a){if(r!=null){if(a!=null)throw Error(ut(60));if(typeof r!="object"||!("__html"in r))throw Error(ut(61));r=r.__html,r!=null&&t.push(ft(""+r))}}function Rw(t){var r="";return kp.Children.forEach(t,function(a){a!=null&&(r+=a)}),r}var tc=ye(' selected=""');function nc(t,r,a,l){t.push(yr(a));var h=a=null,o;for(o in r)if(kn.call(r,o)){var c=r[o];if(c!=null)switch(o){case"children":a=c;break;case"dangerouslySetInnerHTML":h=c;break;default:Hn(t,l,o,c)}}return t.push(ua),io(t,h,a),typeof a=="string"?(t.push(ft(ln(a))),null):a}var rc=ye(`
`),$w=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,Yh=new Map;function yr(t){var r=Yh.get(t);if(r===void 0){if(!$w.test(t))throw Error(ut(65,t));r=ye("<"+t),Yh.set(t,r)}return r}var Ow=ye("<!DOCTYPE html>");function Bw(t,r,a,l,h){switch(r){case"select":t.push(yr("select"));var o=null,c=null;for(y in a)if(kn.call(a,y)){var d=a[y];if(d!=null)switch(y){case"children":o=d;break;case"dangerouslySetInnerHTML":c=d;break;case"defaultValue":case"value":break;default:Hn(t,l,y,d)}}return t.push(ua),io(t,c,o),o;case"option":c=h.selectedValue,t.push(yr("option"));var f=d=null,m=null,y=null;for(o in a)if(kn.call(a,o)){var _=a[o];if(_!=null)switch(o){case"children":d=_;break;case"selected":m=_;break;case"dangerouslySetInnerHTML":y=_;break;case"value":f=_;default:Hn(t,l,o,_)}}if(c!=null)if(a=f!==null?""+f:Rw(d),vc(c)){for(l=0;l<c.length;l++)if(""+c[l]===a){t.push(tc);break}}else""+c===a&&t.push(tc);else m&&t.push(tc);return t.push(ua),io(t,y,d),d;case"textarea":t.push(yr("textarea")),y=c=o=null;for(d in a)if(kn.call(a,d)&&(f=a[d],f!=null))switch(d){case"children":y=f;break;case"value":o=f;break;case"defaultValue":c=f;break;case"dangerouslySetInnerHTML":throw Error(ut(91));default:Hn(t,l,d,f)}if(o===null&&c!==null&&(o=c),t.push(ua),y!=null){if(o!=null)throw Error(ut(92));if(vc(y)&&1<y.length)throw Error(ut(93));o=""+y}return typeof o=="string"&&o[0]===`
`&&t.push(rc),o!==null&&t.push(ft(ln(""+o))),null;case"input":t.push(yr("input")),f=y=d=o=null;for(c in a)if(kn.call(a,c)&&(m=a[c],m!=null))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(ut(399,"input"));case"defaultChecked":f=m;break;case"defaultValue":d=m;break;case"checked":y=m;break;case"value":o=m;break;default:Hn(t,l,c,m)}return y!==null?Hn(t,l,"checked",y):f!==null&&Hn(t,l,"checked",f),o!==null?Hn(t,l,"value",o):d!==null&&Hn(t,l,"value",d),t.push(Wh),null;case"menuitem":t.push(yr("menuitem"));for(var S in a)if(kn.call(a,S)&&(o=a[S],o!=null))switch(S){case"children":case"dangerouslySetInnerHTML":throw Error(ut(400));default:Hn(t,l,S,o)}return t.push(ua),null;case"title":t.push(yr("title")),o=null;for(_ in a)if(kn.call(a,_)&&(c=a[_],c!=null))switch(_){case"children":o=c;break;case"dangerouslySetInnerHTML":throw Error(ut(434));default:Hn(t,l,_,c)}return t.push(ua),o;case"listing":case"pre":t.push(yr(r)),c=o=null;for(f in a)if(kn.call(a,f)&&(d=a[f],d!=null))switch(f){case"children":o=d;break;case"dangerouslySetInnerHTML":c=d;break;default:Hn(t,l,f,d)}if(t.push(ua),c!=null){if(o!=null)throw Error(ut(60));if(typeof c!="object"||!("__html"in c))throw Error(ut(61));a=c.__html,a!=null&&(typeof a=="string"&&0<a.length&&a[0]===`
`?t.push(rc,ft(a)):t.push(ft(""+a)))}return typeof o=="string"&&o[0]===`
`&&t.push(rc),o;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":t.push(yr(r));for(var b in a)if(kn.call(a,b)&&(o=a[b],o!=null))switch(b){case"children":case"dangerouslySetInnerHTML":throw Error(ut(399,r));default:Hn(t,l,b,o)}return t.push(Wh),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return nc(t,a,r,l);case"html":return h.insertionMode===0&&t.push(Ow),nc(t,a,r,l);default:if(r.indexOf("-")===-1&&typeof a.is!="string")return nc(t,a,r,l);t.push(yr(r)),c=o=null;for(m in a)if(kn.call(a,m)&&(d=a[m],d!=null))switch(m){case"children":o=d;break;case"dangerouslySetInnerHTML":c=d;break;case"style":Ap(t,l,d);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:Ep(m)&&typeof d!="function"&&typeof d!="symbol"&&t.push(ca,ft(m),hs,ft(ln(d)),Ia)}return t.push(ua),io(t,c,o),o}}var Nw=ye("</"),Hw=ye(">"),Gw=ye('<template id="'),Uw=ye('"></template>'),Vw=ye("<!--$-->"),Zw=ye('<!--$?--><template id="'),Ww=ye('"></template>'),Yw=ye("<!--$!-->"),qw=ye("<!--/$-->"),Xw=ye("<template"),Kw=ye('"'),Jw=ye(' data-dgst="');ye(' data-msg="');ye(' data-stck="');var Qw=ye("></template>");function qh(t,r,a){if(ze(t,Zw),a===null)throw Error(ut(395));return ze(t,a),Gt(t,Ww)}var eb=ye('<div hidden id="'),tb=ye('">'),nb=ye("</div>"),rb=ye('<svg aria-hidden="true" style="display:none" id="'),ab=ye('">'),sb=ye("</svg>"),ib=ye('<math aria-hidden="true" style="display:none" id="'),ob=ye('">'),lb=ye("</math>"),cb=ye('<table hidden id="'),ub=ye('">'),db=ye("</table>"),hb=ye('<table hidden><tbody id="'),fb=ye('">'),pb=ye("</tbody></table>"),gb=ye('<table hidden><tr id="'),mb=ye('">'),xb=ye("</tr></table>"),vb=ye('<table hidden><colgroup id="'),_b=ye('">'),yb=ye("</colgroup></table>");function Cb(t,r,a,l){switch(a.insertionMode){case 0:case 1:return ze(t,eb),ze(t,r.segmentPrefix),ze(t,ft(l.toString(16))),Gt(t,tb);case 2:return ze(t,rb),ze(t,r.segmentPrefix),ze(t,ft(l.toString(16))),Gt(t,ab);case 3:return ze(t,ib),ze(t,r.segmentPrefix),ze(t,ft(l.toString(16))),Gt(t,ob);case 4:return ze(t,cb),ze(t,r.segmentPrefix),ze(t,ft(l.toString(16))),Gt(t,ub);case 5:return ze(t,hb),ze(t,r.segmentPrefix),ze(t,ft(l.toString(16))),Gt(t,fb);case 6:return ze(t,gb),ze(t,r.segmentPrefix),ze(t,ft(l.toString(16))),Gt(t,mb);case 7:return ze(t,vb),ze(t,r.segmentPrefix),ze(t,ft(l.toString(16))),Gt(t,_b);default:throw Error(ut(397))}}function wb(t,r){switch(r.insertionMode){case 0:case 1:return Gt(t,nb);case 2:return Gt(t,sb);case 3:return Gt(t,lb);case 4:return Gt(t,db);case 5:return Gt(t,pb);case 6:return Gt(t,xb);case 7:return Gt(t,yb);default:throw Error(ut(397))}}var bb=ye('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("'),Sb=ye('$RS("'),jb=ye('","'),Lb=ye('")<\/script>'),kb=ye('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("'),Mb=ye('$RC("'),Ib=ye('","'),Eb=ye('")<\/script>'),Ab=ye('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("'),Pb=ye('$RX("'),Tb=ye('"'),zb=ye(")<\/script>"),ac=ye(","),Fb=/[<\u2028\u2029]/g;function sc(t){return JSON.stringify(t).replace(Fb,function(r){switch(r){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var Hs=Object.assign,Db=Symbol.for("react.element"),Pp=Symbol.for("react.portal"),Tp=Symbol.for("react.fragment"),zp=Symbol.for("react.strict_mode"),Fp=Symbol.for("react.profiler"),Dp=Symbol.for("react.provider"),Rp=Symbol.for("react.context"),$p=Symbol.for("react.forward_ref"),Op=Symbol.for("react.suspense"),Bp=Symbol.for("react.suspense_list"),Np=Symbol.for("react.memo"),qc=Symbol.for("react.lazy"),Rb=Symbol.for("react.scope"),$b=Symbol.for("react.debug_trace_mode"),Ob=Symbol.for("react.legacy_hidden"),Bb=Symbol.for("react.default_value"),Xh=Symbol.iterator;function _c(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Tp:return"Fragment";case Pp:return"Portal";case Fp:return"Profiler";case zp:return"StrictMode";case Op:return"Suspense";case Bp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Rp:return(t.displayName||"Context")+".Consumer";case Dp:return(t._context.displayName||"Context")+".Provider";case $p:var r=t.render;return t=t.displayName,t||(t=r.displayName||r.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Np:return r=t.displayName||null,r!==null?r:_c(t.type)||"Memo";case qc:r=t._payload,t=t._init;try{return _c(t(r))}catch{}}return null}var Hp={};function Kh(t,r){if(t=t.contextTypes,!t)return Hp;var a={},l;for(l in t)a[l]=r[l];return a}var Da=null;function Do(t,r){if(t!==r){t.context._currentValue=t.parentValue,t=t.parent;var a=r.parent;if(t===null){if(a!==null)throw Error(ut(401))}else{if(a===null)throw Error(ut(401));Do(t,a)}r.context._currentValue=r.value}}function Gp(t){t.context._currentValue=t.parentValue,t=t.parent,t!==null&&Gp(t)}function Up(t){var r=t.parent;r!==null&&Up(r),t.context._currentValue=t.value}function Vp(t,r){if(t.context._currentValue=t.parentValue,t=t.parent,t===null)throw Error(ut(402));t.depth===r.depth?Do(t,r):Vp(t,r)}function Zp(t,r){var a=r.parent;if(a===null)throw Error(ut(402));t.depth===a.depth?Do(t,a):Zp(t,a),r.context._currentValue=r.value}function jo(t){var r=Da;r!==t&&(r===null?Up(t):t===null?Gp(r):r.depth===t.depth?Do(r,t):r.depth>t.depth?Vp(r,t):Zp(r,t),Da=t)}var Jh={isMounted:function(){return!1},enqueueSetState:function(t,r){t=t._reactInternals,t.queue!==null&&t.queue.push(r)},enqueueReplaceState:function(t,r){t=t._reactInternals,t.replace=!0,t.queue=[r]},enqueueForceUpdate:function(){}};function Qh(t,r,a,l){var h=t.state!==void 0?t.state:null;t.updater=Jh,t.props=a,t.state=h;var o={queue:[],replace:!1};t._reactInternals=o;var c=r.contextType;if(t.context=typeof c=="object"&&c!==null?c._currentValue:l,c=r.getDerivedStateFromProps,typeof c=="function"&&(c=c(a,h),h=c==null?h:Hs({},h,c),t.state=h),typeof r.getDerivedStateFromProps!="function"&&typeof t.getSnapshotBeforeUpdate!="function"&&(typeof t.UNSAFE_componentWillMount=="function"||typeof t.componentWillMount=="function"))if(r=t.state,typeof t.componentWillMount=="function"&&t.componentWillMount(),typeof t.UNSAFE_componentWillMount=="function"&&t.UNSAFE_componentWillMount(),r!==t.state&&Jh.enqueueReplaceState(t,t.state,null),o.queue!==null&&0<o.queue.length)if(r=o.queue,c=o.replace,o.queue=null,o.replace=!1,c&&r.length===1)t.state=r[0];else{for(o=c?r[0]:t.state,h=!0,c=c?1:0;c<r.length;c++){var d=r[c];d=typeof d=="function"?d.call(t,o,a,l):d,d!=null&&(h?(h=!1,o=Hs({},o,d)):Hs(o,d))}t.state=o}else o.queue=null}var Nb={id:1,overflow:""};function yc(t,r,a){var l=t.id;t=t.overflow;var h=32-oo(l)-1;l&=~(1<<h),a+=1;var o=32-oo(r)+h;if(30<o){var c=h-h%5;return o=(l&(1<<c)-1).toString(32),l>>=c,h-=c,{id:1<<32-oo(r)+h|a<<h|l,overflow:o+t}}return{id:1<<o|a<<h|l,overflow:t}}var oo=Math.clz32?Math.clz32:Ub,Hb=Math.log,Gb=Math.LN2;function Ub(t){return t>>>=0,t===0?32:31-(Hb(t)/Gb|0)|0}function Vb(t,r){return t===r&&(t!==0||1/t===1/r)||t!==t&&r!==r}var Zb=typeof Object.is=="function"?Object.is:Vb,Xr=null,Xc=null,lo=null,Ot=null,Os=!1,Lo=!1,Ws=0,fa=null,Ro=0;function Ea(){if(Xr===null)throw Error(ut(321));return Xr}function ef(){if(0<Ro)throw Error(ut(312));return{memoizedState:null,queue:null,next:null}}function Kc(){return Ot===null?lo===null?(Os=!1,lo=Ot=ef()):(Os=!0,Ot=lo):Ot.next===null?(Os=!1,Ot=Ot.next=ef()):(Os=!0,Ot=Ot.next),Ot}function Jc(){Xc=Xr=null,Lo=!1,lo=null,Ro=0,Ot=fa=null}function Wp(t,r){return typeof r=="function"?r(t):r}function tf(t,r,a){if(Xr=Ea(),Ot=Kc(),Os){var l=Ot.queue;if(r=l.dispatch,fa!==null&&(a=fa.get(l),a!==void 0)){fa.delete(l),l=Ot.memoizedState;do l=t(l,a.action),a=a.next;while(a!==null);return Ot.memoizedState=l,[l,r]}return[Ot.memoizedState,r]}return t=t===Wp?typeof r=="function"?r():r:a!==void 0?a(r):r,Ot.memoizedState=t,t=Ot.queue={last:null,dispatch:null},t=t.dispatch=Wb.bind(null,Xr,t),[Ot.memoizedState,t]}function nf(t,r){if(Xr=Ea(),Ot=Kc(),r=r===void 0?null:r,Ot!==null){var a=Ot.memoizedState;if(a!==null&&r!==null){var l=a[1];e:if(l===null)l=!1;else{for(var h=0;h<l.length&&h<r.length;h++)if(!Zb(r[h],l[h])){l=!1;break e}l=!0}if(l)return a[0]}}return t=t(),Ot.memoizedState=[t,r],t}function Wb(t,r,a){if(25<=Ro)throw Error(ut(301));if(t===Xr)if(Lo=!0,t={action:a,next:null},fa===null&&(fa=new Map),a=fa.get(r),a===void 0)fa.set(r,t);else{for(r=a;r.next!==null;)r=r.next;r.next=t}}function Yb(){throw Error(ut(394))}function Ki(){}var rf={readContext:function(t){return t._currentValue},useContext:function(t){return Ea(),t._currentValue},useMemo:nf,useReducer:tf,useRef:function(t){Xr=Ea(),Ot=Kc();var r=Ot.memoizedState;return r===null?(t={current:t},Ot.memoizedState=t):r},useState:function(t){return tf(Wp,t)},useInsertionEffect:Ki,useLayoutEffect:function(){},useCallback:function(t,r){return nf(function(){return t},r)},useImperativeHandle:Ki,useEffect:Ki,useDebugValue:Ki,useDeferredValue:function(t){return Ea(),t},useTransition:function(){return Ea(),[!1,Yb]},useId:function(){var t=Xc.treeContext,r=t.overflow;t=t.id,t=(t&~(1<<32-oo(t)-1)).toString(32)+r;var a=co;if(a===null)throw Error(ut(404));return r=Ws++,t=":"+a.idPrefix+"R"+t,0<r&&(t+="H"+r.toString(32)),t+":"},useMutableSource:function(t,r){return Ea(),r(t._source)},useSyncExternalStore:function(t,r,a){if(a===void 0)throw Error(ut(407));return a()}},co=null,ic=kp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function qb(t){return console.error(t),null}function Bs(){}function Xb(t,r,a,l,h,o,c,d,f){var m=[],y=new Set;return r={destination:null,responseState:r,progressiveChunkSize:l===void 0?12800:l,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:y,pingedTasks:m,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:h===void 0?qb:h,onAllReady:o===void 0?Bs:o,onShellReady:c===void 0?Bs:c,onShellError:d===void 0?Bs:d,onFatalError:f===void 0?Bs:f},a=ko(r,0,null,a,!1,!1),a.parentFlushed=!0,t=Qc(r,t,null,a,y,Hp,null,Nb),m.push(t),r}function Qc(t,r,a,l,h,o,c,d){t.allPendingTasks++,a===null?t.pendingRootTasks++:a.pendingTasks++;var f={node:r,ping:function(){var m=t.pingedTasks;m.push(f),m.length===1&&Xp(t)},blockedBoundary:a,blockedSegment:l,abortSet:h,legacyContext:o,context:c,treeContext:d};return h.add(f),f}function ko(t,r,a,l,h,o){return{status:0,id:-1,index:r,parentFlushed:!1,chunks:[],children:[],formatContext:l,boundary:a,lastPushedText:h,textEmbedded:o}}function Ys(t,r){if(t=t.onError(r),t!=null&&typeof t!="string")throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof t+'" instead');return t}function Mo(t,r){var a=t.onShellError;a(r),a=t.onFatalError,a(r),t.destination!==null?(t.status=2,Ip(t.destination,r)):(t.status=1,t.fatalError=r)}function af(t,r,a,l,h){for(Xr={},Xc=r,Ws=0,t=a(l,h);Lo;)Lo=!1,Ws=0,Ro+=1,Ot=null,t=a(l,h);return Jc(),t}function sf(t,r,a,l){var h=a.render(),o=l.childContextTypes;if(o!=null){var c=r.legacyContext;if(typeof a.getChildContext!="function")l=c;else{a=a.getChildContext();for(var d in a)if(!(d in o))throw Error(ut(108,_c(l)||"Unknown",d));l=Hs({},c,a)}r.legacyContext=l,Zn(t,r,h),r.legacyContext=c}else Zn(t,r,h)}function of(t,r){if(t&&t.defaultProps){r=Hs({},r),t=t.defaultProps;for(var a in t)r[a]===void 0&&(r[a]=t[a]);return r}return r}function Cc(t,r,a,l,h){if(typeof a=="function")if(a.prototype&&a.prototype.isReactComponent){h=Kh(a,r.legacyContext);var o=a.contextType;o=new a(l,typeof o=="object"&&o!==null?o._currentValue:h),Qh(o,a,l,h),sf(t,r,o,a)}else{o=Kh(a,r.legacyContext),h=af(t,r,a,l,o);var c=Ws!==0;if(typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0)Qh(h,a,l,o),sf(t,r,h,a);else if(c){l=r.treeContext,r.treeContext=yc(l,1,0);try{Zn(t,r,h)}finally{r.treeContext=l}}else Zn(t,r,h)}else if(typeof a=="string"){switch(h=r.blockedSegment,o=Bw(h.chunks,a,l,t.responseState,h.formatContext),h.lastPushedText=!1,c=h.formatContext,h.formatContext=zw(c,a,l),wc(t,r,o),h.formatContext=c,a){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:h.chunks.push(Nw,ft(a),Hw)}h.lastPushedText=!1}else{switch(a){case Ob:case $b:case zp:case Fp:case Tp:Zn(t,r,l.children);return;case Bp:Zn(t,r,l.children);return;case Rb:throw Error(ut(343));case Op:e:{a=r.blockedBoundary,h=r.blockedSegment,o=l.fallback,l=l.children,c=new Set;var d={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:c,errorDigest:null},f=ko(t,h.chunks.length,d,h.formatContext,!1,!1);h.children.push(f),h.lastPushedText=!1;var m=ko(t,0,null,h.formatContext,!1,!1);m.parentFlushed=!0,r.blockedBoundary=d,r.blockedSegment=m;try{if(wc(t,r,l),m.lastPushedText&&m.textEmbedded&&m.chunks.push(Yc),m.status=1,Io(d,m),d.pendingTasks===0)break e}catch(y){m.status=4,d.forceClientRender=!0,d.errorDigest=Ys(t,y)}finally{r.blockedBoundary=a,r.blockedSegment=h}r=Qc(t,o,a,f,c,r.legacyContext,r.context,r.treeContext),t.pingedTasks.push(r)}return}if(typeof a=="object"&&a!==null)switch(a.$$typeof){case $p:if(l=af(t,r,a.render,l,h),Ws!==0){a=r.treeContext,r.treeContext=yc(a,1,0);try{Zn(t,r,l)}finally{r.treeContext=a}}else Zn(t,r,l);return;case Np:a=a.type,l=of(a,l),Cc(t,r,a,l,h);return;case Dp:if(h=l.children,a=a._context,l=l.value,o=a._currentValue,a._currentValue=l,c=Da,Da=l={parent:c,depth:c===null?0:c.depth+1,context:a,parentValue:o,value:l},r.context=l,Zn(t,r,h),t=Da,t===null)throw Error(ut(403));l=t.parentValue,t.context._currentValue=l===Bb?t.context._defaultValue:l,t=Da=t.parent,r.context=t;return;case Rp:l=l.children,l=l(a._currentValue),Zn(t,r,l);return;case qc:h=a._init,a=h(a._payload),l=of(a,l),Cc(t,r,a,l,void 0);return}throw Error(ut(130,a==null?a:typeof a,""))}}function Zn(t,r,a){if(r.node=a,typeof a=="object"&&a!==null){switch(a.$$typeof){case Db:Cc(t,r,a.type,a.props,a.ref);return;case Pp:throw Error(ut(257));case qc:var l=a._init;a=l(a._payload),Zn(t,r,a);return}if(vc(a)){lf(t,r,a);return}if(a===null||typeof a!="object"?l=null:(l=Xh&&a[Xh]||a["@@iterator"],l=typeof l=="function"?l:null),l&&(l=l.call(a))){if(a=l.next(),!a.done){var h=[];do h.push(a.value),a=l.next();while(!a.done);lf(t,r,h)}return}throw t=Object.prototype.toString.call(a),Error(ut(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t))}typeof a=="string"?(l=r.blockedSegment,l.lastPushedText=Gh(r.blockedSegment.chunks,a,t.responseState,l.lastPushedText)):typeof a=="number"&&(l=r.blockedSegment,l.lastPushedText=Gh(r.blockedSegment.chunks,""+a,t.responseState,l.lastPushedText))}function lf(t,r,a){for(var l=a.length,h=0;h<l;h++){var o=r.treeContext;r.treeContext=yc(o,l,h);try{wc(t,r,a[h])}finally{r.treeContext=o}}}function wc(t,r,a){var l=r.blockedSegment.formatContext,h=r.legacyContext,o=r.context;try{return Zn(t,r,a)}catch(f){if(Jc(),typeof f=="object"&&f!==null&&typeof f.then=="function"){a=f;var c=r.blockedSegment,d=ko(t,c.chunks.length,null,c.formatContext,c.lastPushedText,!0);c.children.push(d),c.lastPushedText=!1,t=Qc(t,r.node,r.blockedBoundary,d,r.abortSet,r.legacyContext,r.context,r.treeContext).ping,a.then(t,t),r.blockedSegment.formatContext=l,r.legacyContext=h,r.context=o,jo(o)}else throw r.blockedSegment.formatContext=l,r.legacyContext=h,r.context=o,jo(o),f}}function Kb(t){var r=t.blockedBoundary;t=t.blockedSegment,t.status=3,qp(this,r,t)}function Yp(t,r,a){var l=t.blockedBoundary;t.blockedSegment.status=3,l===null?(r.allPendingTasks--,r.status!==2&&(r.status=2,r.destination!==null&&r.destination.close())):(l.pendingTasks--,l.forceClientRender||(l.forceClientRender=!0,t=a===void 0?Error(ut(432)):a,l.errorDigest=r.onError(t),l.parentFlushed&&r.clientRenderedBoundaries.push(l)),l.fallbackAbortableTasks.forEach(function(h){return Yp(h,r,a)}),l.fallbackAbortableTasks.clear(),r.allPendingTasks--,r.allPendingTasks===0&&(l=r.onAllReady,l()))}function Io(t,r){if(r.chunks.length===0&&r.children.length===1&&r.children[0].boundary===null){var a=r.children[0];a.id=r.id,a.parentFlushed=!0,a.status===1&&Io(t,a)}else t.completedSegments.push(r)}function qp(t,r,a){if(r===null){if(a.parentFlushed){if(t.completedRootSegment!==null)throw Error(ut(389));t.completedRootSegment=a}t.pendingRootTasks--,t.pendingRootTasks===0&&(t.onShellError=Bs,r=t.onShellReady,r())}else r.pendingTasks--,r.forceClientRender||(r.pendingTasks===0?(a.parentFlushed&&a.status===1&&Io(r,a),r.parentFlushed&&t.completedBoundaries.push(r),r.fallbackAbortableTasks.forEach(Kb,t),r.fallbackAbortableTasks.clear()):a.parentFlushed&&a.status===1&&(Io(r,a),r.completedSegments.length===1&&r.parentFlushed&&t.partialBoundaries.push(r)));t.allPendingTasks--,t.allPendingTasks===0&&(t=t.onAllReady,t())}function Xp(t){if(t.status!==2){var r=Da,a=ic.current;ic.current=rf;var l=co;co=t.responseState;try{var h=t.pingedTasks,o;for(o=0;o<h.length;o++){var c=h[o],d=t,f=c.blockedSegment;if(f.status===0){jo(c.context);try{Zn(d,c,c.node),f.lastPushedText&&f.textEmbedded&&f.chunks.push(Yc),c.abortSet.delete(c),f.status=1,qp(d,c.blockedBoundary,f)}catch(T){if(Jc(),typeof T=="object"&&T!==null&&typeof T.then=="function"){var m=c.ping;T.then(m,m)}else{c.abortSet.delete(c),f.status=4;var y=c.blockedBoundary,_=T,S=Ys(d,_);if(y===null?Mo(d,_):(y.pendingTasks--,y.forceClientRender||(y.forceClientRender=!0,y.errorDigest=S,y.parentFlushed&&d.clientRenderedBoundaries.push(y))),d.allPendingTasks--,d.allPendingTasks===0){var b=d.onAllReady;b()}}}finally{}}}h.splice(0,o),t.destination!==null&&eu(t,t.destination)}catch(T){Ys(t,T),Mo(t,T)}finally{co=l,ic.current=a,a===rf&&jo(r)}}}function Ji(t,r,a){switch(a.parentFlushed=!0,a.status){case 0:var l=a.id=t.nextSegmentId++;return a.lastPushedText=!1,a.textEmbedded=!1,t=t.responseState,ze(r,Gw),ze(r,t.placeholderPrefix),t=ft(l.toString(16)),ze(r,t),Gt(r,Uw);case 1:a.status=2;var h=!0;l=a.chunks;var o=0;a=a.children;for(var c=0;c<a.length;c++){for(h=a[c];o<h.index;o++)ze(r,l[o]);h=$o(t,r,h)}for(;o<l.length-1;o++)ze(r,l[o]);return o<l.length&&(h=Gt(r,l[o])),h;default:throw Error(ut(390))}}function $o(t,r,a){var l=a.boundary;if(l===null)return Ji(t,r,a);if(l.parentFlushed=!0,l.forceClientRender)l=l.errorDigest,Gt(r,Yw),ze(r,Xw),l&&(ze(r,Jw),ze(r,ft(ln(l))),ze(r,Kw)),Gt(r,Qw),Ji(t,r,a);else if(0<l.pendingTasks){l.rootSegmentID=t.nextSegmentId++,0<l.completedSegments.length&&t.partialBoundaries.push(l);var h=t.responseState,o=h.nextSuspenseID++;h=ye(h.boundaryPrefix+o.toString(16)),l=l.id=h,qh(r,t.responseState,l),Ji(t,r,a)}else if(l.byteSize>t.progressiveChunkSize)l.rootSegmentID=t.nextSegmentId++,t.completedBoundaries.push(l),qh(r,t.responseState,l.id),Ji(t,r,a);else{if(Gt(r,Vw),a=l.completedSegments,a.length!==1)throw Error(ut(391));$o(t,r,a[0])}return Gt(r,qw)}function cf(t,r,a){return Cb(r,t.responseState,a.formatContext,a.id),$o(t,r,a),wb(r,a.formatContext)}function uf(t,r,a){for(var l=a.completedSegments,h=0;h<l.length;h++)Kp(t,r,a,l[h]);if(l.length=0,t=t.responseState,l=a.id,a=a.rootSegmentID,ze(r,t.startInlineScript),t.sentCompleteBoundaryFunction?ze(r,Mb):(t.sentCompleteBoundaryFunction=!0,ze(r,kb)),l===null)throw Error(ut(395));return a=ft(a.toString(16)),ze(r,l),ze(r,Ib),ze(r,t.segmentPrefix),ze(r,a),Gt(r,Eb)}function Kp(t,r,a,l){if(l.status===2)return!0;var h=l.id;if(h===-1){if((l.id=a.rootSegmentID)===-1)throw Error(ut(392));return cf(t,r,l)}return cf(t,r,l),t=t.responseState,ze(r,t.startInlineScript),t.sentCompleteSegmentFunction?ze(r,Sb):(t.sentCompleteSegmentFunction=!0,ze(r,bb)),ze(r,t.segmentPrefix),h=ft(h.toString(16)),ze(r,h),ze(r,jb),ze(r,t.placeholderPrefix),ze(r,h),Gt(r,Lb)}function eu(t,r){Un=new Uint8Array(512),Vn=0;try{var a=t.completedRootSegment;if(a!==null&&t.pendingRootTasks===0){$o(t,r,a),t.completedRootSegment=null;var l=t.responseState.bootstrapChunks;for(a=0;a<l.length-1;a++)ze(r,l[a]);a<l.length&&Gt(r,l[a])}var h=t.clientRenderedBoundaries,o;for(o=0;o<h.length;o++){var c=h[o];l=r;var d=t.responseState,f=c.id,m=c.errorDigest,y=c.errorMessage,_=c.errorComponentStack;if(ze(l,d.startInlineScript),d.sentClientRenderFunction?ze(l,Pb):(d.sentClientRenderFunction=!0,ze(l,Ab)),f===null)throw Error(ut(395));ze(l,f),ze(l,Tb),(m||y||_)&&(ze(l,ac),ze(l,ft(sc(m||"")))),(y||_)&&(ze(l,ac),ze(l,ft(sc(y||"")))),_&&(ze(l,ac),ze(l,ft(sc(_)))),Gt(l,zb)}h.splice(0,o);var S=t.completedBoundaries;for(o=0;o<S.length;o++)uf(t,r,S[o]);S.splice(0,o),Oh(r),Un=new Uint8Array(512),Vn=0;var b=t.partialBoundaries;for(o=0;o<b.length;o++){var T=b[o];e:{h=t,c=r;var z=T.completedSegments;for(d=0;d<z.length;d++)if(!Kp(h,c,T,z[d])){d++,z.splice(0,d);var J=!1;break e}z.splice(0,d),J=!0}if(!J){t.destination=null,o++,b.splice(0,o);return}}b.splice(0,o);var F=t.completedBoundaries;for(o=0;o<F.length;o++)uf(t,r,F[o]);F.splice(0,o)}finally{Oh(r),t.allPendingTasks===0&&t.pingedTasks.length===0&&t.clientRenderedBoundaries.length===0&&t.completedBoundaries.length===0&&r.close()}}function df(t,r){try{var a=t.abortableTasks;a.forEach(function(l){return Yp(l,t,r)}),a.clear(),t.destination!==null&&eu(t,t.destination)}catch(l){Ys(t,l),Mo(t,l)}}Vc.renderToReadableStream=function(t,r){return new Promise(function(a,l){var h,o,c=new Promise(function(y,_){o=y,h=_}),d=Xb(t,Pw(r?r.identifierPrefix:void 0,r?r.nonce:void 0,r?r.bootstrapScriptContent:void 0,r?r.bootstrapScripts:void 0,r?r.bootstrapModules:void 0),Tw(r?r.namespaceURI:void 0),r?r.progressiveChunkSize:void 0,r?r.onError:void 0,o,function(){var y=new ReadableStream({type:"bytes",pull:function(_){if(d.status===1)d.status=2,Ip(_,d.fatalError);else if(d.status!==2&&d.destination===null){d.destination=_;try{eu(d,_)}catch(S){Ys(d,S),Mo(d,S)}}},cancel:function(){df(d)}},{highWaterMark:0});y.allReady=c,a(y)},function(y){c.catch(function(){}),l(y)},h);if(r&&r.signal){var f=r.signal,m=function(){df(d,f.reason),f.removeEventListener("abort",m)};f.addEventListener("abort",m)}Xp(d)})};Vc.version="18.3.1";var gs,Jp;gs=ps,Jp=Vc;Ba.version=gs.version;Ba.renderToString=gs.renderToString;Ba.renderToStaticMarkup=gs.renderToStaticMarkup;Ba.renderToNodeStream=gs.renderToNodeStream;Ba.renderToStaticNodeStream=gs.renderToStaticNodeStream;Ba.renderToReadableStream=Jp.renderToReadableStream;(function(){function t(r){return this instanceof t?(this._canvas=r=typeof r=="string"?document.getElementById(r):r,this._ctx=r.getContext("2d"),this._width=r.width,this._height=r.height,this._max=1,void this.clear()):new t(r)}t.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(r,a){return this._data=r,this},max:function(r){return this._max=r,this},add:function(r){return this._data.push(r),this},clear:function(){return this._data=[],this},radius:function(r,a){a=a||15;var l=this._circle=document.createElement("canvas"),h=l.getContext("2d"),o=this._r=r+a;return l.width=l.height=2*o,h.shadowOffsetX=h.shadowOffsetY=200,h.shadowBlur=a,h.shadowColor="black",h.beginPath(),h.arc(o-200,o-200,r,0,2*Math.PI,!0),h.closePath(),h.fill(),this},gradient:function(r){var a=document.createElement("canvas"),l=a.getContext("2d"),h=l.createLinearGradient(0,0,0,256);a.width=1,a.height=256;for(var o in r)h.addColorStop(o,r[o]);return l.fillStyle=h,l.fillRect(0,0,1,256),this._grad=l.getImageData(0,0,1,256).data,this},draw:function(r){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var a=this._ctx;a.clearRect(0,0,this._width,this._height);for(var l,h=0,o=this._data.length;o>h;h++)l=this._data[h],a.globalAlpha=Math.max(l[2]/this._max,r||.05),a.drawImage(this._circle,l[0]-this._r,l[1]-this._r);var c=a.getImageData(0,0,this._width,this._height);return this._colorize(c.data,this._grad),a.putImageData(c,0,0),this},_colorize:function(r,a){for(var l,h=3,o=r.length;o>h;h+=4)l=4*r[h],l&&(r[h-3]=a[l],r[h-2]=a[l+1],r[h-1]=a[l+2])}},window.simpleheat=t})(),L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t,r){this._latlngs=t,L.setOptions(this,r)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return L.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),r=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);t.style[r]="50% 50%";var a=this._map.getSize();t.width=a.x,t.height=a.y;var l=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,"leaflet-zoom-"+(l?"animated":"hide")),this._heat=simpleheat(t),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var r=this._map.getSize();this._heat._width!==r.x&&(this._canvas.width=this._heat._width=r.x),this._heat._height!==r.y&&(this._canvas.height=this._heat._height=r.y),this._redraw()},_redraw:function(){var t,r,a,l,h,o,c,d,f,m=[],y=this._heat._r,_=this._map.getSize(),S=new L.Bounds(L.point([-y,-y]),_.add([y,y])),b=this.options.max===void 0?1:this.options.max,T=this.options.maxZoom===void 0?this._map.getMaxZoom():this.options.maxZoom,z=1/Math.pow(2,Math.max(0,Math.min(T-this._map.getZoom(),12))),J=y/2,F=[],te=this._map._getMapPanePos(),re=te.x%J,O=te.y%J;for(t=0,r=this._latlngs.length;r>t;t++)if(a=this._map.latLngToContainerPoint(this._latlngs[t]),S.contains(a)){h=Math.floor((a.x-re)/J)+2,o=Math.floor((a.y-O)/J)+2;var ce=this._latlngs[t].alt!==void 0?this._latlngs[t].alt:this._latlngs[t][2]!==void 0?+this._latlngs[t][2]:1;f=ce*z,F[o]=F[o]||[],l=F[o][h],l?(l[0]=(l[0]*l[2]+a.x*f)/(l[2]+f),l[1]=(l[1]*l[2]+a.y*f)/(l[2]+f),l[2]+=f):F[o][h]=[a.x,a.y,f]}for(t=0,r=F.length;r>t;t++)if(F[t])for(c=0,d=F[t].length;d>c;c++)l=F[t][c],l&&m.push([Math.round(l[0]),Math.round(l[1]),Math.min(l[2],b)]);this._heat.data(m).draw(this.options.minOpacity),this._frame=null},_animateZoom:function(t){var r=this._map.getZoomScale(t.zoom),a=this._map._getCenterOffset(t.center)._multiplyBy(-r).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,a,r):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a)+" scale("+r+")"}}),L.heatLayer=function(t,r){return new L.HeatLayer(t,r)};const Jb=({points:t,options:r})=>{const a=mo(),[l,h]=g.useState(!1);return g.useEffect(()=>{if(!a)return;const o=()=>{const c=a.getContainer();c&&c.clientWidth>0&&c.clientHeight>0&&(h(!0),a.off("resize",o))};return o(),a.on("resize",o),()=>{a.off("resize",o)}},[a]),g.useEffect(()=>{if(!(!l||!a))try{const o=an.heatLayer(t,r).addTo(a);return()=>{a.removeLayer(o)}}catch(o){console.error("Error creating heatmap layer:",o)}},[a,t,r,l]),null};var hf={exports:{}};(function(t,r){(function(a,l){l(r)})(us,function(a){var l=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(o){L.Util.setOptions(this,o),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var c=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,c?this._withAnimation:this._noAnimation),this._markerCluster=c?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(o){if(o instanceof L.LayerGroup)return this.addLayers([o]);if(!o.getLatLng)return this._nonPointGroup.addLayer(o),this.fire("layeradd",{layer:o}),this;if(!this._map)return this._needsClustering.push(o),this.fire("layeradd",{layer:o}),this;if(this.hasLayer(o))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(o,this._maxZoom),this.fire("layeradd",{layer:o}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var c=o,d=this._zoom;if(o.__parent)for(;c.__parent._zoom>=d;)c=c.__parent;return this._currentShownBounds.contains(c.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(o,c):this._animationAddLayerNonAnimated(o,c)),this},removeLayer:function(o){return o instanceof L.LayerGroup?this.removeLayers([o]):o.getLatLng?this._map?o.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(o)),this._removeLayer(o,!0),this.fire("layerremove",{layer:o}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),o.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(o)&&(this._featureGroup.removeLayer(o),o.clusterShow&&o.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,o)&&this.hasLayer(o)&&this._needsRemoving.push({layer:o,latlng:o._latlng}),this.fire("layerremove",{layer:o}),this):(this._nonPointGroup.removeLayer(o),this.fire("layerremove",{layer:o}),this)},addLayers:function(o,c){if(!L.Util.isArray(o))return this.addLayer(o);var d=this._featureGroup,f=this._nonPointGroup,m=this.options.chunkedLoading,y=this.options.chunkInterval,_=this.options.chunkProgress,S=o.length,b=0,T=!0,z;if(this._map){var J=new Date().getTime(),F=L.bind(function(){var re=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();b<S;b++){if(m&&b%200===0){var O=new Date().getTime()-re;if(O>y)break}if(z=o[b],z instanceof L.LayerGroup){T&&(o=o.slice(),T=!1),this._extractNonGroupLayers(z,o),S=o.length;continue}if(!z.getLatLng){f.addLayer(z),c||this.fire("layeradd",{layer:z});continue}if(!this.hasLayer(z)&&(this._addLayer(z,this._maxZoom),c||this.fire("layeradd",{layer:z}),z.__parent&&z.__parent.getChildCount()===2)){var ce=z.__parent.getAllChildMarkers(),xe=ce[0]===z?ce[1]:ce[0];d.removeLayer(xe)}}_&&_(b,S,new Date().getTime()-J),b===S?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(F,this.options.chunkDelay)},this);F()}else for(var te=this._needsClustering;b<S;b++){if(z=o[b],z instanceof L.LayerGroup){T&&(o=o.slice(),T=!1),this._extractNonGroupLayers(z,o),S=o.length;continue}if(!z.getLatLng){f.addLayer(z);continue}this.hasLayer(z)||te.push(z)}return this},removeLayers:function(o){var c,d,f=o.length,m=this._featureGroup,y=this._nonPointGroup,_=!0;if(!this._map){for(c=0;c<f;c++){if(d=o[c],d instanceof L.LayerGroup){_&&(o=o.slice(),_=!1),this._extractNonGroupLayers(d,o),f=o.length;continue}this._arraySplice(this._needsClustering,d),y.removeLayer(d),this.hasLayer(d)&&this._needsRemoving.push({layer:d,latlng:d._latlng}),this.fire("layerremove",{layer:d})}return this}if(this._unspiderfy){this._unspiderfy();var S=o.slice(),b=f;for(c=0;c<b;c++){if(d=S[c],d instanceof L.LayerGroup){this._extractNonGroupLayers(d,S),b=S.length;continue}this._unspiderfyLayer(d)}}for(c=0;c<f;c++){if(d=o[c],d instanceof L.LayerGroup){_&&(o=o.slice(),_=!1),this._extractNonGroupLayers(d,o),f=o.length;continue}if(!d.__parent){y.removeLayer(d),this.fire("layerremove",{layer:d});continue}this._removeLayer(d,!0,!0),this.fire("layerremove",{layer:d}),m.hasLayer(d)&&(m.removeLayer(d),d.clusterShow&&d.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(o){o.off(this._childMarkerEventHandlers,this),delete o.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var o=new L.LatLngBounds;this._topClusterLevel&&o.extend(this._topClusterLevel._bounds);for(var c=this._needsClustering.length-1;c>=0;c--)o.extend(this._needsClustering[c].getLatLng());return o.extend(this._nonPointGroup.getBounds()),o},eachLayer:function(o,c){var d=this._needsClustering.slice(),f=this._needsRemoving,m,y,_;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(d),y=d.length-1;y>=0;y--){for(m=!0,_=f.length-1;_>=0;_--)if(f[_].layer===d[y]){m=!1;break}m&&o.call(c,d[y])}this._nonPointGroup.eachLayer(o,c)},getLayers:function(){var o=[];return this.eachLayer(function(c){o.push(c)}),o},getLayer:function(o){var c=null;return o=parseInt(o,10),this.eachLayer(function(d){L.stamp(d)===o&&(c=d)}),c},hasLayer:function(o){if(!o)return!1;var c,d=this._needsClustering;for(c=d.length-1;c>=0;c--)if(d[c]===o)return!0;for(d=this._needsRemoving,c=d.length-1;c>=0;c--)if(d[c].layer===o)return!1;return!!(o.__parent&&o.__parent._group===this)||this._nonPointGroup.hasLayer(o)},zoomToShowLayer:function(o,c){var d=this._map;typeof c!="function"&&(c=function(){});var f=function(){(d.hasLayer(o)||d.hasLayer(o.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",f,this),this.off("animationend",f,this),d.hasLayer(o)?c():o.__parent._icon&&(this.once("spiderfied",c,this),o.__parent.spiderfy()))};o._icon&&this._map.getBounds().contains(o.getLatLng())?c():o.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",f,this),this._map.panTo(o.getLatLng())):(this._map.on("moveend",f,this),this.on("animationend",f,this),o.__parent.zoomToBounds())},onAdd:function(o){this._map=o;var c,d,f;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(o),this._nonPointGroup.addTo(o),this._gridClusters||this._generateInitialClusters(),this._maxLat=o.options.crs.projection.MAX_LATITUDE,c=0,d=this._needsRemoving.length;c<d;c++)f=this._needsRemoving[c],f.newlatlng=f.layer._latlng,f.layer._latlng=f.latlng;for(c=0,d=this._needsRemoving.length;c<d;c++)f=this._needsRemoving[c],this._removeLayer(f.layer,!0),f.layer._latlng=f.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),d=this._needsClustering,this._needsClustering=[],this.addLayers(d,!0)},onRemove:function(o){o.off("zoomend",this._zoomEnd,this),o.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(o){for(var c=o;c&&!c._icon;)c=c.__parent;return c||null},_arraySplice:function(o,c){for(var d=o.length-1;d>=0;d--)if(o[d]===c)return o.splice(d,1),!0},_removeFromGridUnclustered:function(o,c){for(var d=this._map,f=this._gridUnclustered,m=Math.floor(this._map.getMinZoom());c>=m&&f[c].removeObject(o,d.project(o.getLatLng(),c));c--);},_childMarkerDragStart:function(o){o.target.__dragStart=o.target._latlng},_childMarkerMoved:function(o){if(!this._ignoreMove&&!o.target.__dragStart){var c=o.target._popup&&o.target._popup.isOpen();this._moveChild(o.target,o.oldLatLng,o.latlng),c&&o.target.openPopup()}},_moveChild:function(o,c,d){o._latlng=c,this.removeLayer(o),o._latlng=d,this.addLayer(o)},_childMarkerDragEnd:function(o){var c=o.target.__dragStart;delete o.target.__dragStart,c&&this._moveChild(o.target,c,o.target._latlng)},_removeLayer:function(o,c,d){var f=this._gridClusters,m=this._gridUnclustered,y=this._featureGroup,_=this._map,S=Math.floor(this._map.getMinZoom());c&&this._removeFromGridUnclustered(o,this._maxZoom);var b=o.__parent,T=b._markers,z;for(this._arraySplice(T,o);b&&(b._childCount--,b._boundsNeedUpdate=!0,!(b._zoom<S));)c&&b._childCount<=1?(z=b._markers[0]===o?b._markers[1]:b._markers[0],f[b._zoom].removeObject(b,_.project(b._cLatLng,b._zoom)),m[b._zoom].addObject(z,_.project(z.getLatLng(),b._zoom)),this._arraySplice(b.__parent._childClusters,b),b.__parent._markers.push(z),z.__parent=b.__parent,b._icon&&(y.removeLayer(b),d||y.addLayer(z))):b._iconNeedsUpdate=!0,b=b.__parent;delete o.__parent},_isOrIsParent:function(o,c){for(;c;){if(o===c)return!0;c=c.parentNode}return!1},fire:function(o,c,d){if(c&&c.layer instanceof L.MarkerCluster){if(c.originalEvent&&this._isOrIsParent(c.layer._icon,c.originalEvent.relatedTarget))return;o="cluster"+o}L.FeatureGroup.prototype.fire.call(this,o,c,d)},listens:function(o,c){return L.FeatureGroup.prototype.listens.call(this,o,c)||L.FeatureGroup.prototype.listens.call(this,"cluster"+o,c)},_defaultIconCreateFunction:function(o){var c=o.getChildCount(),d=" marker-cluster-";return c<10?d+="small":c<100?d+="medium":d+="large",new L.DivIcon({html:"<div><span>"+c+"</span></div>",className:"marker-cluster"+d,iconSize:new L.Point(40,40)})},_bindEvents:function(){var o=this._map,c=this.options.spiderfyOnMaxZoom,d=this.options.showCoverageOnHover,f=this.options.zoomToBoundsOnClick,m=this.options.spiderfyOnEveryZoom;(c||f||m)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),d&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),o.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(o){var c=o.layer,d=c;if(!(o.type==="clusterkeypress"&&o.originalEvent&&o.originalEvent.keyCode!==13)){for(;d._childClusters.length===1;)d=d._childClusters[0];d._zoom===this._maxZoom&&d._childCount===c._childCount&&this.options.spiderfyOnMaxZoom?c.spiderfy():this.options.zoomToBoundsOnClick&&c.zoomToBounds(),this.options.spiderfyOnEveryZoom&&c.spiderfy(),o.originalEvent&&o.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(o){var c=this._map;this._inZoomAnimation||(this._shownPolygon&&c.removeLayer(this._shownPolygon),o.layer.getChildCount()>2&&o.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(o.layer.getConvexHull(),this.options.polygonOptions),c.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var o=this.options.spiderfyOnMaxZoom,c=this.options.showCoverageOnHover,d=this.options.zoomToBoundsOnClick,f=this.options.spiderfyOnEveryZoom,m=this._map;(o||d||f)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),c&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),m.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var o=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,o),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),o),this._currentShownBounds=o}},_generateInitialClusters:function(){var o=Math.ceil(this._map.getMaxZoom()),c=Math.floor(this._map.getMinZoom()),d=this.options.maxClusterRadius,f=d;typeof d!="function"&&(f=function(){return d}),this.options.disableClusteringAtZoom!==null&&(o=this.options.disableClusteringAtZoom-1),this._maxZoom=o,this._gridClusters={},this._gridUnclustered={};for(var m=o;m>=c;m--)this._gridClusters[m]=new L.DistanceGrid(f(m)),this._gridUnclustered[m]=new L.DistanceGrid(f(m));this._topClusterLevel=new this._markerCluster(this,c-1)},_addLayer:function(o,c){var d=this._gridClusters,f=this._gridUnclustered,m=Math.floor(this._map.getMinZoom()),y,_;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(o),o.on(this._childMarkerEventHandlers,this);c>=m;c--){y=this._map.project(o.getLatLng(),c);var S=d[c].getNearObject(y);if(S){S._addChild(o),o.__parent=S;return}if(S=f[c].getNearObject(y),S){var b=S.__parent;b&&this._removeLayer(S,!1);var T=new this._markerCluster(this,c,S,o);d[c].addObject(T,this._map.project(T._cLatLng,c)),S.__parent=T,o.__parent=T;var z=T;for(_=c-1;_>b._zoom;_--)z=new this._markerCluster(this,_,z),d[_].addObject(z,this._map.project(S.getLatLng(),_));b._addChild(z),this._removeFromGridUnclustered(S,c);return}f[c].addObject(o,y)}this._topClusterLevel._addChild(o),o.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(o){o instanceof L.MarkerCluster&&o._iconNeedsUpdate&&o._updateIcon()})},_enqueue:function(o){this._queue.push(o),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var o=0;o<this._queue.length;o++)this._queue[o].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var o=Math.round(this._map._zoom);this._processQueue(),this._zoom<o&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,o)):this._zoom>o?(this._animationStart(),this._animationZoomOut(this._zoom,o)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(o){var c=this._maxLat;return c!==void 0&&(o.getNorth()>=c&&(o._northEast.lat=1/0),o.getSouth()<=-c&&(o._southWest.lat=-1/0)),o},_animationAddLayerNonAnimated:function(o,c){if(c===o)this._featureGroup.addLayer(o);else if(c._childCount===2){c._addToMap();var d=c.getAllChildMarkers();this._featureGroup.removeLayer(d[0]),this._featureGroup.removeLayer(d[1])}else c._updateIcon()},_extractNonGroupLayers:function(o,c){var d=o.getLayers(),f=0,m;for(c=c||[];f<d.length;f++){if(m=d[f],m instanceof L.LayerGroup){this._extractNonGroupLayers(m,c);continue}c.push(m)}return c},_overrideMarkerIcon:function(o){var c=o.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[o]}});return c}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(o,c){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),o),this._topClusterLevel._recursivelyAddChildrenToMap(null,c,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(o,c){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),o),this._topClusterLevel._recursivelyAddChildrenToMap(null,c,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(o,c){this._animationAddLayerNonAnimated(o,c)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(o,c){var d=this._getExpandedVisibleBounds(),f=this._featureGroup,m=Math.floor(this._map.getMinZoom()),y;this._ignoreMove=!0,this._topClusterLevel._recursively(d,o,m,function(_){var S=_._latlng,b=_._markers,T;for(d.contains(S)||(S=null),_._isSingleParent()&&o+1===c?(f.removeLayer(_),_._recursivelyAddChildrenToMap(null,c,d)):(_.clusterHide(),_._recursivelyAddChildrenToMap(S,c,d)),y=b.length-1;y>=0;y--)T=b[y],d.contains(T._latlng)||f.removeLayer(T)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(d,c),f.eachLayer(function(_){!(_ instanceof L.MarkerCluster)&&_._icon&&_.clusterShow()}),this._topClusterLevel._recursively(d,o,c,function(_){_._recursivelyRestoreChildPositions(c)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(d,o,m,function(_){f.removeLayer(_),_.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(o,c){this._animationZoomOutSingle(this._topClusterLevel,o-1,c),this._topClusterLevel._recursivelyAddChildrenToMap(null,c,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),o,this._getExpandedVisibleBounds())},_animationAddLayer:function(o,c){var d=this,f=this._featureGroup;f.addLayer(o),c!==o&&(c._childCount>2?(c._updateIcon(),this._forceLayout(),this._animationStart(),o._setPos(this._map.latLngToLayerPoint(c.getLatLng())),o.clusterHide(),this._enqueue(function(){f.removeLayer(o),o.clusterShow(),d._animationEnd()})):(this._forceLayout(),d._animationStart(),d._animationZoomOutSingle(c,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(o,c,d){var f=this._getExpandedVisibleBounds(),m=Math.floor(this._map.getMinZoom());o._recursivelyAnimateChildrenInAndAddSelfToMap(f,m,c+1,d);var y=this;this._forceLayout(),o._recursivelyBecomeVisible(f,d),this._enqueue(function(){if(o._childCount===1){var _=o._markers[0];this._ignoreMove=!0,_.setLatLng(_.getLatLng()),this._ignoreMove=!1,_.clusterShow&&_.clusterShow()}else o._recursively(f,d,m,function(S){S._recursivelyRemoveChildrenFromMap(f,m,c+1)});y._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(o){return new L.MarkerClusterGroup(o)};var h=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(o,c,d,f){L.Marker.prototype.initialize.call(this,d?d._cLatLng||d.getLatLng():new L.LatLng(0,0),{icon:this,pane:o.options.clusterPane}),this._group=o,this._zoom=c,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,d&&this._addChild(d),f&&this._addChild(f)},getAllChildMarkers:function(o,c){o=o||[];for(var d=this._childClusters.length-1;d>=0;d--)this._childClusters[d].getAllChildMarkers(o,c);for(var f=this._markers.length-1;f>=0;f--)c&&this._markers[f].__dragStart||o.push(this._markers[f]);return o},getChildCount:function(){return this._childCount},zoomToBounds:function(o){for(var c=this._childClusters.slice(),d=this._group._map,f=d.getBoundsZoom(this._bounds),m=this._zoom+1,y=d.getZoom(),_;c.length>0&&f>m;){m++;var S=[];for(_=0;_<c.length;_++)S=S.concat(c[_]._childClusters);c=S}f>m?this._group._map.setView(this._latlng,m):f<=y?this._group._map.setView(this._latlng,y+1):this._group._map.fitBounds(this._bounds,o)},getBounds:function(){var o=new L.LatLngBounds;return o.extend(this._bounds),o},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(o,c){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(o),o instanceof L.MarkerCluster?(c||(this._childClusters.push(o),o.__parent=this),this._childCount+=o._childCount):(c||this._markers.push(o),this._childCount++),this.__parent&&this.__parent._addChild(o,!0)},_setClusterCenter:function(o){this._cLatLng||(this._cLatLng=o._cLatLng||o._latlng)},_resetBounds:function(){var o=this._bounds;o._southWest&&(o._southWest.lat=1/0,o._southWest.lng=1/0),o._northEast&&(o._northEast.lat=-1/0,o._northEast.lng=-1/0)},_recalculateBounds:function(){var o=this._markers,c=this._childClusters,d=0,f=0,m=this._childCount,y,_,S,b;if(m!==0){for(this._resetBounds(),y=0;y<o.length;y++)S=o[y]._latlng,this._bounds.extend(S),d+=S.lat,f+=S.lng;for(y=0;y<c.length;y++)_=c[y],_._boundsNeedUpdate&&_._recalculateBounds(),this._bounds.extend(_._bounds),S=_._wLatLng,b=_._childCount,d+=S.lat*b,f+=S.lng*b;this._latlng=this._wLatLng=new L.LatLng(d/m,f/m),this._boundsNeedUpdate=!1}},_addToMap:function(o){o&&(this._backupLatlng=this._latlng,this.setLatLng(o)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(o,c,d){this._recursively(o,this._group._map.getMinZoom(),d-1,function(f){var m=f._markers,y,_;for(y=m.length-1;y>=0;y--)_=m[y],_._icon&&(_._setPos(c),_.clusterHide())},function(f){var m=f._childClusters,y,_;for(y=m.length-1;y>=0;y--)_=m[y],_._icon&&(_._setPos(c),_.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(o,c,d,f){this._recursively(o,f,c,function(m){m._recursivelyAnimateChildrenIn(o,m._group._map.latLngToLayerPoint(m.getLatLng()).round(),d),m._isSingleParent()&&d-1===f?(m.clusterShow(),m._recursivelyRemoveChildrenFromMap(o,c,d)):m.clusterHide(),m._addToMap()})},_recursivelyBecomeVisible:function(o,c){this._recursively(o,this._group._map.getMinZoom(),c,null,function(d){d.clusterShow()})},_recursivelyAddChildrenToMap:function(o,c,d){this._recursively(d,this._group._map.getMinZoom()-1,c,function(f){if(c!==f._zoom)for(var m=f._markers.length-1;m>=0;m--){var y=f._markers[m];d.contains(y._latlng)&&(o&&(y._backupLatlng=y.getLatLng(),y.setLatLng(o),y.clusterHide&&y.clusterHide()),f._group._featureGroup.addLayer(y))}},function(f){f._addToMap(o)})},_recursivelyRestoreChildPositions:function(o){for(var c=this._markers.length-1;c>=0;c--){var d=this._markers[c];d._backupLatlng&&(d.setLatLng(d._backupLatlng),delete d._backupLatlng)}if(o-1===this._zoom)for(var f=this._childClusters.length-1;f>=0;f--)this._childClusters[f]._restorePosition();else for(var m=this._childClusters.length-1;m>=0;m--)this._childClusters[m]._recursivelyRestoreChildPositions(o)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(o,c,d,f){var m,y;this._recursively(o,c-1,d-1,function(_){for(y=_._markers.length-1;y>=0;y--)m=_._markers[y],(!f||!f.contains(m._latlng))&&(_._group._featureGroup.removeLayer(m),m.clusterShow&&m.clusterShow())},function(_){for(y=_._childClusters.length-1;y>=0;y--)m=_._childClusters[y],(!f||!f.contains(m._latlng))&&(_._group._featureGroup.removeLayer(m),m.clusterShow&&m.clusterShow())})},_recursively:function(o,c,d,f,m){var y=this._childClusters,_=this._zoom,S,b;if(c<=_&&(f&&f(this),m&&_===d&&m(this)),_<c||_<d)for(S=y.length-1;S>=0;S--)b=y[S],b._boundsNeedUpdate&&b._recalculateBounds(),o.intersects(b._bounds)&&b._recursively(o,c,d,f,m)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var o=this.options.opacity;return this.setOpacity(0),this.options.opacity=o,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(o){this._cellSize=o,this._sqCellSize=o*o,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(o,c){var d=this._getCoord(c.x),f=this._getCoord(c.y),m=this._grid,y=m[f]=m[f]||{},_=y[d]=y[d]||[],S=L.Util.stamp(o);this._objectPoint[S]=c,_.push(o)},updateObject:function(o,c){this.removeObject(o),this.addObject(o,c)},removeObject:function(o,c){var d=this._getCoord(c.x),f=this._getCoord(c.y),m=this._grid,y=m[f]=m[f]||{},_=y[d]=y[d]||[],S,b;for(delete this._objectPoint[L.Util.stamp(o)],S=0,b=_.length;S<b;S++)if(_[S]===o)return _.splice(S,1),b===1&&delete y[d],!0},eachObject:function(o,c){var d,f,m,y,_,S,b,T=this._grid;for(d in T){_=T[d];for(f in _)for(S=_[f],m=0,y=S.length;m<y;m++)b=o.call(c,S[m]),b&&(m--,y--)}},getNearObject:function(o){var c=this._getCoord(o.x),d=this._getCoord(o.y),f,m,y,_,S,b,T,z,J=this._objectPoint,F=this._sqCellSize,te=null;for(f=d-1;f<=d+1;f++)if(_=this._grid[f],_){for(m=c-1;m<=c+1;m++)if(S=_[m],S)for(y=0,b=S.length;y<b;y++)T=S[y],z=this._sqDist(J[L.Util.stamp(T)],o),(z<F||z<=F&&te===null)&&(F=z,te=T)}return te},_getCoord:function(o){var c=Math.floor(o/this._cellSize);return isFinite(c)?c:o},_sqDist:function(o,c){var d=c.x-o.x,f=c.y-o.y;return d*d+f*f}},function(){L.QuickHull={getDistant:function(o,c){var d=c[1].lat-c[0].lat,f=c[0].lng-c[1].lng;return f*(o.lat-c[0].lat)+d*(o.lng-c[0].lng)},findMostDistantPointFromBaseLine:function(o,c){var d=0,f=null,m=[],y,_,S;for(y=c.length-1;y>=0;y--){if(_=c[y],S=this.getDistant(_,o),S>0)m.push(_);else continue;S>d&&(d=S,f=_)}return{maxPoint:f,newPoints:m}},buildConvexHull:function(o,c){var d=[],f=this.findMostDistantPointFromBaseLine(o,c);return f.maxPoint?(d=d.concat(this.buildConvexHull([o[0],f.maxPoint],f.newPoints)),d=d.concat(this.buildConvexHull([f.maxPoint,o[1]],f.newPoints)),d):[o[0]]},getConvexHull:function(o){var c=!1,d=!1,f=!1,m=!1,y=null,_=null,S=null,b=null,T=null,z=null,J;for(J=o.length-1;J>=0;J--){var F=o[J];(c===!1||F.lat>c)&&(y=F,c=F.lat),(d===!1||F.lat<d)&&(_=F,d=F.lat),(f===!1||F.lng>f)&&(S=F,f=F.lng),(m===!1||F.lng<m)&&(b=F,m=F.lng)}d!==c?(z=_,T=y):(z=b,T=S);var te=[].concat(this.buildConvexHull([z,T],o),this.buildConvexHull([T,z],o));return te}}}(),L.MarkerCluster.include({getConvexHull:function(){var o=this.getAllChildMarkers(),c=[],d,f;for(f=o.length-1;f>=0;f--)d=o[f].getLatLng(),c.push(d);return L.QuickHull.getConvexHull(c)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var o=this.getAllChildMarkers(null,!0),c=this._group,d=c._map,f=d.latLngToLayerPoint(this._latlng),m;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?m=this._group.options.spiderfyShapePositions(o.length,f):o.length>=this._circleSpiralSwitchover?m=this._generatePointsSpiral(o.length,f):(f.y+=10,m=this._generatePointsCircle(o.length,f)),this._animationSpiderfy(o,m)}},unspiderfy:function(o){this._group._inZoomAnimation||(this._animationUnspiderfy(o),this._group._spiderfied=null)},_generatePointsCircle:function(o,c){var d=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+o),f=d/this._2PI,m=this._2PI/o,y=[],_,S;for(f=Math.max(f,35),y.length=o,_=0;_<o;_++)S=this._circleStartAngle+_*m,y[_]=new L.Point(c.x+f*Math.cos(S),c.y+f*Math.sin(S))._round();return y},_generatePointsSpiral:function(o,c){var d=this._group.options.spiderfyDistanceMultiplier,f=d*this._spiralLengthStart,m=d*this._spiralFootSeparation,y=d*this._spiralLengthFactor*this._2PI,_=0,S=[],b;for(S.length=o,b=o;b>=0;b--)b<o&&(S[b]=new L.Point(c.x+f*Math.cos(_),c.y+f*Math.sin(_))._round()),_+=m/f+b*5e-4,f+=y/_;return S},_noanimationUnspiderfy:function(){var o=this._group,c=o._map,d=o._featureGroup,f=this.getAllChildMarkers(null,!0),m,y;for(o._ignoreMove=!0,this.setOpacity(1),y=f.length-1;y>=0;y--)m=f[y],d.removeLayer(m),m._preSpiderfyLatlng&&(m.setLatLng(m._preSpiderfyLatlng),delete m._preSpiderfyLatlng),m.setZIndexOffset&&m.setZIndexOffset(0),m._spiderLeg&&(c.removeLayer(m._spiderLeg),delete m._spiderLeg);o.fire("unspiderfied",{cluster:this,markers:f}),o._ignoreMove=!1,o._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(o,c){var d=this._group,f=d._map,m=d._featureGroup,y=this._group.options.spiderLegPolylineOptions,_,S,b,T;for(d._ignoreMove=!0,_=0;_<o.length;_++)T=f.layerPointToLatLng(c[_]),S=o[_],b=new L.Polyline([this._latlng,T],y),f.addLayer(b),S._spiderLeg=b,S._preSpiderfyLatlng=S._latlng,S.setLatLng(T),S.setZIndexOffset&&S.setZIndexOffset(1e6),m.addLayer(S);this.setOpacity(.3),d._ignoreMove=!1,d.fire("spiderfied",{cluster:this,markers:o})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(o,c){var d=this,f=this._group,m=f._map,y=f._featureGroup,_=this._latlng,S=m.latLngToLayerPoint(_),b=L.Path.SVG,T=L.extend({},this._group.options.spiderLegPolylineOptions),z=T.opacity,J,F,te,re,O,ce;for(z===void 0&&(z=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),b?(T.opacity=0,T.className=(T.className||"")+" leaflet-cluster-spider-leg"):T.opacity=z,f._ignoreMove=!0,J=0;J<o.length;J++)F=o[J],ce=m.layerPointToLatLng(c[J]),te=new L.Polyline([_,ce],T),m.addLayer(te),F._spiderLeg=te,b&&(re=te._path,O=re.getTotalLength()+.1,re.style.strokeDasharray=O,re.style.strokeDashoffset=O),F.setZIndexOffset&&F.setZIndexOffset(1e6),F.clusterHide&&F.clusterHide(),y.addLayer(F),F._setPos&&F._setPos(S);for(f._forceLayout(),f._animationStart(),J=o.length-1;J>=0;J--)ce=m.layerPointToLatLng(c[J]),F=o[J],F._preSpiderfyLatlng=F._latlng,F.setLatLng(ce),F.clusterShow&&F.clusterShow(),b&&(te=F._spiderLeg,re=te._path,re.style.strokeDashoffset=0,te.setStyle({opacity:z}));this.setOpacity(.3),f._ignoreMove=!1,setTimeout(function(){f._animationEnd(),f.fire("spiderfied",{cluster:d,markers:o})},200)},_animationUnspiderfy:function(o){var c=this,d=this._group,f=d._map,m=d._featureGroup,y=o?f._latLngToNewLayerPoint(this._latlng,o.zoom,o.center):f.latLngToLayerPoint(this._latlng),_=this.getAllChildMarkers(null,!0),S=L.Path.SVG,b,T,z,J,F,te;for(d._ignoreMove=!0,d._animationStart(),this.setOpacity(1),T=_.length-1;T>=0;T--)b=_[T],b._preSpiderfyLatlng&&(b.closePopup(),b.setLatLng(b._preSpiderfyLatlng),delete b._preSpiderfyLatlng,te=!0,b._setPos&&(b._setPos(y),te=!1),b.clusterHide&&(b.clusterHide(),te=!1),te&&m.removeLayer(b),S&&(z=b._spiderLeg,J=z._path,F=J.getTotalLength()+.1,J.style.strokeDashoffset=F,z.setStyle({opacity:0})));d._ignoreMove=!1,setTimeout(function(){var re=0;for(T=_.length-1;T>=0;T--)b=_[T],b._spiderLeg&&re++;for(T=_.length-1;T>=0;T--)b=_[T],b._spiderLeg&&(b.clusterShow&&b.clusterShow(),b.setZIndexOffset&&b.setZIndexOffset(0),re>1&&m.removeLayer(b),f.removeLayer(b._spiderLeg),delete b._spiderLeg);d._animationEnd(),d.fire("unspiderfied",{cluster:c,markers:_})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(o){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(o))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(o){this._spiderfied&&this._spiderfied.unspiderfy(o)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(o){o._spiderLeg&&(this._featureGroup.removeLayer(o),o.clusterShow&&o.clusterShow(),o.setZIndexOffset&&o.setZIndexOffset(0),this._map.removeLayer(o._spiderLeg),delete o._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(o){return o?o instanceof L.MarkerClusterGroup?o=o._topClusterLevel.getAllChildMarkers():o instanceof L.LayerGroup?o=o._layers:o instanceof L.MarkerCluster?o=o.getAllChildMarkers():o instanceof L.Marker&&(o=[o]):o=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(o),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(o),this},_flagParentsIconsNeedUpdate:function(o){var c,d;for(c in o)for(d=o[c].__parent;d;)d._iconNeedsUpdate=!0,d=d.__parent},_refreshSingleMarkerModeMarkers:function(o){var c,d;for(c in o)d=o[c],this.hasLayer(d)&&d.setIcon(this._overrideMarkerIcon(d))}}),L.Marker.include({refreshIconOptions:function(o,c){var d=this.options.icon;return L.setOptions(d,o),this.setIcon(d),c&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),a.MarkerClusterGroup=l,a.MarkerCluster=h,Object.defineProperty(a,"__esModule",{value:!0})})})(hf,hf.exports);const ff=[{name:"home",icon:Wf},{name:"star",icon:Xf},{name:"flag",icon:Zf},{name:"user",icon:Kf},{name:"pin",icon:rr},{name:"building",icon:Hf},{name:"briefcase",icon:Nf},{name:"alert",icon:jf}],Qb=({info:t,onClose:r,onEditLocalizacion:a,isLocalizacion:l,onNavigate:h})=>t?s.jsxs(Ie,{style:{position:"absolute",bottom:20,left:"50%",transform:"translateX(-50%)",zIndex:1e3,backgroundColor:"white",padding:"15px 20px",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",maxWidth:"90%",width:"auto",animation:"slideUp 0.3s cubic-bezier(.4,0,.2,1)"},children:[s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[s.jsxs(X,{gap:"xs",align:"center",children:[s.jsx(Ie,{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:l?"#228be6":"#011638",flexShrink:0}}),s.jsx(Y,{fw:700,size:"sm",children:l?t.titulo:t.Matricula}),s.jsx(We,{variant:"subtle",color:"gray",onClick:r,size:"sm",style:{marginLeft:"auto"},children:s.jsx(fs,{size:14})})]}),s.jsxs(X,{gap:"md",children:[s.jsxs(Y,{size:"sm",children:[s.jsx("b",{children:"Fecha/Hora:"})," ",(()=>{const o=l?t.fecha_hora:t.Fecha_y_Hora;if(!o)return"-";const[c,d]=o.split("T");return c&&d?`${c} ${d.slice(0,8)}`:o})()]}),!l&&typeof t.Velocidad=="number"&&!isNaN(t.Velocidad)&&s.jsxs(Y,{size:"sm",children:[s.jsx("b",{children:"Velocidad:"})," ",t.Velocidad.toFixed(1)," km/h"]})]}),s.jsxs(X,{gap:"md",children:[s.jsxs(Y,{size:"sm",children:[s.jsx("b",{children:"Coordenadas:"})," ",l?`${typeof t.coordenada_y=="number"&&!isNaN(t.coordenada_y)?t.coordenada_y.toFixed(6):"?"}, ${typeof t.coordenada_x=="number"&&!isNaN(t.coordenada_x)?t.coordenada_x.toFixed(6):"?"}`:`${typeof t.Coordenada_Y=="number"&&!isNaN(t.Coordenada_Y)?t.Coordenada_Y.toFixed(6):"?"}, ${typeof t.Coordenada_X=="number"&&!isNaN(t.Coordenada_X)?t.Coordenada_X.toFixed(6):"?"}`]}),!l&&typeof t.duracion_parada_min=="number"&&!isNaN(t.duracion_parada_min)&&t.duracion_parada_min>=.33&&s.jsxs(Y,{size:"sm",c:"orange",children:[s.jsx("b",{children:"Duración parada:"})," ",t.duracion_parada_min.toFixed(1)," min"]})]}),l&&t.descripcion&&s.jsxs(Y,{size:"sm",c:"dimmed",children:[s.jsx("b",{children:"Descripción:"})," ",t.descripcion]}),h&&!l||l&&a||!l&&t.onGuardarLocalizacion?s.jsxs(X,{justify:"center",gap:4,mt:"xs",children:[h&&!l&&s.jsxs(s.Fragment,{children:[s.jsx(We,{size:"md",variant:"filled",color:"blue",onClick:()=>h("prev"),children:s.jsx(bf,{size:20})}),s.jsx(We,{size:"md",variant:"filled",color:"blue",onClick:()=>h("next"),children:s.jsx(Mc,{size:20})})]}),l&&a&&s.jsx(We,{size:"md",variant:"filled",color:"blue",onClick:a,children:s.jsx(rr,{size:20})}),!l&&t.onGuardarLocalizacion&&s.jsx(We,{size:"md",variant:"filled",color:"green",onClick:t.onGuardarLocalizacion,children:s.jsx(rr,{size:20})})]}):null]}),s.jsx("style",{children:`
        @keyframes slideUp {
          from { transform: translate(-50%, 20px); opacity: 0; }
          to { transform: translate(-50%, 0); opacity: 1; }
        }
      `})]}):null,tu=(t,r,a,l)=>{const o=(a-t)*Math.PI/180,c=(l-r)*Math.PI/180,d=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(c/2)*Math.sin(c/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))},eS=(t,r,a)=>{const l=t.Coordenada_Y,h=t.Coordenada_X,o=r.Coordenada_Y,c=r.Coordenada_X,d=a.Coordenada_Y,f=a.Coordenada_X,m=Math.atan2(c-h,o-l),y=Math.atan2(f-c,d-o);let _=Math.abs(m-y)*180/Math.PI;return _>180?360-_:_},tS=(t,r={minDistance:.05,maxAngle:30,keepStops:!0,keepSpeedChanges:!0,speedThreshold:10})=>{if(t.length<=2)return t;const a=[t[0]];let l=t[0],h=!1;for(let o=1;o<t.length-1;o++){const c=t[o],d=t[o+1],f=tu(l.Coordenada_Y,l.Coordenada_X,c.Coordenada_Y,c.Coordenada_X),m=o>0&&o<t.length-1?eS(t[o-1],c,d):0,y=(c.Velocidad||0)>5;m<r.maxAngle&&y?h=!0:h=!1;const S=c.duracion_parada_min&&c.duracion_parada_min>0,b=Math.abs((c.Velocidad||0)-(l.Velocidad||0))>r.speedThreshold,T=h?.1:r.minDistance;(r.keepStops&&S||r.keepSpeedChanges&&b||f>T||o>0&&o<t.length-1&&m>r.maxAngle)&&(a.push(c),l=c)}return t.length>1&&a.push(t[t.length-1]),a},nS=(t,r=1e-4)=>{const a=[],l=new Set;return t.forEach((h,o)=>{if(l.has(o))return;const c=[h];l.add(o),t.forEach((d,f)=>{if(o===f||l.has(f))return;tu(h.Coordenada_Y,h.Coordenada_X,d.Coordenada_Y,d.Coordenada_X)<r&&(c.push(d),l.add(f))}),a.push(c)}),a},rS=t=>{const r=t.reduce((l,h)=>l+h.Coordenada_Y,0),a=t.reduce((l,h)=>l+h.Coordenada_X,0);return{...t[0],Coordenada_Y:r/t.length,Coordenada_X:a/t.length,clusterSize:t.length}},aS=()=>{const t=mo();return g.useEffect(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize")),t.invalidateSize()},200);const r=t.getContainer();let a=null;return r&&"ResizeObserver"in window&&(a=new ResizeObserver(()=>{t.invalidateSize()}),a.observe(r)),()=>{a&&a.disconnect()}},[t]),null},pf=new Worker(new URL("/assets/gpsWorker-DCDiHhej.js",import.meta.url)),gf=Yr.memo(g.forwardRef(({lecturas:t,capas:r,localizaciones:a,mapControls:l,mostrarLocalizaciones:h,onGuardarLocalizacion:o,playbackLayer:c,currentPlaybackIndex:d,interpolationProgress:f,fullscreenMap:m,puntoSeleccionado:y,heatmapMultiplier:_=1.65,primerPunto:S,ultimoPunto:b,drawnShape:T,onShapeDrawn:z,onShapeDeleted:J},F)=>{const te=g.useRef(null),[re,O]=g.useState(null),[ce,xe]=g.useState([]),[Ee,Le]=g.useState(!1),[ge,pe]=g.useState(null),ae=g.useMemo(()=>{const G=Array.isArray(t)&&t.length>0?t.find(K=>typeof K.Coordenada_Y=="number"&&typeof K.Coordenada_X=="number"&&!isNaN(K.Coordenada_Y)&&!isNaN(K.Coordenada_X)):null;return G?[G.Coordenada_Y,G.Coordenada_X]:[40.416775,-3.70379]},[t]),me=g.useMemo(()=>(Array.isArray(t)&&t.length>0?t.find(K=>typeof K.Coordenada_Y=="number"&&typeof K.Coordenada_X=="number"&&!isNaN(K.Coordenada_Y)&&!isNaN(K.Coordenada_X)):null)?13:10,[t]);g.useEffect(()=>{if(!l.optimizePoints||!Array.isArray(t)||t.length===0){xe(t);return}Le(!0),pf.postMessage({type:"decimate",data:{points:t,options:{minDistance:.05,maxAngle:30,keepStops:!0,keepSpeedChanges:!0,speedThreshold:10}}}),pf.onmessage=G=>{G.data.type==="decimate"&&(xe(G.data.data),Le(!1))}},[t,l.optimizePoints]);const Ce=(G,K)=>{const W=new Date(G.Fecha_y_Hora).getTime(),he=new Date(K.Fecha_y_Hora).getTime();return Math.abs(he-W)/(1e3*60)},Pe=(G,K,W,he,de=1e-4)=>tu(G,K,W,he)<de,xt=g.useMemo(()=>{if(!l.showHeatmap||!ce.length)return[];const G=new Map,K=new Map;for(let W=0;W<ce.length-1;W++){const he=ce[W],de=ce[W+1],De=Ce(he,de);if(De>1&&Pe(he.Coordenada_Y,he.Coordenada_X,de.Coordenada_Y,de.Coordenada_X)){const Ne=`${he.Coordenada_Y.toFixed(5)},${he.Coordenada_X.toFixed(5)}`;K.set(Ne,(K.get(Ne)||0)+De)}}return ce.forEach((W,he)=>{const de=`${W.Coordenada_Y.toFixed(5)},${W.Coordenada_X.toFixed(5)}`;let De=.02;if(K.has(de)){const Ne=K.get(de);De+=Math.log(Ne+1)*.7}W.duracion_parada_min&&W.duracion_parada_min>0&&(De+=Math.log(W.duracion_parada_min+1)*.7),G.set(de,(G.get(de)||0)+De)}),Array.from(G.entries()).map(([W,he])=>{const[de,De]=W.split(",").map(Number);return[de,De,he*_]})},[ce,l.showHeatmap,_]);g.useCallback(ep.debounce(G=>{console.log("Zoom level:",G)},150),[]),g.useEffect(()=>()=>{te.current&&te.current.eachLayer(G=>{G instanceof an.Marker&&G.remove()})},[]),g.useImperativeHandle(F,()=>te.current,[te.current]);const Ye=g.useMemo(()=>Array.isArray(r)?r.filter(G=>G.activa).flatMap(G=>{if(l.optimizePoints){const K=tS(G.lecturas);return nS(K).map(rS)}return G.lecturas}):[],[r,l.optimizePoints]),jt=g.useMemo(()=>[...ce,...Ye],[ce,Ye]),bt=()=>{switch(l.visualizationType){case"standard":return"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";case"satellite":return"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}";case"cartodb-light":return"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png";default:return"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}},Dt=()=>{switch(l.visualizationType){case"standard":return'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors';case"satellite":return"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community";case"cartodb-light":return'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>';default:return'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}},rt=G=>{if(!re||re.isLocalizacion)return;const K=jt.findIndex(de=>de.ID_Lectura===re.info.ID_Lectura);if(K===-1)return;let W;G==="prev"?W=K>0?K-1:jt.length-1:W=K<jt.length-1?K+1:0;const he=jt[W];O({info:{...he,onGuardarLocalizacion:()=>o(he)},isLocalizacion:!1}),te.current&&te.current.setView([he.Coordenada_Y,he.Coordenada_X],te.current.getZoom())};g.useEffect(()=>{if(!c||d==null||d<0)return;const G=c.lecturas[d],K=c.lecturas[d+1];if(!G)return;if(ge==null||!K){pe([G.Coordenada_Y,G.Coordenada_X]);return}const W=f||0;if(W===0){pe([G.Coordenada_Y,G.Coordenada_X]);return}const he=G.Coordenada_Y+(K.Coordenada_Y-G.Coordenada_Y)*W,de=G.Coordenada_X+(K.Coordenada_X-G.Coordenada_X)*W;(!ge||Math.abs(ge[0]-he)>1e-6||Math.abs(ge[1]-de)>1e-6)&&pe([he,de])},[d,c,f]),g.useEffect(()=>{if(!c||d==null||d<0){pe(null);return}const G=c.lecturas[d];G&&pe([G.Coordenada_Y,G.Coordenada_X])},[c]);const q=()=>{const G=mo();return g.useEffect(()=>{if(!G)return;const K=ce.map(he=>{var Ne;const de=re&&!re.isLocalizacion&&((Ne=re.info)==null?void 0:Ne.ID_Lectura)===he.ID_Lectura,De=an.marker([he.Coordenada_Y,he.Coordenada_X],{icon:an.divIcon({className:`custom-marker ${de?"selected":""}`,html:`
              <div style="
                background-color: ${de?"#ff0f35":"#228be6"};
                width: ${de?"30px":"18px"};
                height: ${de?"30px":"18px"};
                border-radius: 50%;
                border: ${de?"5px solid #222":"2px solid white"};
                box-shadow: ${de?"0 0 12px rgba(255,15,53,0.6)":"0 0 8px rgba(0,0,0,0.4)"};
                transform: translate(-50%, -50%);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: ${de?"10000":"1000"};
                position: relative;
              ">
                ${de?"<span style='color: white; font-size: 14px; font-weight: bold; line-height: 1;'>!</span>":""}
              </div>
            `,iconSize:de?[30,30]:[18,18],iconAnchor:de?[15,15]:[9,9]}),zIndexOffset:de?1e4:1e3});return De.on("click",()=>{O({info:{...he,onGuardarLocalizacion:()=>o(he)},isLocalizacion:!1})}),he.clusterSize&&he.clusterSize>1&&De.bindTooltip(he.clusterSize.toString()),De});if(!l.enableClustering)return K.forEach(he=>G.addLayer(he)),()=>{K.forEach(he=>G.removeLayer(he))};const W=an.markerClusterGroup({chunkedLoading:!0,maxClusterRadius:50,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,removeOutsideVisibleBounds:!0,animate:!0});return W.addLayers(K),G.addLayer(W),()=>{l.enableClustering?G.removeLayer(W):K.forEach(he=>G.removeLayer(he))}},[G,ce,re,o,l.enableClustering]),null},ke=()=>{const G=mo();return g.useEffect(()=>{if(!G||!Array.isArray(r))return;const K=[];return r.filter(W=>W.activa).forEach(W=>{const he=W.lecturas.filter(de=>typeof de.Coordenada_Y=="number"&&typeof de.Coordenada_X=="number"&&!isNaN(de.Coordenada_Y)&&!isNaN(de.Coordenada_X)).map(de=>[de.Coordenada_Y,de.Coordenada_X]);if(he.length>0){const de=an.polyline(he,{color:W.color||"#228be6",weight:3,opacity:.7}),De=W.lecturas.map(Ne=>{var Ke;const Ve=re&&!re.isLocalizacion&&((Ke=re.info)==null?void 0:Ke.ID_Lectura)===Ne.ID_Lectura,at=an.marker([Ne.Coordenada_Y,Ne.Coordenada_X],{icon:an.divIcon({className:"custom-marker",html:`
                  <div style="
                    background-color: ${Ve?"#ff0f35":W.color||"#228be6"};
                    width: ${Ve?"24px":"8px"};
                    height: ${Ve?"24px":"8px"};
                    border-radius: 50%;
                    border: ${Ve?"4px solid #222":"2px solid white"};
                    box-shadow: ${Ve?"0 0 12px rgba(255,15,53,0.6)":"0 0 4px rgba(0,0,0,0.3)"};
                    transform: translate(-50%, -50%);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: ${Ve?"10000":"500"};
                    position: relative;
                  ">
                    ${Ve?"<span style='color: white; font-size: 10px; font-weight: bold; line-height: 1;'>!</span>":""}
                  </div>
                `,iconSize:Ve?[24,24]:[8,8],iconAnchor:Ve?[12,12]:[4,4]}),zIndexOffset:Ve?1e4:500});return at.on("click",()=>{O({info:{...Ne,onGuardarLocalizacion:()=>o(Ne)},isLocalizacion:!1})}),at});K.push(de),K.push(...De)}}),K.forEach(W=>G.addLayer(W)),()=>{K.forEach(W=>G.removeLayer(W))}},[G,r,o]),null};return s.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[s.jsxs(If,{center:ae,zoom:me,maxZoom:22,scrollWheelZoom:!0,style:{height:"100%",width:"100%"},ref:te,whenReady:()=>{te.current&&te.current.invalidateSize()},children:[s.jsx(Ef,{url:bt(),attribution:Dt(),maxZoom:22,maxNativeZoom:18}),s.jsx(aS,{}),s.jsx(fy,{onShapeDrawn:z,onShapeDeleted:J}),l.showPoints&&s.jsx(q,{}),l.showPoints&&s.jsx(ke,{}),l.showHeatmap&&s.jsx(Jb,{points:xt,options:{radius:15,blur:10,maxZoom:22}}),h&&a&&a.map(G=>{var De;const K=ff.find(Ne=>Ne.name===G.icono)||ff.find(Ne=>Ne.name==="pin"),W=K?K.icon:rr,he=re&&re.isLocalizacion&&((De=re.info)==null?void 0:De.id)===G.id,de=Ba.renderToString(Yr.createElement(W,{size:he?36:28,color:he?"#ff0f35":G.color}));return s.jsx(Cr,{position:[G.coordenada_y,G.coordenada_x],icon:an.divIcon({className:"custom-localizacion-icon",html:`
                  <div style="
                    filter: ${he?"drop-shadow(0 0 8px rgba(255,15,53,0.6))":"none"};
                    transform: ${he?"scale(1.2)":"scale(1)"};
                    z-index: ${he?"10000":"2000"};
                    position: relative;
                  ">
                    ${de}
                  </div>
                `,iconSize:he?[36,36]:[28,28],iconAnchor:he?[18,18]:[14,14]}),zIndexOffset:he?1e4:2e3,eventHandlers:{click:()=>{O({info:G,isLocalizacion:!0})}},children:s.jsxs(pC,{children:[s.jsx("b",{children:G.titulo}),s.jsx("br",{}),G.descripcion]})},G.id)}).filter(Boolean),g.useMemo(()=>!c||d==null||d<0||!ge?null:s.jsxs(s.Fragment,{children:[s.jsx(fC,{positions:c.lecturas.slice(0,d+1).map(G=>[G.Coordenada_Y,G.Coordenada_X]),pathOptions:{color:c.color||"#228be6",weight:4,opacity:.85}}),s.jsx(Cr,{position:ge,icon:an.divIcon({className:"playback-marker",html:`
                    <div style="
                      background-color: ${c.color||"#228be6"};
                      width: 22px;
                      height: 22px;
                      border-radius: 50%;
                      border: 4px solid white;
                      box-shadow: 0 0 12px rgba(0,0,0,0.4);
                      transform: translate(-50%, -50%);
                      z-index: 5000;
                      position: relative;
                      will-change: transform;
                    "></div>
                  `,iconSize:[22,22],iconAnchor:[11,11]}),zIndexOffset:5e3})]}),[c,d,ge])]}),re&&s.jsx(Qb,{info:re.info,onClose:()=>O(null),onEditLocalizacion:re.isLocalizacion?()=>o(re.info):void 0,isLocalizacion:re.isLocalizacion,onNavigate:re.isLocalizacion?void 0:rt})]})})),Gr={LECTURAS:(t,r)=>`gps_lecturas_${t}_${r}`,CAPAS:t=>`gps_capas_${t}`,LOCALIZACIONES:t=>`gps_localizaciones_${t}`},oc=1e3*60*60;class sS{constructor(){this.cache=new Map,this.TTL=5*60*1e3}set(r,a){this.cache.set(r,{data:a,timestamp:Date.now()})}get(r){const a=this.cache.get(r);return a?Date.now()-a.timestamp>this.TTL?(this.cache.delete(r),null):a.data:null}clear(){this.cache.clear()}setLecturas(r,a,l){const h={data:l,timestamp:Date.now()};localStorage.setItem(Gr.LECTURAS(r,a),JSON.stringify(h)),this.set(`lecturas_${r}_${a}`,l)}getLecturas(r,a){const l=localStorage.getItem(Gr.LECTURAS(r,a));if(l){const h=JSON.parse(l);return Date.now()-h.timestamp>oc?(localStorage.removeItem(Gr.LECTURAS(r,a)),null):h.data}return this.get(`lecturas_${r}_${a}`)}setCapas(r,a){const l={data:a,timestamp:Date.now()};localStorage.setItem(Gr.CAPAS(r),JSON.stringify(l)),this.set(`capas_${r}`,a)}getCapas(r){const a=localStorage.getItem(Gr.CAPAS(r));if(a){const l=JSON.parse(a);return Date.now()-l.timestamp>oc?(localStorage.removeItem(Gr.CAPAS(r)),null):l.data}return this.get(`capas_${r}`)}setLocalizaciones(r,a){const l={data:a,timestamp:Date.now()};localStorage.setItem(Gr.LOCALIZACIONES(r),JSON.stringify(l)),this.set(`localizaciones_${r}`,a)}getLocalizaciones(r){const a=localStorage.getItem(Gr.LOCALIZACIONES(r));if(a){const l=JSON.parse(a);return Date.now()-l.timestamp>oc?(localStorage.removeItem(Gr.LOCALIZACIONES(r)),null):l.data}return this.get(`localizaciones_${r}`)}clearCache(r){Object.keys(localStorage).forEach(a=>{a.startsWith("gps_")&&a.includes(`_${r}_`)&&localStorage.removeItem(a)}),this.clear()}clearAllCache(){Object.keys(localStorage).forEach(r=>{r.startsWith("gps_")&&localStorage.removeItem(r)}),this.clear()}}const lc=new sS,bc=[{name:"home",icon:Wf},{name:"star",icon:Xf},{name:"flag",icon:Zf},{name:"user",icon:Kf},{name:"pin",icon:rr},{name:"building",icon:Hf},{name:"briefcase",icon:Nf},{name:"alert",icon:jf}],iS=Yr.memo(({localizacionActual:t,setLocalizacionActual:r,setModalAbierto:a,setFormFocused:l,handleGuardarLocalizacion:h,handleEliminarLocalizacion:o,localizaciones:c})=>t?s.jsxs(zt,{p:"md",withBorder:!0,mb:"md",style:{position:"relative"},children:[s.jsx(We,{variant:"subtle",color:"gray",style:{position:"absolute",top:8,right:8,zIndex:10},onClick:()=>{a(!1),r(null)},"aria-label":"Cerrar panel",children:s.jsx(fs,{size:20})}),s.jsxs(ct,{gap:"sm",children:[s.jsxs(X,{align:"center",children:[(()=>{var f;const d=((f=bc.find(m=>m.name===t.icono))==null?void 0:f.icon)||rr;return s.jsx(d,{size:32,color:typeof t.color=="string"?t.color:"#228be6"})})(),s.jsx(Xe,{label:"Título",value:t.titulo,onChange:d=>r(f=>f&&{...f,titulo:d.target.value}),style:{flex:1},onFocus:()=>l(!0),onBlur:()=>l(!1)})]}),s.jsx(ho,{label:"Descripción",value:t.descripcion??"",onChange:d=>r(f=>f&&{...f,descripcion:d.target.value}),onFocus:()=>l(!0),onBlur:()=>l(!1)}),s.jsxs(Y,{size:"sm",c:"dimmed",children:["Fecha y hora: ",Tt(t.fecha_hora).format("DD/MM/YYYY HH:mm:ss")]}),s.jsxs(X,{children:[s.jsx(Y,{size:"sm",children:"Icono:"}),s.jsx(xo,{cols:5,spacing:4,children:bc.map(({name:d,icon:f})=>s.jsx(We,{variant:t.icono===d?"filled":"light",color:t.icono===d?typeof t.color=="string"?t.color:"#228be6":"gray",onClick:()=>r(m=>m&&{...m,icono:d}),children:s.jsx(f,{size:20})},d))}),s.jsx(Pc,{label:"Color",value:typeof t.color=="string"?t.color:"#228be6",onChange:d=>r(f=>f&&{...f,color:d}),format:"hex",style:{width:120}})]}),s.jsxs(X,{justify:"flex-end",children:[c.some(d=>d.id_lectura===t.id_lectura)&&s.jsx(Me,{color:"red",variant:"light",onClick:o,children:"Eliminar"}),s.jsx(Me,{variant:"light",onClick:()=>{a(!1),r(null)},children:"Cancelar"}),s.jsx(Me,{onClick:h,disabled:!t.titulo,children:"Guardar"})]})]})]}):null),oS=Yr.memo(({loc:t,setLocalizacionActual:r,setModalAbierto:a,handleEliminarLocalizacion:l})=>{var o;const h=((o=bc.find(c=>c.name===t.icono))==null?void 0:o.icon)||rr;return s.jsxs(zt,{p:"xs",withBorder:!0,children:[s.jsxs(X,{justify:"space-between",children:[s.jsxs(X,{gap:"xs",children:[s.jsx(h,{size:18,color:t.color}),s.jsx(Y,{size:"sm",fw:600,children:t.titulo})]}),s.jsxs(X,{gap:4,children:[s.jsx(We,{variant:"subtle",color:"blue",onClick:()=>{},children:s.jsx(rr,{size:16})}),s.jsx(We,{variant:"subtle",color:"gray",onClick:()=>{r(t),a(!0)},children:s.jsx(Tc,{size:16})}),s.jsx(We,{variant:"subtle",color:"red",onClick:()=>{r(t),l()},children:s.jsx(Oa,{size:16})})]})]}),s.jsx(Y,{size:"xs",c:"dimmed",mt:2,children:Tt(t.fecha_hora).format("DD/MM/YYYY HH:mm")}),t.descripcion&&s.jsx(Y,{size:"xs",c:"dimmed",mt:2,children:t.descripcion})]},t.id_lectura)}),lS=Yr.memo(({capa:t,handleToggleCapa:r,handleEditarCapa:a,handleEliminarCapa:l})=>s.jsxs(zt,{p:"xs",withBorder:!0,children:[s.jsxs(X,{justify:"space-between",children:[s.jsxs(X,{gap:"xs",children:[s.jsx(br,{checked:t.activa,onChange:()=>r(t.id),size:"sm"}),s.jsx(Ie,{style:{width:16,height:16,backgroundColor:t.color,borderRadius:"50%"}}),s.jsx(Y,{size:"sm",children:t.nombre}),s.jsx(In,{label:`Filtros: ${JSON.stringify(t.filtros)}`,children:s.jsx(We,{variant:"subtle",size:"sm",children:s.jsx(Pf,{size:14})})})]}),s.jsxs(X,{gap:4,children:[s.jsx(We,{variant:"subtle",color:"blue",onClick:()=>a(t.id),children:s.jsx(Tc,{size:16})}),s.jsx(We,{variant:"subtle",color:"red",onClick:()=>l(t.id),children:s.jsx(Oa,{size:16})})]})]}),s.jsxs(Y,{size:"xs",c:"dimmed",mt:4,children:[t.lecturas.length," lecturas"]})]},t.id)),cS=Yr.memo(({capas:t,onPlay:r,onPause:a,onStop:l,onSpeedChange:h,isPlaying:o,currentSpeed:c,currentIndex:d,onIndexChange:f,selectedLayerId:m,onLayerChange:y})=>{var z;const _=t.find(J=>J.id===m),S=(_==null?void 0:_.lecturas.length)||0,b=_==null?void 0:_.lecturas[d],T=S>0?(d+1)/S*100:0;return s.jsx(zt,{p:"md",withBorder:!0,children:s.jsxs(ct,{gap:"md",children:[s.jsx(X,{justify:"space-between",align:"center",children:s.jsx(Wt,{order:2,children:"Reproductor de Recorrido"})}),s.jsx($a,{placeholder:"Selecciona una capa",value:(m==null?void 0:m.toString())||null,onChange:J=>{y(J?Number(J):null),f(0),l()},data:t.map(J=>({value:J.id.toString(),label:J.nombre})),clearable:!0,style:{width:"100%"}}),s.jsxs("div",{style:{position:"relative",height:8,backgroundColor:"var(--mantine-color-gray-2)",borderRadius:4,cursor:_?"pointer":"default",userSelect:"none"},onClick:J=>{if(!_)return;const F=J.currentTarget.getBoundingClientRect(),re=(J.clientX-F.left)/F.width*100,O=Math.min(Math.max(0,Math.floor(re/100*S)),S-1);f(O)},onMouseDown:J=>{if(!_)return;J.preventDefault();const F=O=>{const ce=J.currentTarget.getBoundingClientRect(),Ee=(O-ce.left)/ce.width*100,Le=Math.min(Math.max(0,Math.floor(Ee/100*S)),S-1);f(Le)};F(J.clientX);const te=O=>{requestAnimationFrame(()=>{F(O.clientX)})},re=()=>{document.removeEventListener("mousemove",te),document.removeEventListener("mouseup",re)};document.addEventListener("mousemove",te),document.addEventListener("mouseup",re)},children:[s.jsx("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${T}%`,backgroundColor:(_==null?void 0:_.color)||"var(--mantine-color-blue-6)",borderRadius:4}}),s.jsx("div",{style:{position:"absolute",left:`${T}%`,top:"50%",transform:"translate(-50%, -50%)",width:16,height:16,backgroundColor:"white",border:`2px solid ${(_==null?void 0:_.color)||"var(--mantine-color-blue-6)"}`,borderRadius:"50%",boxShadow:"0 0 4px rgba(0,0,0,0.2)",pointerEvents:"none"}})]}),b&&s.jsxs(X,{gap:"xs",children:[s.jsx(Uf,{size:16,style:{color:"var(--mantine-color-gray-6)"}}),s.jsx(Y,{size:"sm",children:Tt(b.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss")}),s.jsx(Xy,{size:16,style:{color:"var(--mantine-color-gray-6)"}}),s.jsxs(Y,{size:"sm",children:[((z=b.Velocidad)==null?void 0:z.toFixed(1))||"0"," km/h"]})]}),s.jsxs(X,{justify:"center",gap:"xs",children:[s.jsx(We,{variant:"filled",color:"#234be7",size:"lg",onClick:()=>f(Math.max(0,d-1)),disabled:!_||d===0,style:{fontWeight:700},children:s.jsx(aC,{size:20})}),s.jsx(We,{variant:"outline",color:"#234be7",size:"lg",onClick:()=>{const J=[.25,.5,1,2,4,8,10,20],F=J.indexOf(c);F>0&&h(J[F-1])},disabled:!_||c<=.25,style:{fontWeight:700},children:s.jsx(oC,{size:20})}),o?s.jsx(We,{variant:"filled",color:"#234be7",size:"xl",onClick:a,disabled:!_,style:{fontWeight:700},children:s.jsx(nC,{size:24})}):s.jsx(We,{variant:"filled",color:"#234be7",size:"xl",onClick:r,disabled:!_,style:{fontWeight:700},children:s.jsx(rC,{size:24})}),s.jsx(We,{variant:"outline",color:"#234be7",size:"lg",onClick:()=>{const J=[.25,.5,1,2,4,8,10,20],F=J.indexOf(c);F<J.length-1&&h(J[F+1])},disabled:!_||c>=20,style:{fontWeight:700},children:s.jsx(iC,{size:20})}),s.jsx(We,{variant:"filled",color:"#234be7",size:"lg",onClick:()=>f(Math.min(S-1,d+1)),disabled:!_||d===S-1,style:{fontWeight:700},children:s.jsx(sC,{size:20})})]}),s.jsx(X,{justify:"center",gap:"xs",children:s.jsxs(Y,{size:"sm",children:["Velocidad: ",c,"x"]})}),_&&s.jsxs(Y,{size:"sm",c:"dimmed",ta:"center",children:[d+1," / ",S," puntos"]})]})})}),uS=(t,r)=>{const a=`<?xml version="1.0" encoding="UTF-8"?>
<kml xmlns="http://www.opengis.net/kml/2.2">
  <Document>
    <name>${r}</name>
    <Style id="track">
      <LineStyle>
        <color>ff0000ff</color>
        <width>4</width>
      </LineStyle>
    </Style>
    <Placemark>
      <name>${r}</name>
      <styleUrl>#track</styleUrl>
      <LineString>
        <coordinates>`,l=t.filter(o=>typeof o.Coordenada_X=="number"&&typeof o.Coordenada_Y=="number"&&!isNaN(o.Coordenada_X)&&!isNaN(o.Coordenada_Y)).map(o=>`${o.Coordenada_X},${o.Coordenada_Y},0`).join(`
`);return a+l+`</coordinates>
      </LineString>
    </Placemark>
  </Document>
</kml>`},dS=(t,r)=>{const a=`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="LPR Tracer GPS Export"
     xmlns="http://www.topografix.com/GPX/1/1"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">
  <metadata>
    <name>${r}</name>
    <time>${new Date().toISOString()}</time>
  </metadata>
  <trk>
    <name>${r}</name>
    <trkseg>`,l=t.filter(o=>typeof o.Coordenada_X=="number"&&typeof o.Coordenada_Y=="number"&&!isNaN(o.Coordenada_X)&&!isNaN(o.Coordenada_Y)).map(o=>`    <trkpt lat="${o.Coordenada_Y}" lon="${o.Coordenada_X}">
      <time>${o.Fecha_y_Hora}</time>
      ${o.Velocidad?`<speed>${o.Velocidad}</speed>`:""}
    </trkpt>`).join(`
`);return a+l+`
    </trkseg>
  </trk>
</gpx>`},mf=(t,r)=>{const a=new Blob([t],{type:"text/plain"}),l=window.URL.createObjectURL(a),h=document.createElement("a");h.href=l,h.download=r,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(l)},hS=({casoId:t,puntoSeleccionado:r})=>{var ma;const a=g.useRef(null),[l,h]=g.useState([]),[o,c]=g.useState(!1),[d,f]=g.useState([]),[m,y]=g.useState({nombre:"",color:"#228be6"}),[_,S]=g.useState(!1),[b,T]=g.useState(!1),[z,J]=g.useState(null),[F,te]=g.useState(!0),[re,O]=g.useState(null),[ce,xe]=g.useState({primero:null,ultimo:null}),[Ee,Le]=g.useState(!0),[ge,pe]=g.useState("filtros"),[ae,me]=g.useState(null),[Ce,Pe]=g.useState(!1),[xt,Ye]=g.useState(null),[jt,bt]=g.useState(!1),[Dt,rt]=g.useState(!1),[q,ke]=g.useState({fechaInicio:"",horaInicio:"",fechaFin:"",horaFin:"",velocidadMin:null,velocidadMax:null,duracionParada:null,zonaSeleccionada:null}),[G,K]=g.useState({visualizationType:"standard",showHeatmap:!0,showPoints:!1,optimizePoints:!1,enableClustering:!1}),[W,he]=g.useState([]),[de,De]=g.useState(null),[Ne,Ve]=g.useState(!1),[at,Ke]=g.useState([]),[Vt,E]=g.useState(!1),[H,je]=g.useState(null),[oe,Re]=g.useState(!1),[Mt,vt]=g.useState(!1),[Je,dt]=g.useState(!1),[St,D]=g.useState(!1),[fe,Ae]=g.useState(!1),[Oe,Fe]=g.useState(!1),[Qe,Bt]=g.useState(4),[Lt,I]=g.useState(0),[$,Q]=g.useState(null),ue=[40.416775,-3.70379],[It,Nt]=g.useState(ue),[st,tn]=g.useState(10);g.useEffect(()=>{t&&(async()=>{try{const k=await BC(t);Ke(k)}catch{Ke([])}})()},[t]);const Cn=k=>{if(!k)return;D(!1);const N=at.find(we=>we.id_lectura===k.ID_Lectura);O(k),je(N||{id_lectura:k.ID_Lectura,titulo:"",descripcion:"",fecha_hora:k.Fecha_y_Hora,icono:"pin",color:"#228be6",coordenada_x:k.Coordenada_X,coordenada_y:k.Coordenada_Y}),E(!0)},U=async()=>{if(H){Re(!0);try{if("id"in H&&H.id){const k=await HC(t,H.id,H);Ke(N=>N.map(we=>we.id===k.id?k:we))}else{const k=await NC(t,H);Ke(N=>[...N,k])}E(!1)}catch{}finally{Re(!1)}}},$e=async()=>{if(!(!H||!("id"in H)||!H.id))try{await GC(t,H.id),Ke(k=>k.filter(N=>N.id!==H.id)),E(!1)}catch{}};Tf([["Escape",()=>b&&T(!1)]]),g.useEffect(()=>{t&&(Ve(!0),wt.get(`/casos/${t}/matriculas_gps`).then(k=>{const N=k.data||[];he(N.map(we=>({value:we,label:we})))}).catch(()=>{he([])}).finally(()=>{Ve(!1)}))},[t]),g.useEffect(()=>{h([])},[t]);const ot=g.useCallback(async()=>{if(!de)return;c(!0);const k="gps-loading";ie.show({id:k,title:"Cargando datos GPS...",message:"Obteniendo lecturas GPS para el mapa.",color:"blue",autoClose:!1,withCloseButton:!1,loading:!0});try{let N=q.fechaInicio||void 0,we=q.horaInicio||void 0,ht=q.fechaFin||void 0,_t=q.horaFin||void 0;if(N&&!we&&(we="00:00"),ht&&!_t&&(_t="23:59"),N&&ht&&N===ht&&we&&_t&&_t<we){const An=new Date(ht);An.setDate(An.getDate()+1),ht=An.toISOString().slice(0,10)}N||(we=void 0),ht||(_t=void 0);const dn=`${t}_${de}_${N}_${we}_${ht}_${_t}_${q.velocidadMin}_${q.velocidadMax}_${q.duracionParada}_${JSON.stringify(q.zonaSeleccionada)}`,Wn=lc.getLecturas(t,dn);if(Wn){Wn.length>2e3&&!Dt?(Ye(Wn),Pe(!0)):h(Wn),ie.update({id:k,title:"Datos GPS cargados",message:`Se han cargado ${Wn.length} lecturas GPS.`,color:"green",autoClose:2e3,loading:!1});return}const hr=await np(t,{fecha_inicio:N,hora_inicio:we,fecha_fin:ht,hora_fin:_t,velocidad_min:q.velocidadMin!==null?q.velocidadMin:void 0,velocidad_max:q.velocidadMax!==null?q.velocidadMax:void 0,duracion_parada:q.duracionParada!==null?q.duracionParada:void 0,zona_seleccionada:q.zonaSeleccionada||void 0,matricula:de});hr.length>2e3&&!Dt?(Ye(hr),Pe(!0)):(h(hr),lc.setLecturas(t,dn,hr),ie.update({id:k,title:"Datos GPS cargados",message:`Se han cargado ${hr.length} lecturas GPS.`,color:"green",autoClose:2e3,loading:!1}))}catch(N){console.error("Error al filtrar lecturas GPS:",N),ie.update({id:k,title:"Error",message:"No se pudieron cargar los datos GPS.",color:"red",autoClose:4e3,loading:!1})}finally{c(!1)}},[t,q,de,Dt]),Jt=g.useCallback(k=>{ke(N=>({...N,...k})),rt(!1)},[]),jr=g.useCallback(()=>{ke({fechaInicio:"",horaInicio:"",fechaFin:"",horaFin:"",velocidadMin:null,velocidadMax:null,duracionParada:null,zonaSeleccionada:null}),rt(!1),de?ot():h([])},[ot,de]);g.useEffect(()=>{rt(!1)},[de]);const Lr=()=>{h([]),y({nombre:"",color:"#228be6"}),S(!1),J(null),ke({fechaInicio:"",horaInicio:"",fechaFin:"",horaFin:"",velocidadMin:null,velocidadMax:null,duracionParada:null,zonaSeleccionada:null}),De(null)};an.divIcon({className:"custom-div-icon",html:'<div style="background: #228be6; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 4px rgba(0,0,0,0.4);"></div>',iconSize:[12,12],iconAnchor:[6,6]});const En=()=>{const k=Array.isArray(l)&&l.length>0?l.find(N=>typeof N.Coordenada_Y=="number"&&typeof N.Coordenada_X=="number"&&!isNaN(N.Coordenada_Y)&&!isNaN(N.Coordenada_X)):null;return k?{center:[k.Coordenada_Y,k.Coordenada_X],zoom:13}:{center:[40.416775,-3.70379],zoom:10}};g.useRef(En());const[qs]=g.useState(()=>Date.now()),[kr,Na]=g.useState(null),[Mr,Kr]=g.useState(!1),dr=async()=>{if(Na(null),!m.nombre)return;Kr(!0);const k={nombre:m.nombre,color:m.color||"#228be6",activa:!0,lecturas:l,filtros:{...q},descripcion:m.descripcion||""};try{const N=await $C(t,k);f(we=>[...we,{...N,descripcion:N.descripcion||""}]),h([]),y({nombre:"",color:"#228be7"}),S(!1),J(null)}catch(N){Na((N==null?void 0:N.message)||"Error al guardar la capa")}finally{Kr(!1)}},Ha=k=>{const N=d.find(we=>we.id===k);N&&(y({nombre:N.nombre,color:N.color,descripcion:N.descripcion}),J(k),S(!0))},Ga=async()=>{if(z===null||!m.nombre)return;const k=d.find(we=>we.id===z);if(!k)return;const N={...k,nombre:m.nombre,color:m.color||"#228be6",descripcion:m.descripcion||""};try{const we=await vh(t,z,N);f(ht=>ht.map(_t=>_t.id===z?{..._t,...we,descripcion:we.descripcion||""}:_t))}catch{}y({nombre:"",color:"#228be6"}),J(null),S(!1)},pa=async k=>{const N=d.find(ht=>ht.id===k);if(!N)return;const we={...N,activa:!N.activa};try{const ht=await vh(t,k,we);f(_t=>_t.map(dn=>dn.id===k?{...dn,activa:ht.activa}:dn)),$===k&&!ht.activa&&(Fe(!1),Q(null),I(0))}catch(ht){console.error("Error al actualizar el estado de la capa:",ht)}},Xs=async k=>{try{await OC(t,k),f(N=>N.filter(we=>we.id!==k))}catch{}};function Ua(k){const N=[];return k&&k.vehiculoObjetivo?N.push(k.vehiculoObjetivo):k.matricula&&N.push(k.matricula),k.fechaInicio&&N.push(k.fechaInicio.split("-").reverse().join("/")),k.duracionParada&&N.push(`Paradas ${k.duracionParada}min`),k.velocidadMin&&N.push(`> ${k.velocidadMin}km/h`),k.velocidadMax&&N.push(`< ${k.velocidadMax}km/h`),N.join(", ")}const[Ks,Jr]=g.useState(0),Qr=g.useRef();g.useEffect(()=>{if(Oe&&$!==null){const k=d.find(dn=>dn.id===$);if(!k)return;const N=1e3/Qe,we=Date.now();let ht=0;const _t=()=>{const dn=Date.now()-we,Wn=Math.min(dn/N,1),An=(fr=>1-Math.pow(1-fr,3))(Wn);Math.abs(An-ht)>.02&&(Jr(An),ht=An),Wn>=1?I(fr=>fr>=k.lecturas.length-1?(Fe(!1),Jr(0),fr):fr+1):Qr.current=requestAnimationFrame(_t)};Qr.current=requestAnimationFrame(_t)}return()=>{Qr.current&&cancelAnimationFrame(Qr.current)}},[Oe,Qe,$,d,Lt]),g.useEffect(()=>{Jr(0)},[Lt]);const Ir=g.useCallback(()=>{if($===null)return;const k=d.find(we=>we.id===$);if(!k||!k.lecturas[Lt])return;const N=k.lecturas[Lt];a.current&&typeof N.Coordenada_Y=="number"&&typeof N.Coordenada_X=="number"&&a.current.setView([N.Coordenada_Y,N.Coordenada_X],a.current.getZoom())},[$,d,Lt]);g.useEffect(()=>{Ir()},[Lt,Ir]);const[ga,Va]=g.useState(1.65);g.useEffect(()=>{if(!b)return;const k=N=>{N.key==="Escape"&&T(!1)};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[b]),g.useEffect(()=>{async function k(){try{const N=await RC(t);f(N)}catch{f([])}}k()},[t]);const[Er,Za]=g.useState(null),ms=g.useCallback(k=>{Za(k)},[]),Wa=g.useCallback(()=>{Za(null)},[]),nn=g.useMemo(()=>{if(!Er)return l;const k=Er.toGeoJSON().geometry;return l.filter(N=>{if(N.Coordenada_X==null||N.Coordenada_Y==null)return!1;try{const we=py([N.Coordenada_X,N.Coordenada_Y]);return gy(we,k)}catch{return!1}})},[l,Er]);g.useEffect(()=>{if(nn.length===0){xe({primero:null,ultimo:null});return}const k=nn.filter(_t=>_t.Coordenada_X!=null&&_t.Coordenada_Y!=null&&!isNaN(_t.Coordenada_X)&&!isNaN(_t.Coordenada_Y)&&_t.Fecha_y_Hora);if(k.length===0){xe({primero:null,ultimo:null});return}const N=[...k].sort((_t,dn)=>new Date(_t.Fecha_y_Hora).getTime()-new Date(dn.Fecha_y_Hora).getTime()),we=N[0],ht=N[N.length-1];xe({primero:we,ultimo:ht}),we&&a.current&&(console.log(`Centrando mapa en primer punto: Lat ${we.Coordenada_Y}, Lng ${we.Coordenada_X}`),a.current.flyTo([we.Coordenada_Y,we.Coordenada_X],16))},[nn]);const xs=g.useCallback((k,N)=>{me(k),O(N),a.current&&typeof N.Coordenada_Y=="number"&&typeof N.Coordenada_X=="number"&&a.current.flyTo([N.Coordenada_Y,N.Coordenada_X],16)},[]),ar=[{id:"filtros",icon:Uy,label:"Filtros",color:"#228be6"},{id:"mapa",icon:rr,label:"Mapa",color:"#40c057"},{id:"capas",icon:uC,label:"Capas",color:"#fd7e14"},{id:"navegacion",icon:tC,label:"Navegación",color:"#7c2d12"},{id:"posiciones",icon:Dc,label:"Posiciones",color:"#6741d9"},{id:"exportar",icon:po,label:"Exportar",color:"#e64980"}],Ar=()=>{switch(ge){case"filtros":return s.jsxs(ct,{gap:"md",children:[s.jsx(Ie,{style:{height:16}}),s.jsx(Wt,{order:4,children:"Filtros y Análisis"}),s.jsx($a,{label:"Vehículo Objetivo",placeholder:"Selecciona matrícula",data:W,value:de,onChange:De,searchable:!0,clearable:!0,disabled:Ne,leftSection:s.jsx(Sr,{size:18})}),s.jsxs(ct,{gap:"md",children:[s.jsxs(X,{grow:!0,children:[s.jsx(Xe,{label:"Fecha Inicio",type:"date",value:q.fechaInicio,onChange:k=>Jt({fechaInicio:k.target.value})}),s.jsx(Xe,{label:"Hora Inicio",type:"time",value:q.horaInicio,onChange:k=>Jt({horaInicio:k.target.value})})]}),s.jsxs(X,{grow:!0,children:[s.jsx(Xe,{label:"Fecha Fin",type:"date",value:q.fechaFin,onChange:k=>Jt({fechaFin:k.target.value})}),s.jsx(Xe,{label:"Hora Fin",type:"time",value:q.horaFin,onChange:k=>Jt({horaFin:k.target.value})})]}),s.jsxs(X,{grow:!0,children:[s.jsx(Vr,{label:"Velocidad Mínima (km/h)",value:q.velocidadMin||"",onChange:k=>Jt({velocidadMin:k===""?null:Number(k)}),min:0}),s.jsx(Vr,{label:"Velocidad Máxima (km/h)",value:q.velocidadMax||"",onChange:k=>Jt({velocidadMax:k===""?null:Number(k)}),min:0})]}),s.jsx(Vr,{label:"Detección de Paradas",value:q.duracionParada||"",onChange:k=>Jt({duracionParada:k===""?null:Number(k)}),min:0})]}),s.jsxs(X,{grow:!0,mt:"md",children:[s.jsx(Me,{variant:"outline",color:"#234be7",leftSection:s.jsx(Jy,{size:18}),onClick:jr,style:{fontWeight:500},children:"Limpiar"}),s.jsx(Me,{variant:"filled",color:"#234be7",leftSection:s.jsx(ur,{size:18}),onClick:ot,style:{fontWeight:700},children:"Aplicar"})]}),s.jsx(Me,{variant:"light",color:"red",fullWidth:!0,onClick:Lr,children:"Limpiar Mapa"})]});case"mapa":return s.jsxs(ct,{gap:"md",children:[s.jsx(Ie,{style:{height:16}}),s.jsx(Wt,{order:4,children:"Controles del Mapa"}),s.jsx($a,{label:"Tipo de Visualización",value:G.visualizationType,onChange:k=>{(k==="standard"||k==="satellite"||k==="cartodb-light")&&K(N=>({...N,visualizationType:k}))},data:[{value:"standard",label:"Estándar"},{value:"satellite",label:"Satélite"},{value:"cartodb-light",label:"CartoDB Light"}]}),s.jsx(br,{label:"Mostrar mapa de calor",checked:G.showHeatmap,onChange:k=>K(N=>({...N,showHeatmap:k.currentTarget.checked}))}),s.jsx(br,{label:"Mostrar puntos individuales",checked:G.showPoints,onChange:k=>K(N=>({...N,showPoints:k.currentTarget.checked}))}),s.jsx(br,{label:"Optimizar puntos (reduce densidad)",checked:G.optimizePoints,onChange:k=>K(N=>({...N,optimizePoints:k.currentTarget.checked})),description:"Elimina puntos redundantes manteniendo los importantes"}),s.jsx(br,{label:"Agrupar puntos cercanos",checked:G.enableClustering,onChange:k=>K(N=>({...N,enableClustering:k.currentTarget.checked})),description:"Agrupa puntos cercanos en clusters para mejor visualización"}),s.jsx(Y,{size:"xs",mt:8,mb:-8,fw:500,children:"Intensidad Heatmap"}),s.jsx(Fc,{min:1.25,max:5,step:.01,value:ga,onChange:Va,marks:[{value:1.25,label:"1.25"},{value:1.65,label:"1.65"},{value:3,label:"3"},{value:5,label:"5"}],style:{marginTop:12}})]});case"capas":return s.jsxs(ct,{gap:"md",children:[s.jsx(Ie,{style:{height:16}}),s.jsx(Wt,{order:4,children:"Gestión de Capas"}),l.length>0&&(_?s.jsxs(ct,{gap:"sm",children:[s.jsx(Xe,{label:"Nombre de la capa",value:m.nombre,onChange:k=>y(N=>({...N,nombre:k.target.value})),placeholder:"Ej: Trayecto 1"}),s.jsx(Pc,{label:"Color de la capa",value:m.color,onChange:k=>y(N=>({...N,color:k})),format:"hex"}),s.jsx(Xe,{label:"Descripción de la capa",value:m.descripcion,onChange:k=>y(N=>({...N,descripcion:k.target.value})),placeholder:"Descripción de la capa"}),s.jsxs(X,{justify:"flex-end",children:[s.jsxs(Me,{variant:"light",color:"gray",onClick:()=>{S(!1),J(null)},children:[s.jsx(fs,{size:16,style:{marginRight:8}}),"Cancelar"]}),z!==null?s.jsxs(Me,{onClick:Ga,disabled:!m.nombre,children:[s.jsx(Aa,{size:16,style:{marginRight:8}}),"Actualizar capa"]}):s.jsxs(Me,{onClick:dr,loading:Mr,disabled:!m.nombre,children:[s.jsx(Aa,{size:16,style:{marginRight:8}}),"Guardar en capa"]})]}),kr&&s.jsx(Pa,{color:"red",mt:"sm",children:kr})]}):s.jsxs(Me,{fullWidth:!0,variant:"light",color:"blue",onClick:()=>{y(k=>({...k,nombre:Ua({...q,vehiculoObjetivo:de})})),S(!0)},children:[s.jsx(Af,{size:16,style:{marginRight:8}}),"Guardar resultados en capa"]})),s.jsx(Ur,{}),s.jsxs(ct,{gap:"xs",children:[d.map(k=>s.jsx(lS,{capa:k,handleToggleCapa:pa,handleEditarCapa:Ha,handleEliminarCapa:Xs},k.id)),d.length===0&&s.jsx(Y,{size:"sm",c:"dimmed",ta:"center",py:"md",children:"No hay capas creadas. Aplica un filtro y guárdalo en una capa."})]})]});case"navegacion":return s.jsxs(ct,{gap:"md",children:[s.jsx(Ie,{style:{height:16}}),s.jsx(Wt,{order:4,children:"Localizaciones de Interés"}),s.jsx(X,{justify:"flex-end",children:s.jsx(br,{checked:F,onChange:k=>te(k.currentTarget.checked),label:F?"Mostrar":"Ocultar",size:"sm",color:"#234be7"})}),s.jsx(Q1,{in:Vt&&!!H,children:Vt&&H&&s.jsx(iS,{localizacionActual:H,setLocalizacionActual:je,setModalAbierto:E,setFormFocused:vt,handleGuardarLocalizacion:U,handleEliminarLocalizacion:$e,localizaciones:at})}),s.jsxs(ct,{gap:"xs",children:[at.length===0&&s.jsx(Y,{size:"sm",c:"dimmed",children:"No hay localizaciones guardadas."}),at.map(k=>s.jsx(oS,{loc:k,setLocalizacionActual:je,setModalAbierto:E,handleEliminarLocalizacion:$e},k.id_lectura))]}),s.jsx(Ur,{}),s.jsx(cS,{capas:d,onPlay:()=>Fe(!0),onPause:()=>Fe(!1),onStop:()=>{Fe(!1),I(0)},onSpeedChange:Bt,isPlaying:Oe,currentSpeed:Qe,currentIndex:Lt,onIndexChange:I,selectedLayerId:$,onLayerChange:Q})]});case"posiciones":return s.jsxs(ct,{gap:"md",children:[s.jsx(Ie,{style:{height:16}}),s.jsxs(X,{justify:"space-between",children:[s.jsx(Wt,{order:4,children:"Tabla de Posiciones"}),s.jsxs(Mn,{variant:"light",color:"blue",children:[nn.length," posiciones"]})]}),nn.length===0?s.jsx(Y,{size:"sm",c:"dimmed",ta:"center",py:"xl",children:"No hay posiciones para mostrar. Aplica filtros para cargar datos GPS."}):s.jsx(Gs,{h:400,children:s.jsxs(se,{striped:!0,highlightOnHover:!0,withTableBorder:!0,children:[s.jsx(se.Thead,{children:s.jsxs(se.Tr,{children:[s.jsx(se.Th,{children:"#"}),s.jsx(se.Th,{children:"Fecha/Hora"}),s.jsx(se.Th,{children:"Velocidad"}),s.jsx(se.Th,{children:"Coordenadas"})]})}),s.jsx(se.Tbody,{children:nn.filter(k=>k.Coordenada_X!=null&&k.Coordenada_Y!=null).sort((k,N)=>new Date(k.Fecha_y_Hora).getTime()-new Date(N.Fecha_y_Hora).getTime()).map((k,N)=>{var we,ht,_t;return s.jsxs(se.Tr,{onClick:()=>xs(N,k),style:{cursor:"pointer",backgroundColor:ae===N?"var(--mantine-color-blue-0)":void 0},children:[s.jsx(se.Td,{children:s.jsx(Mn,{size:"sm",variant:ae===N?"filled":"light",color:ae===N?"blue":"gray",children:N+1})}),s.jsx(se.Td,{children:s.jsx(Y,{size:"sm",children:Tt(k.Fecha_y_Hora).format("DD/MM HH:mm:ss")})}),s.jsx(se.Td,{children:s.jsxs(Mn,{variant:"outline",color:"orange",size:"sm",children:[((we=k.Velocidad)==null?void 0:we.toFixed(1))||"0"," km/h"]})}),s.jsx(se.Td,{children:s.jsxs(Y,{size:"xs",c:"dimmed",children:[(ht=k.Coordenada_Y)==null?void 0:ht.toFixed(6),", ",(_t=k.Coordenada_X)==null?void 0:_t.toFixed(6)]})})]},`${k.ID_Lectura}-${N}`)})})]})}),ae!==null&&s.jsxs(zt,{p:"sm",withBorder:!0,children:[s.jsxs(Y,{size:"sm",fw:500,children:["Posición ",ae+1," seleccionada"]}),s.jsx(Me,{size:"xs",variant:"light",onClick:()=>me(null),mt:"xs",children:"Deseleccionar"})]})]});case"exportar":return s.jsxs(ct,{gap:"md",children:[s.jsx(Ie,{style:{height:16}}),s.jsx(Wt,{order:4,children:"Exportar Datos"}),s.jsxs(ct,{gap:"md",children:[s.jsxs(X,{grow:!0,children:[s.jsx(Me,{leftSection:s.jsx(hc,{size:18}),color:"blue",variant:"filled",onClick:()=>{const k=uS(l,`GPS_Track_${new Date().toISOString().split("T")[0]}`);mf(k,`gps_track_${new Date().toISOString().split("T")[0]}.kml`)},disabled:l.length===0,children:"Exportar KML"}),s.jsx(Me,{leftSection:s.jsx(hc,{size:18}),color:"blue",variant:"light",onClick:()=>{const k=dS(l,`GPS_Track_${new Date().toISOString().split("T")[0]}`);mf(k,`gps_track_${new Date().toISOString().split("T")[0]}.gpx`)},disabled:l.length===0,children:"Exportar GPX"})]}),s.jsx(Ur,{}),s.jsxs(ct,{gap:"sm",children:[s.jsx(Y,{size:"sm",fw:500,children:"Capturas de Pantalla"}),s.jsx(Me,{leftSection:s.jsx(go,{size:18}),variant:"outline",onClick:async()=>{var N;const k=(N=document.querySelector(".leaflet-container"))==null?void 0:N.parentElement;k&&fo(k,{useCORS:!0,backgroundColor:null}).then(we=>{const ht=document.createElement("a");ht.download="captura-mapa-gps.png",ht.href=we.toDataURL("image/png"),ht.click()})},children:"Capturar Mapa"})]}),s.jsx(Ur,{}),s.jsxs(ct,{gap:"sm",children:[s.jsx(Y,{size:"sm",fw:500,children:"Estadísticas"}),s.jsxs(xo,{cols:2,spacing:"xs",children:[s.jsxs(zt,{p:"xs",withBorder:!0,children:[s.jsx(Y,{size:"xs",c:"dimmed",children:"Total Puntos"}),s.jsx(Y,{size:"lg",fw:700,children:l.length})]}),s.jsxs(zt,{p:"xs",withBorder:!0,children:[s.jsx(Y,{size:"xs",c:"dimmed",children:"Capas Creadas"}),s.jsx(Y,{size:"lg",fw:700,children:d.length})]}),s.jsxs(zt,{p:"xs",withBorder:!0,children:[s.jsx(Y,{size:"xs",c:"dimmed",children:"Localizaciones"}),s.jsx(Y,{size:"lg",fw:700,children:at.length})]}),s.jsxs(zt,{p:"xs",withBorder:!0,children:[s.jsx(Y,{size:"xs",c:"dimmed",children:"Vehículos"}),s.jsx(Y,{size:"lg",fw:700,children:W.length})]})]})]})]})]});default:return null}};return b?s.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"white",zIndex:9999},children:[s.jsxs("div",{style:{position:"absolute",top:24,right:32,zIndex:2e4,display:"flex",gap:12},children:[s.jsx(We,{variant:"default",size:48,style:{width:48,height:48,background:"white",border:"2px solid #234be7",color:"#234be7",boxShadow:"none",fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",padding:0,zIndex:20001},onClick:async()=>{var we;const k=(we=document.querySelector(".leaflet-container"))==null?void 0:we.parentElement;if(!k)return;const N=document.getElementById("camera-capture-btn-fullscreen");N&&(N.style.visibility="hidden"),await new Promise(ht=>setTimeout(ht,50)),fo(k,{useCORS:!0,backgroundColor:null}).then(ht=>{N&&(N.style.visibility="visible");const _t=document.createElement("a");_t.download="captura-mapa-gps.png",_t.href=ht.toDataURL("image/png"),_t.click()})},id:"camera-capture-btn-fullscreen","aria-label":"Exportar captura de pantalla",children:s.jsx(go,{size:28,color:"#234be7"})}),s.jsx(In,{label:"Salir de pantalla completa",position:"left",withArrow:!0,children:s.jsx(We,{variant:"filled",color:"blue",size:56,style:{width:56,height:56,background:"#234be7",border:"3px solid #234be7",color:"white",boxShadow:"0 0 16px #234be7",fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",padding:0,zIndex:20001},onClick:()=>T(!1),"aria-label":"Salir de pantalla completa",children:s.jsx(qf,{size:32,color:"white"})})})]}),s.jsx(zt,{withBorder:!0,style:{height:"100vh",minHeight:400,width:"100vw"},children:s.jsx(gf,{ref:a,lecturas:nn,capas:d,localizaciones:at,mapControls:G,mostrarLocalizaciones:F,onGuardarLocalizacion:Cn,playbackLayer:$!==null&&d.find(k=>k.id===$)||null,currentPlaybackIndex:Lt,fullscreenMap:b,puntoSeleccionado:r,heatmapMultiplier:ga,drawnShape:Er,onShapeDrawn:ms,onShapeDeleted:Wa,primerPunto:ce.primero,ultimoPunto:ce.ultimo})})]}):s.jsxs(Ie,{children:[s.jsx(Zr,{opened:Ce,onClose:()=>{Pe(!1),Ye(null)},title:"Advertencia: Gran cantidad de datos",centered:!0,children:s.jsxs(ct,{children:[s.jsxs(Y,{children:["La búsqueda ha encontrado ",xt==null?void 0:xt.length," puntos, lo que puede ralentizar significativamente el sistema."]}),s.jsxs(Y,{size:"sm",c:"dimmed",children:["Recomendaciones:",s.jsxs("ul",{children:[s.jsx("li",{children:"Acota el rango de fechas o horas"}),s.jsx("li",{children:"Utiliza el mapa de calor para visualizar grandes conjuntos de datos"}),s.jsx("li",{children:"Considera aplicar filtros adicionales (velocidad, zona, etc.)"}),s.jsx("li",{children:'Activa "Agrupar puntos cercanos" en los controles del mapa'}),s.jsx("li",{children:'Habilita "Optimizar puntos" para reducir la densidad de puntos'})]})]}),s.jsxs(X,{justify:"flex-end",mt:"md",children:[s.jsx(Me,{variant:"light",color:"gray",onClick:()=>{if(xt){h(xt);const k=`${t}_${de}_${q.fechaInicio}_${q.horaInicio}_${q.fechaFin}_${q.horaFin}_${q.velocidadMin}_${q.velocidadMax}_${q.duracionParada}_${JSON.stringify(q.zonaSeleccionada)}`;lc.setLecturas(t,k,xt)}Pe(!1),Ye(null),rt(!0)},children:"Continuar de todos modos"}),s.jsx(Me,{color:"blue",onClick:()=>{Pe(!1),Ye(null),h([]),rt(!0)},children:"Cancelar"})]})]})}),s.jsxs("div",{style:{display:"flex",height:"calc(100vh - 200px)"},children:[s.jsx(Ie,{style:{display:"flex",flexDirection:"column",gap:"4px",padding:"8px 4px",borderRight:"1px solid var(--mantine-color-gray-3)",backgroundColor:"var(--mantine-color-gray-0)"},children:ar.map(k=>{const N=k.icon,we=ge===k.id;return s.jsxs(Ie,{style:{width:40,height:40,border:`2px solid ${we?k.color:"var(--mantine-color-gray-4)"}`,borderRadius:"4px",backgroundColor:we?k.color:"white",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s ease",position:"relative"},onClick:()=>pe(k.id),title:k.label,children:[s.jsx(N,{size:20,color:we?"white":k.color}),we&&s.jsx(Ie,{style:{position:"absolute",right:-2,top:"50%",transform:"translateY(-50%)",width:0,height:0,borderTop:"8px solid transparent",borderBottom:"8px solid transparent",borderLeft:`8px solid ${k.color}`}})]},k.id)})}),s.jsxs(zt,{withBorder:!0,style:{width:Ee?380:60,transition:"width 0.3s ease",display:"flex",flexDirection:"column",borderRight:"1px solid var(--mantine-color-gray-3)"},children:[s.jsxs(X,{justify:Ee?"space-between":"center",p:"md",style:{borderBottom:"1px solid var(--mantine-color-gray-3)"},children:[Ee&&s.jsx(Wt,{order:4,children:((ma=ar.find(k=>k.id===ge))==null?void 0:ma.label)||"Herramientas GPS"}),s.jsx(We,{variant:"subtle",onClick:()=>Le(!Ee),"aria-label":Ee?"Colapsar sidebar":"Expandir sidebar",children:Ee?s.jsx(eC,{size:18}):s.jsx(Qy,{size:18})})]}),Ee&&s.jsx(Gs,{flex:1,p:"md",pt:0,children:Ar()})]}),s.jsxs(Ie,{style:{flex:1,position:"relative"},children:[s.jsxs(X,{justify:"flex-end",gap:"xs",style:{position:"absolute",top:12,right:16,zIndex:1e3},children:[s.jsx(Me,{variant:"outline",size:"xs",color:"blue",onClick:()=>{var k;return(k=a.current)==null?void 0:k.invalidateSize()},leftSection:s.jsx(Eo,{size:16}),children:"Actualizar"}),s.jsx(We,{variant:"default",size:32,style:{background:"white",border:"2px solid #234be7",color:"#234be7"},onClick:()=>T(!0),children:s.jsx(Yf,{size:16})})]}),s.jsx(zt,{withBorder:!0,style:{height:"100%",minHeight:400},children:s.jsx(gf,{ref:a,lecturas:nn,capas:d,localizaciones:at,mapControls:G,mostrarLocalizaciones:F,onGuardarLocalizacion:Cn,playbackLayer:$!==null&&d.find(k=>k.id===$)||null,currentPlaybackIndex:Lt,interpolationProgress:Ks,fullscreenMap:b,puntoSeleccionado:ae!==null?nn[ae]:r,heatmapMultiplier:ga,drawnShape:Er,onShapeDrawn:ms,onShapeDeleted:Wa,primerPunto:ce.primero,ultimoPunto:ce.ultimo})})]})]})]})},xf={matricula:"",fechaInicio:"",horaInicio:"",fechaFin:"",horaFin:"",velocidadMin:"",velocidadMax:""},fS=({casoId:t,onVerEnMapa:r})=>{const[a,l]=g.useState(!0),[h,o]=g.useState([]),[c,d]=g.useState(xf),[f,m]=g.useState(1),[y,_]=g.useState(15),[S,b]=g.useState(0),[T,z]=g.useState({columnAccessor:"Fecha_y_Hora",direction:"desc"}),[J,F]=g.useState([]),[te,re]=g.useState([]),[O,ce]=g.useState([]),xe=[{accessor:"ID_Lectura",title:"ID",textAlign:"right"},{accessor:"Matricula",title:"Matrícula"},{accessor:"Fecha_y_Hora",title:"Fecha y Hora",render:ae=>Tt(ae.Fecha_y_Hora).format("DD/MM/YYYY HH:mm:ss")},{accessor:"Coordenada_Y",title:"Latitud",textAlign:"right"},{accessor:"Coordenada_X",title:"Longitud",textAlign:"right"},{accessor:"Velocidad",title:"Velocidad",textAlign:"right"},{accessor:"actions",title:"Acciones",textAlign:"center",render:ae=>s.jsx(X,{gap:4,justify:"center",children:s.jsx(In,{label:"Ver en mapa",children:s.jsx(We,{variant:"subtle",color:"blue",size:"sm",onClick:()=>r&&r(ae),children:s.jsx(yy,{size:16})})})})}],Ee=g.useCallback(async()=>{l(!0);const ae="datos-gps-loading";ie.show({id:ae,title:"Cargando datos GPS...",message:"Obteniendo lecturas GPS para la tabla.",color:"blue",autoClose:!1,withCloseButton:!1,loading:!0});try{const me=await np(t,{matricula:c.matricula||void 0,fecha_inicio:c.fechaInicio||void 0,hora_inicio:c.horaInicio||void 0,fecha_fin:c.fechaFin||void 0,hora_fin:c.horaFin||void 0,velocidad_min:c.velocidadMin?parseFloat(c.velocidadMin):void 0,velocidad_max:c.velocidadMax?parseFloat(c.velocidadMax):void 0}),Ce=[...new Set(me.map(Ye=>Ye.Matricula))].filter(Ye=>Ye!=null).sort().map(Ye=>({value:Ye,label:Ye}));ce(Ce);const Pe=(f-1)*y,xt=Pe+y;o(me.slice(Pe,xt)),b(me.length),ie.update({id:ae,title:"Datos GPS cargados",message:`Se han cargado ${me.length} lecturas GPS.`,color:"green",autoClose:2e3,loading:!1})}catch(me){console.error("Error fetching GPS data:",me),ie.update({id:ae,title:"Error",message:"No se pudieron cargar los datos GPS.",color:"red",autoClose:4e3,loading:!1})}finally{l(!1)}},[t,c,f,y]);g.useEffect(()=>{t&&Ee()},[t,f,y,Ee]);const Le=(ae,me)=>{d(Ce=>({...Ce,[ae]:me}))},ge=()=>{d(xf),m(1),Ee()},pe=()=>{m(1),Ee()};return s.jsxs(s.Fragment,{children:[s.jsx("style",{children:`
                .mantine-DataTable-noRecords svg,
                .mantine-DataTable-noRecords [class*="noRecordsIcon"],
                .mantine-DataTable-noRecords [data-icon],
                .mantine-DataTable-noRecordsIcon {
                    display: none !important;
                }
                .mantine-DataTable-pagination {
                    margin-top: 0 !important;
                    justify-content: center !important;
                }
                .mantine-DataTable-pagination .mantine-Text-root {
                    display: none !important;
                }
            `}),s.jsx(zt,{shadow:"xs",p:"md",withBorder:!0,style:{height:"auto",minHeight:0},children:s.jsxs(ct,{gap:0,children:[s.jsxs(X,{gap:"xs",align:"flex-end",grow:!0,children:[s.jsx($a,{label:"Matrícula",placeholder:"Seleccionar matrícula...",value:c.matricula,onChange:ae=>Le("matricula",ae||""),data:O,searchable:!0,clearable:!0}),s.jsx(Xe,{label:"Fecha Inicio",type:"date",value:c.fechaInicio,onChange:ae=>Le("fechaInicio",ae.target.value)}),s.jsx(Xe,{label:"Hora Inicio",type:"time",value:c.horaInicio,onChange:ae=>Le("horaInicio",ae.target.value)}),s.jsx(Xe,{label:"Fecha Fin",type:"date",value:c.fechaFin,onChange:ae=>Le("fechaFin",ae.target.value)}),s.jsx(Xe,{label:"Hora Fin",type:"time",value:c.horaFin,onChange:ae=>Le("horaFin",ae.target.value)}),s.jsx(Xe,{label:"Velocidad Mínima",type:"number",placeholder:"km/h",value:c.velocidadMin,onChange:ae=>Le("velocidadMin",ae.target.value)}),s.jsx(Xe,{label:"Velocidad Máxima",type:"number",placeholder:"km/h",value:c.velocidadMax,onChange:ae=>Le("velocidadMax",ae.target.value)}),s.jsx(Me,{variant:"filled",color:"#234be7",leftSection:s.jsx(Yy,{size:16}),onClick:pe,children:"Aplicar Filtros"}),s.jsx(Me,{variant:"light",color:"gray",leftSection:s.jsx(Gf,{size:16}),onClick:ge,children:"Limpiar"})]}),s.jsxs(Ie,{style:{position:"relative",height:"auto",minHeight:0},children:[s.jsx(Ie,{style:{width:"100%",textAlign:"center",fontSize:14,color:"#666",marginBottom:4},children:"Registros por página"}),a&&s.jsx(Ie,{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(255,255,255,0.7)",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:8},children:s.jsx(Lf,{size:"lg",color:"#234be7"})}),s.jsx(Ac,{records:h,columns:xe,withTableBorder:!0,borderRadius:"sm",striped:!0,highlightOnHover:!0,idAccessor:"ID_Lectura",selectedRecords:h.filter(ae=>J.includes(ae.ID_Lectura)),onSelectedRecordsChange:ae=>F(ae.map(me=>me.ID_Lectura)),sortStatus:T,onSortStatusChange:z,page:f,onPageChange:m,totalRecords:S,recordsPerPage:y,onRecordsPerPageChange:_,recordsPerPageOptions:[10,15,20,25,50],noRecordsText:"",verticalSpacing:"xs"})]})]})})]})},Qi=[{id:"analisis-lpr",label:"Lecturas LPR",icon:Sf,section:"lecturas"},{id:"lecturas-relevantes",label:"Lecturas Relevantes",icon:kc,section:"lecturas"},{id:"lanzadera",label:"Análisis Avanzado",icon:qy,section:"lecturas"},{id:"vehiculos",label:"Vehículos",icon:Sr,section:"vehiculos"},{id:"mapa",label:"Mapa",icon:my,section:"vehiculos"},{id:"analisis-gps",label:"Mapa GPS",icon:cC,section:"gps"},{id:"datos-gps",label:"Datos GPS",icon:Dc,section:"gps"},{id:"archivos",label:"Archivos Importados",icon:Vf,section:"archivos"}];function NS(){const{idCaso:t}=wf(),r=t?parseInt(t,10):null,[a,l]=g.useState(null),[h,o]=g.useState(!0),[c,d]=g.useState(null),[f,m]=g.useState([]),[y,_]=g.useState(!0),[S,b]=g.useState(null),[T,z]=g.useState(null),J=ey(),{setActiveCase:F}=ty(),[te,re]=g.useState("analisis-lpr"),[O,ce]=g.useState(null),[xe,Ee]=g.useState(new Set),Le=g.useCallback(D=>{Ee(fe=>{const Ae=new Set(fe);return D.forEach(Oe=>Ae.add(Oe)),Ae})},[]),[ge,pe]=g.useState([]),[ae,me]=g.useState(!0),[Ce,Pe]=g.useState(1),xt=15,[Ye,jt]=g.useState({columnAccessor:"Fecha_y_Hora",direction:"asc"}),[bt,Dt]=g.useState([]),[rt,q]=g.useState(null),[ke,G]=g.useState(""),K=g.useCallback(async()=>{var D;if(r){me(!0);try{const fe=await wt.get("/lecturas",{params:{caso_ids:r,solo_relevantes:!0}});pe(fe.data||[]),console.log("[CasoDetailPage] Lecturas relevantes cargadas:",(D=fe.data)==null?void 0:D.length)}catch(fe){console.error("Error fetching relevant lecturas:",fe),ie.show({title:"Error",message:"No se pudieron cargar las lecturas relevantes.",color:"red"}),pe([])}finally{me(!1)}}},[r]);g.useEffect(()=>{te==="lecturas-relevantes"&&K()},[r,te,K]);const W=D=>{var fe;q(D),G(((fe=D.relevancia)==null?void 0:fe.Nota)||"")},he=()=>{q(null),G("")},de=async()=>{var fe,Ae;if(!rt||!rt.relevancia)return;const D=rt.relevancia.ID_Relevante;me(!0);try{await wt.put(`/lecturas_relevantes/${D}/nota`,{Nota:ke}),ie.show({title:"Éxito",message:"Nota actualizada.",color:"green"}),he(),K()}catch(Oe){ie.show({title:"Error",message:((Ae=(fe=Oe.response)==null?void 0:fe.data)==null?void 0:Ae.detail)||"No se pudo guardar la nota.",color:"red"})}finally{me(!1)}},De=D=>{ds({title:"Confirmar Desmarcar",centered:!0,children:s.jsxs(Y,{size:"sm",children:["¿Seguro que quieres desmarcar esta lectura (",D,") como relevante?"]}),labels:{confirm:"Desmarcar",cancel:"Cancelar"},confirmProps:{color:"red"},onConfirm:async()=>{var fe,Ae;me(!0);try{await wt.delete(`/lecturas/${D}/desmarcar_relevante`),ie.show({title:"Éxito",message:`Lectura ${D} desmarcada.`,color:"green"}),K()}catch(Oe){ie.show({title:"Error",message:((Ae=(fe=Oe.response)==null?void 0:fe.data)==null?void 0:Ae.detail)||"No se pudo desmarcar.",color:"red"})}finally{me(!1)}}})},Ne=()=>{const D=[...bt];D.length!==0&&ds({title:"Confirmar Desmarcar Selección",centered:!0,children:s.jsxs(Y,{size:"sm",children:["¿Estás seguro de desmarcar ",D.length," lecturas seleccionadas?"]}),labels:{confirm:"Desmarcar Seleccionadas",cancel:"Cancelar"},confirmProps:{color:"red"},onConfirm:async()=>{me(!0);const fe=await Promise.allSettled(D.map(Fe=>wt.delete(`/lecturas/${Fe}/desmarcar_relevante`)));let Ae=0,Oe=0;fe.forEach((Fe,Qe)=>{Fe.status==="fulfilled"?Ae++:(Oe++,console.error(`Error desmarcando ID ${D[Qe]}:`,Fe.reason))}),Ae>0&&ie.show({title:"Desmarcado Completado",message:`${Ae} lecturas desmarcadas.`+(Oe>0?` ${Oe} fallaron.`:""),color:Oe>0?"orange":"green"}),Dt([]),K(),me(!1)}})},Ve=D=>{if(!D.Matricula){ie.show({title:"Error",message:"La lectura no tiene matrícula.",color:"red"});return}ds({title:"Confirmar Guardar Vehículo",centered:!0,children:s.jsxs(Y,{size:"sm",children:["¿Guardar vehículo con matrícula ",D.Matricula,"?"]}),labels:{confirm:"Guardar",cancel:"Cancelar"},confirmProps:{color:"green"},onConfirm:async()=>{var fe,Ae,Oe,Fe;me(!0);try{await wt.post("/vehiculos",{Matricula:D.Matricula}),ie.show({title:"Éxito",message:`Vehículo ${D.Matricula} guardado.`,color:"green"}),Wr.emit("listaVehiculosCambiada")}catch(Qe){((fe=Qe.response)==null?void 0:fe.status)===400||((Ae=Qe.response)==null?void 0:Ae.status)===409?(ie.show({title:"Vehículo Existente",message:`El vehículo ${D.Matricula} ya existe.`,color:"blue"}),Wr.emit("listaVehiculosCambiada")):ie.show({title:"Error",message:((Fe=(Oe=Qe.response)==null?void 0:Oe.data)==null?void 0:Fe.detail)||"No se pudo guardar.",color:"red"})}finally{me(!1)}}})},at=()=>{const D=ge.filter(Ae=>bt.includes(Ae.ID_Lectura)),fe=Array.from(new Set(D.map(Ae=>Ae.Matricula).filter(Ae=>!!Ae)));if(fe.length===0){ie.show({title:"Sin Matrículas",message:"Ninguna lectura seleccionada tiene matrícula válida.",color:"orange"});return}ds({title:"Confirmar Guardar Vehículos",centered:!0,children:s.jsxs(Y,{size:"sm",children:["¿Guardar ",fe.length," vehículo(s) único(s) (",fe.join(", "),")?"]}),labels:{confirm:"Guardar Seleccionados",cancel:"Cancelar"},confirmProps:{color:"green"},onConfirm:async()=>{me(!0);const Ae=await Promise.allSettled(fe.map(Lt=>wt.post("/vehiculos",{Matricula:Lt})));let Oe=0,Fe=0,Qe=0;Ae.forEach(Lt=>{var I,$,Q,ue;Lt.status==="fulfilled"?Oe++:(($=(I=Lt.reason)==null?void 0:I.response)==null?void 0:$.status)===400||((ue=(Q=Lt.reason)==null?void 0:Q.response)==null?void 0:ue.status)===409?Fe++:(Qe++,console.error("Error guardando vehículo:",Lt.reason))});let Bt="";Oe>0&&(Bt+=`${Oe} guardados. `),Fe>0&&(Bt+=`${Fe} ya existían. `),Qe>0&&(Bt+=`${Qe} errores.`),ie.show({title:"Guardar Vehículos Completado",message:Bt.trim(),color:Qe>0?"orange":"green"}),Wr.emit("listaVehiculosCambiada"),Dt([]),me(!1)}})},Ke=g.useCallback(D=>{console.log("Solicitud para ver en mapa GPS:",D),ce(D),re("analisis-gps")},[]),Vt=g.useCallback(async()=>{var D,fe;if(!(!r||isNaN(r))){_(!0),b(null);try{const Ae=await sy(r.toString());m(Ae)}catch(Ae){b(((fe=(D=Ae.response)==null?void 0:D.data)==null?void 0:fe.detail)||Ae.message||"Error al cargar los archivos.")}finally{_(!1)}}},[r]);g.useEffect(()=>{r&&!isNaN(r)?((async()=>{var fe,Ae;o(!0),d(null);try{const Oe=await ay(r);l(Oe)}catch(Oe){d(((Ae=(fe=Oe.response)==null?void 0:fe.data)==null?void 0:Ae.detail)||Oe.message||"Error al cargar detalles del caso.")}finally{o(!1)}})(),Vt()):(l(null),m([]),d("No se proporcionó ID de caso."),b(null),o(!1),_(!1),F(null))},[r,Vt,F]),g.useEffect(()=>{a&&F({id:a.ID_Caso,nombre:a.Nombre_del_Caso})},[a,F]);const E=async D=>{ds({title:"Confirmar Eliminación",centered:!0,children:s.jsxs(Y,{size:"sm",children:["¿Está seguro de que desea eliminar el archivo ID ",s.jsx("strong",{children:D})," y todas sus lecturas asociadas? Esta acción no se puede deshacer."]}),labels:{confirm:"Eliminar Archivo",cancel:"Cancelar"},confirmProps:{color:"red"},onConfirm:async()=>{var fe,Ae;z(D);try{await iy(D),ie.show({title:"Archivo Eliminado",message:`El archivo ID ${D} ha sido eliminado.`,color:"teal"}),await Vt()}catch(Oe){ie.show({title:"Error al Eliminar",message:((Ae=(fe=Oe.response)==null?void 0:fe.data)==null?void 0:Ae.detail)||"No se pudo eliminar el archivo.",color:"red"})}finally{z(null)}}})},[H,je]=g.useState([]),[oe,Re]=g.useState(!1),[Mt,vt]=g.useState(null),Je=g.useCallback(async()=>{var D,fe,Ae;if(r){console.log("[CasoMap] Fetching lecturas para mapa del caso:",r),Re(!0),vt(null);try{const Oe=await wt.get(`/casos/${r}/lectores`);je(Oe.data||[]),console.log("[CasoMap] Lectores LPR cargados:",(D=Oe.data)==null?void 0:D.length)}catch(Oe){console.error("Error fetching map lecturas:",Oe),vt(((Ae=(fe=Oe.response)==null?void 0:fe.data)==null?void 0:Ae.detail)||"No se pudieron cargar los datos para el mapa."),je([])}finally{Re(!1)}}},[r]);g.useEffect(()=>{te==="mapa"&&H.length===0&&!oe&&Je()},[te,H.length,Je]);const dt=async(D,fe)=>{ie.show({title:"Descarga no disponible",message:"La funcionalidad de descarga aún no está implementada en esta página.",color:"orange"})},St=g.useMemo(()=>rt&&rt.relevancia?{ID_Relevante:rt.relevancia.ID_Relevante,Nota:rt.relevancia.Nota}:null,[rt,ge]);return h?s.jsx(Lf,{}):c?s.jsx(Pa,{color:"red",title:"Error al cargar el caso",children:c}):a?s.jsx(mC,{children:s.jsxs(Cy,{fluid:!0,style:{paddingLeft:32,paddingRight:32},children:[s.jsxs(Y,{size:"xl",fw:700,mt:"md",mb:"lg",children:["Panel de Investigación: ",a.Nombre_del_Caso," (",a.Año,")"]}),s.jsx(ct,{gap:"xs",mb:"md",children:s.jsxs(X,{gap:0,align:"flex-start",children:[s.jsxs(Ie,{children:[s.jsx(Y,{fw:500,c:"#2b4fcf",mb:"xs",children:"Análisis sobre Lecturas"}),s.jsx(X,{gap:"xs",children:Qi.filter(D=>D.section==="lecturas").map(D=>s.jsx(Me,{variant:te===D.id?"filled":"light",leftSection:s.jsx(D.icon,{size:16}),onClick:()=>re(D.id),color:"#2b4fcf",children:D.label},D.id))})]}),s.jsx(Ur,{orientation:"vertical",mx:"md"}),s.jsxs(Ie,{children:[s.jsx(Y,{fw:500,c:"violet",mb:"xs",children:"Análisis sobre Vehículos"}),s.jsx(X,{gap:"xs",children:Qi.filter(D=>D.section==="vehiculos").map(D=>s.jsx(Me,{variant:te===D.id?"filled":"light",leftSection:s.jsx(D.icon,{size:16}),onClick:()=>re(D.id),color:"violet",children:D.label},D.id))})]}),s.jsx(Ur,{orientation:"vertical",mx:"md"}),s.jsxs(Ie,{children:[s.jsx(Y,{fw:500,c:"grape",mb:"xs",children:"Análisis GPS"}),s.jsx(X,{gap:"xs",children:Qi.filter(D=>D.section==="gps").map(D=>s.jsx(Me,{variant:te===D.id?"filled":"light",leftSection:s.jsx(D.icon,{size:16}),onClick:()=>re(D.id),color:"grape",children:D.label},D.id))})]}),s.jsx(Ur,{orientation:"vertical",mx:"md"}),s.jsxs(Ie,{children:[s.jsx(Y,{fw:500,mb:"xs",style:{color:"#15803d"},children:"Archivos"}),s.jsx(X,{gap:"xs",children:Qi.filter(D=>D.section==="archivos").map(D=>s.jsx(Me,{variant:te===D.id?"filled":"light",leftSection:s.jsx(D.icon,{size:16}),onClick:()=>re(D.id),color:"#22c55e",children:D.label},D.id))})]})]})}),s.jsxs(Ie,{mt:"lg",style:{position:"relative"},children:[" ",s.jsx(Ie,{style:{display:te==="analisis-lpr"?"block":"none",position:"relative"},children:s.jsx(DC,{casoIdFijo:r,interactedMatriculas:xe,addInteractedMatricula:Le,permitirSeleccionCaso:!1,mostrarTitulo:!1,tipoFuenteFijo:"LPR"})}),s.jsx(Ie,{style:{display:te==="lanzadera"?"block":"none",position:"relative"},children:s.jsx(MC,{casoId:r})}),s.jsx(Ie,{style:{display:te==="lecturas-relevantes"?"block":"none",position:"relative"},children:s.jsx(_C,{lecturas:ge,loading:ae,totalRecords:ge.length,page:Ce,onPageChange:Pe,pageSize:xt,sortStatus:Ye,onSortStatusChange:jt,selectedRecordIds:bt,onSelectionChange:Dt,onEditNota:W,onDesmarcar:De,onDesmarcarSeleccionados:Ne,onGuardarVehiculo:Ve,onGuardarVehiculosSeleccionados:at,onRefresh:K})}),s.jsx(Ie,{style:{display:te==="vehiculos"?"block":"none",position:"relative"},children:s.jsx(yC,{casoId:r})}),s.jsx(Ie,{style:{display:te==="analisis-gps"?"block":"none",position:"relative"},children:s.jsx(hS,{casoId:r,puntoSeleccionado:O})}),s.jsx(Ie,{style:{display:te==="datos-gps"?"block":"none",position:"relative"},children:s.jsx(fS,{casoId:r,onVerEnMapa:Ke})}),s.jsx(Ie,{style:{display:te==="mapa"?"block":"none",position:"relative"},children:s.jsxs(Ie,{style:{position:"relative",height:"500px"},children:[s.jsx(Ra,{visible:oe}),Mt&&s.jsx(Pa,{color:"red",title:"Error en Mapa",children:Mt}),!oe&&!Mt&&s.jsx(PC,{casoId:r})]})}),s.jsxs(Ie,{style:{display:te==="archivos"?"block":"none",position:"relative"},children:[s.jsxs(X,{justify:"space-between",align:"center",mb:"md",children:[s.jsx(Wt,{order:4,children:"Archivos Importados"}),s.jsxs(X,{children:[f.length>0&&s.jsxs(Mn,{variant:"light",color:"blue",children:[f.length," archivo",f.length!==1?"s":""]}),s.jsx(Me,{leftSection:s.jsx(ny,{size:16}),onClick:()=>J("/importar",{state:{preselectedCasoId:r}}),variant:"light",size:"sm",children:"Cargar Nuevos Archivos"})]})]}),s.jsx(Ra,{visible:y}),S&&s.jsx(Pa,{color:"red",title:"Error",mb:"md",children:S}),y?s.jsxs(se,{striped:!0,highlightOnHover:!0,withTableBorder:!0,children:[s.jsx(se.Thead,{children:s.jsxs(se.Tr,{children:[s.jsx(se.Th,{children:"ID"}),s.jsx(se.Th,{children:"Nombre Archivo"}),s.jsx(se.Th,{children:"Tipo"}),s.jsx(se.Th,{children:"Importado"}),s.jsx(se.Th,{children:"Registros"}),s.jsx(se.Th,{children:"Acciones"})]})}),s.jsx(se.Tbody,{children:[...Array(3)].map((D,fe)=>s.jsxs(se.Tr,{children:[s.jsx(se.Td,{children:s.jsx(Y,{c:"dimmed",children:"..."})}),s.jsx(se.Td,{children:s.jsx(Y,{c:"dimmed",children:"Cargando..."})}),s.jsx(se.Td,{children:s.jsx(Y,{c:"dimmed",children:"..."})}),s.jsx(se.Td,{children:s.jsx(Y,{c:"dimmed",children:"..."})}),s.jsx(se.Td,{children:s.jsx(Y,{c:"dimmed",children:"..."})}),s.jsx(se.Td,{children:s.jsx(Y,{c:"dimmed",children:"..."})})]},fe))})]}):f.length>0?s.jsxs(se,{striped:!0,highlightOnHover:!0,withTableBorder:!0,children:[s.jsx(se.Thead,{children:s.jsxs(se.Tr,{children:[s.jsx(se.Th,{children:"ID"}),s.jsx(se.Th,{children:"Nombre Archivo"}),s.jsx(se.Th,{children:"Tipo"}),s.jsx(se.Th,{children:"Importado"}),s.jsx(se.Th,{children:"Registros"}),s.jsx(se.Th,{children:"Acciones"})]})}),s.jsx(se.Tbody,{children:f.sort((D,fe)=>new Date(fe.Fecha_de_Importacion).getTime()-new Date(D.Fecha_de_Importacion).getTime()).map(D=>s.jsxs(se.Tr,{children:[s.jsx(se.Td,{children:D.ID_Archivo}),s.jsx(se.Td,{style:{maxWidth:"400px",wordBreak:"break-word"},children:s.jsx(Y,{style:{whiteSpace:"normal",lineHeight:1.3},children:D.Nombre_del_Archivo})}),s.jsx(se.Td,{children:s.jsx(Mn,{variant:"light",color:D.Tipo_de_Archivo==="LPR"?"green":D.Tipo_de_Archivo==="GPS"?"blue":"orange",children:D.Tipo_de_Archivo})}),s.jsx(se.Td,{children:Tt(D.Fecha_de_Importacion).format("DD/MM/YYYY HH:mm")}),s.jsx(se.Td,{children:s.jsx(Mn,{variant:"outline",color:"gray",children:D.Total_Registros.toLocaleString()})}),s.jsx(se.Td,{children:s.jsxs(X,{gap:4,children:[s.jsx(In,{label:"Descargar",withinPortal:!0,children:s.jsx(We,{variant:"subtle",color:"blue",onClick:()=>dt(D.ID_Archivo,D.Nombre_del_Archivo),children:s.jsx(hc,{size:16})})}),s.jsx(In,{label:"Eliminar",withinPortal:!0,children:s.jsx(We,{variant:"subtle",color:"red",onClick:()=>E(D.ID_Archivo),loading:T===D.ID_Archivo,children:s.jsx(Oa,{size:16})})})]})})]},D.ID_Archivo))})]}):s.jsx(ry,{p:"xl",children:s.jsxs(ct,{align:"center",gap:"sm",children:[s.jsx(Vf,{size:48,color:"#ccc"}),s.jsx(Y,{c:"dimmed",children:"No hay archivos importados para este caso"}),s.jsx(Y,{size:"sm",c:"dimmed",children:'Use el botón "Cargar Nuevos Archivos" para importar datos'})]})})]})]}),s.jsx(xC,{opened:!!rt,onClose:he,lecturaRelevante:St,onSave:async(D,fe)=>{await de()}})]})}):s.jsx(Pa,{color:"orange",children:"Caso no encontrado."})}export{NS as default};
